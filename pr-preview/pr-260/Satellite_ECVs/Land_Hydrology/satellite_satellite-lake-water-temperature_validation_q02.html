
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.5.1. Satellite-Derived Data Insights into Long-Term Lake Temperature Trends &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Land_Hydrology/satellite_satellite-lake-water-temperature_validation_q02';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.6. Ocean" href="../Ocean/Ocean.html" />
    <link rel="prev" title="1.5. Land Hydrology" href="Land_Hydrology.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Land_Hydrology.html">1.5. Land Hydrology</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.5.1. Satellite-Derived Data Insights into Long-Term Lake Temperature Trends</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Land_Hydrology/satellite_satellite-lake-water-temperature_validation_q02.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Land_Hydrology/satellite_satellite-lake-water-temperature_validation_q02.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Satellite-Derived Data Insights into Long-Term Lake Temperature Trends</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-analyzing-the-long-term-trend-in-surface-water-temperature-of-lake-superior">üåç Use case: Analyzing the long-term trend in surface water temperature of Lake Superior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-and-download-data">1. Request and download data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-variables">Set variables</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-data-request">Set the data request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">Download data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">2. Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-lakeid">Plot lakeid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-filtering">Data filtering</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summer-mean-analysis">3. Summer mean analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summer-mean">Summer mean</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#trend-estimation">Trend estimation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-with-noaa-buoy-data">4. Comparison with NOAA buoy data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-linear-trends">Estimation of linear trends</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="satellite-derived-data-insights-into-long-term-lake-temperature-trends">
<h1><span class="section-number">1.5.1. </span>Satellite-Derived Data Insights into Long-Term Lake Temperature Trends<a class="headerlink" href="#satellite-derived-data-insights-into-long-term-lake-temperature-trends" title="Link to this heading">#</a></h1>
<p>Production date: 16-12-2025</p>
<p>Produced by: Amaya Camila Trigoso Barrientos (VUB) and Victor Couplet (VUB)</p>
<section id="use-case-analyzing-the-long-term-trend-in-surface-water-temperature-of-lake-superior">
<h2>üåç Use case: Analyzing the long-term trend in surface water temperature of Lake Superior<a class="headerlink" href="#use-case-analyzing-the-long-term-trend-in-surface-water-temperature-of-lake-superior" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question-s">
<h2>‚ùì Quality assessment question(s)<a class="headerlink" href="#quality-assessment-question-s" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Can satellite data be used to detect the observed increase in summer water temperatures in Lake Superior due to global warming?</strong></p></li>
</ul>
<p>Cases of an increasing trend in lake surface water temperature (LSWT) have been observed in numerous lakes across various regions, including the United States, Europe, and other parts of the world <a class="reference external" href="https://doi.org/10.1038/s41558-024-02122-y" rel="noreferrer" target="_blank">[1]</a> <a class="reference external" href="https://climate.copernicus.eu/lake-surface-temperatures" rel="noreferrer" target="_blank">[2]</a>. For example, Austin and Colman (2008) found that summer LSWT in Lake Superior increased at a rate of (11¬±6)√ó10<sup>-2</sup> ¬∞C/year from 1979 to 2006. They attributed this trend to the earlier retreat of winter ice, which causes the positive overturning period to begin sooner, allowing the lake more time to warm. Their analysis was based on measurements from in-situ buoys <a class="reference external" href="https://doi.org/10.1029/2006GL029021" rel="noreferrer" target="_blank">[3]</a>. Later, the Great Lakes Integrated Sciences and Assessments (GLISA) analyzed the annual mean LSWT of Lake Superior between 1995 and 2021. The increasing long-term trend observed by Austin and Colman was not apparent in the period analyzed by GLISA. However, they noted a shift to higher temperatures after 1998 <a class="reference external" href="https://glisa.umich.edu/lake-superior-retrospective/" rel="noreferrer" target="_blank">[4]</a>. The LSWT data analyzed by GLISA was derived from satellite observations and obtained through the NOAA Great Lakes CoastWatch <a class="reference external" href="https://coastwatch.glerl.noaa.gov/statistics/average-surface-water-temperature-glsea/" rel="noreferrer" target="_blank">[5]</a>. Cannon et al. (2024) investigated summer LSWT of Lake Superior using simulation data over a longer time interval (1980-2021), and found a warming trend of (5.2¬±3.1)√ó10<sup>-2</sup> ¬∞C/year <a class="reference external" href="https://journals.ametsoc.org/view/journals/clim/37/4/JCLI-D-23-0092.1.xml" rel="noreferrer" target="_blank">[6]</a>.</p>
<p>The objective of this assessment is to evaluate whether the <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-lake-water-temperature?tab=overview" rel="noreferrer" target="_blank">satellite-lake-water-temperature</a> dataset from the Climate Data Store (CDS) is suitable for climate change monitoring, using Lake Superior as a case study. We calculated the trend summer LWST for a period of 28 years, from 1995 to 2023, and validated the data and trend computation against in-situ buoy measurements from the NOAA National Buoy Data Center (NBDC) <a class="reference external" href="https://www.ndbc.noaa.gov/" rel="noreferrer" target="_blank">[7]</a>.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>Lake Superior‚Äôs summer LSWT trend over 1995‚Äì2023, derived from the Copernicus satellite lake water temperature dataset, is slightly negative but not statistically significant.</p></li>
<li><p>The¬†<a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-lake-water-temperature?tab=overview" rel="noreferrer" target="_blank">satellite-lake-water-temperature</a> dataset shows good agreement with NOAA in-situ buoy observations at selected locations. Differences in summer mean temperatures are partly attributable to the higher temporal sampling of in-situ measurements and to differences in measurement depth, with satellites observing skin temperature and buoys measuring subsurface temperature (‚âà1 m). Additional discrepancies may result from cloud contamination in the satellite record.</p></li>
<li><p>The dataset is well suited for climate monitoring; however, trend analyses require caution. Elevated summer temperatures in 1998, associated with a strong El Ni√±o event, may obscure longer-term warming signals. Incorporating pre-1995 in-situ observations, where available, would strengthen assessments of long-term trends.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>The analysis and results are organized in the following steps, which are detailed in the sections below:</p>
<p><strong><a class="reference internal" href="#satellite-satellite-lake-water-temperature-validation-q02-section-1"><span class="std std-ref">1. Request and download data</span></a></strong></p>
<ul class="simple">
<li><p>Satellite lake surface water temperature (LSWT) data are downloaded for the summer months (July‚ÄìSeptember) over the period 1995‚Äì2023.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-lake-water-temperature-validation-q02-section-2"><span class="std std-ref">2. Data preprocessing</span></a></strong></p>
<ul class="simple">
<li><p>The dataset is filtered based on quality flags and lake identification to retain only high-quality observations for Lake Superior.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-lake-water-temperature-validation-q02-section-3"><span class="std std-ref">3. Summer mean analysis</span></a></strong></p>
<ul class="simple">
<li><p>A spatially weighted mean LSWT is computed, followed by the calculation of annual summer mean LSWT values.</p></li>
<li><p>The temporal trend is estimated using the Theil‚ÄìSen estimator, and its statistical significance is assessed with the Mann‚ÄìKendall test.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-lake-water-temperature-validation-q02-section-4"><span class="std std-ref">4. Comparison with NOAA buoy data</span></a></strong></p>
<ul class="simple">
<li><p>Satellite LSWT data are validated against in-situ measurements from three NOAA-NBDC buoys located in Lake Superior.</p></li>
<li><p>Performance metrics, including mean bias, mean absolute error (MAE), and root mean square error (RMSE), are calculated.</p></li>
<li><p>Buoy observations are resampled to match the less frequent satellite overpass times. Metrics are then recalculated on these time-matched datasets to determine whether differences in summer means arise from sampling frequency or from measurement characteristics (e.g., sensing depth, retrieval uncertainties).</p></li>
<li><p>Finally, LSWT trends derived from buoy data over multiple periods are computed and compared with satellite-based trends and published literature results.</p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="request-and-download-data">
<span id="satellite-satellite-lake-water-temperature-validation-q02-section-1"></span><h3>1. Request and download data<a class="headerlink" href="#request-and-download-data" title="Link to this heading">#</a></h3>
<section id="import-packages">
<h4>Import packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.feature</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfeature</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.mpl.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cticker</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cbook</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpatches</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.dates</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mdates</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pymannkendall</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mk</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">linregress</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.lines</span><span class="w"> </span><span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">mean_squared_error</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span><span class="o">,</span><span class="w"> </span><span class="nn">gzip</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">io</span><span class="w"> </span><span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="set-variables">
<h4>Set variables<a class="headerlink" href="#set-variables" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time</span>
<span class="n">year_start</span> <span class="o">=</span> <span class="mi">1995</span>
<span class="n">year_stop</span> <span class="o">=</span> <span class="mi">2023</span>

<span class="c1"># Region</span>
<span class="n">lon_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">92.10</span><span class="p">,</span> <span class="o">-</span><span class="mf">84.80</span><span class="p">)</span>
<span class="n">lat_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mf">46.30</span><span class="p">,</span> <span class="mf">49.00</span><span class="p">)</span>

<span class="c1"># Variable</span>
<span class="n">varname</span> <span class="o">=</span> <span class="s2">&quot;lake_surface_water_temperature&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="set-the-data-request">
<h4>Set the data request<a class="headerlink" href="#set-the-data-request" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-lake-water-temperature&quot;</span>
<span class="n">Requests</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">Requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)],</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;07&quot;</span><span class="p">,</span> <span class="s2">&quot;08&quot;</span><span class="p">,</span> <span class="s2">&quot;09&quot;</span><span class="p">],</span>
            <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)],</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;4_5&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2021</span> <span class="k">else</span> <span class="s2">&quot;4_5_2&quot;</span><span class="p">],</span>
        <span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-data">
<h4>Download data<a class="headerlink" href="#download-data" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">Requests</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="n">lon_slice</span><span class="p">,</span> <span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="n">lat_slice</span><span class="p">},</span>
    <span class="n">chunks</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 29/29 [00:00&lt;00:00, 30.79it/s]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="data-preprocessing">
<span id="satellite-satellite-lake-water-temperature-validation-q02-section-2"></span><h3>2. Data preprocessing<a class="headerlink" href="#data-preprocessing" title="Link to this heading">#</a></h3>
<p>We download satellite lake surface temperature data and visualize the water masses over the region spanning 46.30‚Äì49.00¬∞N latitude and 92.10‚Äì84.80¬∞W longitude. In the dataset, Lake Superior is identified by ID number 2. The locations of the three NOAA buoys used for data comparison are also plotted.</p>
<section id="plot-lakeid">
<h4>Plot lakeid<a class="headerlink" href="#plot-lakeid" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lakeid_data</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;lakeid_CCI&#39;</span><span class="p">]</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>

<span class="n">unique_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">lakeid_data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">lakeid_data</span><span class="o">.</span><span class="n">values</span><span class="p">)])</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;tab10&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ids</span><span class="p">))</span>

<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># Buoy coordinates (lon, lat)</span>
<span class="n">buoy_coords</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;45006&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">89.793</span><span class="p">,</span> <span class="mf">47.335</span><span class="p">),</span>
    <span class="s2">&quot;45004&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">86.585</span><span class="p">,</span> <span class="mf">47.585</span><span class="p">),</span>
    <span class="s2">&quot;45001&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">87.793</span><span class="p">,</span> <span class="mf">48.061</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
    <span class="n">lons</span><span class="p">,</span>
    <span class="n">lats</span><span class="p">,</span>
    <span class="n">lakeid_data</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">shading</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># Plot buoys</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">buoy_coords</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">markeredgewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="n">lon</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span>
        <span class="n">name</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">zorder</span><span class="o">=</span><span class="mi">11</span>
    <span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># Longitude / latitude ticks</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">92</span><span class="p">,</span> <span class="o">-</span><span class="mi">84</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">46</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">cticker</span><span class="o">.</span><span class="n">LongitudeFormatter</span><span class="p">())</span>
<span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">cticker</span><span class="o">.</span><span class="n">LatitudeFormatter</span><span class="p">())</span>

<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># ------------------------------------------------------------------</span>
<span class="c1"># Legend for lake IDs</span>
<span class="n">legend_handles</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">mpatches</span><span class="o">.</span><span class="n">Patch</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">(</span><span class="n">i</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_ids</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">uid</span><span class="p">)))</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">uid</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_ids</span><span class="p">)</span>
<span class="p">]</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="o">=</span><span class="n">legend_handles</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Lake ID CCI&quot;</span><span class="p">,</span>
    <span class="n">frameon</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;ID Identification for Lake Superior and Outliers&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/3bf6e7994177c0028ff772cef16a0aca5b2be3ec6d79dc126d9f1efcba90f421.png" src="../../_images/3bf6e7994177c0028ff772cef16a0aca5b2be3ec6d79dc126d9f1efcba90f421.png" />
</div>
</div>
<p><em>Figure 1 : Lake Superior identification in the dataset. Locations of the three NOAA-NBDC buoys used for data comparison are shown as orange crosses.</em></p>
</section>
<section id="data-filtering">
<h4>Data filtering<a class="headerlink" href="#data-filtering" title="Link to this heading">#</a></h4>
<p>Only observations with quality levels 4 (good) and 5 (best) are retained for analysis.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Reindex using lakeids and min_quality_level</span>
<span class="n">lakeid</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lakeid_CCI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;lakeid_CCI&quot;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="s2">&quot;lakeid_CCI&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">min_quality_level</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">4</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;min_quality_level&quot;</span><span class="p">))</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s2">&quot;lakeid_CCI&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lakeid_CCI&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">lakeid</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;lswt_quality_level&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">min_quality_level</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">lakeid_CCI</span><span class="o">=</span><span class="n">lakeid</span><span class="p">,</span> <span class="n">min_quality_level</span><span class="o">=</span><span class="n">min_quality_level</span><span class="p">)</span>

<span class="n">filtered_ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lakeid_CCI</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">min_quality_level</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="summer-mean-analysis">
<span id="satellite-satellite-lake-water-temperature-validation-q02-section-3"></span><h3>3. Summer mean analysis<a class="headerlink" href="#summer-mean-analysis" title="Link to this heading">#</a></h3>
<p>For each time step, lake surface water temperatures are averaged spatially across Lake Superior, and these values are then averaged over the summer months (July‚ÄìSeptember). The 1995‚Äì2023 trend is estimated using the Theil‚ÄìSen estimator, and its statistical significance is assessed with the Mann‚ÄìKendall test.</p>
<section id="summer-mean">
<h4>Summer mean<a class="headerlink" href="#summer-mean" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_mean</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">filtered_ds</span><span class="p">[</span><span class="s2">&quot;lake_surface_water_temperature&quot;</span><span class="p">])</span>
<span class="n">summer_mean</span> <span class="o">=</span> <span class="n">spatial_mean</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="trend-estimation">
<h4>Trend estimation<a class="headerlink" href="#trend-estimation" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">summer_mean</span><span class="o">.</span><span class="n">values</span><span class="o">-</span><span class="mf">273.15</span>
<span class="n">years</span> <span class="o">=</span> <span class="n">summer_mean</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># Run Theil-Sen + Mann-Kendall</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">mk</span><span class="o">.</span><span class="n">original_test</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">slope</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">slope</span>
<span class="n">trend</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">trend</span>
<span class="n">p_value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">p</span>

<span class="c1"># Compute Theil-Sen line for plotting</span>
<span class="n">intercept</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
<span class="n">trend_line</span> <span class="o">=</span> <span class="n">intercept</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># Plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="s1">&#39;o-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Observed temperature&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">trend_line</span><span class="p">,</span> <span class="s1">&#39;C0--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Slope: </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1"> K/year</span><span class="se">\n</span><span class="s1">p-value: </span><span class="si">{</span><span class="n">p_value</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean summer LSWT (K)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Summer LSWT trend in Lake Superior&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/b149a7460194b5c0f5c06a222c27bf6ccd3f840c87717f9ea9442f21f37c137c.png" src="../../_images/b149a7460194b5c0f5c06a222c27bf6ccd3f840c87717f9ea9442f21f37c137c.png" />
</div>
</div>
<p><em>Figure 2 : Mean summer LSWT for Lake Superior between 1995 and 2023, and trend estimation.</em></p>
<p>The trend line in <em>Figure 2</em> shows a slight negative slope of ‚àí0.0032‚ÄØ¬∞C‚ÄØyr‚Åª¬π. However, the p-value of 0.81 is well above the common significance threshold of 0.05, indicating that the trend is not statistically significant. This lack of significance may partly reflect the relatively short 28-year period analyzed, as longer time series are typically required to detect meaningful climate trends in large lakes.</p>
<p>At first glance, the absence of a significant warming trend may seem surprising. Previous work <a class="reference external" href="https://doi.org/10.1029/2006GL029021" rel="noreferrer" target="_blank">[3]</a> reported a significant increase in summer temperatures from 1979 to 2006, and it seems unlikely that summer lake surface temperatures have stabilised since then, given ongoing global warming.</p>
<p>To verify these results, we will compare the satellite data with in-situ buoy measurements.</p>
</section>
</section>
<section id="comparison-with-noaa-buoy-data">
<span id="satellite-satellite-lake-water-temperature-validation-q02-section-4"></span><h3>4. Comparison with NOAA buoy data<a class="headerlink" href="#comparison-with-noaa-buoy-data" title="Link to this heading">#</a></h3>
<p>The satellite data are compared with in-situ measurements from three NOAA NDBC buoys in Lake Superior <a class="reference external" href="https://www.ndbc.noaa.gov/" rel="noreferrer" target="_blank">[7]</a>. These are the same buoys used in <a class="reference external" href="https://doi.org/10.1029/2006GL029021" rel="noreferrer" target="_blank">[3]</a>, which reported a significant increase in summer temperatures from 1979 to 2006. In-situ data are now available through 2024. The goal of this section is thus to compare satellite and buoy data over 1995‚Äì2023 and evaluate whether similar trends are observed in the buoy measurements.</p>
<p>First, the buoy data are downloaded from the NOAA National Data Buoy Center website <a class="reference external" href="https://www.ndbc.noaa.gov/" rel="noreferrer" target="_blank">[7]</a>, which provides data by station and year. We developed a Python script that automatically downloads the data for buoys 45001, 45004, and 45006 for all available years between 1979 and 2024, and combines them into a single, unified dataset.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">parse_noaa_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Parse NOAA stdmet text data.</span>

<span class="sd">    Args:</span>
<span class="sd">        text (str): Raw text from NOAA stdmet file.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: (columns_list, data_lines_str, header_line_index) or (None, None, None) if no header found.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>

    <span class="c1"># Find header: first non-empty line whose first token contains letters</span>
    <span class="n">header_idx</span><span class="p">,</span> <span class="n">header</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
        <span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">ln</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ln</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="n">ch</span><span class="o">.</span><span class="n">isalpha</span><span class="p">()</span> <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">ln</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])),</span>
        <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">header</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

    <span class="n">cols</span> <span class="o">=</span> <span class="n">header</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="c1"># Extract data lines (non-empty, non-comment lines after header)</span>
    <span class="n">data_lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">ln</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">header_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">ln</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">cols</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_lines</span><span class="p">),</span> <span class="n">header_idx</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_noaa_year</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">year</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">15</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load one year of NOAA stdmet data for a given station.</span>

<span class="sd">    Args:</span>
<span class="sd">        station (str): NOAA station ID.</span>
<span class="sd">        year (int): Year to load.</span>
<span class="sd">        timeout (int): Requests timeout in seconds.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Columns [&#39;datetime&#39;, &#39;WTMP&#39;], or None if no usable data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://www.ndbc.noaa.gov/data/historical/stdmet/</span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2">h</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">.txt.gz&quot;</span>
    <span class="c1">#print(f&quot;Downloading {url} ...&quot;, end=&quot; &quot;)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
        <span class="n">r</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">raw</span> <span class="o">=</span> <span class="n">gzip</span><span class="o">.</span><span class="n">decompress</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">content</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;replace&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">tqdm</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> ‚Üí download error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">cols</span><span class="p">,</span> <span class="n">data_text</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">parse_noaa_text</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">cols</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">data_text</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ‚Üí no usable header/data&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
            <span class="n">StringIO</span><span class="p">(</span><span class="n">data_text</span><span class="p">),</span>
            <span class="n">sep</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;\s+&quot;</span><span class="p">,</span>
            <span class="n">names</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">na_values</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MM&quot;</span><span class="p">,</span> <span class="s2">&quot;99.0&quot;</span><span class="p">,</span> <span class="s2">&quot;99&quot;</span><span class="p">,</span> <span class="s2">&quot;999&quot;</span><span class="p">,</span> <span class="s2">&quot;999.0&quot;</span><span class="p">,</span> <span class="s2">&quot;9999&quot;</span><span class="p">],</span>
            <span class="n">comment</span><span class="o">=</span><span class="s2">&quot;#&quot;</span><span class="p">,</span>
            <span class="n">engine</span><span class="o">=</span><span class="s2">&quot;python&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ‚Üí pandas read error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>

    <span class="c1"># Ensure numeric columns for date/time</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;YY&quot;</span><span class="p">,</span> <span class="s2">&quot;YYYY&quot;</span><span class="p">,</span> <span class="s2">&quot;MM&quot;</span><span class="p">,</span> <span class="s2">&quot;DD&quot;</span><span class="p">,</span> <span class="s2">&quot;hh&quot;</span><span class="p">,</span> <span class="s2">&quot;mm&quot;</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>

    <span class="c1"># Determine proper year</span>
    <span class="k">if</span> <span class="s2">&quot;YYYY&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;YYYY&quot;</span><span class="p">]</span>
    <span class="k">elif</span> <span class="s2">&quot;YY&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="ow">or</span> <span class="s2">&quot;#YY&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">yy_col</span> <span class="o">=</span> <span class="s2">&quot;YY&quot;</span> <span class="k">if</span> <span class="s2">&quot;YY&quot;</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">else</span> <span class="s2">&quot;#YY&quot;</span>
        <span class="c1"># If any 4-digit year present, treat as full year</span>
        <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">yy_col</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">len</span><span class="p">()</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">yy_col</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># 2-digit year: &lt;50 -&gt; 2000s, &gt;=50 -&gt; 1900s</span>
            <span class="n">df</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">yy_col</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">2000</span> <span class="o">+</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="mi">50</span> <span class="k">else</span> <span class="mi">1900</span> <span class="o">+</span> <span class="n">x</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ‚Üí no recognizable year column&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Ensure minutes exist</span>
    <span class="k">if</span> <span class="s2">&quot;mm&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Build datetime column</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="nb">dict</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;YEAR&quot;</span><span class="p">],</span> <span class="n">month</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;MM&quot;</span><span class="p">],</span> <span class="n">day</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;DD&quot;</span><span class="p">],</span> <span class="n">hour</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;hh&quot;</span><span class="p">],</span> <span class="n">minute</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;mm&quot;</span><span class="p">]),</span>
            <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; ‚Üí datetime conversion error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Process WTMP</span>
    <span class="k">if</span> <span class="s2">&quot;WTMP&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot; ‚Üí WTMP column missing, skipping&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;coerce&quot;</span><span class="p">)</span>

    <span class="c1"># Build output dataframe and filter invalid/extreme values</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;datetime&quot;</span><span class="p">:</span> <span class="n">dt</span><span class="p">,</span> <span class="s2">&quot;WTMP&quot;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">]})</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">])</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()]</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">[(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">out</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span><span class="p">)]</span>

    <span class="c1">#print(f&quot; ‚Üí loaded {len(out)} rows&quot;)</span>
    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_noaa_range</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="n">start_year</span><span class="o">=</span><span class="mi">1979</span><span class="p">,</span> <span class="n">end_year</span><span class="o">=</span><span class="mi">2024</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load NOAA data for multiple stations and years, with a progress bar.</span>
<span class="sd">    Returns a single DataFrame with a MultiIndex (station, datetime) and column &#39;WTMP&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">total_steps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">end_year</span> <span class="o">-</span> <span class="n">start_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">total</span><span class="o">=</span><span class="n">total_steps</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Overall progress&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">pbar</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">station</span> <span class="ow">in</span> <span class="n">stations</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">({</span><span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="n">station</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">year</span><span class="p">})</span>
                <span class="n">df</span> <span class="o">=</span> <span class="n">load_noaa_year</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">df</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station</span>
                    <span class="n">all_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
                <span class="n">pbar</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">all_data</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No data loaded for any station.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">([[],</span> <span class="p">[]],</span> <span class="n">names</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">)))</span>

    <span class="c1"># Concatenate all data</span>
    <span class="n">full_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">all_data</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Set MultiIndex (station, datetime)</span>
    <span class="n">full_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;datetime&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">full_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total rows loaded: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">full_df</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">full_df</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stations</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;45001&quot;</span><span class="p">,</span><span class="s2">&quot;45004&quot;</span><span class="p">,</span><span class="s2">&quot;45006&quot;</span><span class="p">]</span>
<span class="n">buoy_data</span> <span class="o">=</span> <span class="n">load_noaa_range</span><span class="p">(</span><span class="n">stations</span><span class="p">,</span> <span class="mi">1979</span><span class="p">,</span> <span class="mi">2024</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overall progress:  34%|‚ñà‚ñà‚ñà‚ñç      | 47/138 [00:34&lt;01:21,  1.12it/s, station=45004, year=1980]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ‚Üí download error: 404 Client Error: Not Found for url: https://www.ndbc.noaa.gov/data/historical/stdmet/45004h1979.txt.gz
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overall progress:  67%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñã   | 93/138 [01:09&lt;00:46,  1.03s/it, station=45006, year=1980]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ‚Üí download error: 404 Client Error: Not Found for url: https://www.ndbc.noaa.gov/data/historical/stdmet/45006h1979.txt.gz
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overall progress:  68%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñä   | 94/138 [01:09&lt;00:34,  1.26it/s, station=45006, year=1981]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> ‚Üí download error: 404 Client Error: Not Found for url: https://www.ndbc.noaa.gov/data/historical/stdmet/45006h1980.txt.gz
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Overall progress: 100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 138/138 [01:42&lt;00:00,  1.34it/s, station=45006, year=2024]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Total rows loaded: 958592
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
<p>Second, the buoy data are averaged over the summer months, and each buoy is compared to the summer mean temperature of the nearest satellite pixel corresponding to its location (see <em>Figure 3</em>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compare buoy and satellite summer mean temperatures</span>

<span class="n">summer_months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>  <span class="c1"># JAS</span>


<span class="n">buoy_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">buoy_data</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span>
        <span class="n">year</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">,</span>
        <span class="n">month</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;datetime&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">summer_buoy</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">buoy_df</span>
    <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">buoy_df</span><span class="p">[</span><span class="s2">&quot;month&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">)]</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">as_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">]</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Extract nearest-neighbor satellite temperature at each buoy position,</span>
<span class="c1"># convert from Kelvin to Celsius, and compute summer annual means</span>

<span class="n">sat_records</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">station</span><span class="p">,</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">buoy_coords</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>

    <span class="c1"># Nearest satellite pixel to buoy location</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">filtered_ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Convert from Kelvin to Celsius</span>
    <span class="n">ts_C</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">-</span> <span class="mf">273.15</span>

    <span class="c1"># Restrict to summer months</span>
    <span class="n">ts_summer</span> <span class="o">=</span> <span class="n">ts_C</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ts_C</span><span class="p">[</span><span class="s2">&quot;time.month&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">))</span>

    <span class="c1"># Compute annual summer mean</span>
    <span class="n">ts_summer_mean</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ts_summer</span>
        <span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;sat_WTMP&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="n">ts_summer_mean</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station</span>
    <span class="n">sat_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts_summer_mean</span><span class="p">)</span>

<span class="c1"># Concatenate all stations into a single reusable table</span>
<span class="n">sat_summer</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">sat_records</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="o">.</span><span class="n">sort_values</span><span class="p">([</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">])</span>
<span class="p">)</span>

<span class="c1"># Plot comparison </span>

<span class="n">stations</span> <span class="o">=</span> <span class="n">summer_buoy</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">),</span>
    <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span>
    <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">stations</span><span class="p">):</span>

    <span class="n">s_buoy</span> <span class="o">=</span> <span class="n">summer_buoy</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">summer_buoy</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">st</span><span class="p">]</span>
    <span class="n">s_sat</span>  <span class="o">=</span> <span class="n">sat_summer</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sat_summer</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">st</span><span class="p">]</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">s_buoy</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
        <span class="n">s_buoy</span><span class="p">[</span><span class="s2">&quot;WTMP&quot;</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Buoy&quot;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span>
    <span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">s_sat</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span>
        <span class="n">s_sat</span><span class="p">[</span><span class="s2">&quot;sat_WTMP&quot;</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Satellite&quot;</span><span class="p">,</span>
        <span class="n">color</span> <span class="o">=</span><span class="s1">&#39;C0&#39;</span>
    <span class="p">)</span>

    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">buoy_coords</span><span class="p">[</span><span class="n">st</span><span class="p">]</span>  <span class="c1"># get coordinates</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buoy </span><span class="si">{</span><span class="n">st</span><span class="si">}</span><span class="s2"> (lat: </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">¬∞, lon: </span><span class="si">{</span><span class="n">lon</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">¬∞)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean summer LSWT ¬∞C&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/bed8cbe613721ea37ed54cf864eb47901a57951d33c741b0c3dcdf43d160573b.png" src="../../_images/bed8cbe613721ea37ed54cf864eb47901a57951d33c741b0c3dcdf43d160573b.png" />
</div>
</div>
<p><em>Figure 3: Mean summer LSWT for three Lake Superior buoys, compared to the mean summer LSWT from satellite data at the nearest pixel locations.</em></p>
<p>We observe that the satellite data are generally close to the buoy measurements; for instance, the 1998 peak in summer LSWT is well captured. To further quantify the differences between satellite and buoy data, we compute the mean bias, mean absolute error (MAE), and root mean square error (RMSE).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">compute_sst_validation_metrics</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute satellite-vs-buoy SST validation metrics.</span>

<span class="sd">    Expects columns: [&#39;station&#39;, &#39;year&#39;, &#39;buoy&#39;, &#39;sat&#39;].</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame with per-station metrics and a final &#39;ALL&#39; row</span>
<span class="sd">        containing overall metrics.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">rows</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># ---- Helper to compute metrics for any subset ----</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metrics</span><span class="p">(</span><span class="n">sub</span><span class="p">):</span>
        <span class="n">sat</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;sat&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">buoy</span> <span class="o">=</span> <span class="n">sub</span><span class="p">[</span><span class="s2">&quot;buoy&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">sat</span> <span class="o">-</span> <span class="n">buoy</span>

        <span class="n">bias</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">mae</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
        <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">buoy</span><span class="p">,</span> <span class="n">sat</span><span class="p">))</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;n_samples&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">sub</span><span class="p">),</span>
            <span class="s2">&quot;bias&quot;</span><span class="p">:</span> <span class="n">bias</span><span class="p">,</span>
            <span class="s2">&quot;MAE&quot;</span><span class="p">:</span> <span class="n">mae</span><span class="p">,</span>
            <span class="s2">&quot;RMSE&quot;</span><span class="p">:</span> <span class="n">rmse</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="c1"># ---- Per-station metrics ----</span>
    <span class="k">for</span> <span class="n">st</span><span class="p">,</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;station&quot;</span><span class="p">):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="n">st</span><span class="p">}</span>
        <span class="n">row</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metrics</span><span class="p">(</span><span class="n">sub</span><span class="p">))</span>
        <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>

    <span class="c1"># ---- Overall metrics (all stations pooled) ----</span>
    <span class="n">overall</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;station&quot;</span><span class="p">:</span> <span class="s2">&quot;ALL&quot;</span><span class="p">}</span>
    <span class="n">overall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">metrics</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
    <span class="n">rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">overall</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_diff</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">summer_buoy</span>
    <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;WTMP&quot;</span><span class="p">:</span> <span class="s2">&quot;buoy&quot;</span><span class="p">})</span>
    <span class="o">.</span><span class="n">merge</span><span class="p">(</span>
        <span class="n">sat_summer</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;sat_WTMP&quot;</span><span class="p">:</span> <span class="s2">&quot;sat&quot;</span><span class="p">}),</span>
        <span class="n">on</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;station&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">],</span>
        <span class="n">how</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">metrics_df</span> <span class="o">=</span> <span class="n">compute_sst_validation_metrics</span><span class="p">(</span><span class="n">df_diff</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{:.2f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span>

<span class="n">display</span><span class="p">(</span><span class="n">metrics_df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>n_samples</th>
      <th>bias</th>
      <th>MAE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>45001</td>
      <td>29</td>
      <td>0.32</td>
      <td>1.23</td>
      <td>1.88</td>
    </tr>
    <tr>
      <th>1</th>
      <td>45004</td>
      <td>28</td>
      <td>-0.12</td>
      <td>1.20</td>
      <td>1.58</td>
    </tr>
    <tr>
      <th>2</th>
      <td>45006</td>
      <td>28</td>
      <td>0.21</td>
      <td>0.95</td>
      <td>1.18</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ALL</td>
      <td>85</td>
      <td>0.14</td>
      <td>1.13</td>
      <td>1.58</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Overall, the satellite data exhibit a small warm bias of 0.14‚ÄØ¬∞C. However, the MAE and RMSE are relatively large, at 1.13‚ÄØ¬∞C and 1.58‚ÄØ¬∞C, respectively. A likely source of error is the difference in sampling frequency: the satellite dataset provides roughly one measurement per day, whereas the buoys record about 30 measurements per day. In addition, some days are missing in the satellite data, possibly due to cloud cover. To explore this further, we focus on summer 2016 for buoy 45001 (<em>see Figure 4</em>).</p>
<p>We observe that only two satellite observations are available between late July and mid-August, a particularly warm period, whereas the buoy provides continuous coverage throughout the three summer months (<em>Figure 4, top pannel</em>). This limited satellite data availability likely contributes to the satellite-derived mean summer LSWT being approximately 2 ¬∞C lower than the buoy-based mean. Indeed, when restricting the buoy data to the 31 measurements closest in time to the 31 satellite observations during summer 2016, the resulting mean LSWT is very similar to the satellite-derived value (<em>Figure 4, bottom pannel</em>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_matched_buoy_sat</span><span class="p">(</span><span class="n">buoy_data</span><span class="p">,</span> <span class="n">filtered_ds</span><span class="p">,</span> <span class="n">varname</span><span class="p">,</span> <span class="n">buoy_coords</span><span class="p">,</span>
                          <span class="n">summer_months</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span> <span class="n">tolerance</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Match buoy and satellite time series by timestamp within a tolerance for multiple stations.</span>

<span class="sd">    Args:</span>
<span class="sd">        buoy_data (pd.DataFrame): Buoy data with MultiIndex (station, datetime)</span>
<span class="sd">        filtered_ds (xarray.DataArray): Satellite data (Kelvin)</span>
<span class="sd">        varname (str): Name of variable in filtered_ds</span>
<span class="sd">        buoy_coords (dict): station -&gt; (lat, lon)</span>
<span class="sd">        summer_months (list): List of summer months to consider</span>
<span class="sd">        tolerance (pd.Timedelta): Maximum allowed time difference for matching</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: Long-form DataFrame with columns</span>
<span class="sd">                      [&#39;station&#39;, &#39;time&#39;, &#39;buoy&#39;, &#39;sat&#39;]</span>
<span class="sd">                      containing matched values for each station/time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">records</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Flatten buoy data and add year/month</span>
    <span class="n">df_buoy</span> <span class="o">=</span> <span class="n">buoy_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
    <span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

    <span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

    <span class="k">for</span> <span class="n">st</span><span class="p">,</span> <span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span><span class="p">)</span> <span class="ow">in</span> <span class="n">buoy_coords</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="c1"># Satellite at buoy location</span>
        <span class="n">ts_sat</span> <span class="o">=</span> <span class="n">filtered_ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mf">273.15</span>
        <span class="n">df_sat</span> <span class="o">=</span> <span class="n">ts_sat</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df_sat</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sat</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
        <span class="n">df_sat</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_sat</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>
        <span class="n">df_sat_summer</span> <span class="o">=</span> <span class="n">df_sat</span><span class="p">[</span><span class="n">df_sat</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">)]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

        <span class="c1"># Buoy summer series</span>
        <span class="n">df_buoy_st</span> <span class="o">=</span> <span class="n">df_buoy</span><span class="p">[(</span><span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">st</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_buoy</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">))]</span>
        <span class="n">df_buoy_st</span> <span class="o">=</span> <span class="n">df_buoy_st</span><span class="p">[[</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="s1">&#39;WTMP&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>

        <span class="c1"># Match satellite and buoy points year by year</span>
        <span class="k">for</span> <span class="n">yr</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
            <span class="n">df_sat_year</span> <span class="o">=</span> <span class="n">df_sat_summer</span><span class="p">[</span><span class="n">df_sat_summer</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">yr</span><span class="p">]</span>
            <span class="n">df_buoy_year</span> <span class="o">=</span> <span class="n">df_buoy_st</span><span class="p">[</span><span class="n">df_buoy_st</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">yr</span><span class="p">]</span>
           
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_sat_year</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_buoy_year</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">matched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge_asof</span><span class="p">(</span>
                    <span class="n">df_sat_year</span><span class="p">,</span>
                    <span class="n">df_buoy_year</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;time&#39;</span><span class="p">}),</span>
                    <span class="n">on</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span>
                    <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                    <span class="n">tolerance</span><span class="o">=</span><span class="n">tolerance</span>
                <span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">matched</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                    <span class="n">records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;station&#39;</span><span class="p">:</span> <span class="n">st</span><span class="p">,</span>
                        <span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;buoy&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;WTMP&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;sat&#39;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;sat&#39;</span><span class="p">]</span>
                    <span class="p">})</span>
        
    <span class="n">df_matched</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">records</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df_matched</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_matched</span> <span class="o">=</span> <span class="n">get_matched_buoy_sat</span><span class="p">(</span>
    <span class="n">buoy_data</span><span class="o">=</span><span class="n">buoy_data</span><span class="p">,</span>
    <span class="n">filtered_ds</span><span class="o">=</span><span class="n">filtered_ds</span><span class="p">,</span>
    <span class="n">varname</span><span class="o">=</span><span class="n">varname</span><span class="p">,</span>
    <span class="n">buoy_coords</span><span class="o">=</span><span class="n">buoy_coords</span><span class="p">,</span>
    <span class="n">summer_months</span><span class="o">=</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">],</span>
    <span class="n">tolerance</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1h&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --------------------------------------------------</span>
<span class="c1"># User inputs</span>
<span class="c1"># --------------------------------------------------</span>
<span class="n">year</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="n">station</span> <span class="o">=</span> <span class="s2">&quot;45001&quot;</span>
<span class="n">summer_months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">]</span>

<span class="c1"># Station coordinates</span>
<span class="n">lon_gridcell</span><span class="p">,</span> <span class="n">lat_gridcell</span> <span class="o">=</span> <span class="n">buoy_coords</span><span class="p">[</span><span class="n">station</span><span class="p">]</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># 1. All points (summer) for the station/year</span>
<span class="c1"># --------------------------------------------------</span>
<span class="c1"># Buoy: all summer points</span>
<span class="n">df_buoy_all</span> <span class="o">=</span> <span class="n">buoy_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">df_buoy_all</span> <span class="o">=</span> <span class="n">df_buoy_all</span><span class="p">[</span>
    <span class="p">(</span><span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">station</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;datetime&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">))</span>
<span class="p">]</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>

<span class="c1"># Satellite: all summer points at gridcell</span>
<span class="n">ts_sat_all</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">filtered_ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
    <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat_gridcell</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">lon_gridcell</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">filtered_ds</span><span class="p">[</span><span class="s1">&#39;time.year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ts_sat_all</span> <span class="o">=</span> <span class="n">ts_sat_all</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">ts_sat_all</span><span class="p">[</span><span class="s1">&#39;time.month&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">))</span> <span class="o">-</span> <span class="mf">273.15</span>

<span class="c1"># Means for all points</span>
<span class="n">mean_buoy_all</span> <span class="o">=</span> <span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;WTMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_sat_all</span> <span class="o">=</span> <span class="n">ts_sat_all</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># 2. Matched points from df_matched</span>
<span class="c1"># --------------------------------------------------</span>
<span class="n">df_st_matched</span> <span class="o">=</span> <span class="n">df_matched</span><span class="p">[</span>
    <span class="p">(</span><span class="n">df_matched</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">station</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df_matched</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="n">year</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df_matched</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">summer_months</span><span class="p">))</span>
<span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

<span class="n">mean_buoy_matched</span> <span class="o">=</span> <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;buoy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean_sat_matched</span> <span class="o">=</span> <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;sat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># 3. Shared y-axis limits</span>
<span class="c1"># --------------------------------------------------</span>
<span class="n">ymin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;WTMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">ts_sat_all</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span>
           <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;buoy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;sat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
<span class="n">ymax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;WTMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">ts_sat_all</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span>
           <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;buoy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;sat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">pad</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">pad</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">+</span> <span class="n">pad</span><span class="p">)</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># 4. Plot</span>
<span class="c1"># --------------------------------------------------</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># ---- Date formatting ----</span>
<span class="n">locator</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">MonthLocator</span><span class="p">()</span>
<span class="n">formatter</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s2">&quot;%b </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># -------------------------</span>
<span class="c1"># Top subplot: all summer points</span>
<span class="c1"># -------------------------</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_buoy_all</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">df_buoy_all</span><span class="p">[</span><span class="s1">&#39;WTMP&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buoy&#39;</span><span class="p">)</span>
<span class="n">ts_sat_all</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Satellite&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_buoy_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Buoy Mean (</span><span class="si">{</span><span class="n">mean_buoy_all</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> ¬∞C)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_sat_all</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Satellite Mean (</span><span class="si">{</span><span class="n">mean_sat_all</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> ¬∞C)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buoy </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2"> ‚Äî Summer </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> (All points)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;LSWT (¬∞C)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># -------------------------</span>
<span class="c1"># Bottom subplot: matched points only</span>
<span class="c1"># -------------------------</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;buoy&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buoy (matched)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">df_st_matched</span><span class="p">[</span><span class="s1">&#39;sat&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Satellite (matched)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_buoy_matched</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Buoy Mean (</span><span class="si">{</span><span class="n">mean_buoy_matched</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> ¬∞C)&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">mean_sat_matched</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Satellite Mean (</span><span class="si">{</span><span class="n">mean_sat_matched</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> ¬∞C)&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buoy </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2"> ‚Äî Summer </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2"> (Matched points)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;LSWT (¬∞C)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Date&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="c1"># ---- Shared x-axis formatting ----</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">locator</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-07-01&quot;</span><span class="p">),</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-09-30&quot;</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/57bbe540f62fd648175832768b00eb53cf1975cd1143d5d55c9c71d9ddf7cd91.png" src="../../_images/57bbe540f62fd648175832768b00eb53cf1975cd1143d5d55c9c71d9ddf7cd91.png" />
</div>
</div>
<p><em>Figure 4 : Comparison of buoy and satellite measurements used to compute the 2016 mean summer LSWT at the location of buoy 45001.</em></p>
<p>This time-matching procedure is repeated for each buoy and year. Specifically, each satellite observation is paired with the nearest buoy measurement in time, provided that the time difference is less than the specified tolerance (default: 1 hour).</p>
<p>The mean summer LSWT computed from the successfully time-matched satellite‚Äìbuoy pairs are compared in <em>Figure 5</em>. To further quantify differences between the time-matched satellite and buoy data, we compute the mean bias, mean absolute error (MAE), and root mean square error (RMSE).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute summer mean per year for each station</span>
<span class="n">df_diff_matched</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df_matched</span>
    <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="k">lambda</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
    <span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;station&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stations</span> <span class="o">=</span> <span class="n">df_diff_matched</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">stations</span><span class="p">):</span>
    <span class="n">df_st</span> <span class="o">=</span> <span class="n">df_diff_matched</span><span class="p">[</span><span class="n">df_diff_matched</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">st</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>

    <span class="c1"># Plot buoy data with cross marker</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_st</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">df_st</span><span class="p">[</span><span class="s1">&#39;buoy&#39;</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buoy (matched)&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># Plot satellite data with circle marker</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">df_st</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">df_st</span><span class="p">[</span><span class="s1">&#39;sat&#39;</span><span class="p">],</span>
            <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Satellite (matched)&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>

    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">buoy_coords</span><span class="p">[</span><span class="n">st</span><span class="p">]</span>  <span class="c1"># get coordinates</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buoy </span><span class="si">{</span><span class="n">st</span><span class="si">}</span><span class="s2"> (lat: </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">¬∞, lon: </span><span class="si">{</span><span class="n">lon</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">¬∞)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean summer LSWT ¬∞C&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/00c1d26f628134916fd011d98fb47773e98652b185b273b53f8c7e580a57c0b0.png" src="../../_images/00c1d26f628134916fd011d98fb47773e98652b185b273b53f8c7e580a57c0b0.png" />
</div>
</div>
<p><em>Figure 5: Mean summer LSWT from satellite data compared to buoy data using only successfully time-matched satellite‚Äìbuoy pairs.</em></p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">metrics_df_matched</span> <span class="o">=</span> <span class="n">compute_sst_validation_metrics</span><span class="p">(</span><span class="n">df_diff_matched</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">metrics_df_matched</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>station</th>
      <th>n_samples</th>
      <th>bias</th>
      <th>MAE</th>
      <th>RMSE</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>45001</td>
      <td>29</td>
      <td>0.30</td>
      <td>0.43</td>
      <td>0.50</td>
    </tr>
    <tr>
      <th>1</th>
      <td>45004</td>
      <td>28</td>
      <td>0.10</td>
      <td>0.33</td>
      <td>0.39</td>
    </tr>
    <tr>
      <th>2</th>
      <td>45006</td>
      <td>28</td>
      <td>0.26</td>
      <td>0.41</td>
      <td>0.53</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ALL</td>
      <td>85</td>
      <td>0.22</td>
      <td>0.39</td>
      <td>0.48</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Overall, the satellite data exhibit a small warm bias of 0.22 ¬∞C relative to the time-matched buoy observations, slightly larger than the bias obtained when using all available data to compute summer means (0.14 ¬∞C). In contrast, the MAE and RMSE are substantially reduced, at 0.39 ¬∞C and 0.48 ¬∞C, respectively (compared to 1.13 ¬∞C and 1.58 ¬∞C). This indicates that a large fraction of the difference between the LSWT means shown in <em>Figure 3</em> (computed using all data) is attributable to the lower sampling frequency and limited temporal availability of the satellite observations, while individual satellite measurements are comparatively precise. The remaining discrepancies with buoy data are likely due to fundamental measurement differences: satellites measure the lake skin temperature, whereas buoys measure subsurface temperature (typically at ~1 m depth). Depending on atmospheric and lake conditions (e.g., wind and stratification), these measurements can differ. In addition, satellite retrievals may be affected by cloud contamination.</p>
<section id="estimation-of-linear-trends">
<h4>Estimation of linear trends<a class="headerlink" href="#estimation-of-linear-trends" title="Link to this heading">#</a></h4>
<p>Using all the available buoy data, we estimate linear trends for three periods: 1979‚Äì2006, 1995‚Äì2023, and 1979‚Äì2023 (Figure 6). These are compared with trends derived from satellite data and with previously published results.</p>
<p>For 1979‚Äì2006, the three buoys show warming trends of 0.108‚ÄØ¬∞C/year, 0.098‚ÄØ¬∞C/year, and 0.100‚ÄØ¬∞C/year. Unsurprisingly, these values are consistent with the 0.11‚ÄØ¬±‚ÄØ0.06‚ÄØ¬∞C/year estimate reported in <a class="reference external" href="https://doi.org/10.1029/2006GL029021" rel="noreferrer" target="_blank">[3]</a>, which used the same buoy dataset. The associated p-values are relatively small (0.10, 0.30, and 0.07) but fall short of the conventional 0.05 significance threshold, likely due to the limited number of observations.</p>
<p>For 1995-2023, the three buoys show diverging trends of -0.013‚ÄØ¬∞C/year, 0.035‚ÄØ¬∞C/year, and 0.014‚ÄØ¬∞C/year, with large associated p-values (<span class="math notranslate nohighlight">\(\geq\)</span>0.8), indicating that none of these trends are significant. Satellite-derived trends at the corresponding buoy locations (0.003‚ÄØ¬∞C/year, ‚àí0.032‚ÄØ¬∞C/year, and ‚àí0.004‚ÄØ¬∞C/year) display the same qualitative behavior: diverging and non-significant. These results are consistent with those in <em>Figure 2</em> based on spatially averaged satellite data, and with previous analyses <a class="reference external" href="https://glisa.umich.edu/lake-superior-retrospective/" rel="noreferrer" target="_blank">[4]</a>, confirming the absence of a significant summer LSWT warming trend over this period.</p>
<p>For 1979‚Äì2023, the three buoys show warming trends of 0.048‚ÄØ¬∞C/year, 0.061‚ÄØ¬∞C/year, and 0.044‚ÄØ¬∞C/year, with p-values just above the conventional 0.05 significance threshold. These results are consistent with <a class="reference external" href="https://journals.ametsoc.org/view/journals/clim/37/4/JCLI-D-23-0092.1.xml" rel="noreferrer" target="_blank">[6]</a>, which reported a warming trend of 0.052¬±0.031¬∞C/year for 1980-2021 based on simulation data.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --------------------------------------------------</span>
<span class="c1"># Adjustable line transparency</span>
<span class="c1"># --------------------------------------------------</span>
<span class="n">LINE_ALPHA</span> <span class="o">=</span> <span class="mf">0.2</span>

<span class="c1"># Buoy trend periods</span>
<span class="n">periods_buoy</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">2006</span><span class="p">,</span> <span class="s2">&quot;1979‚Äì2006&quot;</span><span class="p">,</span> <span class="s2">&quot;dotted&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1995</span><span class="p">,</span> <span class="mi">2023</span><span class="p">,</span> <span class="s2">&quot;1995‚Äì2023&quot;</span><span class="p">,</span> <span class="s2">&quot;dashed&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="mi">1979</span><span class="p">,</span> <span class="mi">2023</span><span class="p">,</span> <span class="s2">&quot;1979‚Äì2023&quot;</span><span class="p">,</span> <span class="s2">&quot;solid&quot;</span><span class="p">)</span>
<span class="p">]</span>

<span class="c1"># Satellite trend period</span>
<span class="n">period_sat</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1995</span><span class="p">,</span> <span class="mi">2023</span><span class="p">)</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># Helper function to plot series + trend</span>
<span class="c1"># --------------------------------------------------</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_series_with_trend</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">years</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a series with markers and optional trend lines.&quot;&quot;&quot;</span>
    <span class="n">line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">years</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">line_alpha</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span>
    <span class="p">)</span>

    <span class="c1"># Add trends if periods provided</span>
    <span class="k">if</span> <span class="n">periods</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">period_label</span><span class="p">,</span> <span class="n">ls</span> <span class="ow">in</span> <span class="n">periods</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">years</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">years</span> <span class="o">&lt;=</span> <span class="n">end</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">data_sel</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">mk</span><span class="o">.</span><span class="n">original_test</span><span class="p">(</span><span class="n">data_sel</span><span class="p">)</span>
            <span class="n">slope</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">slope</span>
            <span class="n">trend_line</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">data_sel</span> <span class="o">-</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_sel</span><span class="p">)))</span> <span class="o">+</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_sel</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">years</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span>
                <span class="n">trend_line</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> Trend </span><span class="si">{</span><span class="n">period_label</span><span class="si">}</span><span class="s2"> (slope=</span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> ¬∞C/yr, p=</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">p</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="p">)</span>

<span class="c1"># --------------------------------------------------</span>
<span class="c1"># Plotting</span>
<span class="c1"># --------------------------------------------------</span>
<span class="n">stations</span> <span class="o">=</span> <span class="n">summer_buoy</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">stations</span><span class="p">),</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">st</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span> <span class="n">stations</span><span class="p">):</span>

    <span class="c1"># ---- Buoy summer means ----</span>
    <span class="n">s_buoy</span> <span class="o">=</span> <span class="n">summer_buoy</span><span class="p">[</span><span class="n">summer_buoy</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">st</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
    <span class="n">plot_series_with_trend</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">s_buoy</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">s_buoy</span><span class="p">[</span><span class="s1">&#39;WTMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Buoy&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span>
        <span class="n">line_alpha</span><span class="o">=</span><span class="n">LINE_ALPHA</span><span class="p">,</span>
        <span class="n">periods</span><span class="o">=</span><span class="n">periods_buoy</span>
    <span class="p">)</span>

    <span class="c1"># ---- Satellite summer means ----</span>
    <span class="n">s_sat</span> <span class="o">=</span> <span class="n">sat_summer</span><span class="p">[</span><span class="n">sat_summer</span><span class="p">[</span><span class="s1">&#39;station&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">st</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span>
    <span class="n">plot_series_with_trend</span><span class="p">(</span>
        <span class="n">ax</span><span class="p">,</span>
        <span class="n">s_sat</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">s_sat</span><span class="p">[</span><span class="s1">&#39;sat_WTMP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Satellite&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span>
        <span class="n">line_alpha</span><span class="o">=</span><span class="n">LINE_ALPHA</span><span class="p">,</span>
        <span class="n">periods</span><span class="o">=</span><span class="p">[(</span><span class="o">*</span><span class="n">period_sat</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">period_sat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">‚Äì</span><span class="si">{</span><span class="n">period_sat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;--&quot;</span><span class="p">)]</span>
    <span class="p">)</span>

    <span class="c1"># ---- Axes settings ----</span>
    <span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">=</span> <span class="n">buoy_coords</span><span class="p">[</span><span class="n">st</span><span class="p">]</span>  <span class="c1"># get coordinates</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Buoy </span><span class="si">{</span><span class="n">st</span><span class="si">}</span><span class="s2"> (lat: </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">¬∞, lon: </span><span class="si">{</span><span class="n">lon</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">¬∞)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Mean summer LSWT ¬∞C&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/2097e6aa4e6c38310056f37f1ccb1cf3f6df9619f686c4f6be74c613b273609a.png" src="../../_images/2097e6aa4e6c38310056f37f1ccb1cf3f6df9619f686c4f6be74c613b273609a.png" />
</div>
</div>
<p><em>Figure 6: Time series of mean summer LSWT for buoy and satellite observations at each buoy location. Semi-transparent lines show summer means, and overlaid trend lines (dotted, dashed, or solid) indicate linear trends for different periods, with slope and p-values reported. Trends were estimated using the Theil-Sen method  in combination with the Mann-Kendall test for statistical significance.</em></p>
</section>
<section id="discussion">
<h4>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h4>
<p>Lake Superior‚Äôs summer LSWT trend over 1995‚Äì2023, derived from the Copernicus <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-lake-water-temperature?tab=overview" rel="noreferrer" target="_blank">satellite-lake-water-temperature</a> dataset, is slightly negative but not statistically significant. Although this initially seemed surprising given sustained global warming, the result was confirmed using in-situ buoy data.</p>
<p>Overall, the satellite data shows good agreement with buoy measurements. Differences in computed summer means primarily arise from the lower temporal sampling and occasional missing satellite observations, but the systematic bias is small. This indicates that the satellite-lake-water-temperature dataset is suitable for analyzing summer LSWT trends in Lake Superior. However, no significant warming trend is observed over the 1995‚Äì2023 period.</p>
<p>One possible explanation is the unusually high summer temperatures in 1998, associated with a strong El Ni√±o event early in the satellite record. This may have contributed to the relatively large warming trend reported for 1979‚Äì2006 <a class="reference external" href="https://doi.org/10.1029/2006GL029021" rel="noreferrer" target="_blank">[3]</a> and simultaneously obscured longer-term warming signals in the 1995‚Äì2023 period. Incorporating pre-1995 in-situ observations, where available, would improve assessments of long-term trends. Indeed, when considering the full buoy record, a near-significant warming trend of ~0.05‚ÄØ¬∞C/year is observed over 1979‚Äì2023.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Farina, G., Thiem, H. (2024) <a class="reference external" href="https://www.climate.gov/news-features/event-tracker/several-great-lakes-experience-record-warm-water-temperatures-heading#" rel="noreferrer" target="_blank">Several Great Lakes experience record-warm water temperatures heading into winter</a>. <a class="reference external" href="http://Climate.gov" rel="noreferrer" target="_blank">Climate.gov</a></p></li>
<li><p><a class="reference external" href="https://coastwatch.glerl.noaa.gov/statistics/average-surface-water-temperature-glsea/" rel="noreferrer" target="_blank">NOAA CoastWatch: Great Lakes Node</a></p></li>
</ul>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Dataset documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://confluence.ecmwf.int/pages/viewpage.action?pageId=348800177" rel="noreferrer" target="_blank">LSWT v4.5: Product User Guide and Specification (PUGS)</a></p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>, prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p><a class="reference external" href="https://doi.org/10.1038/s41558-024-02122-y" rel="noreferrer" target="_blank">[1]</a> Wang, X., Shi, K., Qin, B. et al. (2024). Disproportionate impact of atmospheric heat events on lake surface water temperature increases. Nat. Clim. Chang.</p></li>
<li><p><a class="reference external" href="https://climate.copernicus.eu/lake-surface-temperatures" rel="noreferrer" target="_blank">[2]</a> Copernicus (2018). Lake surface temperatures. Climate Change Service.</p></li>
<li><p><a class="reference external" href="https://doi.org/10.1029/2006GL029021" rel="noreferrer" target="_blank">[3]</a> Jay A. Austin, Steven M. Colman (2007). Lake Superior summer water temperatures are increasing more rapidly than regional air temperatures: A positive ice-albedo feedback. Geophysical Research Letters Volume 34, Issue 6.</p></li>
<li><p><a class="reference external" href="https://glisa.umich.edu/lake-superior-retrospective/" rel="noreferrer" target="_blank">[4]</a> GLISA (2024). Lake Superior Retrospective.</p></li>
<li><p><a class="reference external" href="https://coastwatch.glerl.noaa.gov/statistics/average-surface-water-temperature-glsea/" rel="noreferrer" target="_blank">[5]</a> NOAA CoastWatch Great Lakes Regional Node (2024). Average Surface Water Temperature (GLSEA).</p></li>
<li><p><a class="reference external" href="https://journals.ametsoc.org/view/journals/clim/37/4/JCLI-D-23-0092.1.xml" rel="noreferrer" target="_blank">[6]</a>  Cannon, D., Wang, J., Fujisaki-Manome, A., Kessler, J., Ruberg, S., &amp; Constant, S. (2024). Investigating Multidecadal Trends in Ice Cover and Subsurface Temperatures in the Laurentian Great Lakes Using a Coupled Hydrodynamic‚ÄìIce Model. Journal of Climate, 37(4), 1249-1276.</p></li>
<li><p><a class="reference external" href="https://www.ndbc.noaa.gov/" rel="noreferrer" target="_blank">[7]</a> NOAA National Buoy Data Centre.</p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Land_Hydrology"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Land_Hydrology.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.5. </span>Land Hydrology</p>
      </div>
    </a>
    <a class="right-next"
       href="../Ocean/Ocean.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.6. </span>Ocean</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-analyzing-the-long-term-trend-in-surface-water-temperature-of-lake-superior">üåç Use case: Analyzing the long-term trend in surface water temperature of Lake Superior</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-and-download-data">1. Request and download data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-variables">Set variables</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-the-data-request">Set the data request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">Download data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-preprocessing">2. Data preprocessing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-lakeid">Plot lakeid</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-filtering">Data filtering</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summer-mean-analysis">3. Summer mean analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#summer-mean">Summer mean</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#trend-estimation">Trend estimation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comparison-with-noaa-buoy-data">4. Comparison with NOAA buoy data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#estimation-of-linear-trends">Estimation of linear trends</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>