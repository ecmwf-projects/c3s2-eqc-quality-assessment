
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.1.1. Satellite Surface Radiation Budget intercomparison for climate change monitoring &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Atmosphere_Physics/satellite_satellite-surface-radiation-budget_climate-monitoring_q01';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.2. Atmospheric Composition" href="../Atmospheric_Composition/Atmospheric_Composition.html" />
    <link rel="prev" title="1.1. Atmosphere Physics" href="Atmosphere_Physics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.1.1. Satellite Surface Radiation Budget intercomparison for climate change monitoring</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Atmosphere_Physics/satellite_satellite-surface-radiation-budget_climate-monitoring_q01.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Atmosphere_Physics/satellite_satellite-surface-radiation-budget_climate-monitoring_q01.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Satellite Surface Radiation Budget intercomparison for climate change monitoring</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-use-surface-radiation-budget-to-monitor-climate-change">üåç Use case: Use surface radiation budget to monitor climate change</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-data-to-use-and-setup-code">1. Choose the data to use and setup code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">2. Download and Transform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-spatial-weighted-time-series-time-weighted-means-spatial-weighted-zonal-means">3. Plot spatial weighted time series, time weighted means, spatial weighted zonal means</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weighted-time-series">Spatially-weighted time series</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weighted-mean-annual-cycles">Spatially-weighted mean annual cycles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-weighted-means">Time-weighted means</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weightes-zonal-means">Spatially-weightes zonal means</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-applications">Discussion and applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="satellite-surface-radiation-budget-intercomparison-for-climate-change-monitoring">
<h1><span class="section-number">1.1.1. </span>Satellite Surface Radiation Budget intercomparison for climate change monitoring<a class="headerlink" href="#satellite-surface-radiation-budget-intercomparison-for-climate-change-monitoring" title="Link to this heading">#</a></h1>
<p>Production date: 10-06-2025</p>
<p>Produced by: CNR-ISMAR, Andrea Storto, Vincenzo de Toma</p>
<section id="use-case-use-surface-radiation-budget-to-monitor-climate-change">
<h2>üåç Use case: Use surface radiation budget to monitor climate change<a class="headerlink" href="#use-case-use-surface-radiation-budget-to-monitor-climate-change" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question-s">
<h2>‚ùì Quality assessment question(s)<a class="headerlink" href="#quality-assessment-question-s" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>What is the climatology and temporal variability of SRB and its uncertainty? How consistent are the surface radiation budget products?</strong></p></li>
</ul>
<p>The Surface Radiation Budget (SRB) products allow quantifying the surface energy budget, the energy exchanges at the atmospheric lower boundary (with ocean, ice, and land), and their temporal and spatial variability, for use in several climate applications, such as, for instance: i) climate modeling and validation, where SRB data are essential for calibrating and validating general circulation models (GCMs) of the ocean and atmosphere. Accurate SRB measurements help improve model predictions of climate tendencies by ensuring that energy exchanges are correctly represented; ii) energy balance analysis, focusing on understanding the role of SRB on Earth‚Äôs energy balance, which influences global temperatures and climate dynamics. Significant variations in the SRB can indicate changes in climate forcings, such as increased greenhouse gases or variations in solar radiation, etc.; iii) surface temperature studies, where SRB data contribute to studying regional amplifications of climate variations; iv) research on other cycles, like for instance the hydrological cycle, for which SRB strongly influences the evaporation rate and, to a lesser extent, precipitation patterns. Their temporal coverage and spatial detail, however, vary significantly between the products. There exist offsets between the products, which tend to be significant for shortwave components, although they tend to cancel out in the net surface shortwave flux. Longwave fluxes are less consistent, in general, at low latitudes. In particular, biases of opposite sign (negative for CLARA products, positive for ESA and C3S products) and documented within the Product Validation and Intercomparison Reports, amplify the cross-product differences.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>The surface radiation budget (SRB) products capture the spatial and temporal variability of the radiative fluxes at the surface, for use in climate analyses, energy budget studies, and climate model assessment</p></li>
<li><p>The SRB products have different temporal coverage and spatial resolution, namely their combined use is not straightforward and it is recommended for advanced users only, or within selected periods</p></li>
<li><p>The consistency among the products concerning spatially averaged values is sufficient to capture the annual cycle of all the variables, both in the tropics and in the Nino 3.4 region. Moreover, there‚Äôs more agreement regarding the temporal variability for the net solar radiation across products than for the other variables investigated</p></li>
<li><p>Climatological maps and zonally averaged values indicate that the products suffer from poor consistency in some areas, e.g. longwave flux components (downwelling and outgoing) at low latitudes, and shortwave at high latitudes.</p></li>
</ul>
</div>
<p>Using satellite data to estimate the surface radiation budget - comprising shortwave and longwave radiation at the interfaces between atmosphere and ocean, atmosphere and land, and atmosphere and ice - is often discontinuous and poses significant challenges for climate monitoring and model verification. These estimates can be influenced by various atmospheric conditions and instrument limitations, making their use complex and recommended only for expert users (<a class="reference external" href="https://doi.org/10.1016/j.agrformet.2006.02.001" rel="noreferrer" target="_blank">[1]</a>; <a class="reference external" href="https://doi.org/10.1175/2008BAMS2634.1" rel="noreferrer" target="_blank">[2]</a>). Partial temporal (and spatial, to a lesser extent) sampling of the datasets hampers their easy utilization.</p>
<figure class="align-default" id="id1">
<img alt="../../_images/f5a4c8e0-86fa-49eb-9b70-ebee0c7e3c6f.png" src="../../_images/f5a4c8e0-86fa-49eb-9b70-ebee0c7e3c6f.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.1.1.1 </span><span class="caption-text">Monthly Climatological Time Series of fluxes within the Tropical and Nino 3.4 region for all the datasets</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>We aim here to inter-compare the following catalogue entries from the Climate Data Store (CDS) by Copernicus:</p>
<ol class="arabic simple">
<li><p>ESA Cloud Climate Change Initiative (ESA Cloud_cci) data: Cloud_cci ATSR2-AATSR L3C/L3U CLD_PRODUCTS v3.0.</p></li>
<li><p>CLARA-A3: CM SAF cLoud, Albedo and surface RAdiation dataset from AVHRR data - Edition 3. Satellite Application Facility on Climate Monitoring (CLARA EUMETSAT A3)</p></li>
<li><p>Sentinel 3A  and Sentinel 3B, and the combined product from the Rutherford Appleton Laboratory under the Copernicus Climate Change Service (C3S) programme.</p></li>
</ol>
<p>In particular, this analysis takes into account the Surface Radiation Budget Essential Climate Variable (ECV), in terms of the following ECV products:</p>
<ul class="simple">
<li><p>Surface Reflected Solar Radiation (SRS);</p></li>
<li><p>Surface Incoming Solar Radiation (SIS);</p></li>
<li><p>Surface Downwelling Longwave Radiation (SDL);</p></li>
<li><p>Surface Net Downward Shortwave Radiation (SNS);</p></li>
<li><p>Surface Outgoing Longwave Radiation (SOL).</p></li>
</ul>
<p>Please note that not all catalogue entries provide the above ECV products. For example, SRS/SOL (Surface Reflected Solar / Surface Outgoing Longwave radiation) is not provided in CLARA EUMETSAT A3, we derived the SRS/SOL by subtracting SIS/SDL (Surface Incoming Solar / Surface Downwelling Longwave radiation) and SNS/SNL (Surface Net Solar / Surface Net Longwave radiation). Please see the Download and transform section for details.</p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-climate-monitoring-q01-section-1"><span class="std std-ref">1. Choose the data to use and setup code</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-climate-monitoring-q01-section-2"><span class="std std-ref">2. Download and Transform</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-climate-monitoring-q01-section-3"><span class="std std-ref">3. Plot spatial weighted time series, time weighted means, spatial weighted zonal means</span></a></strong></p>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<p>Given the multi-panel nature of most of the figure in this assessment, please consider to open them in a separate tab on your browser.</p>
<section id="choose-the-data-to-use-and-setup-code">
<span id="satellite-satellite-surface-radiation-budget-climate-monitoring-q01-section-1"></span><h3>1. Choose the data to use and setup code<a class="headerlink" href="#choose-the-data-to-use-and-setup-code" title="Link to this heading">#</a></h3>
<p>In this section, we import the required packages and set up the dataset names for further use in the following sections. Processing functions are also defined.
The choice to use only the latest version of CLARA is intentional: previous versions are on the CDS for backwards compatibility reasons.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.gridspec</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gridspec</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CDSAPI_RC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/detoma_vincenzo/.cdsapirc&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>

<span class="c1"># Variables to analyse</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;srs&quot;</span><span class="p">,</span> <span class="s2">&quot;sis&quot;</span><span class="p">,</span> <span class="s2">&quot;sdl&quot;</span><span class="p">,</span> <span class="s2">&quot;sol&quot;</span><span class="p">,</span> <span class="s2">&quot;sns&quot;</span><span class="p">,</span> <span class="s2">&quot;snl&quot;</span><span class="p">)</span>

<span class="n">VARIABLES</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="n">var</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">])</span>

<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-surface-radiation-budget&quot;</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">request_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;1979-01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;eumetsat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;clara_a3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;surface_downwelling_shortwave_flux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surface_downwelling_longwave_flux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surface_upwelling_shortwave_flux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surface_downwelling_shortwave_flux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surface_net_downward_shortwave_flux&quot;</span><span class="p">,</span>
            <span class="s2">&quot;surface_net_downward_longwave_flux&quot;</span><span class="p">,</span>
        <span class="p">],</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;v2_0&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CCI ENVISAT&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2003-01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;esa&quot;</span><span class="p">,</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;aatsr_on_envisat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CCI ERS&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;1997-01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2002-12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;esa&quot;</span><span class="p">,</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;atsr2_on_ers2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CCI S3A&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;interim_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;c3s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;slstr_on_sentinel_3a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CCI S3B&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;interim_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;c3s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;slstr_on_sentinel_3b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CCI S3A-S3B&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2018-10&quot;</span><span class="p">,</span>
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2022-06&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;interim_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;c3s&quot;</span><span class="p">,</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;slstr_on_sentinel_3a_3b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>

<span class="c1"># Functions to cache</span>
<span class="k">def</span><span class="w"> </span><span class="nf">preprocess_time</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">and</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
        <span class="c1"># Could not decode</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time_coverage_start&quot;</span><span class="p">])</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">spatial_count</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">])</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mean_map_period</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">),</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">attrs</span><span class="p">)})</span>
    <span class="n">ds_map</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">S</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">ds_map</span>

<span class="n">xarray_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;drop_variables&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;time_bounds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_bnds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lon_bnds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lat_bnds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;record_status&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;preprocess&quot;</span><span class="p">:</span> <span class="n">preprocess_time</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">xarray_kwargs_a3</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;drop_variables&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;time_bounds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_bnds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lon_bnds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;lat_bnds&quot;</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="s2">&quot;preprocess&quot;</span><span class="p">:</span> <span class="n">preprocess_time</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-and-transform">
<span id="satellite-satellite-surface-radiation-budget-climate-monitoring-q01-section-2"></span><h3>2. Download and Transform<a class="headerlink" href="#download-and-transform" title="Link to this heading">#</a></h3>
<p>The code below will download the products.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clara_start</span><span class="p">,</span> <span class="n">clara_end</span> <span class="o">=</span> <span class="s2">&quot;1982-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2018-12&quot;</span>
<span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span> <span class="o">=</span> <span class="s2">&quot;1997-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2002-12&quot;</span>
<span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span> <span class="o">=</span> <span class="s2">&quot;2003-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2011-12&quot;</span> 
<span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span> <span class="o">=</span> <span class="s2">&quot;2019-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-12&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_maps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_timeseries</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_nino3_4</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_count_tro</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_count_nino3_4</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p3</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p4</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">rec_status</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">weights</span><span class="o">=</span><span class="kc">True</span>
<span class="n">skipna</span><span class="o">=</span><span class="kc">True</span>
<span class="n">prod_to_coarsen</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
    <span class="n">requests</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">update_request_date</span><span class="p">(</span>
        <span class="n">request</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">stringify_dates</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

    <span class="c1"># Maps</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
        <span class="n">collection_id</span><span class="p">,</span>
        <span class="n">requests</span><span class="p">,</span>
        <span class="c1">#transform_func=diagnostics.time_weighted_mean,</span>
        <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="c1">#transform_chunks=False,</span>
        <span class="o">**</span><span class="p">(</span><span class="n">xarray_kwargs_a3</span> <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span> <span class="k">else</span> <span class="n">xarray_kwargs</span><span class="p">),</span>
        <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s1">&#39;CLARA EUMETSAT A3&#39;</span><span class="p">:</span>
        <span class="n">srs</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;SIS&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;SNS&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;SRS&#39;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">srs</span><span class="o">=</span><span class="n">srs</span><span class="p">)</span>
        <span class="n">sol</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;SDL&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;SNL&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;SOL&quot;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">sol</span><span class="o">=</span><span class="n">sol</span><span class="p">)</span>
        <span class="n">rec_status</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;record_status&#39;</span><span class="p">]</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s1">&#39;record_status&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rec_status</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec_status</span><span class="p">[</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">]</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">),</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">attrs</span><span class="p">)})</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">})</span>
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;SIS&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;long_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;surface incoming solar radiation&#39;</span>
    
    <span class="k">if</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">prod_to_coarsen</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">rec_status</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">rec_status</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">rec_status</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="n">curr_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
    <span class="n">clara_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">clara_start</span><span class="p">,</span> <span class="n">clara_end</span><span class="p">)</span>
    <span class="n">esa_ers2_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">)</span>
    <span class="n">esa_envisat_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">)</span>
    <span class="n">sentinel_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">esa_ers2_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">or</span> <span class="n">esa_ers2_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
        <span class="n">ds_maps_p2</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">esa_envisat_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">or</span> <span class="n">esa_envisat_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
        <span class="n">ds_maps_p3</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">sentinel_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">or</span> <span class="n">sentinel_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
        <span class="n">ds_maps_p4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span> 
        
    <span class="n">ds_timeseries</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">})</span>
    <span class="n">ds_count_tro</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_count</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">})</span>
    <span class="n">ds_nino3_4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">),</span> <span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">})</span>
    <span class="n">ds_count_nino3_4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">spatial_count</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">),</span> <span class="n">lat_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">})</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sentinel 3A
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/2 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 1/2 [00:00&lt;00:00,  5.95it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:00&lt;00:00,  7.30it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:00&lt;00:00,  7.04it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inserting Sentinel 3A in ds_maps_p4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Sentinel 3B
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/2 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> 50%|‚ñà‚ñà‚ñà‚ñà‚ñà     | 1/2 [00:00&lt;00:00,  4.60it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:00&lt;00:00,  5.46it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 2/2 [00:00&lt;00:00,  5.30it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Inserting Sentinel 3B in ds_maps_p4
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_periods_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds_maps_p2</span><span class="p">,</span> <span class="n">ds_maps_p3</span><span class="p">,</span> <span class="n">ds_maps_p4</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-spatial-weighted-time-series-time-weighted-means-spatial-weighted-zonal-means">
<span id="satellite-satellite-surface-radiation-budget-climate-monitoring-q01-section-3"></span><h3>3. Plot spatial weighted time series, time weighted means, spatial weighted zonal means<a class="headerlink" href="#plot-spatial-weighted-time-series-time-weighted-means-spatial-weighted-zonal-means" title="Link to this heading">#</a></h3>
<section id="spatially-weighted-time-series">
<h4>Spatially-weighted time series<a class="headerlink" href="#spatially-weighted-time-series" title="Link to this heading">#</a></h4>
<p>Below, we calculate and plot spatially weighted means for the different surface radiation budget products. Please note that masks of available data may differ across the products. However, the spatial weighted means are calculated between 30¬∞S and 30¬∞N, so that mask inconsistencies have minimal effects. Additionally, quality mask (variable record_status) from the CLARA EUMETSAT A3 product has been used to mask all products‚Äô data points in the attempt to make the comparison aware of data gaps - we also calculate the percentage of valid measurements according to this criterion in the region considered, referring to it with the generic term ‚Äúcoverage‚Äù in the following.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># First subplot 3x taller than second</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># First subplot (larger)</span>
    <span class="n">Ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_timeseries</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">ds_count_tro</span><span class="p">[</span><span class="n">product</span><span class="p">][</span><span class="n">var</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_maps_p4</span><span class="p">[</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_maps_p4</span><span class="p">[</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">))</span><span class="o">.</span><span class="n">longitude</span><span class="p">))</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coverage [%]&#39;</span><span class="p">)</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/6ec0344a7bb27d740fe2f6a0fa3b92dfd84bf56dace099e853ab36786fdb0d01.png" src="../../_images/6ec0344a7bb27d740fe2f6a0fa3b92dfd84bf56dace099e853ab36786fdb0d01.png" />
<img alt="../../_images/44f1128a242c1d841ce354e8f830f99c4c8797bee7faa45eff879b3b2de639d6.png" src="../../_images/44f1128a242c1d841ce354e8f830f99c4c8797bee7faa45eff879b3b2de639d6.png" />
<img alt="../../_images/778728d9adc60069b92c6f05891dcc7574413834a06de995262bba0d836f34dc.png" src="../../_images/778728d9adc60069b92c6f05891dcc7574413834a06de995262bba0d836f34dc.png" />
<img alt="../../_images/e5ac6a536aab06a3fce917c4a42d9c6b85973720f00cc6fd233a32df90515ca0.png" src="../../_images/e5ac6a536aab06a3fce917c4a42d9c6b85973720f00cc6fd233a32df90515ca0.png" />
<img alt="../../_images/de40c6437ec2bed4f31805465add9d600d5a619b9966e43e1fb3386f59d1cf8a.png" src="../../_images/de40c6437ec2bed4f31805465add9d600d5a619b9966e43e1fb3386f59d1cf8a.png" />
<img alt="../../_images/48f22e7ec1c70f5f78d33fd291e43d30f21b8f0a60ec389bc333cf265ea05d1c.png" src="../../_images/48f22e7ec1c70f5f78d33fd291e43d30f21b8f0a60ec389bc333cf265ea05d1c.png" />
</div>
</div>
<p>The timeseries above show that the different products do not fully overlap temporally, and thus they can be combined by expert users only. Moreover, there exist large offsets, likely linked to the different processing chains and sensors rather than to inter-annual variations, especially for the surface (outgoing and downwelling) longwave radiation. Products show a good consistency in representing the surface incoming solar radiation, although significant differences exist in the reflected solar radiation, likely due to different albedo definitions and diverse daily cycles implied in turn by different sensors. However, these differences are partly compensated between the downward and upward fluxes, and result in the net solar radiation exhibiting reasonably comparable timeseries.</p>
<p>The Nino3.4 region is specifically investigated. Assessing the Surface Radiation Budget (SRB) over the Ni√±o3.4 region is important because it directly influences sea surface temperatures that drive El Ni√±o events, which in turn impact global weather and climate patterns. Additionally, the area does not present any data gap (unlike high-latitude areas), thus representing an ideal region to fairly compare the SRB products. Therein, seasonal variations are less important than the inter-annual variations, which in turn respond to the El Nino-Southern Oscillation (ENSO) variability. Additionally, the region exhibits good observational coverage. Except for the reflected solar radiation (see later for details), all variables show reasonable consistency. Surface incoming solar radiation and longwave radiation fluxes are found in large consistency and differences fall mostly within the error bars (i.e. between 5 W/m2 and 10 W/m2) depending on variables as indicated in the product quality assurance document (<a class="reference external" href="https://confluence.ecmwf.int/pages/viewpage.action?pageId=384141061" rel="noreferrer" target="_blank">https://confluence.ecmwf.int/pages/viewpage.action?pageId=384141061</a>). These findings also emerge from the monthly climatology shown in the spatially-weighted mean annual cycles section below.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">7</span><span class="p">))</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># First subplot 3x taller than second</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>  <span class="c1"># First subplot (larger)</span>
    <span class="n">Ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sharex</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> 
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_nino3_4</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">ds_count_nino3_4</span><span class="p">[</span><span class="n">product</span><span class="p">][</span><span class="n">var</span><span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_maps_p4</span><span class="p">[</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">ds_maps_p4</span><span class="p">[</span><span class="s2">&quot;CLARA EUMETSAT A3&quot;</span><span class="p">][</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">170</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span><span class="o">.</span><span class="n">longitude</span><span class="p">))</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">count</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="n">count</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Coverage [%]&#39;</span><span class="p">)</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">Ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/89ab00040047dc4f5527082b3d335e51f1164c95130e2d49e6e24a74cdc4bd1e.png" src="../../_images/89ab00040047dc4f5527082b3d335e51f1164c95130e2d49e6e24a74cdc4bd1e.png" />
<img alt="../../_images/28b74af773542a3865e64d117897c7322a8a2fd02f45e414947e085ac2aa7e21.png" src="../../_images/28b74af773542a3865e64d117897c7322a8a2fd02f45e414947e085ac2aa7e21.png" />
<img alt="../../_images/5bd694e2d67ea1cbc13ce701ca9ac8416ce0c8e72a1cf0b110b031974a3c236c.png" src="../../_images/5bd694e2d67ea1cbc13ce701ca9ac8416ce0c8e72a1cf0b110b031974a3c236c.png" />
<img alt="../../_images/9048e6aaa89d2d6008ce8bf9f69f539078c7d6d29d7c65043205e28cf9ed9759.png" src="../../_images/9048e6aaa89d2d6008ce8bf9f69f539078c7d6d29d7c65043205e28cf9ed9759.png" />
<img alt="../../_images/298a49dfd8da871d4036900df4ae065a22c28467069bc5b969a88d6ef1dbc068.png" src="../../_images/298a49dfd8da871d4036900df4ae065a22c28467069bc5b969a88d6ef1dbc068.png" />
<img alt="../../_images/14b99e3d8ec3bafa073e66e5ed5458805124fe1935d51f806fd965fd86d5fa72.png" src="../../_images/14b99e3d8ec3bafa073e66e5ed5458805124fe1935d51f806fd965fd86d5fa72.png" />
</div>
</div>
</section>
<section id="spatially-weighted-mean-annual-cycles">
<h4>Spatially-weighted mean annual cycles<a class="headerlink" href="#spatially-weighted-mean-annual-cycles" title="Link to this heading">#</a></h4>
<p>The seasonal means below indicate a good consistency for solar radiation products (both reflected and incoming) across the products. Longwave radiation products have consistency within the products‚Äô nominal accuracy, with CLARA systematically exhibiting, on average, about 10-15 W m-2 less than the other products concerning the downwelling longwave radiation; it is known, indeed, from the Validation Report (CM SAF Cloud, Albedo, Radiation data record, AVHRR-based, Edition 3 (CLARA-A3) Surface Radiation, doi:10.5676/EUM_SAF_CM/CLARA_AVHRR/V003) that CLARA surface downwelling radiation suffers from a negative bias of about -6 W m-2 compared to station-based observations, while ESA products (both longwave and shortwave radiative fluxes) are known to be positvely biased (ESA Cloud_cci Product Validation and Intercomparison Report (PVIR), <a class="reference external" href="https://climate.esa.int/media/documents/Cloud_Product-Validation-and-Intercomparison-Report-PVIR_v6.0.pdf" rel="noreferrer" target="_blank"></a>, and SRB CCI-ICDR: Product Quality Assurance Document (PQAD), <a class="reference external" href="https://confluence.ecmwf.int/pages/viewpage.action?pageId=304239428" rel="noreferrer" target="_blank">https://confluence.ecmwf.int/pages/viewpage.action?pageId=304239428</a>). Results on the outgoing longwave radiations show different distributions of the datasets, with CLARA and ESA Envisat exhibiting respectively the smallest and the largest values, on average.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="n">ts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">prodlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ts_var</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_timeseries</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">prodlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="n">prodlist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s1">&#39;CCI ERS&#39;</span><span class="p">:</span>
            <span class="n">tdrop</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">28</span><span class="p">)))</span>
            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">drop_sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tdrop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="n">ts_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
    <span class="n">ts_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts_var</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">prodlist</span><span class="p">})</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts_var</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">)})</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="n">col</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Radiation [W/m$^2$]&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]:</span>
    <span class="n">row</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">t1</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Monthly mean time series in the tropical domain (30¬∞S - 30¬∞N)&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Monthly mean time series in the tropical domain (30¬∞S - 30¬∞N)&#39;)
</pre></div>
</div>
<img alt="../../_images/ab035de6bfe60f4d4d3379f961e6c06a936ea4223f2f25bf30dac2b01d29e5f5.png" src="../../_images/ab035de6bfe60f4d4d3379f961e6c06a936ea4223f2f25bf30dac2b01d29e5f5.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="n">ts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="n">prodlist</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ts_var</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_nino3_4</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">prodlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
            <span class="n">prodlist</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s1">&#39;CCI ERS&#39;</span><span class="p">:</span>
            <span class="n">tdrop</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span><span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2002</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">28</span><span class="p">)))</span>
            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">drop_sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">tdrop</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ds_var</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span>
        <span class="n">ts_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds_var</span><span class="p">)</span>
    <span class="n">ts_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts_var</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">prodlist</span><span class="p">})</span>
    <span class="n">ts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ts_var</span><span class="p">)</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">t</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">ts</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">)})</span>

<span class="n">t1</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;F&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;M&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;J&quot;</span><span class="p">,</span> <span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;O&quot;</span><span class="p">,</span> <span class="s2">&quot;N&quot;</span><span class="p">,</span> <span class="s2">&quot;D&quot;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]:</span>
    <span class="n">col</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Radiation [W/m$^2$]&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]:</span>
    <span class="n">row</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">t1</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Monthly mean time series in Nino 3.4 region&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Monthly mean time series in Nino 3.4 region&#39;)
</pre></div>
</div>
<img alt="../../_images/b6f0361376e8019253a5395bea2dcf52c7191a7c35b6fbc91aee566a0ed606e7.png" src="../../_images/b6f0361376e8019253a5395bea2dcf52c7191a7c35b6fbc91aee566a0ed606e7.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">esa_ers2_time</span><span class="p">,</span> <span class="n">esa_envisat_time</span><span class="p">,</span> <span class="n">sentinel_time</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="time-weighted-means">
<h4>Time-weighted means<a class="headerlink" href="#time-weighted-means" title="Link to this heading">#</a></h4>
<p>Below, we calculate and plot time-weighted means for the different surface radiation budget products. Please note that periods differ across the products as illustrated in the previous section.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearSegmentedColormap</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_custom_colormap</span><span class="p">(</span><span class="n">colormaps</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">256</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a custom colormap by merging an arbitrary number of predefined colormaps.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        colormaps (list of matplotlib colormaps): List of colormaps to merge.</span>
<span class="sd">        n_colors (int): Total number of colors in the resulting colormap.</span>

<span class="sd">    Returns:</span>
<span class="sd">        LinearSegmentedColormap: The custom merged colormap.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">colormaps</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;You must provide at least one colormap.&quot;</span><span class="p">)</span>

    <span class="c1"># Number of colors to sample from each colormap</span>
    <span class="n">split</span> <span class="o">=</span> <span class="n">n_colors</span> <span class="o">//</span> <span class="nb">len</span><span class="p">(</span><span class="n">colormaps</span><span class="p">)</span>

    <span class="c1"># Sample colors from each colormap and combine</span>
    <span class="n">merged_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span>
        <span class="n">cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">split</span><span class="p">))</span> <span class="k">for</span> <span class="n">cmap</span> <span class="ow">in</span> <span class="n">colormaps</span>
    <span class="p">])</span>

    <span class="c1"># Handle rounding if n_colors is not evenly divisible</span>
    <span class="n">extra_colors</span> <span class="o">=</span> <span class="n">n_colors</span> <span class="o">-</span> <span class="n">merged_colors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">extra_colors</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">last_cmap</span> <span class="o">=</span> <span class="n">colormaps</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">merged_colors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">merged_colors</span><span class="p">,</span> <span class="n">last_cmap</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">extra_colors</span><span class="p">))))</span>

    <span class="c1"># Create and return the custom colormap</span>
    <span class="k">return</span> <span class="n">LinearSegmentedColormap</span><span class="o">.</span><span class="n">from_list</span><span class="p">(</span><span class="s2">&quot;CustomColormap&quot;</span><span class="p">,</span> <span class="n">merged_colors</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ds_maps</span><span class="p">,</span> <span class="n">times</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ds_periods_list</span><span class="p">,</span> <span class="n">periods</span><span class="p">):</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="n">m_var</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">vmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ds_maps</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">])</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ds_maps</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">])</span>
        <span class="n">prodlist</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">ds_maps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">==</span><span class="mi">1440</span><span class="p">:</span>
                <span class="n">prodlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
                <span class="n">m_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">89.75</span><span class="p">,</span> <span class="mf">89.75</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">179.85</span><span class="p">,</span> <span class="mf">179.85</span><span class="p">,</span> <span class="mi">360</span><span class="p">)}))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span><span class="o">==</span><span class="mi">720</span><span class="p">:</span>
                <span class="n">prodlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
                <span class="n">m_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">coarsen</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;latitude&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">89.75</span><span class="p">,</span> <span class="mf">89.75</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="s1">&#39;longitude&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">179.85</span><span class="p">,</span> <span class="mf">179.85</span><span class="p">,</span> <span class="mi">360</span><span class="p">)}))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prodlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
                <span class="n">m_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">])</span>
        <span class="n">m_var</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">mv</span> <span class="k">for</span> <span class="n">mv</span> <span class="ow">in</span> <span class="n">m_var</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">prodlist</span><span class="p">})</span>
        <span class="n">ms</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m_var</span><span class="p">)</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">m</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">ms</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;variable&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">)})</span>
    
    <span class="n">colormaps</span> <span class="o">=</span> <span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20c</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">tab20b_r</span><span class="p">]</span>
    <span class="n">custom_cmap</span> <span class="o">=</span> <span class="n">create_custom_colormap</span><span class="p">(</span><span class="n">colormaps</span><span class="p">,</span> <span class="n">n_colors</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>

    <span class="n">levels_cbar</span> <span class="o">=</span>  <span class="p">[</span><span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">260</span><span class="p">,</span> <span class="mi">280</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">325</span><span class="p">,</span> <span class="mi">350</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">425</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">550</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">570</span><span class="p">]</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">ms</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span>
                 <span class="n">row</span><span class="o">=</span><span class="s1">&#39;variable&#39;</span><span class="p">,</span> 
                 <span class="n">subplot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
                 <span class="n">levels</span><span class="o">=</span> <span class="n">levels_cbar</span><span class="p">,</span> <span class="c1">#range(int(ms.min()), int(ms.max()), 5),</span>
                 <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span>
                 <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">p2</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>  <span class="c1"># loop through the map axes</span>
        <span class="n">subplotspec</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">subplotspec</span><span class="o">.</span><span class="n">is_last_row</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">subplotspec</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">():</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;50m&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s2">&quot;compressed&quot;</span><span class="p">)</span>
    <span class="n">cax</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.80</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">])</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">add_colorbar</span><span class="p">(</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.85</span><span class="p">,</span><span class="mf">0.50</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Radiation [$W/m^2$]&#39;</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">p2</span><span class="o">.</span><span class="n">cbar</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">levels_cbar</span><span class="p">)</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">(),</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
    <span class="n">p2</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Mean map on the period &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/1f4576457dd25acaa00b2ec14b6d47ae5accaa6634cca16de866581ee028fc4f.png" src="../../_images/1f4576457dd25acaa00b2ec14b6d47ae5accaa6634cca16de866581ee028fc4f.png" />
<img alt="../../_images/75460a080114355327aa3899db5eb383983237ad1b3aba36f73f0c9518f95cbd.png" src="../../_images/75460a080114355327aa3899db5eb383983237ad1b3aba36f73f0c9518f95cbd.png" />
<img alt="../../_images/0e04fa8d1906f549e4b9cde0231cbc1c756db5c5cfd87714034691253d1e936c.png" src="../../_images/0e04fa8d1906f549e4b9cde0231cbc1c756db5c5cfd87714034691253d1e936c.png" />
</div>
</div>
<p>Maps exhibit generally similar features, and are shown for different data periods with consistent coverage across products. The incoming shortwave radiation peaks at low latitudes; variations in its reflected counterpart depend on albedo values, which are very low in the open ocean and then increase for land, and snow and it is the highest over desertic regions. Values of reflected shortwave radiation over the open ocean seem too low in ESA and C3S products (less than 8 W m-2), while CLARA values (13-16 W m-2) are more aligned to the open ocean albedo of 0.06. Differences, however, tend to cancel in the net shortwave radiation, as pointed out above.
The downwelling longwave radiation is also distributed geographically depending on the incoming solar radiation and cloudiness, and thus also peaks in the Tropical band. In contrast, the outgoing downwelling radiations rely on the surface temperature, and thus peak again in the Tropics, with the lowest values on ice-covered regions.
However, the different products are poorly consistent in many areas. In CLARA, for instance, the reflected shortwave is smaller over desertic regions and larger over oceans, while the incoming shortwave is on average smaller in the Tropical band. Downwelling longwave components are in good agreement, except for local differences (e.g., ESA ERS-2 over the Indian sub-continent). Differences in the outgoing longwave radiation are large over land, and mountainous areas in particular.</p>
</section>
<section id="spatially-weightes-zonal-means">
<h4>Spatially-weightes zonal means<a class="headerlink" href="#spatially-weightes-zonal-means" title="Link to this heading">#</a></h4>
<p>The code below will calculate and plot weighted zonal means for the surface radiation budget products. Please note that spatial and temporal sampling may differ across the products.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">ds_maps</span><span class="p">,</span> <span class="n">times</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ds_periods_list</span><span class="p">,</span> <span class="n">periods</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">ds</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ds_maps</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">var</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">)),</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span>
            <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Spatial Weighted Zonal Mean, Period: &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/702653294ec9659ca3e23cd9d566d64a675c425afefc934f49046a4e84d26611.png" src="../../_images/702653294ec9659ca3e23cd9d566d64a675c425afefc934f49046a4e84d26611.png" />
<img alt="../../_images/674ccbf592411721a97f3c14cd1fd932509cee047b98aaca4739107a6406430e.png" src="../../_images/674ccbf592411721a97f3c14cd1fd932509cee047b98aaca4739107a6406430e.png" />
<img alt="../../_images/0debe7c6605129adcb65221f6d148a60bb858203e40d67a214e6dc67dfb0097e.png" src="../../_images/0debe7c6605129adcb65221f6d148a60bb858203e40d67a214e6dc67dfb0097e.png" />
<img alt="../../_images/8bc6671a73ea92f78714e57db29e9a760efe49a761ef474afd8bf08d8b947236.png" src="../../_images/8bc6671a73ea92f78714e57db29e9a760efe49a761ef474afd8bf08d8b947236.png" />
<img alt="../../_images/ec46dbd46251a8f11977dce36d3c8701a866eb5c6304ba7d2660f9d7ca7ce3a2.png" src="../../_images/ec46dbd46251a8f11977dce36d3c8701a866eb5c6304ba7d2660f9d7ca7ce3a2.png" />
<img alt="../../_images/7447e5d329462a7bcb1135a5bb87b43bc53eafbafd23e503809ca41fee102ca8.png" src="../../_images/7447e5d329462a7bcb1135a5bb87b43bc53eafbafd23e503809ca41fee102ca8.png" />
<img alt="../../_images/9ef93ac8b9cc7e15dad8f3e6738b0931dd54169981939b4f47255ff957920208.png" src="../../_images/9ef93ac8b9cc7e15dad8f3e6738b0931dd54169981939b4f47255ff957920208.png" />
<img alt="../../_images/f070add58e5c21e5eae9d3300d377a376640415c3bce31c3db36030ebbfab48a.png" src="../../_images/f070add58e5c21e5eae9d3300d377a376640415c3bce31c3db36030ebbfab48a.png" />
<img alt="../../_images/e88f0eeda0811a900c9dd197f4063a7ad633711d1571d230ba37d8d655a880cb.png" src="../../_images/e88f0eeda0811a900c9dd197f4063a7ad633711d1571d230ba37d8d655a880cb.png" />
<img alt="../../_images/fd2e719d0a505a8e4a7691413415c2db9e1e8894e5e0c3d706c30d9a3cb717ac.png" src="../../_images/fd2e719d0a505a8e4a7691413415c2db9e1e8894e5e0c3d706c30d9a3cb717ac.png" />
<img alt="../../_images/0199247dda2f1148df6e5558ab22a65dd26d4998f4c3f874b3585a203ad74ce0.png" src="../../_images/0199247dda2f1148df6e5558ab22a65dd26d4998f4c3f874b3585a203ad74ce0.png" />
<img alt="../../_images/51cfc6b83a3ec5c79becb50bba4efc98be72a695d75918673d38cd596d35a955.png" src="../../_images/51cfc6b83a3ec5c79becb50bba4efc98be72a695d75918673d38cd596d35a955.png" />
<img alt="../../_images/715b89a6d84c12e52d26a5fe44eafe96e1753414d5ec76b67805a48f6c3fc3b2.png" src="../../_images/715b89a6d84c12e52d26a5fe44eafe96e1753414d5ec76b67805a48f6c3fc3b2.png" />
<img alt="../../_images/9a14e31a7d83399e75b9cfcfc1308fecebaa67c45721a03283400e91ecc035fa.png" src="../../_images/9a14e31a7d83399e75b9cfcfc1308fecebaa67c45721a03283400e91ecc035fa.png" />
<img alt="../../_images/251e76bcf55863c9cf86742a8bb9732483d2e3f35651e8f4c78077f8871e9f6e.png" src="../../_images/251e76bcf55863c9cf86742a8bb9732483d2e3f35651e8f4c78077f8871e9f6e.png" />
<img alt="../../_images/2f24ff0337006791a1b4e1daac7744102d3230ac176e92397bbf0e12458e8443.png" src="../../_images/2f24ff0337006791a1b4e1daac7744102d3230ac176e92397bbf0e12458e8443.png" />
<img alt="../../_images/6dddda96fa75f19f98e27e7cb60f285eff377da7255faa826d3bec04f4b0856c.png" src="../../_images/6dddda96fa75f19f98e27e7cb60f285eff377da7255faa826d3bec04f4b0856c.png" />
<img alt="../../_images/a53c039f65632dc17f9c127595a814ca2965b29aeb467656094169c9e2d99b36.png" src="../../_images/a53c039f65632dc17f9c127595a814ca2965b29aeb467656094169c9e2d99b36.png" />
</div>
</div>
<p>Zonal means exhibit generally similar features, although the different products are poorly consistent in several cases. Incoming shortwave data are inconsistent at high latitude also due to missing data therein during each hemispheric winter (which however may vary across different years), while downwelling longwave radiation datasets differ in the Tropical regions and in the Northern Hemisphere, in general.</p>
</section>
<section id="discussion-and-applications">
<h4>Discussion and applications<a class="headerlink" href="#discussion-and-applications" title="Link to this heading">#</a></h4>
<p>Evaluation of the surface radiation budget has large implications in climate studies and has been the subject of numerous investigations (e.g., <a class="reference external" href="https://doi.org/10.5194/acp-5-2847-2005" rel="noreferrer" target="_blank">[8]</a>). We briefly focus on two examples of application, respectively considering the ocean heat uptake and climate model simulation validation.
The ocean heat uptake refers to the fact that due to the large heat capacity of seawater, most of the excess heat of the Earth‚Äôs System is stored in the oceans. About 89% of the Earth Energy Imbalance at the top of the atmosphere is estimated to reside in the global ocean (<a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">[9]</a>); the surface heat budget is responsible for variations in net air-sea heat flux, i.e. the energy flux at the air-sea and ice-sea interface that regulates the temporal variations of the energy accumulated in the oceans. Ocean heat content tendency (or ocean heat uptake) is closely related to the surface radiation budget over the oceans, and any trend in the surface radiation budget will result in acceleration of the ocean warming. SRB observational products (<a class="reference external" href="https://doi.org/10.3389/fmars.2019.00430" rel="noreferrer" target="_blank">[5]</a>), eventually complemented with model reanalyses or simulations (<a class="reference external" href="https://doi.org/10.1038/s41467-022-32540-5" rel="noreferrer" target="_blank">[7]</a>; <a class="reference external" href="https://doi.org/10.1175/JCLI-D-21-0793.1" rel="noreferrer" target="_blank">[4]</a>), all contribute to our monitoring and understanding of ocean heat uptake variations. Further to the SRB variables, strictly speaking, the ocean heat loss due to turbulent fluxes (latent and sensible heat fluxes) needs to be accounted for in estimating the net air-sea heat flux; reanalyses or some observation-only products contain such fluxes, which can be, however, affected by large uncertainties due to the strong non-linearity of the turbulent fluxes.
The second application involves validating climate model simulations in terms of surface radiation budget. For climate predictions and projections, it is important to have a reliable surface radiation budget so that the ocean-atmosphere energy exchanges are accurately simulated. Inaccuracies in the SRB will result, in turn, in biases and systematic errors in the lower atmosphere temperature (e.g., <a class="reference external" href="https://doi.org/10.1002/2017JD027194" rel="noreferrer" target="_blank">[6]</a>). The SRB products can be used to spot inaccuracies in the climate model simulations, for instance focusing on specific regions, such as polar regions (<a class="reference external" href="https://doi.org/10.1002/2016JD025099" rel="noreferrer" target="_blank">[3]</a>).
For both applications, however, it is recommended to implement a product ensemble approach, where multiple products and sensors are combined together in an ensemble mean and ensemble standard deviation, to increase the robustness of the datasets and mitigate their possible inaccuracies and offsets. The ensemble standard deviation (spread) can then be used as an overall uncertainty estimate of the product.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
<li><p>IPCC Sixth Assessment Report (AR6), Working Group I, Chapter 7: The Earth‚Äôs Energy Budget, Climate Feedbacks, and Climate Sensitivity</p></li>
</ul>
<p>This chapter of IPCC AR6 WG1 emphasizes the role of surface radiation in climate feedback mechanisms and sensitivity analyses, discussing also the advancements since the Fifth Assessment Report, including improved satellite observations and energy flux measurements.
IPCC, 2021: Climate Change 2021: The Physical Science Basis. Contribution of Working Group I to the Sixth Assessment Report of the Intergovernmental Panel on Climate Change. Chapter 7.</p>
<p>Additionally, GCOS (<a class="reference external" href="https://gcos.wmo.int/site/global-climate-observing-system-gcos/essential-climate-variables" rel="noreferrer" target="_blank">https://gcos.wmo.int/site/global-climate-observing-system-gcos/essential-climate-variables</a>) identifies the Surface Radiation Budget as an Essential Climate Variable (ECV), underscoring its significance in climate monitoring. The system outlines specific requirements for SRB data products, including accuracy, resolution, and stability, to ensure reliable climate observations.</p>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.1016/j.agrformet.2006.02.001" rel="noreferrer" target="_blank">[1]</a> Yang, K., Koike, T., &amp; Ye, B. (2006). Improving estimation of hourly, daily, and monthly solar radiation by importing global data sets. Agricultural and Forest Meteorology, 137(1-2), 43-55</p>
<p><a class="reference external" href="https://doi.org/10.1175/2008BAMS2634.1" rel="noreferrer" target="_blank">[2]</a> Trenberth, K. E., Fasullo, J. T., &amp; Kiehl, J. (2009). Earth‚Äôs global energy budget. Bulletin of the American Meteorological Society, 90(3), 311-324</p>
<p><a class="reference external" href="https://doi.org/10.1002/2016JD025099" rel="noreferrer" target="_blank">[3]</a> Boeke, R. C., and P. C. Taylor (2016), Evaluation of the Arctic surface radiation budget in CMIP5 models, J. Geophys. Res. Atmos., 121, 8525‚Äì8548, doi:10.1002/2016JD025099.</p>
<p><a class="reference external" href="https://doi.org/10.1175/JCLI-D-21-0793.1" rel="noreferrer" target="_blank">[4]</a> Cl√©ment, L., E. L. McDonagh, J. M. Gregory, Q. Wu, A. Marzocchi, J. D. Zika, and A. J. G. Nurser, 2022: Mechanisms of Ocean Heat Uptake along and across Isopycnals. J. Climate, 35, 4885‚Äì4904, <a class="reference external" href="https://doi.org/10.1175/JCLI-D-21-0793.1" rel="noreferrer" target="_blank">https://doi.org/10.1175/JCLI-D-21-0793.1</a></p>
<p><a class="reference external" href="https://doi.org/10.3389/fmars.2019.00430" rel="noreferrer" target="_blank">[5]</a> Cronin MF, Gentemann CL, Edson J, Ueki I, Bourassa M, Brown S, Clayson CA, Fairall CW, Farrar JT, Gille ST, Gulev S, Josey SA, Kato S, Katsumata M, Kent E, Krug M, Minnett PJ, Parfitt R, Pinker RT, Stackhouse PW Jr, Swart S, Tomita H, Vandemark D, Weller RA, Yoneyama K, Yu L and Zhang D (2019) Air-Sea Fluxes With a Focus on Heat and Momentum. Front. Mar. Sci. 6:430. doi:10.3389/fmars.2019.00430</p>
<p><a class="reference external" href="https://doi.org/10.1002/2017JD027194" rel="noreferrer" target="_blank">[6]</a> Ma, H.-Y., Klein, S. A., Xie, S., Zhang, C., Tang, S., Tang, Q. et al (2018). CAUSES: On the role of surface energy budget errors to the warm surface air temperature error over the Central United States. Journal of Geophysical Research: Atmospheres, 123, 2888‚Äì2909. <a class="reference external" href="https://doi.org/10.1002/2017JD027194" rel="noreferrer" target="_blank">https://doi.org/10.1002/2017JD027194</a></p>
<p><a class="reference external" href="https://doi.org/10.1038/s41467-022-32540-5" rel="noreferrer" target="_blank">[7]</a> Huguenin, M.F., Holmes, R.M. &amp; England, M.H. Drivers and distribution of global ocean heat uptake over the last half century. Nat Commun 13, 4921 (2022). <a class="reference external" href="https://doi.org/10.1038/s41467-022-32540-5" rel="noreferrer" target="_blank">https://doi.org/10.1038/s41467-022-32540-5</a></p>
<p><a class="reference external" href="https://doi.org/10.5194/acp-5-2847-2005" rel="noreferrer" target="_blank">[8]</a> Hatzianastassiou, N., Matsoukas, C., Fotiadi, A., Pavlakis, K. G., Drakakis, E., Hatzidimitriou, D., and Vardavas, I.: Global distribution of Earth‚Äôs surface shortwave radiation budget, Atmos. Chem. Phys., 5, 2847‚Äì2867, <a class="reference external" href="https://doi.org/10.5194/acp-5-2847-2005" rel="noreferrer" target="_blank">https://doi.org/10.5194/acp-5-2847-2005</a>, 2005.</p>
<p><a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">[9]</a> von Schuckmann, et al.: Heat stored in the Earth system 1960‚Äì2020: where does the energy go?, Earth Syst. Sci. Data, 15, 1675‚Äì1709, <a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">https://doi.org/10.5194/essd-15-1675-2023</a>, 2023.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Atmosphere_Physics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Atmosphere_Physics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.1. </span>Atmosphere Physics</p>
      </div>
    </a>
    <a class="right-next"
       href="../Atmospheric_Composition/Atmospheric_Composition.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.2. </span>Atmospheric Composition</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-use-surface-radiation-budget-to-monitor-climate-change">üåç Use case: Use surface radiation budget to monitor climate change</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-data-to-use-and-setup-code">1. Choose the data to use and setup code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">2. Download and Transform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-spatial-weighted-time-series-time-weighted-means-spatial-weighted-zonal-means">3. Plot spatial weighted time series, time weighted means, spatial weighted zonal means</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weighted-time-series">Spatially-weighted time series</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weighted-mean-annual-cycles">Spatially-weighted mean annual cycles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#time-weighted-means">Time-weighted means</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weightes-zonal-means">Spatially-weightes zonal means</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-applications">Discussion and applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>