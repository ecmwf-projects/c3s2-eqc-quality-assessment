
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.2.3. Bias in precipitation-based indices for impact models &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q03';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.2.4. Projected changes in precipitation-based indices for impact models" href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q04.html" />
    <link rel="prev" title="5.2.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector" href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q02.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">⚠️This is under development!⚠️</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Satellite Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Satellite_ECVs/satellite.html">1. Quality assessments for Satellite Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/satellite_satellite-fire-burned-area_climate-and-weather-extremes_q01.html">1.4.1. Satellite fire burned area completeness for seasonal climatology maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/satellite_satellite-fire-burned-area_trend-assessment_q02.html">1.4.2. Satellite fire burned area trends assessment for climate monitoring</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_forecast-skill_q02.html">4.1. Seasonal forecasts bias assessment for impact models</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Climate Projections</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../climate.html">5. Quality assessments for Climate Projections</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q02.html">5.1.1. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q03.html">5.1.2. Uncertainty in projected changes in extreme temperature indices at a 2°C Global Warming Level for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CMIP6/climate_projections-cmip6_climate-impact-indicators_q01.html">5.1.3. Biases in energy-consumption-related indices in Europe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CMIP6/climate_projections-cmip6_climate-impact-indicators_q02.html">5.1.4. Uncertainty in projected changes of energy consumption in Europe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CMIP6/climate_projections-cmip6_climate-impact-indicators_q03.html">5.1.5. Uncertainty in projected changes of energy consumption in Europe at a 2°C Global Warming Level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CMIP6/climate_projections-cmip6_validation_q10.html">5.1.6. Testing the capability of CMIP6 GCMs to represent precipitation variability</a></li>
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="CORDEX.html">5.2. CORDEX</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q01.html">5.2.1. Bias in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q02.html">5.2.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">5.2.3. Bias in precipitation-based indices for impact models</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q04.html">5.2.4. Projected changes in precipitation-based indices for impact models</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FClimate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q03.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q03.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Bias in precipitation-based indices for impact models</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-verification-of-precipitation-indices-used-as-proxies-for-rainfall-erosivity-in-europe-under-future-climate-scenarios">🌍 Use case: Verification of precipitation indices used as proxies for rainfall erosivity in Europe under future climate scenarios.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">❓ Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-requests-and-functions-definition">1. Parameters, requests and functions definition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1.1. Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-parameters">1.2. Define Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-models">1.3. Define models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-era5-request">1.4. Define ERA5 request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-model-requests">1.5. Define model requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">1.6. Functions to cache</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-and-processing">2. Downloading and processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-era5">2.1. Download and transform ERA5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-models">2.2. Download and transform models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-land-sea-mask-change-attributes-and-cut-the-region-to-show">2.3. Apply land-sea mask, change attributes and cut the region to show</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">3. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-plotting-functions">3.1. Define plotting functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-ensemble-maps">3.2. Plot ensemble maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-model-maps">3.3. Plot model maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-bias-maps">3.4. Plot bias maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots-of-the-historical-trend">3.5. Boxplots of the historical trend</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion">3.6. Results summary and discussion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="bias-in-precipitation-based-indices-for-impact-models">
<h1><span class="section-number">5.2.3. </span>Bias in precipitation-based indices for impact models<a class="headerlink" href="#bias-in-precipitation-based-indices-for-impact-models" title="Link to this heading">#</a></h1>
<p>Production date: 29-05-2024</p>
<p>Produced by: CMCC foundation - Euro-Mediterranean Center on Climate Change. Albert Martinez Boti.</p>
<section id="use-case-verification-of-precipitation-indices-used-as-proxies-for-rainfall-erosivity-in-europe-under-future-climate-scenarios">
<h2>🌍 Use case: Verification of precipitation indices used as proxies for rainfall erosivity in Europe under future climate scenarios.<a class="headerlink" href="#use-case-verification-of-precipitation-indices-used-as-proxies-for-rainfall-erosivity-in-europe-under-future-climate-scenarios" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>❓ Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How well do CORDEX projections represent climatology and trends of precipitation-based indices in Europe?</strong></p></li>
</ul>
<p>Soil erosion stands as one of the primary environmental concerns in Europe <a class="reference external" href="https://doi.org/10.1016/j.envsci.2015.08.012">[1]</a>. Its accelerated occurrence can precipitate a decline in ecosystem stability, land productivity, and overall land degradation, resulting in diminished income for farmers <a class="reference external" href="https://doi.org/10.1016/j.landusepol.2012.11.007">[2]</a>. This notebook is designed to evaluate the effectiveness of a specific set of models from <strong><a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cordex-domains-single-levels?tab=overview">CORDEX</a></strong> Regional Climate Models (RCMs) in accurately replicating historical precipitation extreme indices. These selected rainfall indicators are recognised as valuable proxies for rainfall erosivity, a factor directly linked to empirical calculations of soil loss, as outlined in an application available through the old CDS platform (<a class="reference external" href="https://datastore.copernicus-climate.eu/documents/sis-soil-erosion/C3S_D429d.2.3.2_Product_User_Guide_v1.2.pdf">dataset documentation</a>). The five precipitation-based indices used here are calculated using the <strong><a class="reference external" href="https://icclim.readthedocs.io/en/stable/">icclim</a></strong> package, them being:</p>
<ul class="simple">
<li><p>Spell length of days with precipitation greater than 1 mm (also known as “Maximum consecutive wet days” - “CWD”)</p></li>
<li><p>Number of heavy precipitation days (Precip &gt;= 20mm - “R20mm”)</p></li>
<li><p>Number of wet days (Precip &gt;= 1mm - “RR1”)</p></li>
<li><p>Maximum 1-day total precipitation (“RX1day”)</p></li>
<li><p>Maximum 5-day total precipitation (“RX5day”).</p></li>
</ul>
<p>Within this notebook, these calculations are performed over the temporal aggregation of DJF and for the historical period spanning from 1971 to 2000. It is important to note that the results presented here pertain to a specific subset of the CORDEX ensemble and may not be generalisable to the entire dataset. Also note that a separate assessment examines the representation of trends of these indices for the same models during a fixed future period (2015-2099).</p>
</section>
<section id="quality-assessment-statement">
<h2>📢 Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>The assessment of CORDEX projections regarding the climatology and trend of precipitation-based indices across Europe requires a comprehensive evaluation of the historical period.</p></li>
<li><p>The subset of Regional Climate Models (RCMs) considered in this notebook for the seasonal aggregation of DJF generally struggle to replicate both the observed climatology and historical trends of the selected precipitation-based indices, with particular difficulty in capturing the trends. However, the models manage to accurately capture the climatology and trend directions for certain regions and indices. For instance, the models reflect an increasing trend for the CWD index in the western part of the Iberian Peninsula and an upward trend for RR1 in central Europe. Users should take into account these regional variations, the specific indices they intend to use, the differing bias behaviours between climatology and trends, and the necessity of bias-correcting data before using it for hydrological applications <a class="reference external" href="https://doi.org/10.1016/j.jhydrol.2012.05.052">[3]</a>.</p></li>
<li><p>Precipitation trends in observational and reanalysis datasets are generally less robust and more challenging to detect compared to temperature trends. This limitation is also evident in model simulations.</p></li>
<li><p>While ERA5 serves as a reference dataset in this notebook, it is important to recognise its inherent uncertainties. Although uncertainties exist for all variables, these biases are especially relevant for variables like surface wind or precipitation, as shown in <a class="reference external" href="https://doi.org/10.1002/qj.3616">[4]</a> and <a class="reference external" href="https://doi.org/10.3390/atmos12111462">[5]</a>. This highlights the need for cautious interpretation, particularly in the context of precipitation extremes.</p></li>
<li><p>A larger GCM-RCM matrix should be considered when addressing specific cases to enhance the robustness of the analysis and account for uncertainties <a class="reference external" href="https://doi.org/10.1002/wcc.8">[6]</a><a class="reference external" href="https://doi.org/10.1088/1748-9326/aacc77">[7]</a>.</p></li>
</ul>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/4890e24e-847d-40bd-91e3-ea3202916a49.png"><img alt="mean_bias_RR1" src="../../_images/4890e24e-847d-40bd-91e3-ea3202916a49.png" style="width: 900px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 5.2.3.1 </span><span class="caption-text">Number of wet days (Precip &gt;= 1mm) (‘RRI’) for the temporal aggreggtion of ‘DJF’. Mean bias for the historical period (1971 - 2000) of each individual CORDEX model.</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p><a id='INITIAL NOTE'></a></p>
<div class="alert alert-block alert-warning">  
<b>NOTE on the DJF selection</b>:<br> 
It is important to note that using seasonal temporal aggregations offers only partial insights into the dynamics. For more comprehensive results, it is advisable to also consider other seasons and annual aggregations. However, for the sake of efficiency and to avoid making the notebook too heavy, we have opted to prioritise seasonal aggregations.</section>
<section id="methodology">
<h2>📋 Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>This notebook provides an assessment of the systematic errors (trend and climatology) in a subset of 9 models from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cordex-domains-single-levels?tab=overview">CORDEX</a>. The analysis involves comparing model predictions with ERA5 reanalysis data using several precipitation-based indices. These indices, calculated over the DJF period for the historical period spanning from 1971 to 2000, include:</p>
<ul class="simple">
<li><p>Spell length of days with precipitation greater than 1 mm (also known as “Maximum consecutive wet days” - “CWD”)</p></li>
<li><p>Number of heavy precipitation days (Precip &gt;= 20mm - “R20mm”)</p></li>
<li><p>Number of wet days (Precip &gt;= 1mm - “RR1”)</p></li>
<li><p>Maximum 1-day total precipitation (“RX1day”)</p></li>
<li><p>Maximum 5-day total precipitation (“RX5day”).</p></li>
</ul>
<p>In particular, spatial patterns of climate mean and trend, along with biases, are examined and displayed for each model and the ensemble median (calculated for each grid cell). Additionally, spatially-averaged trend values are analysed and presented using box plots to provide an overview of trend behavior across the distribution of the chosen subset of models when averaged across Europe.</p>
<p>The analysis and results follow the next outline:</p>
<p><strong><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1"><span class="std std-ref">1. Parameters, requests and functions definition</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-1"><span class="std std-ref">1.1. Import packages</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-2"><span class="std std-ref">1.2. Define Parameters</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-3"><span class="std std-ref">1.3. Define models</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-4"><span class="std std-ref">1.4. Define ERA5 request</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-5"><span class="std std-ref">1.5. Define model requests</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-6"><span class="std std-ref">1.6. Functions to cache</span></a></p></li>
</ul>
<p><strong><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2"><span class="std std-ref">2. Downloading and processing</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2-1"><span class="std std-ref">2.1. Download and transform ERA5</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2-2"><span class="std std-ref">2.2. Download and transform models</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2-3"><span class="std std-ref">2.3. Apply land-sea mask, change attributes and cut the region to show</span></a></p></li>
</ul>
<p><strong><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3"><span class="std std-ref">3. Plot and describe results</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-1"><span class="std std-ref">3.1. Define plotting functions</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-2"><span class="std std-ref">3.2. Plot ensemble maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-3"><span class="std std-ref">3.3. Plot model maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-4"><span class="std std-ref">3.4. Plot bias maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-5"><span class="std std-ref">3.5. Boxplots of the historical trend</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-6"><span class="std std-ref">3.6. Results summary and discussion</span></a></p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>📈 Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="parameters-requests-and-functions-definition">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1"></span><h3>1. Parameters, requests and functions definition<a class="headerlink" href="#parameters-requests-and-functions-definition" title="Link to this heading">#</a></h3>
<section id="import-packages">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-1"></span><h4>1.1. Import packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">icclim</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xarrayMannKendall</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mann_Kendall_test</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;hatch.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-parameters">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-2"></span><h4>1.2. Define Parameters<a class="headerlink" href="#define-parameters" title="Link to this heading">#</a></h4>
<p>In the “Define Parameters” section, various customisable options for the notebook are specified:</p>
<ul class="simple">
<li><p>The initial and ending year used for the historical period can be specified by changing the parameters <code class="docutils literal notranslate"><span class="pre">year_start</span></code> and <code class="docutils literal notranslate"><span class="pre">year_stop</span></code> (1971-2000 is chosen for consistency between CORDEX and CMIP6).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">timeseries</span></code> set the temporal aggregation. For instance, selecting “DJF” implies considering only the winter season.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collection_id</span></code> provides the choice between Global Climate Models CMIP6 or Regional Climate Models CORDEX. Although the code allows choosing between CMIP6 or CORDEX, the example provided in this notebook deals with CORDEX RCMs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">area</span></code> allows specifying the geographical domain of interest.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">interpolation_method</span></code> parameter allows selecting the interpolation method when regridding is performed over the indices.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">chunk</span></code> selection allows the user to define if dividing into chunks when downloading the data on their local machine. Although it does not significantly affect the analysis, it is recommended to keep the default value for optimal performance.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time period</span>
<span class="n">year_start</span> <span class="o">=</span> <span class="mi">1971</span>
<span class="n">year_stop</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="k">assert</span> <span class="n">year_start</span> <span class="o">&gt;=</span> <span class="mi">1971</span>

<span class="c1"># Choose annual or seasonal timeseries</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;DJF&quot;</span>
<span class="k">assert</span> <span class="n">timeseries</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;annual&quot;</span><span class="p">,</span> <span class="s2">&quot;DJF&quot;</span><span class="p">,</span> <span class="s2">&quot;MAM&quot;</span><span class="p">,</span> <span class="s2">&quot;JJA&quot;</span><span class="p">,</span> <span class="s2">&quot;SON&quot;</span><span class="p">)</span>

<span class="c1"># Variable</span>
<span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;precipitation&quot;</span>
<span class="k">assert</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">)</span>

<span class="c1"># Choose CORDEX or CMIP6</span>
<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;CORDEX&quot;</span>
<span class="k">assert</span> <span class="n">collection_id</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CORDEX&quot;</span><span class="p">,</span> <span class="s2">&quot;CMIP6&quot;</span><span class="p">)</span>

<span class="c1"># Interpolation method</span>
<span class="n">interpolation_method</span> <span class="o">=</span> <span class="s2">&quot;bilinear&quot;</span>

<span class="c1"># Area to show</span>
<span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="mi">72</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>

<span class="c1"># Chunks for download</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-models">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-3"></span><h4>1.3. Define models<a class="headerlink" href="#define-models" title="Link to this heading">#</a></h4>
<p>The following climate analyses are performed considering a subset of GCMs from CMIP6. Models names are listed in the parameters below. Some variable-dependent parameters are also selected, as the <code class="docutils literal notranslate"><span class="pre">index_names</span></code> parameter, which specifies the precipitation-based indices (‘CWD’, ‘R20mm’, ‘RR1’, ‘RX1day’ and ‘RX5day’ in our case) from the <a class="reference external" href="https://icclim.readthedocs.io/en/stable/">icclim</a> Python package.</p>
<p>When choosing Cordex models, it is crucial to consider the availability of RCMs for the selected GCM and the specified region. The listed RCMs, for instance, are accessible for the GCM “mpi_m_mpi_esm_lr” in the “europe” cordex_domain. To confirm the available combinations, refer to the <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cordex-domains-single-levels?tab=overview">CORDEX</a> CDS catalogue entry.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_cordex</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;clmcom_clm_cclm4_8_17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;clmcom_eth_cosmo_crclim&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cnrm_aladin63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dmi_hirham5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;knmi_racmo22e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mohc_hadrem3_ga7_05&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mpi_csc_remo2009&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smhi_rca4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;uhoh_wrf361h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="k">match</span> <span class="n">variable</span><span class="p">:</span>
    <span class="k">case</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span>
        <span class="n">resample_reduction</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span>
        <span class="n">index_names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SU&quot;</span><span class="p">,</span> <span class="s2">&quot;TX90p&quot;</span><span class="p">)</span>
        <span class="n">era5_variable</span> <span class="o">=</span> <span class="s2">&quot;2m_temperature&quot;</span>
        <span class="n">cordex_variable</span> <span class="o">=</span> <span class="s2">&quot;maximum_2m_temperature_in_the_last_24_hours&quot;</span>
        <span class="n">cmip6_variable</span> <span class="o">=</span> <span class="s2">&quot;daily_maximum_near_surface_air_temperature&quot;</span>
        <span class="n">models_cmip6</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;access_cm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;awi_cm_1_1_mr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmcc_esm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cnrm_cm6_1_hr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec_earth3_cc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gfdl_esm4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inm_cm5_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;miroc6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mpi_esm1_2_lr&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        
        <span class="c1"># Colormaps</span>
        <span class="n">cmaps</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span>
        <span class="n">cmaps_trend</span> <span class="o">=</span> <span class="n">cmaps_bias</span> <span class="o">=</span> <span class="s2">&quot;RdBu_r&quot;</span>
        <span class="c1">#Define dictionaries to use in titles and caption</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;SU&quot;</span><span class="p">:</span><span class="s2">&quot;Number of summer days&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TX90p&quot;</span><span class="p">:</span><span class="s2">&quot;Number of days with daily maximum temperatures exceeding the daily 90th percentile of maximum temperature for a 5-day moving window&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">:</span>
        <span class="n">resample_reduction</span> <span class="o">=</span> <span class="s2">&quot;sum&quot;</span>
        <span class="n">index_names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CWD&quot;</span><span class="p">,</span> <span class="s2">&quot;R20mm&quot;</span><span class="p">,</span> <span class="s2">&quot;RR1&quot;</span><span class="p">,</span> <span class="s2">&quot;RX1day&quot;</span><span class="p">,</span> <span class="s2">&quot;RX5day&quot;</span><span class="p">)</span>
        <span class="n">era5_variable</span> <span class="o">=</span> <span class="s2">&quot;total_precipitation&quot;</span>
        <span class="n">cordex_variable</span> <span class="o">=</span> <span class="s2">&quot;mean_precipitation_flux&quot;</span>
        <span class="n">cmip6_variable</span> <span class="o">=</span> <span class="s2">&quot;precipitation&quot;</span>
        <span class="n">models_cmip6</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;access_cm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bcc_csm2_mr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmcc_esm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cnrm_cm6_1_hr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec_earth3_cc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gfdl_esm4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inm_cm5_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;miroc6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mpi_esm1_2_lr&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Colormaps</span>
        <span class="n">cmaps</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span>
        <span class="n">cmaps_trend</span> <span class="o">=</span> <span class="n">cmaps_bias</span> <span class="o">=</span> <span class="s2">&quot;RdBu&quot;</span>
        
        <span class="c1">#Define dictionaries to use in titles and caption</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;RX1day&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum 1-day total precipitation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RX5day&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum 5-day total precipitation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RR1&quot;</span><span class="p">:</span><span class="s2">&quot;Number of wet days (Precip &gt;= 1mm)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R20mm&quot;</span><span class="p">:</span><span class="s2">&quot;Number of heavy precipitation days (Precip &gt;= 20mm)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CWD&quot;</span><span class="p">:</span><span class="s2">&quot;Maximum consecutive wet days&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-era5-request">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-4"></span><h4>1.4. Define ERA5 request<a class="headerlink" href="#define-era5-request" title="Link to this heading">#</a></h4>
<p>Within this notebook, ERA5 serves as the reference product. In this section, we set the required parameters for the cds-api data-request of ERA5.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_era</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;reanalysis-era5-single-levels&quot;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="s2">&quot;reanalysis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">hour</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">:00&quot;</span> <span class="k">for</span> <span class="n">hour</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)],</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">era5_variable</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;DJF&quot;</span><span class="p">),</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span>  <span class="c1"># Include D(year-1)</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
        <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)],</span>
        <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">area</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">request_lsm</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">request_era</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="n">request_era</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="o">|</span> <span class="p">{</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;1940&quot;</span><span class="p">,</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;land_sea_mask&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-model-requests">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-5"></span><h4>1.5. Define model requests<a class="headerlink" href="#define-model-requests" title="Link to this heading">#</a></h4>
<p>In this section we set the required parameters for the cds-api data-request.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">get_cordex_years</span></code> function is employed to choose suitable data chunks for CORDEX data requests.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">Weights</span> <span class="pre">=</span> <span class="pre">True</span></code>, spatial weighting is applied for calculations requiring spatial data aggregation. This is particularly relevant for CMIP6 GCMs with regular lon-lat grids that do not consider varying surface extensions at different latitudes. In contrast, CORDEX RCMs, using rotated grids, inherently account for different cell surfaces based on latitude, eliminating the need for a latitude cosine multiplicative factor (<code class="docutils literal notranslate"><span class="pre">Weights</span> <span class="pre">=</span> <span class="pre">False</span></code>).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_cordex</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;europe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;historical&quot;</span><span class="p">,</span>
    <span class="s2">&quot;horizontal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;0_11_degree_x_0_11_degree&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;daily_mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">cordex_variable</span><span class="p">,</span>
    <span class="s2">&quot;gcm_model&quot;</span><span class="p">:</span> <span class="s2">&quot;mpi_m_mpi_esm_lr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ensemble_member&quot;</span><span class="p">:</span> <span class="s2">&quot;r1i1p1&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">request_cmip6</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;historical&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">cmip6_variable</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">],</span>  <span class="c1"># Include D(year-1)</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)],</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">area</span><span class="p">,</span>
<span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_cordex_years</span><span class="p">(</span>
    <span class="n">year_start</span><span class="p">,</span>
    <span class="n">year_stop</span><span class="p">,</span>
    <span class="n">timeseries</span><span class="p">,</span>
    <span class="n">start_years</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1951</span><span class="p">,</span> <span class="mi">2097</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="n">end_years</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1955</span><span class="p">,</span> <span class="mi">2101</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
<span class="p">):</span>
    <span class="n">start_year</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">end_year</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">year_start</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;DJF&quot;</span><span class="p">),</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_years</span><span class="p">,</span> <span class="n">end_years</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">years</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">start_year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">end_year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>


<span class="n">model_requests</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CORDEX&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_cordex</span><span class="p">:</span>
        <span class="n">start_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1970</span> <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;smhi_rca4&quot;</span><span class="p">,</span> <span class="s2">&quot;uhoh_wrf361h&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1966</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="mi">1971</span><span class="p">,</span> <span class="mi">2097</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">end_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1970</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">2101</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="n">model_requests</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;projections-cordex-domains-single-levels&quot;</span><span class="p">,</span>
            <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s2">&quot;rcm_model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">request_cordex</span><span class="p">,</span>
                    <span class="s2">&quot;start_year&quot;</span><span class="p">:</span> <span class="n">start_year</span><span class="p">,</span>
                    <span class="s2">&quot;end_year&quot;</span><span class="p">:</span> <span class="n">end_year</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">get_cordex_years</span><span class="p">(</span>
                        <span class="n">year_start</span><span class="p">,</span>
                        <span class="n">year_stop</span><span class="p">,</span>
                        <span class="n">timeseries</span><span class="p">,</span>
                        <span class="n">start_years</span><span class="o">=</span><span class="n">start_years</span><span class="p">,</span>
                        <span class="n">end_years</span><span class="o">=</span><span class="n">end_years</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">],</span>
        <span class="p">)</span>
<span class="k">elif</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_cmip6</span><span class="p">:</span>
        <span class="n">model_requests</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;projections-cmip6&quot;</span><span class="p">,</span>
            <span class="n">download</span><span class="o">.</span><span class="n">split_request</span><span class="p">(</span><span class="n">request_cmip6</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">},</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">),</span>
        <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="functions-to-cache">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-1-6"></span><h4>1.6. Functions to cache<a class="headerlink" href="#functions-to-cache" title="Link to this heading">#</a></h4>
<p>In this section, functions that will be executed in the caching phase are defined. Caching is the process of storing copies of files in a temporary storage location, so that they can be accessed more quickly. This process also checks if the user has already downloaded a file, avoiding redundant downloads.</p>
<p>Functions description:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">select_timeseries</span></code> function subsets the dataset based on the chosen <code class="docutils literal notranslate"><span class="pre">timeseries</span></code> parameter.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">compute_indices</span></code> function utilises the icclim package to calculate the precipitation-based indices.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">compute_trends</span></code> function employs the Mann-Kendall test for trend calculation.</p></li>
<li><p>Finally, the <code class="docutils literal notranslate"><span class="pre">compute_indices_and_trends</span></code> accumulates the daily precipitation (only if we are dealing with ERA5), calculates the precipitation-based indices for the corresponding temporal aggregation using the <code class="docutils literal notranslate"><span class="pre">compute_indices</span></code> function, determines the indices mean over the historical period (1971-2000), obtain the trends using the <code class="docutils literal notranslate"><span class="pre">compute_trends</span></code> function, and offers an option for regridding to ERA5 if required.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">select_timeseries</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span><span class="p">,</span> <span class="n">index_names</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;annual&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year_start</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">year_stop</span><span class="p">)))</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year_start</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">-12&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">-11&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="s2">&quot;RX5day&quot;</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ds</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  
    
<span class="k">def</span><span class="w"> </span><span class="nf">compute_indices</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">index_names</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">):</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">datasets</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">))</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.nc&quot;</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">]</span>
    <span class="n">xr</span><span class="o">.</span><span class="n">save_mfdataset</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="n">in_files</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">/rechunked.zarr&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="mi">365</span> <span class="o">*</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span> <span class="k">else</span> <span class="s2">&quot;auto&quot;</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span><span class="n">in_files</span><span class="p">)</span>

    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">icclim</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
            <span class="n">in_files</span><span class="o">=</span><span class="n">in_files</span><span class="p">,</span>
            <span class="n">out_file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">index_name</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span>
            <span class="n">slice_mode</span><span class="o">=</span><span class="s2">&quot;year&quot;</span> <span class="k">if</span> <span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;annual&quot;</span> <span class="k">else</span> <span class="n">timeseries</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">index_name</span> <span class="ow">in</span> <span class="n">index_names</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="o">.</span><span class="n">drop_dims</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_trends</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">(</span><span class="n">lat</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">])</span>
    <span class="p">(</span><span class="n">lon</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">])</span>
    <span class="n">coords_name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">Mann_Kendall_test</span><span class="p">(</span>
            <span class="n">da</span> <span class="o">-</span> <span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;theilslopes&quot;</span><span class="p">,</span>
            <span class="n">coords_name</span><span class="o">=</span><span class="n">coords_name</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coords_name</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">})</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="n">dim</span><span class="p">:</span> <span class="n">da</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">})</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_bounds</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">}</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">bounds</span><span class="p">):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">add_bounds</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_grid_out</span><span class="p">(</span><span class="n">request_grid_out</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="n">ds_regrid</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span><span class="o">*</span><span class="n">request_grid_out</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
        <span class="n">ds_regrid</span> <span class="o">=</span> <span class="n">add_bounds</span><span class="p">(</span><span class="n">ds_regrid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ds_regrid</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">coord</span><span class="p">])</span>
    <span class="n">grid_out</span> <span class="o">=</span> <span class="n">ds_regrid</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span>
    <span class="n">coords_to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_out</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_out</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
    <span class="n">grid_out</span> <span class="o">=</span> <span class="n">ds_regrid</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">coords_to_drop</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">grid_out</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">grid_out</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_indices_and_trends</span><span class="p">(</span>
    <span class="n">ds</span><span class="p">,</span>
    <span class="n">index_names</span><span class="p">,</span>
    <span class="n">timeseries</span><span class="p">,</span>
    <span class="n">year_start</span><span class="p">,</span>
    <span class="n">year_stop</span><span class="p">,</span>
    <span class="n">resample_reduction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">request_grid_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">regrid_kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">request_grid_out</span> <span class="ow">and</span> <span class="n">regrid_kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="n">request_grid_out</span> <span class="ow">or</span> <span class="n">regrid_kwargs</span>
    <span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)]</span>

    <span class="c1"># Original bounds for conservative interpolation</span>
    <span class="k">if</span> <span class="n">regrid_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">add_bounds</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get_bounds</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">select_timeseries</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span><span class="p">,</span><span class="n">index_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">resample_reduction</span><span class="p">:</span>
        <span class="n">resampled</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">resampled</span><span class="p">,</span> <span class="n">resample_reduction</span><span class="p">)(</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resample_reduction</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / day&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
        <span class="n">ds_indices</span> <span class="o">=</span> <span class="n">compute_indices</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">index_names</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">tmpdir</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">ds_trends</span> <span class="o">=</span> <span class="n">compute_trends</span><span class="p">(</span><span class="n">ds_indices</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_indices</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_trends</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request_grid_out</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">merge</span><span class="p">({</span><span class="n">da</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">da</span> <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">}),</span>
                <span class="n">grid_out</span><span class="o">=</span><span class="n">get_grid_out</span><span class="p">(</span><span class="n">request_grid_out</span><span class="p">,</span> <span class="n">regrid_kwargs</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]),</span>
                <span class="o">**</span><span class="n">regrid_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="downloading-and-processing">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2"></span><h3>2. Downloading and processing<a class="headerlink" href="#downloading-and-processing" title="Link to this heading">#</a></h3>
<section id="download-and-transform-era5">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2-1"></span><h4>2.1. Download and transform ERA5<a class="headerlink" href="#download-and-transform-era5" title="Link to this heading">#</a></h4>
<p>In this section, the <code class="docutils literal notranslate"><span class="pre">download.download_and_transform</span></code> function from the ‘c3s_eqc_automatic_quality_control’ package is employed to download ERA5 reference data, accumulate daily precipitation from hourly data, compute the precipitation-based indices for the selected temporal aggregation (“DJF” in this example), calculate the mean and trend over the historical period (1971-2000) and cache the result (to avoid redundant downloads and processing).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transform_func_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;index_names&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">index_names</span><span class="p">),</span>
    <span class="s2">&quot;timeseries&quot;</span><span class="p">:</span> <span class="n">timeseries</span><span class="p">,</span>
    <span class="s2">&quot;year_start&quot;</span><span class="p">:</span> <span class="n">year_start</span><span class="p">,</span>
    <span class="s2">&quot;year_stop&quot;</span><span class="p">:</span> <span class="n">year_stop</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ds_era5</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="o">*</span><span class="n">request_era</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
    <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">compute_indices_and_trends</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span>
    <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;resample_reduction&quot;</span><span class="p">:</span> <span class="n">resample_reduction</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-and-transform-models">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2-2"></span><h4>2.2. Download and transform models<a class="headerlink" href="#download-and-transform-models" title="Link to this heading">#</a></h4>
<p>In this section, the <code class="docutils literal notranslate"><span class="pre">download.download_and_transform</span></code> function from the ‘c3s_eqc_automatic_quality_control’ package is employed to download daily data from the CORDEX models, compute the precipitation-based indices for the selected temporal aggregation, calculate the mean and trend over the historical period (1971-2005), interpolate to ERA5’s grid (only for the cases in which it is specified, in the other cases, the original model’s grid is mantained), and cache the result (to avoid redundant downloads and processing).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interpolated_datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">model_datasets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">requests</span> <span class="ow">in</span> <span class="n">model_requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="n">chunks</span> <span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;transform_chunks&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;transform_func&quot;</span><span class="p">:</span> <span class="n">compute_indices_and_trends</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="c1"># Original model</span>
    <span class="n">model_datasets</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
        <span class="o">*</span><span class="n">requests</span><span class="p">,</span>
        <span class="o">**</span><span class="n">model_kwargs</span><span class="p">,</span>
        <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Interpolated model</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
        <span class="o">*</span><span class="n">requests</span><span class="p">,</span>
        <span class="o">**</span><span class="n">model_kwargs</span><span class="p">,</span>
        <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span>
        <span class="o">|</span> <span class="p">{</span>
            <span class="s2">&quot;request_grid_out&quot;</span><span class="p">:</span> <span class="n">request_lsm</span><span class="p">,</span>
            <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">interpolation_method</span><span class="p">,</span>
            <span class="s2">&quot;skipna&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="n">interpolated_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]))</span>

<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">interpolated_datasets</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;minimal&#39;</span><span class="p">,</span><span class="n">compat</span><span class="o">=</span><span class="s1">&#39;override&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model=&#39;clmcom_clm_cclm4_8_17&#39;
model=&#39;clmcom_eth_cosmo_crclim&#39;
model=&#39;cnrm_aladin63&#39;
model=&#39;dmi_hirham5&#39;
model=&#39;knmi_racmo22e&#39;
model=&#39;mohc_hadrem3_ga7_05&#39;
model=&#39;mpi_csc_remo2009&#39;
model=&#39;smhi_rca4&#39;
model=&#39;uhoh_wrf361h&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="apply-land-sea-mask-change-attributes-and-cut-the-region-to-show">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-2-3"></span><h4>2.3. Apply land-sea mask, change attributes and cut the region to show<a class="headerlink" href="#apply-land-sea-mask-change-attributes-and-cut-the-region-to-show" title="Link to this heading">#</a></h4>
<p>This section performs the following tasks:</p>
<ol class="arabic simple">
<li><p>Cut the region of interest.</p></li>
<li><p>Downloads the sea mask for ERA5.</p></li>
<li><p>Applies the sea mask to both ERA5 data and the model data, which were previously regridded to ERA5’s grid (i.e., it applies the ERA5 sea mask to <code class="docutils literal notranslate"><span class="pre">ds_interpolated</span></code>).</p></li>
<li><p>Regrids the ERA5 land-sea mask to the model’s grid and applies it to them.</p></li>
<li><p>Change some variable attributes for plotting purposes.</p></li>
</ol>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">ds_interpolated</span></code> contains data from the models (mean and trend over the historical period, p-value of the trends…) regridded to ERA5. <code class="docutils literal notranslate"><span class="pre">model_datasets</span></code> contain the same data but in the original grid of each model.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsm</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span><span class="o">*</span><span class="n">request_lsm</span><span class="p">)[</span><span class="s2">&quot;lsm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Cutout</span>
<span class="n">regionalise_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
    <span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
<span class="p">}</span>
<span class="n">lsm</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">lsm</span><span class="p">,</span> <span class="o">**</span><span class="n">regionalise_kwargs</span><span class="p">)</span>
<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds_interpolated</span><span class="p">,</span> <span class="o">**</span><span class="n">regionalise_kwargs</span><span class="p">)</span>
<span class="n">model_datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="o">**</span><span class="n">regionalise_kwargs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Mask</span>
<span class="n">ds_era5</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lsm</span><span class="p">)</span>
<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">ds_interpolated</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lsm</span><span class="p">)</span>
<span class="n">model_datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">lsm</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Edit attributes</span>
<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_interpolated</span><span class="p">,</span> <span class="o">*</span><span class="n">model_datasets</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;trend&quot;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;days&quot;</span> <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;d&quot;</span> 
                           <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;mm&quot;</span> <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mm d-1&quot;</span> 
                                 <span class="k">else</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="plot-and-describe-results">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3"></span><h3>3. Plot and describe results<a class="headerlink" href="#plot-and-describe-results" title="Link to this heading">#</a></h3>
<p>This section will display the following results:</p>
<ul class="simple">
<li><p>Maps representing the spatial distribution of the <strong>historical mean values</strong> (1971-2000) of the indices (‘CWD’, ‘R20mm’, ‘RR1’, ‘RX1day’ and ‘RX5day’) for ERA5, each model individually, the ensemble median (understood as the median of the mean values of the chosen subset of models calculated for each grid cell), and the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</p></li>
<li><p>Maps representing the spatial distribution of the <strong>historical trends</strong> (1971-2000) of the considered indices. Similar to the first analysis, this includes ERA5, each model individually, the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell), and the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</p></li>
<li><p><strong>Bias maps of the historical mean values</strong>.</p></li>
<li><p><strong>Trend bias maps</strong>.</p></li>
<li><p><strong>Boxplots</strong> representing statistical distributions (PDF) built on the spatially-averaged historical trends from each considered model, displayed together with ERA5.</p></li>
</ul>
<section id="define-plotting-functions">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-1"></span><h4>3.1. Define plotting functions<a class="headerlink" href="#define-plotting-functions" title="Link to this heading">#</a></h4>
<p>The functions presented here are used to plot the mean values and trends calculated over the historical period (1971-2000) for each of the indices (‘CWD’, ‘R20mm’, ‘RR1’, ‘RX1day’ and ‘RX5day’).</p>
<p>For a selected index, three layout types can be displayed, depending on the chosen function:</p>
<ol class="arabic simple">
<li><p>Layout including the reference ERA5 product, the ensemble median, the bias of the ensemble median, and the ensemble spread: <code class="docutils literal notranslate"><span class="pre">plot_ensemble()</span></code> is used.</p></li>
<li><p>Layout including every model (for the trend and mean values): <code class="docutils literal notranslate"><span class="pre">plot_models()</span></code> is employed.</p></li>
<li><p>Layout including the bias of every model (for the trend and mean values): <code class="docutils literal notranslate"><span class="pre">plot_models()</span></code> is used again.</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">trend==True</span></code> argument allows displaying trend values over the historical period, while <code class="docutils literal notranslate"><span class="pre">trend==False</span></code> will show mean values. When the <code class="docutils literal notranslate"><span class="pre">trend</span></code> argument is set to <code class="docutils literal notranslate"><span class="pre">True</span></code>, regions with no significance are hatched. For individual models and ERA5, a grid point is considered to have a statistically significant trend when the p-value is lower than 0.05 (in such cases, no hatching is shown). However, for determining trend significance for the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell), reliance is placed on agreement categories, following the advanced approach proposed in AR6 <a class="reference external" href="https://www.ipcc.ch/report/ar6/wg1/downloads/report/IPCC_AR6_WGI_Atlas.pdf">IPCC</a> on pages 1945-1950. The <code class="docutils literal notranslate"><span class="pre">hatch_p_value_ensemble()</span></code> function is used to distinguish, for each grid point, between three possible cases:</p>
<ol class="arabic simple">
<li><p>If more than 66% of the models are statistically significant (p-value &lt; 0.05) and more than 80% of the models share the same sign, we consider the ensemble median trend to be statistically significant, and there is agreement on the sign. To represent this, no hatching is used.</p></li>
<li><p>If less than 66% of the models are statistically significant, regardless of agreement on the sign of the trend, hatching is applied (indicating that the ensemble median trend is not statistically significant).</p></li>
<li><p>If more than 66% of the models are statistically significant but less than 80% of the models share the same sign, we consider the ensemble median trend to be statistically significant, but there is no agreement on the sign of the trend. This is represented using crosses.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Define function to plot the caption of the figures (for the ensmble case)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_caption_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span><span class="n">exp</span><span class="p">):</span>
    <span class="c1">#Add caption to the figure</span>
    <span class="k">match</span> <span class="n">trend</span><span class="p">:</span>
        <span class="k">case</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">caption_text</span><span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the temporal aggreggtion of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> period (</span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">). The layout &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;includes data corresponding to: (a) ERA5, (b) the ensemble median &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(understood as the median of the trend values of the chosen subset of models &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;calculated for each grid cell), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(c) the bias of the ensemble median and (d) the ensemble spread &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(derived as the standard deviation of the distribution of the chosen &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;subset of models).&quot;</span>
            <span class="p">)</span>
        <span class="k">case</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">caption_text</span><span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the temporal aggreggtion of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Mean for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> period (</span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">). The layout &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;includes data corresponding to: (a) ERA5, (b) the ensemble median &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(understood as the median of the mean values of the chosen subset of models &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;calculated for each grid cell), &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(c) the bias of the ensemble median and (d) the ensemble spread &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(derived as the standard deviation of the distribution of the chosen &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;subset of models).&quot;</span>
            <span class="p">)</span>
            
    <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">caption_text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">105</span><span class="p">)</span>
    <span class="c1"># Add each line to the figure</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1">#end captioning</span>


<span class="c1">#Define function to plot the caption of the figures (for the individual models case)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span><span class="n">bias</span><span class="p">,</span><span class="n">exp</span><span class="p">):</span>
    <span class="c1">#Add caption to the figure</span>
    <span class="k">if</span> <span class="n">bias</span><span class="p">:</span> 
        <span class="k">match</span> <span class="n">trend</span><span class="p">:</span>
            <span class="k">case</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;temporal aggregation of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend bias for the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> period (</span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">) of each individual &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> model.&quot;</span>
                <span class="p">)</span>
            <span class="k">case</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;temporal aggreggtion of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Mean bias for the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> period (</span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">) of each individual &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> model.&quot;</span>
                <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">match</span> <span class="n">trend</span><span class="p">:</span>
            <span class="k">case</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;temporal aggreggtion of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend for the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;period (</span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">) of each individual &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> model.&quot;</span>
                <span class="p">)</span> 
            <span class="k">case</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot; Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for the &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;temporal aggreggtion of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Mean for the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;period (</span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">) of each individual &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> model.&quot;</span>
                <span class="p">)</span>
    <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">caption_text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="c1"># Add each line to the figure</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">hatch_p_value</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;plot_func&quot;</span><span class="p">:</span> <span class="s2">&quot;contourf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;show_stats&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="s2">&quot;add_colorbar&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;levels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;hatches&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span> <span class="o">*</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">default_kwargs</span> <span class="o">|</span> <span class="n">kwargs</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>
    <span class="n">plot_obj</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plot_obj</span>


<span class="k">def</span><span class="w"> </span><span class="nf">hatch_p_value_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">n_models</span> <span class="o">=</span> <span class="n">trend</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
    <span class="n">robust_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_value</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_models</span>
    <span class="n">robust_ratio</span> <span class="o">=</span> <span class="n">robust_ratio</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_value</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">))</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([(</span><span class="n">trend</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">trend</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)],</span> <span class="s2">&quot;sign&quot;</span><span class="p">)</span>
    <span class="n">sign_ratio</span> <span class="o">=</span> <span class="n">signs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&quot;sign&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_models</span>
    <span class="n">robust_threshold</span> <span class="o">=</span> <span class="mf">0.66</span>
    <span class="n">sign_ratio</span> <span class="o">=</span> <span class="n">sign_ratio</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">robust_ratio</span> <span class="o">&gt;</span> <span class="n">robust_threshold</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">da</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">character</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span><span class="n">robust_ratio</span><span class="p">,</span> <span class="n">sign_ratio</span><span class="p">],</span> <span class="p">[</span><span class="n">robust_threshold</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">hatch_p_value</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">hatches</span><span class="o">=</span><span class="p">[</span><span class="n">character</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">set_extent</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">area</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extent</span><span class="p">):</span>
        <span class="n">extent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_models</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">da_for_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">p_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span> <span class="k">if</span> <span class="n">collection_id</span><span class="o">==</span><span class="s2">&quot;CMIP6&quot;</span> <span class="k">else</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
    <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span>
    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">da_for_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">model_dataarrays</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">da_for_kwargs</span> <span class="o">=</span> <span class="n">da_for_kwargs</span> <span class="ow">or</span> <span class="n">data</span>
        <span class="n">model_dataarrays</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">p_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model_p_dataarrays</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">p_values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p_values</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model_p_dataarrays</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Get kwargs</span>
    <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;robust&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">default_kwargs</span> <span class="o">|</span> <span class="n">kwargs</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">_determine_cmap_params</span><span class="p">(</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="n">col_wrap</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_dataarrays</span><span class="p">)</span> <span class="o">/</span> <span class="n">col_wrap</span><span class="p">)),</span>
        <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">da</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model_dataarrays</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axs</span><span class="p">):</span>
        <span class="n">pcm</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
            <span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_p_dataarrays</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hatch_p_value</span><span class="p">(</span><span class="n">model_p_dataarrays</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">set_extent</span><span class="p">(</span><span class="n">da_for_kwargs</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">pcm</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">extend</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;extend&quot;</span><span class="p">],</span>
        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_ensemble</span><span class="p">(</span>
    <span class="n">da_models</span><span class="p">,</span>
    <span class="n">da_era5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">p_value_era5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">p_value_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
    <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
    <span class="n">cmap_bias</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap_std</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># Get kwargs</span>
    <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;robust&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">default_kwargs</span> <span class="o">|</span> <span class="n">kwargs</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">_determine_cmap_params</span><span class="p">(</span>
        <span class="n">da_models</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">da_era5</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cbar_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">}</span>

    <span class="c1"># Figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">axs_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>

    <span class="c1"># ERA5</span>
    <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
            <span class="n">da_era5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">p_value_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hatch_p_value</span><span class="p">(</span><span class="n">p_value_era5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(a) ERA5&quot;</span><span class="p">)</span>

    <span class="c1"># Median</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">da_models</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
        <span class="n">median</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">p_value_models</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hatch_p_value_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="n">da_models</span><span class="p">,</span> <span class="n">p_value</span><span class="o">=</span><span class="n">p_value_models</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(b) Ensemble Median&quot;</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;(a) Ensemble Median&quot;</span><span class="p">)</span>

    <span class="c1"># Bias</span>
    <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">bias</span> <span class="o">=</span> <span class="n">median</span> <span class="o">-</span> <span class="n">da_era5</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
            <span class="n">bias</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="p">(</span><span class="n">default_kwargs</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">cmap_bias</span><span class="p">}),</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(c) Ensemble Median Bias&quot;</span><span class="p">)</span>

    <span class="c1"># Std</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">da_models</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
        <span class="n">std</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
        <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span>
        <span class="o">**</span><span class="p">(</span><span class="n">default_kwargs</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">cmap_std</span><span class="p">}),</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(d) Ensemble Standard Deviation&quot;</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;(b) Ensemble Standard Deviation&quot;</span><span class="p">)</span>

    <span class="n">set_extent</span><span class="p">(</span><span class="n">da_models</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-ensemble-maps">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-2"></span><h4>3.2. Plot ensemble maps<a class="headerlink" href="#plot-ensemble-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_ensemble()</span></code> function to visualise the mean values and trends calculated over the historical period (1971-2000) for the model ensemble and ERA5 reference product across Europe. Note that the model data used in this section has previously been interpolated to the ERA5 grid.</p>
<p>Specifically, for each of the indices (‘CWD’, ‘R20mm’, ‘RR1’, ‘RX1day’ and ‘RX5day’), this section presents two layouts:</p>
<ol class="arabic simple">
<li><p>Mean values of the historical period (1971-2000) for: (a) the reference ERA5 product, (b) the ensemble median (understood as the median of the mean values of the chosen subset of models calculated for each grid cell), (c) the bias of the ensemble median, and (d) the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</p></li>
<li><p>Trend values of the historical period (1971-2000) for: (a) the reference ERA5 product, (b) the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell), (c) the bias of the ensemble median, and (d) the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Fig number counter</span>
<span class="n">fig_number</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#Common title</span>
<span class="n">common_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Historical period: </span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">. Temporal aggregation: &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
    <span class="c1"># Index</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">ds_interpolated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="o">!=</span><span class="s2">&quot;TX90p&quot;</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_ensemble</span><span class="p">(</span><span class="n">da_models</span><span class="o">=</span><span class="n">da</span><span class="p">,</span>
                            <span class="n">da_era5</span><span class="o">=</span><span class="n">ds_era5</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cmaps</span><span class="p">,</span>
                            <span class="n">cmap_bias</span><span class="o">=</span><span class="n">cmaps_bias</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (ERA5 vs </span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> ensemble)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">add_caption_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Trend</span>
    <span class="n">da_trend</span> <span class="o">=</span> <span class="n">ds_interpolated</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da_trend</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span>
    <span class="n">da_era5</span><span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da_era5</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_ensemble</span><span class="p">(</span>
        <span class="n">da_models</span><span class="o">=</span><span class="n">da_trend</span><span class="p">,</span>
        <span class="n">da_era5</span><span class="o">=</span><span class="n">da_era5</span><span class="p">,</span>
        <span class="n">p_value_era5</span><span class="o">=</span><span class="n">ds_era5</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">),</span>
        <span class="n">p_value_models</span><span class="o">=</span><span class="n">ds_interpolated</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">),</span>
        <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmaps_trend</span><span class="p">,</span>
        <span class="n">cmap_bias</span><span class="o">=</span><span class="n">cmaps_bias</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trend of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (ERA5 vs </span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> ensemble)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">add_caption_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/8a68ebcf00ee996650c083bd44d979872d68f9e8d2d6ba2480b46c96dc78081a.png" src="../../_images/8a68ebcf00ee996650c083bd44d979872d68f9e8d2d6ba2480b46c96dc78081a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/6dd2435f35e836ca0d62af8e87aefa109026e3a3795b975347bb1ddcb836d89c.png" src="../../_images/6dd2435f35e836ca0d62af8e87aefa109026e3a3795b975347bb1ddcb836d89c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/cd89c9ff8abcec6e1b0506ffe4fe8c42694f8e4518f20904deafcfee94764581.png" src="../../_images/cd89c9ff8abcec6e1b0506ffe4fe8c42694f8e4518f20904deafcfee94764581.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/d017b9442462bf5b5d17795b9b523e0f1b2bfe006488c1ee5541448dc31c39e2.png" src="../../_images/d017b9442462bf5b5d17795b9b523e0f1b2bfe006488c1ee5541448dc31c39e2.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/246e1d0f62bb38a62872c8c46ed096f6c689cb59ca2e6f9da651a8ee105c7179.png" src="../../_images/246e1d0f62bb38a62872c8c46ed096f6c689cb59ca2e6f9da651a8ee105c7179.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/bdadbf6961691a88a1895015af5425ac9367a7051beeda8bb739447794f38f64.png" src="../../_images/bdadbf6961691a88a1895015af5425ac9367a7051beeda8bb739447794f38f64.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/aaf3284f3fbdff63277199a26d80edd6707c04b56cc976523e83bb5bb6358d07.png" src="../../_images/aaf3284f3fbdff63277199a26d80edd6707c04b56cc976523e83bb5bb6358d07.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/2472c022274d342ed2b244e1c832eb7a1aee87aa53c6637703721678031ffc16.png" src="../../_images/2472c022274d342ed2b244e1c832eb7a1aee87aa53c6637703721678031ffc16.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/2b41a8148b5dd75cc7cb92e93345efe4e2086f0099100bbfc45ab435000951bd.png" src="../../_images/2b41a8148b5dd75cc7cb92e93345efe4e2086f0099100bbfc45ab435000951bd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/2e5e50e8f1dda401ee11219fb6b90cd8ff8b7f2a1efe86bfe3c88525f0a130cd.png" src="../../_images/2e5e50e8f1dda401ee11219fb6b90cd8ff8b7f2a1efe86bfe3c88525f0a130cd.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-model-maps">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-3"></span><h4>3.3. Plot model maps<a class="headerlink" href="#plot-model-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_models()</span></code> function to visualise the mean values and trends calculated over the historical period (1971-2000) for every model individually across Europe. Note that the model data used in this section maintains its original grid.</p>
<p>Specifically, for each of the indices (‘CWD’, ‘R20mm’, ‘RR1’, ‘RX1day’ and ‘RX5day’), this section presents two layouts:</p>
<ol class="arabic simple">
<li><p>A layout including the historical mean (1971-2000) of every model (only for the ‘SU’ index).</p></li>
<li><p>A layout including the historical trend (1971-2000) of every model.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
    <span class="c1"># Index</span>
    <span class="n">da_for_kwargs</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="o">!=</span><span class="s2">&quot;TX90p&quot;</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_models</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()},</span>
            <span class="n">da_for_kwargs</span><span class="o">=</span><span class="n">da_for_kwargs</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmaps</span>
        <span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> individual models)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>

    <span class="c1"># Trend</span>
    <span class="n">da_for_kwargs_trends</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da_for_kwargs_trends</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_models</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="n">da_for_kwargs</span><span class="o">=</span><span class="n">da_for_kwargs_trends</span><span class="p">,</span>
        <span class="n">p_values</span><span class="o">=</span><span class="p">{</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">cmaps_trend</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trend of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> individual models)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/77a3b4085b65ea5179603ddbd3461cc03334819a81903f8a854a005a900e3e2f.png" src="../../_images/77a3b4085b65ea5179603ddbd3461cc03334819a81903f8a854a005a900e3e2f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/d78f5a332318236dc153d3a64ceb49a38ca1215a23e243e784d8c6dd44a5dc40.png" src="../../_images/d78f5a332318236dc153d3a64ceb49a38ca1215a23e243e784d8c6dd44a5dc40.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/aa049c87baf13f5a1ab52443dc4e2bb53d7d0beea7c3d9a4c93bbce7ff6cca27.png" src="../../_images/aa049c87baf13f5a1ab52443dc4e2bb53d7d0beea7c3d9a4c93bbce7ff6cca27.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/03cd143ba68b80594a327b38536544cfe06ef4a44fefe29a47340bfd7309cd60.png" src="../../_images/03cd143ba68b80594a327b38536544cfe06ef4a44fefe29a47340bfd7309cd60.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/3f40fc2fd1460fcb9c9d318b8902974c33f0e2efdb5dc10f7e18bf4daeea58cb.png" src="../../_images/3f40fc2fd1460fcb9c9d318b8902974c33f0e2efdb5dc10f7e18bf4daeea58cb.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/59206fc12d757d3ab36c456ab0ad208eaf37322a618aceb9989ca938e4734208.png" src="../../_images/59206fc12d757d3ab36c456ab0ad208eaf37322a618aceb9989ca938e4734208.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/38e531f6fee1af10f1316cecb5e57258ffa753c92b45c29ab467427f4008cc86.png" src="../../_images/38e531f6fee1af10f1316cecb5e57258ffa753c92b45c29ab467427f4008cc86.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/3ee73b274d4d4e02219661843fb480ac355d31e171cb2a6b78e1003370e81a29.png" src="../../_images/3ee73b274d4d4e02219661843fb480ac355d31e171cb2a6b78e1003370e81a29.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/b131c3cd245590ef53b6578f3b12794e2278e856267f2295946b210db7cf7b4f.png" src="../../_images/b131c3cd245590ef53b6578f3b12794e2278e856267f2295946b210db7cf7b4f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/ef3c6f55307ce591c615be3d17d6a5185ee18816cc2d96f12aa7c6df6534bd36.png" src="../../_images/ef3c6f55307ce591c615be3d17d6a5185ee18816cc2d96f12aa7c6df6534bd36.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-bias-maps">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-4"></span><h4>3.4. Plot bias maps<a class="headerlink" href="#plot-bias-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_models()</span></code> function to visualise the bias for the mean values and trends calculated over the historical period (1971-2000) for every model individually across Europe. Note that the model data used in this section has previously been interpolated to the ERA5 grid.</p>
<p>Specifically, for each of the indices (‘CWD’, ‘R20mm’, ‘RR1’, ‘RX1day’ and ‘RX5day’), this section presents two layouts:</p>
<ol class="arabic simple">
<li><p>A layout including the bias for the historical mean (1971-2000) of every model (only for the ‘SU’ index).</p></li>
<li><p>A layout including the bias for the historical trend (1971-2000) of every model.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">bias</span> <span class="o">=</span> <span class="n">ds_interpolated</span> <span class="o">-</span> <span class="n">ds_era5</span>

<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
    <span class="c1"># Index bias</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">bias</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">index</span><span class="o">!=</span><span class="s2">&quot;TX90p&quot;</span><span class="p">):</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_models</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">da</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmaps_bias</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Mean bias of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> individual models)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>

    <span class="c1"># Trend bias</span>
    <span class="n">da_trend</span> <span class="o">=</span> <span class="n">bias</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da_trend</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_models</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">da_trend</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmaps_bias</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trend bias of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> individual models)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;historical&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/0b6d9878a180ce4043f9d6a311140800a96026266aeed85d7e113b058b78c6c9.png" src="../../_images/0b6d9878a180ce4043f9d6a311140800a96026266aeed85d7e113b058b78c6c9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/ea36e9e17acf79f7bfcf50b0e624c71873298f4730930d18c382613f7bf415db.png" src="../../_images/ea36e9e17acf79f7bfcf50b0e624c71873298f4730930d18c382613f7bf415db.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/2d5a320e0a29ca33447e691264204612922cf3d4892c32efeb3fa1b99163b14f.png" src="../../_images/2d5a320e0a29ca33447e691264204612922cf3d4892c32efeb3fa1b99163b14f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/5fc24eb7870428d07372a51afd14c52d901ecce38075d8a681745579305cd598.png" src="../../_images/5fc24eb7870428d07372a51afd14c52d901ecce38075d8a681745579305cd598.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/9644e7882e074ad7abbe01e372582d2a36be80a730ba45c1047facf1b3d5934f.png" src="../../_images/9644e7882e074ad7abbe01e372582d2a36be80a730ba45c1047facf1b3d5934f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/b7f75e20fb66a5516ead2ef67fd756dd2d01b7d253d5c3fd930df41cc47f2998.png" src="../../_images/b7f75e20fb66a5516ead2ef67fd756dd2d01b7d253d5c3fd930df41cc47f2998.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/e2411e6a3772c81c0aaf7b1203e40818bd829b84b78fdc8d97fd4793a9169062.png" src="../../_images/e2411e6a3772c81c0aaf7b1203e40818bd829b84b78fdc8d97fd4793a9169062.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/de861436e7763dfa974ca553bc6b77796c111006bd2d8bb7e0a8152cbbc540ef.png" src="../../_images/de861436e7763dfa974ca553bc6b77796c111006bd2d8bb7e0a8152cbbc540ef.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/f5c5edc676fb2e6fe978723cb058f8ae0d5807a69261e25739fd9c85ceb1553d.png" src="../../_images/f5c5edc676fb2e6fe978723cb058f8ae0d5807a69261e25739fd9c85ceb1553d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/c2d215553b4a21468c0456ac0e2a1242ddeaa20ca1f0e896269044e66470796b.png" src="../../_images/c2d215553b4a21468c0456ac0e2a1242ddeaa20ca1f0e896269044e66470796b.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="boxplots-of-the-historical-trend">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-5"></span><h4>3.5. Boxplots of the historical trend<a class="headerlink" href="#boxplots-of-the-historical-trend" title="Link to this heading">#</a></h4>
<p>In this last section, we compare the trends of the climate models with the reference trend from ERA5.</p>
<p>Dots represent the spatially-averaged historical trend over the selected region (change of the number of days per decade) for each model (grey), the ensemble mean (blue), and the reference product (orange). The ensemble median is shown as a green line. Note that the spatially averaged values are calculated for each model from its original grid (i.e., no interpolated data has been used here).</p>
<p>The boxplot visually illustrates the distribution of trends among the climate models, with the box covering the first quartile (Q1 = 25th percentile) to the third quartile (Q3 = 75th percentile), and a green line indicating the ensemble median (Q2 = 50th percentile). Whiskers extend from the edges of the box to show the full data range.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span>
<span class="n">mean_datasets</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]),</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">mean_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">mean_datasets</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;minimal&#39;</span><span class="p">,</span><span class="n">compat</span><span class="o">=</span><span class="s1">&#39;override&#39;</span><span class="p">)</span>
<span class="n">index_str</span><span class="o">=</span><span class="mi">1</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">mean_ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">):</span>
    <span class="n">df_slope</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[[</span><span class="s2">&quot;trend&quot;</span><span class="p">]]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df_slope</span><span class="o">.</span><span class="n">boxplot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_slope</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">df_slope</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;models&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Ensemble mean</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">),</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> Ensemble Mean&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># ERA5</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> Ensemble&quot;</span><span class="p">]</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;ERA5&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ERA5&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">index_str</span><span class="p">)</span><span class="si">}</span><span class="s2">) Trend of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;region: lon [</span><span class="si">{</span><span class="o">-</span><span class="n">area</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">W, </span><span class="si">{</span><span class="n">area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">E] x lat [</span><span class="si">{</span><span class="n">area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">N, </span><span class="si">{</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">N] </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;period: </span><span class="si">{</span><span class="n">year_start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">year_stop</span><span class="si">}</span><span class="s2">. Temporal aggregation: </span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span> 
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">index_str</span><span class="o">=</span><span class="n">index_str</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/db5e976661cc0f4a0cd4f539a756468f5a26b653850fb0ae35a648d3857e31ed.png" src="../../_images/db5e976661cc0f4a0cd4f539a756468f5a26b653850fb0ae35a648d3857e31ed.png" />
<img alt="../../_images/510532507fafad62514c302f525ed6855dca7bd36d04bcffa0dc2d6bf82fa3a5.png" src="../../_images/510532507fafad62514c302f525ed6855dca7bd36d04bcffa0dc2d6bf82fa3a5.png" />
<img alt="../../_images/55715bb3b12ef4ce1a4e3c0feba931070d8ed7011a6953c74fd3a448d23f4f30.png" src="../../_images/55715bb3b12ef4ce1a4e3c0feba931070d8ed7011a6953c74fd3a448d23f4f30.png" />
<img alt="../../_images/e5cdf1510c4d2120ad1ea9d45a3d3046a08689be6bf9bb95e17b81337b5ca934.png" src="../../_images/e5cdf1510c4d2120ad1ea9d45a3d3046a08689be6bf9bb95e17b81337b5ca934.png" />
<img alt="../../_images/11d8d28e8e054af1e5c00f98f55fb9e04c30c27b4b8a37bdfbd773283c73222f.png" src="../../_images/11d8d28e8e054af1e5c00f98f55fb9e04c30c27b4b8a37bdfbd773283c73222f.png" />
</div>
</div>
<div>
    <div style="max-width: 800px;">
    <p><strong>Fig 31.</strong> Boxplots illustrating the historical trends of the ensemble distribution and ERA5 for the precipitation-based indices: (a)'CWD', (b)'R20mm', (c)'RR1', (d)'RX1day' and (e)'RX5day'. The distribution is created by considering spatially averaged trends across Europe. The ensemble mean and the ensemble median trends are both included. Outliers in the distribution are denoted by a grey circle with a black contour.</p>
</div></section>
<section id="results-summary-and-discussion">
<span id="climate-projections-cordex-domains-single-levels-climate-and-weather-extremes-q03-section-3-6"></span><h4>3.6. Results summary and discussion<a class="headerlink" href="#results-summary-and-discussion" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>The bias behaviour varies depending on the index and whether we are dealing with trends or climatologies. Generally speaking, the subset of models selected overestimates the magnitudes of climatologies for DJF, except in the northwest of Great Britain, the west coast of the Scandinavian Peninsula, parts of the Mediterranean Basin, and the east of Europe for the CWD index, where there is underestimation. For the RR1 index, the models also underestimate the magnitudes for the west coast of the Scandinavian Peninsula and parts of the Mediterranean Basin.</p></li>
<li><p>For the historical period and the seasonal aggregation of DJF, ERA5 exhibits trends that are highly dependent on the region and index. Indices like CWD, R20mm, and RX1day show scattered spatial patterns that are generally not well-reproduced by the considered models, except in some specific areas. The spatial patterns for the trends of RR1 and RX5day are less scattered and are slightly better captured than those of the other indices.</p></li>
<li><p>The boxplots displaying spatially-averaged values reveal diverse outcomes depending on the index under consideration. Notably, significant inter-model variability is evident for certain indices, whose interquantile range encompasses trends of varying directions, and in some cases, even exhibits a trend opposite to that shown by the ERA5 data. This discrepancy is particularly noticeable for the R20mm, RR1, and RX1day indices, where the interquantile range showcases a trend contrary to that portrayed by ERA5. Meanwhile, the RX5day index displays an interquantile range centered around zero, with the trend sign dependent on the model. In contrast, the CWD index demonstrates a trend direction consistent with ERA5.</p></li>
<li><p>It is crucial to emphasise that the boxplots present spatially-averaged values, and their interpretation should be approached with caution, as the outcomes can vary significantly when considering different regions across Europe. For regional analyses, it is essential to focus solely on the region of interest, as the influence of other European regions may distort the results, leading to conclusions that do not accurately reflect the specific area under study.</p></li>
<li><p>Although ERA5 is used as our reference dataset, it is important to be aware of its inherent uncertainties. While uncertainties affect all variables, biases are particularly pronounced for variables such as surface wind and precipitation, as demonstrated in <a class="reference external" href="https://doi.org/10.1002/qj.3616">[4]</a> and <a class="reference external" href="https://doi.org/10.3390/atmos12111462">[5]</a>. This underscores the importance of careful interpretation, especially regarding precipitation extremes.</p></li>
<li><p>A larger GCM-RCM matrix should be considered when addressing specific cases to enhance the robustness of the analysis and account for uncertainties <a class="reference external" href="https://doi.org/10.1002/wcc.8">[6]</a><a class="reference external" href="https://doi.org/10.1088/1748-9326/aacc77">[7]</a>.</p></li>
<li><p>What do the results mean for users? Are the biases relevant?</p>
<ul>
<li><p>The subset of Regional Climate Models (RCMs) considered for this notebook and for this seasonal aggregation struggle to replicate both the observed climatology and the trends during the historical period, with particular difficulty in capturing the trends.</p></li>
<li><p>However, for specific regions and indices, the models successfully capture the climatology and even the direction of the trend. Examples include the increasing trend for the CWD index in the western part of the Iberian Peninsula and the positive trend for RR1 in central Europe. Users should consider these regional variations, the indices they aim to use, the differences in bias behavior between climatology and trends, and the necessity of bias-correcting data before using it for hydrological applications <a class="reference external" href="https://doi.org/10.1016/j.jhydrol.2012.05.052">[3]</a>.</p></li>
<li><p>Precipitation trends in observational and reanalysis datasets are generally less robust and more challenging to detect compared to temperature trends. This limitation is also evident in model simulations.</p></li>
</ul>
</li>
</ul>
<p><a id='RESULTS NOTE'></a></p>
<div class="alert alert-block alert-warning">  
<b>RESULTS NOTE</b>:<br> 
It is important to note that the results presented are specific to the 9 models chosen, and users should aim to assess as wide a range of models as possible before making a sub-selection.</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>ℹ️ If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Some key resources and further reading were linked throughout this assessment.</p>
<p>The CDS catalogue entries for the data used were:</p>
<ul class="simple">
<li><p>CORDEX regional climate model data on single levels (Daily mean - Mean precipitation flux): <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cordex-domains-single-levels?tab=overview">https://cds.climate.copernicus.eu/datasets/projections-cordex-domains-single-levels?tab=overview</a></p></li>
<li><p>ERA5 hourly data on single levels from 1940 to present (Total precipitation): <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=overview">https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=overview</a></p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/">B-Open</a></p></li>
<li><p><a class="reference external" href="https://icclim.readthedocs.io/en/stable/">icclim</a> Python package</p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.1016/j.envsci.2015.08.012">[1]</a> Panagos, P., Borrelli, P., Poesen, J., Ballabio, C., Lugato, E., Meusburger, K., Montanarella, L., Alewell, C. (2015). The new assessment of soil loss by water erosion in Europe. Environ. Sci. Policy, 54, pp. 438-447. <a class="reference external" href="https://doi.org/10.1016/j.envsci.2015.08.012">https://doi.org/10.1016/j.envsci.2015.08.012</a></p>
<p><a class="reference external" href="https://doi.org/10.1016/j.landusepol.2012.11.007">[2]</a> Salvati, L., Carlucci, M. (2013). The impact of mediterranean land degradation on agricultural income: a short-term scenario. Land Use Policy, 32, pp. 302-308. <a class="reference external" href="https://doi.org/10.1016/j.landusepol.2012.11.007">https://doi.org/10.1016/j.landusepol.2012.11.007</a></p>
<p><a class="reference external" href="https://doi.org/10.1016/j.jhydrol.2012.05.052">[3]</a> Teutschbein, C., Seibert, J. (2012). Bias correction of regional climate model simulations for hydrological climate-change impact studies: Review and evaluation of different methods. Journal of Hydrology,
Volumes 456–457, pp. 12-29. <a class="reference external" href="https://doi.org/10.1016/j.jhydrol.2012.05.052">https://doi.org/10.1016/j.jhydrol.2012.05.052</a></p>
<p><a class="reference external" href="https://doi.org/10.1002/qj.3616">[4]</a> Ramon, J., Lledó L., Torralba, V., Soret, A., Doblas-Reyes, F.J. (2019). What global reanalysis best represents near-surface winds?. Q J R Meteorol Soc. 2019; 145: 3236–3251. <a class="reference external" href="https://doi.org/10.1002/qj.3616">https://doi.org/10.1002/qj.3616</a></p>
<p><a class="reference external" href="https://doi.org/10.3390/atmos12111462">[5]</a> Hassler, B. and Lauer, A. (2021). Comparison of Reanalysis and Observational Precipitation Datasets Including ERA5 and WFDE5. Atmosphere, 12, 1462. <a class="reference external" href="https://doi.org/10.3390/atmos12111462">https://doi.org/10.3390/atmos12111462</a></p>
<p><a class="reference external" href="https://doi.org/10.1002/wcc.8">[6]</a> Rummukainen, M. (2010). State-of-the-art with regional climate models. WIREs Clim Change, 1: 82-96. <a class="reference external" href="https://doi.org/10.1002/wcc.8">https://doi.org/10.1002/wcc.8</a></p>
<p><a class="reference external" href="https://doi.org/10.1088/1748-9326/aacc77">[7]</a> Silje Lund Sørland et al. (2018). Bias patterns and climate change signals in GCM-RCM model chains. Environ. Res. Lett. 13 074017. <a class="reference external" href="https://doi.org/10.1088/1748-9326/aacc77">https://doi.org/10.1088/1748-9326/aacc77</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Climate_Projections/CORDEX"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q02.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.2.2. </span>Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</p>
      </div>
    </a>
    <a class="right-next"
       href="climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q04.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.2.4. </span>Projected changes in precipitation-based indices for impact models</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-verification-of-precipitation-indices-used-as-proxies-for-rainfall-erosivity-in-europe-under-future-climate-scenarios">🌍 Use case: Verification of precipitation indices used as proxies for rainfall erosivity in Europe under future climate scenarios.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">❓ Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-requests-and-functions-definition">1. Parameters, requests and functions definition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1.1. Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-parameters">1.2. Define Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-models">1.3. Define models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-era5-request">1.4. Define ERA5 request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-model-requests">1.5. Define model requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">1.6. Functions to cache</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-and-processing">2. Downloading and processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-era5">2.1. Download and transform ERA5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-models">2.2. Download and transform models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-land-sea-mask-change-attributes-and-cut-the-region-to-show">2.3. Apply land-sea mask, change attributes and cut the region to show</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">3. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-plotting-functions">3.1. Define plotting functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-ensemble-maps">3.2. Plot ensemble maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-model-maps">3.3. Plot model maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-bias-maps">3.4. Plot bias maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots-of-the-historical-trend">3.5. Boxplots of the historical trend</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion">3.6. Results summary and discussion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>