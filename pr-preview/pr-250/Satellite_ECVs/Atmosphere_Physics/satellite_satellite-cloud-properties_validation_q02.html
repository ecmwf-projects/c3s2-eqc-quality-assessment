
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.1.1. Cloud Type Determination by Altitude for Analyzing Cloud Radiative Effects &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Atmosphere_Physics/satellite_satellite-cloud-properties_validation_q02';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.2. Atmospheric Composition" href="../Atmospheric_Composition/Atmospheric_Composition.html" />
    <link rel="prev" title="1.1. Atmosphere Physics" href="Atmosphere_Physics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.1.1. Cloud Type Determination by Altitude for Analyzing Cloud Radiative Effects</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Atmosphere_Physics/satellite_satellite-cloud-properties_validation_q02.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Atmosphere_Physics/satellite_satellite-cloud-properties_validation_q02.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Cloud Type Determination by Altitude for Analyzing Cloud Radiative Effects</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-intercomparison-of-cloud-top-altitude-distributions-from-satellite-retrievals">üåç Use case: Intercomparison of cloud top altitude distributions from satellite retrievals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-parameters-to-use-and-setup-code">Choose the parameters to use and setup code</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">Import libraries</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-parameters">Set parameters</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-data-and-check-quality">Download the data and check quality</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-request">Define request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">Functions to cache</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#show-clara-a3-quality">Show CLARA-A3 quality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">Download and transform</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cloud-top-pressure">Cloud top pressure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cloud-top-pressure-uncertainty">Cloud top pressure uncertainty</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reference-useful-material">Reference/Useful material</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="cloud-type-determination-by-altitude-for-analyzing-cloud-radiative-effects">
<h1><span class="section-number">1.1.1. </span>Cloud Type Determination by Altitude for Analyzing Cloud Radiative Effects<a class="headerlink" href="#cloud-type-determination-by-altitude-for-analyzing-cloud-radiative-effects" title="Link to this heading">#</a></h1>
<p>Production date: 23-10-2024, modified 12-06-2025</p>
<p>Produced by: CNRS</p>
<section id="use-case-intercomparison-of-cloud-top-altitude-distributions-from-satellite-retrievals">
<h2>üåç Use case: Intercomparison of cloud top altitude distributions from satellite retrievals<a class="headerlink" href="#use-case-intercomparison-of-cloud-top-altitude-distributions-from-satellite-retrievals" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>‚ùì Quality assessment question:<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How does cloud top pressure vary between climate zones, and which dataset provides the most realistic distribution?</strong></p></li>
</ul>
<p>Clouds are fundamental regulators of the Earth‚Äôs climate system, significantly influencing the planet‚Äôs radiative budget, hydrological cycle, and global circulation. These factors, in turn, play a crucial role in shaping ecosystems, agriculture, water resources, and weather patterns. The overall impact of clouds on Earth‚Äôs climate is determined by various properties, including cloud height, amount, thickness, and microphysical characteristics. Given their substantial influence on climate, cloud properties are extensively studied, both in the present context and in relation to their evolution under climate change.
The following notebook focuses on the cloud height.</p>
<p>High and low clouds have distinct atmospheric radiative effects due to differences in temperature, thickness, and composition. High clouds strongly trap outgoing longwave infrared radiation from the Earth‚Äôs surface, and they allow most shortwave solar radiation to pass when they are thin. This leads to a net warming effect on both the surface and the atmosphere. In contrast, low clouds reflect a significant portion of incoming solar radiation back into space, producing a cooling effect.</p>
<p>This analysis utilizes cloud observations from the dataset <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-cloud-properties?tab=overview"><strong>Cloud properties global gridded monthly and daily data from 1979 to present derived from satellite observations</strong></a>, available at the Climate Data Store. Two complementary Thematic Climate Data Records of cloud properties are provided from two families: CLARA (CM SAF cLoud, Albedo and surface Radiation) and CCI (Climate Change Initiative). These data differ in temporal sampling and horizontal resolution, and three distinct products are available: The two retrieval versions, CLARA-A2 and CLARA-A3, use AVHRR (Advanced Very High Resolution Radiometer) observations, while the CCI product is derived from ATSR2 (Along Track Scanning Radiometer) and AATSR (Advanced ATSR), only covering the period 1995-2012. A CCI intermediate climate data record is available from 2017 onwards, using SLSTR (Sea and Land Surface Temperature Radiometer). The latter is not yet homogenized with the earlier data. Therefore, it is not used in this analysis.</p>
<p>CLARA-A2, CLARA-A3, and CCI, use different methods to retrieve cloud properties. This notebook presents a comparative analysis of their cloud top pressure estimates, both among themselves and against other satellite data <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a>. These datasets also provide cloud top temperature and altitude. This analysis focuses on cloud-top pressure, as it is directly retrieved. The other variables are derived from cloud top pressure by using atmospheric profiles, obtained from meteorological reanalyses.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<p>It is important to note that passive remote sensing has limitations: it provides a top-down perspective, which does not account for hidden cloud layers, and it estimates a ‚Äòradiative‚Äô cloud height. This radiative height can be several kilometers below the actual cloud top, especially in cases where clouds have diffuse tops, with optical depth gradually increasing from the top down over a significant vertical range. This phenomenon is relevant for approximately 70% of high clouds in the tropics and 30-40% of high clouds in the midlatitudes <a class="reference external" href="https://doi.org/10.1029/94JD02430">[2]</a>.</p>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>All datasets show more low-level clouds over ocean than over land, as expected.</p></li>
<li><p>The CCI dataset produces by far the least realistic cloud top height distributions among the evaluated products, by strongly underestimating the amount of high-level clouds (no peak in the upper troposphere). Since the channels of the AATSR and AVHRR instruments are similar, the reason lies in the retrieval method, based on optimal estimation and the assumption of a single layer cloud. The retrieved cloud top pressure is an effective one, defined by infrared radiation. In the case of semi-transparent cirrus, this height should lie much below the cloud top, depending on the optical depth of the cloud. Furthermore, during daytime, the combined use of infrared and visible radiances may lead to a cloud height underestimation due to underlying lower cloud layers.</p></li>
<li><p>The two retrieval versions of the CLARA product lead to very different results. While the A2 version uses a classical retrieval approach, based on radiative transfer, the A3 version uses a neural network approach trained with active lidar data from CALIPSO. This leads to retrievals of ‚Äòradiative‚Äô cloud height for CLARA-A2 and cloud top height for CLARA-A3. However, the CLARA-A3 product seems to identify also very thin (sub-visible) cirrus clouds above the tropopause layer, which a passive sensor like AVHRR should not be able to detect, in particular stratospheric clouds in polar regions over land.</p></li>
<li><p>The CLARA-A2 cloud top pressure of high clouds peaks in the tropics at about 250 hPa. Towards higher latitudes, this peak moves towards larger pressure (lower height). The distributions are bimodal over tropical ocean and in the subtropics. The height of low-level clouds over ocean may be slightly overestimated (800 instead of 850 hPa).</p></li>
<li><p>Compared to CLARA-A2, the CLARA-A3 cloud top pressure peaks around 800 hPa are slightly narrower, while the peaks in the upper troposphere are much more pronounced and at a much higher altitude (150 hPa to 220 hPa in the tropics and subtropics). Yet, at polar latitudes, the CLARA-A3 distributions have still only a single peak in the middle troposphere, and over polar land a non-negligible amount of clouds above the tropopause.</p></li>
<li><p>According to the description in the files, CCI only provides an effective cloud top defined by IR radiation. This height may considerably underestimate the real cloud height. However, the daytime uncertainty of cloud top pressure is quite small. Is is interesting to note that the night uncertainty of high and low-level clouds is similar, but larger than the daytime uncertainty, although the distributions over ocean are similar during day- and nighttime.</p></li>
<li><p>While CLARA-A2 does not provide uncertainty estimates, the uncertainty distributions of CLARA-A3 peak around 20 hPa over the whole globe, with broader distributions for low-level clouds than for high-level clouds and a secondary peak around 100 hPa over land, which is due to gridboxes with only a few cloudy observations.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>The analysis comprises the following steps:</p>
<p><strong><a class="reference internal" href="#satellite-satellite-cloud-properties-validation-q02-section-parameters"><span class="std std-ref">Choose the parameters to use and setup code</span></a></strong></p>
<ul class="simple">
<li><p>Import the relevant libraries. Define the parameters of the analysis and set the dataset requests.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-cloud-properties-validation-q02-section-download"><span class="std std-ref">Download the data and check quality</span></a></strong></p>
<ul class="simple">
<li><p>Download the satellite products of daily mean cloud top pressure and its uncertainty.</p></li>
<li><p>Check the quality status of the CLARA-A3 data.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-cloud-properties-validation-q02-section-results"><span class="std std-ref">Results</span></a></strong></p>
<ul class="simple">
<li><p>Prepare the datasets for the analysis, selecting four different latitude bands</p></li>
<li><p>Include the land mask into the datasets and include climatological limits of the tropopause for the different latitude bands</p></li>
<li><p>Plot the cloud top pressure distributions for selected latitude bands, separately over ocean and over land</p></li>
<li><p>Plot the cloud top pressure uncertainty distribution for the daytime observation of the CCI product</p></li>
<li><p>Plot the cloud top pressure uncertainty distributions for CLARA-A3 and CCI nighttime observations separately for the selected latitude bands</p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="choose-the-parameters-to-use-and-setup-code">
<span id="satellite-satellite-cloud-properties-validation-q02-section-parameters"></span><h3>Choose the parameters to use and setup code<a class="headerlink" href="#choose-the-parameters-to-use-and-setup-code" title="Link to this heading">#</a></h3>
<p>This section includes the library imports and the parameter settings for the analysis.</p>
<section id="import-libraries">
<h4>Import libraries<a class="headerlink" href="#import-libraries" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">collections</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">regionmask</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xhistogram</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">download</span><span class="p">,</span> <span class="n">utils</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="set-parameters">
<h4>Set parameters<a class="headerlink" href="#set-parameters" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time</span>
<span class="n">start</span> <span class="o">=</span> <span class="s2">&quot;2011-01&quot;</span>
<span class="n">stop</span> <span class="o">=</span> <span class="s2">&quot;2011-12&quot;</span>

<span class="c1"># Latitude</span>
<span class="n">latitude_slices</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;deep-tropics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">)],</span>
    <span class="s2">&quot;sub-tropics&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">)],</span>
    <span class="s2">&quot;mid-latitudes&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">)],</span>
    <span class="s2">&quot;polar&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">),</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">)],</span>
<span class="p">}</span>
<span class="k">assert</span> <span class="nb">all</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">latitude_slices</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>

<span class="c1"># Plot kwargs</span>
<span class="n">plot_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CCI day&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;dodgerblue&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">},</span>
    <span class="s2">&quot;CCI night&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;darkblue&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;:&quot;</span><span class="p">},</span>
    <span class="s2">&quot;CLARA-A2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
    <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;ls&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="download-the-data-and-check-quality">
<span id="satellite-satellite-cloud-properties-validation-q02-section-download"></span><h3>Download the data and check quality<a class="headerlink" href="#download-the-data-and-check-quality" title="Link to this heading">#</a></h3>
<section id="define-request">
<h4>Define request<a class="headerlink" href="#define-request" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-cloud-properties&quot;</span>
<span class="n">request_clara</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;eumetsat&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;cloud_top_level&quot;</span><span class="p">],</span>
    <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
    <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;daily_mean&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CCI&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;daily_mean&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;aatsr_on_envisat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;esa&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;CLARA-A2&quot;</span><span class="p">:</span> <span class="n">request_clara</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;clara_a2&quot;</span><span class="p">},</span>
    <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span> <span class="n">request_clara</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;clara_a3&quot;</span><span class="p">},</span>
<span class="p">}</span>
<span class="n">requests</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">product</span><span class="p">:</span> <span class="n">download</span><span class="o">.</span><span class="n">update_request_date</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">stringify_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="functions-to-cache">
<h4>Functions to cache<a class="headerlink" href="#functions-to-cache" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">preprocess</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time_coverage_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="n">time</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_variables</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variables</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">ds</span><span class="p">[</span><span class="n">variables</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mask_and_regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_slices</span><span class="p">):</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">record_status</span> <span class="o">:=</span> <span class="n">ds</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;record_status&quot;</span><span class="p">))</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">record_status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">combine_by_coords</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="mi">180</span><span class="p">),</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">lat_slice</span> <span class="ow">in</span> <span class="n">lat_slices</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="n">lsm</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">defined_regions</span><span class="o">.</span><span class="n">natural_earth_v5_0_0</span><span class="o">.</span><span class="n">land_110</span>
    <span class="n">lsm</span> <span class="o">=</span> <span class="n">lsm</span><span class="o">.</span><span class="n">mask_3D</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s2">&quot;region&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lsm</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;land&quot;</span><span class="p">]),</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">lsm</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;ocean&quot;</span><span class="p">]),</span>
        <span class="p">],</span>
        <span class="s2">&quot;mask&quot;</span><span class="p">,</span>
    <span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_cloud_top_distribution</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_slices</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">mask_and_regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_slices</span><span class="p">)</span>
    <span class="n">dataarrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ctp&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">xhistogram</span><span class="o">.</span><span class="n">xarray</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
            <span class="n">da</span><span class="p">,</span>
            <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1_000</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span>
            <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">],</span>
        <span class="p">)</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">_bin&quot;</span><span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">})</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span> <span class="o">/</span> <span class="n">da</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;bin&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_bins</span> <span class="o">/</span> <span class="mi">10</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Normalized Density&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;hPa$^{-1}$&quot;</span><span class="p">}</span>
        <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataarrays</span><span class="p">)</span>
    <span class="n">da</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cloud Top Pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;hPa&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">da</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_cloud_top_density</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">dataarrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">var</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;ctp&quot;</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">xhistogram</span><span class="o">.</span><span class="n">xarray</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1_011</span><span class="p">))</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s2">_bin&quot;</span><span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">})</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Density&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;hPa$^{-1}$&quot;</span><span class="p">}</span>
        <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataarrays</span><span class="p">)</span>
    <span class="n">da</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cloud Top Pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;hPa&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">da</span>


<span class="k">def</span><span class="w"> </span><span class="nf">unc_distribution</span><span class="p">(</span><span class="n">ctp</span><span class="p">,</span> <span class="n">unc</span><span class="p">):</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">unc</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ctp</span> <span class="o">&gt;</span> <span class="mi">700</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">clouds</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;low&quot;</span><span class="p">]),</span>
            <span class="n">unc</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ctp</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">clouds</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">]),</span>
        <span class="p">],</span>
        <span class="s2">&quot;clouds&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">50</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">xhistogram</span><span class="o">.</span><span class="n">xarray</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
        <span class="n">da</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">unc</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="p">{</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">unc</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">_bin&quot;</span><span class="p">:</span> <span class="s2">&quot;bin&quot;</span><span class="p">})</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">da</span> <span class="o">/</span> <span class="n">da</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;bin&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
    <span class="n">da</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Cloud top pressure uncertainty&quot;</span><span class="p">}</span>
    <span class="n">da</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Density&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;%&quot;</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">da</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_uncertainty_distribution</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_slices</span><span class="p">):</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">mask_and_regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_slices</span><span class="p">)</span>
    <span class="n">dataarrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="s2">&quot;ctp&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">unc_distribution</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;ctp&quot;</span><span class="p">],</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;ctp_unc01&quot;</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;night&quot;</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;unc&quot;</span><span class="p">):</span>
                <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">unc_distribution</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ctp_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">],</span> <span class="n">ds</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ctp_</span><span class="si">{</span><span class="n">prefix</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">])</span>
                <span class="p">)</span>
    <span class="k">assert</span> <span class="n">dataarrays</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dataarrays</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="show-clara-a3-quality">
<h4>Show CLARA-A3 quality<a class="headerlink" href="#show-clara-a3-quality" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">requests</span><span class="p">[</span><span class="s2">&quot;CLARA-A3&quot;</span><span class="p">],</span>
    <span class="n">preprocess</span><span class="o">=</span><span class="n">preprocess</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
    <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">get_variables</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;variables&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;record_status&quot;</span><span class="p">]},</span>
<span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;record_status&quot;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of records with status </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">: &quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">da</span> <span class="o">==</span> <span class="n">status</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of records with status 0:  365
Number of records with status 1:  0
Number of records with status 2:  0
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-transform">
<h4>Download and transform<a class="headerlink" href="#download-and-transform" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">distributions</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">lat_slices</span> <span class="ow">in</span> <span class="n">latitude_slices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">region</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
            <span class="n">collection_id</span><span class="p">,</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">preprocess</span><span class="o">=</span><span class="n">preprocess</span><span class="p">,</span>
            <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">transform_func</span><span class="o">=</span><span class="n">compute_cloud_top_distribution</span><span class="p">,</span>
            <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lat_slices&quot;</span><span class="p">:</span> <span class="n">lat_slices</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">distributions</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">]))</span>
<span class="n">distributions</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">distributions</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>product=&#39;CCI&#39; region=&#39;deep-tropics&#39;
product=&#39;CCI&#39; region=&#39;sub-tropics&#39;
product=&#39;CCI&#39; region=&#39;mid-latitudes&#39;
product=&#39;CCI&#39; region=&#39;polar&#39;
product=&#39;CLARA-A2&#39; region=&#39;deep-tropics&#39;
product=&#39;CLARA-A2&#39; region=&#39;sub-tropics&#39;
product=&#39;CLARA-A2&#39; region=&#39;mid-latitudes&#39;
product=&#39;CLARA-A2&#39; region=&#39;polar&#39;
product=&#39;CLARA-A3&#39; region=&#39;deep-tropics&#39;
product=&#39;CLARA-A3&#39; region=&#39;sub-tropics&#39;
product=&#39;CLARA-A3&#39; region=&#39;mid-latitudes&#39;
product=&#39;CLARA-A3&#39; region=&#39;polar&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncertanties</span> <span class="o">=</span> <span class="n">collections</span><span class="o">.</span><span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;CLARA-A2&quot;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">lat_slices</span> <span class="ow">in</span> <span class="n">latitude_slices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">region</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
            <span class="n">collection_id</span><span class="p">,</span>
            <span class="n">request</span><span class="p">,</span>
            <span class="n">preprocess</span><span class="o">=</span><span class="n">preprocess</span><span class="p">,</span>
            <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">transform_func</span><span class="o">=</span><span class="n">compute_uncertainty_distribution</span><span class="p">,</span>
            <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lat_slices&quot;</span><span class="p">:</span> <span class="n">lat_slices</span><span class="p">},</span>
        <span class="p">)</span>
        <span class="n">uncertanties</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">]))</span>
<span class="n">uncertanties</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">key</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">uncertanties</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>product=&#39;CCI&#39; region=&#39;deep-tropics&#39;
product=&#39;CCI&#39; region=&#39;sub-tropics&#39;
product=&#39;CCI&#39; region=&#39;mid-latitudes&#39;
product=&#39;CCI&#39; region=&#39;polar&#39;
product=&#39;CLARA-A3&#39; region=&#39;deep-tropics&#39;
product=&#39;CLARA-A3&#39; region=&#39;sub-tropics&#39;
product=&#39;CLARA-A3&#39; region=&#39;mid-latitudes&#39;
product=&#39;CLARA-A3&#39; region=&#39;polar&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="results">
<span id="satellite-satellite-cloud-properties-validation-q02-section-results"></span><h3>Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h3>
<section id="cloud-top-pressure">
<h4>Cloud top pressure<a class="headerlink" href="#cloud-top-pressure" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tropopause_level</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;deep-tropics&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="s2">&quot;sub-tropics&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">},</span>
    <span class="s2">&quot;mid-latitudes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">},</span>
    <span class="s2">&quot;polar&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;width&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;land&quot;</span><span class="p">]:</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">latitude_slices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">latitude_slices</span><span class="p">)):</span>
        <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">distributions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">suffix</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;day&quot;</span><span class="p">,</span> <span class="s2">&quot;night&quot;</span><span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;ctp_</span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">suffix</span> <span class="k">else</span> <span class="s2">&quot;ctp&quot;</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
                    <span class="k">continue</span>
                <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">)</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">suffix</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">suffix</span> <span class="k">else</span> <span class="n">product</span>
                <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="n">yincrease</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>
                <span class="p">)</span>
        <span class="c1"># Add level</span>
        <span class="n">level</span> <span class="o">=</span> <span class="n">tropopause_level</span><span class="p">[</span><span class="n">region</span><span class="p">][</span><span class="s2">&quot;level&quot;</span><span class="p">]</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">tropopause_level</span><span class="p">[</span><span class="n">region</span><span class="p">][</span><span class="s2">&quot;width&quot;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">(),</span>
            <span class="p">[</span><span class="n">level</span> <span class="o">-</span> <span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">[</span><span class="n">level</span> <span class="o">+</span> <span class="n">width</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Labels</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="mf">0.8</span><span class="p">,</span>
            <span class="mf">0.96</span><span class="p">,</span>
            <span class="n">mask</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/e0784d0a1e8f38a284cd89ad1a56ce06d53d670d8d67743c9ad89a316f54404b.png" src="../../_images/e0784d0a1e8f38a284cd89ad1a56ce06d53d670d8d67743c9ad89a316f54404b.png" />
<img alt="../../_images/3a1a2245327d42dc0b41c2ffa3abfbe7c02c9c9c128054c88c3b9165e4936448.png" src="../../_images/3a1a2245327d42dc0b41c2ffa3abfbe7c02c9c9c128054c88c3b9165e4936448.png" />
</div>
</div>
<p><em><strong>Figure caption:</strong> Normalized cloud top pressure distributions over ocean (top) and over land (bottom), separately for deep-tropics, sub-tropics, mid-latitudes and polar regions during the period of interest. Compared are results derived from CLARA-A2, CLARA-A3 and CCI (day and night). Tropopause levels (depending on season) are shown as gray bands. The tropopause shifts from about 100 hPa (~17 km) in the tropics to 250 hPa (~9 km) in the polar regions.</em></p>
<p>The figure above compares normalized cloud top pressure distributions derived from CLARA-A2, CLARA-A3 and CCI (day and night). These normalized distributions provide a view from above, without accounting for hidden cloud layers beneath the top layer. While several features are consistent across the three datasets, others show notable differences. In the following, these distributions are compared with the results from the GEWEX cloud assessment <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a> to estimate which dataset offers the most realistic representation.</p>
<p>The GEWEX cloud assessment indicates that cloud top pressure distributions over oceans exhibit a bimodal pattern in tropical regions, with pronounced peaks in the upper and lower troposphere. These strong peaks decrease in intensity as one moves toward the polar regions. Over land, the contribution of single-layer low-level clouds is minimal. Moreover, the cloud tops of high clouds are high in the tropics and gradually lower toward the poles following the tropopause.</p>
<p>The CLARA-A2 dataset correctly captures two distinct peaks in cloud density over tropical oceans, corresponding to high and low cloud layers. These peaks converge into the mid-troposphere as they approach polar regions. Over land, the cloud density peaks at high altitudes in the tropics, with this peak becoming broader and shifting to lower altitudes toward the poles. The updated GEWEX cloud assessment includes several cloud datasets
provided by the Cloud-Aerosol Lidar and Infrared Pathfinder Satellite Observation (CALIPSO) Science Team <a class="reference external" href="https://doi.org/10.5194/amt-12-703-2019">[5]</a>, one mimicking the sensitivity of passive remote sensing <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a>. With respect to this dataset (CALIPSO-passive), the height of low-level clouds given by CLARA-A2 is slightly overestimated (800 instead of 850 hPa), while the height of high-level clouds is underestimated. The latter is expected, since the active
lidar of CALIPSO determines the cloud top, while a classical cloud retrieval using (passive) radiometers, yields a ‚Äòradiative‚Äô cloud height, which is below the cloud top, in particular for diffuse cloud tops which are frequent in the tropics <a class="reference external" href="https://doi.org/10.1029/94JD02430">[2]</a>. It should be noted that the CLARA-A2 version displayed in <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a> is an earlier version than the one provided in the CDS (versions 2.0 and 2.1, respectively).</p>
<p>The CLARA-A3 dataset also depicts two distinct peaks in cloud density over tropical oceans, associated with high and low clouds. These peaks are more pronounced and narrower, particularly in the high troposphere. Over land, CLARA-A3 shows a significant peak of high clouds in the tropics, which becomes less prominent at polar latitudes as the mid-level cloud presence increases. The cloud top pressure retrieval for CLARA-A3 is based on a neural network trained on CALIPSO cloud data. Consequently, the CLARA-A3 product also includes very thin cirrus clouds in the tropopause layer, which a passive sensor like AVHRR is not able to detect, in particular stratospheric clouds in polar regions over frozen land. Compared to CALIPSO results in <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a>, low-level clouds over ocean have slightly higher cloud tops (800 instead of 850 hPa), as CLARA-A2, but the peaks are narrower than for CLARA-A2.</p>
<p>The CCI product only provides cloud top pressure data separately for daytime and nighttime. Both provide similar distributions over ocean, with slightly less high and more low clouds during nighttime. Over land during nighttime the distributions reveal slightly more high clouds and the peak of low-level clouds is shifted to about 700 hPa, compared to 900 hPa during daytime. Furthermore, the distributions of cloud top pressure differ significantly from those of the CLARA products and those deduced from similar instruments as shown in Figure 6 of <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a>. The CCI product overestimates the relative occurrence of low clouds and strongly underestimates the relative occurrence of high clouds, both over land and ocean, especially over tropical and mid-latitude regions. In particular, the expected high-altitude peak in the tropics is nearly negligible. Overall, these cloud top pressure distributions are the least realistic among the products evaluated.</p>
</section>
<section id="cloud-top-pressure-uncertainty">
<h4>Cloud top pressure uncertainty<a class="headerlink" href="#cloud-top-pressure-uncertainty" title="Link to this heading">#</a></h4>
<p>In this subsection, we investigate the uncertainty estimates for cloud top pressure, provided by CCI and CLARA-A3. Since CCI dataset provides cloud top pressure and its associated uncertainty separately for daytime and nighttime, we explore both separately.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">requests</span><span class="p">[</span><span class="s2">&quot;CCI&quot;</span><span class="p">],</span>
    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
    <span class="n">preprocess</span><span class="o">=</span><span class="n">preprocess</span><span class="p">,</span>
    <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">compute_cloud_top_density</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;ctp_day_cor&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">da</span><span class="p">[</span><span class="s2">&quot;bin&quot;</span><span class="p">],</span> <span class="n">da</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;CCI cloud top pressure uncertainty during daytime [hPa]&quot;</span><span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Density [hPa$^{-1}$]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/61ed284acd3173f0066ef90643bd38631775c9ea1c84fe3ab1837175e69e1d48.png" src="../../_images/61ed284acd3173f0066ef90643bd38631775c9ea1c84fe3ab1837175e69e1d48.png" />
</div>
</div>
<p><em><strong>Figure caption:</strong> Distribution of cloud top pressure uncertainty during daytime provided by the CCI product.</em></p>
<p>The distribution of CCI daytime cloud top pressure uncertainty has a peak close to 0, with largest values around 60 hPa. This uncertainty is obtained by the Optimal Estimation Method, which in this retrieval assumes single layered clouds, and may be therefore underestimated due to multi-layered cloud situations, in particular in the case of semi-transparent cirrus clouds above low-level clouds.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">mask</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ocean&quot;</span><span class="p">,</span> <span class="s2">&quot;land&quot;</span><span class="p">]:</span>
    <span class="k">for</span> <span class="n">clouds</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;high&quot;</span><span class="p">,</span> <span class="s2">&quot;low&quot;</span><span class="p">]:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">latitude_slices</span><span class="p">),</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">region</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">latitude_slices</span><span class="p">)):</span>
            <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">uncertanties</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">label</span> <span class="o">=</span> <span class="n">product</span>
                <span class="k">match</span> <span class="n">product</span><span class="p">:</span>
                    <span class="k">case</span> <span class="s2">&quot;CCI&quot;</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ctp_night_unc&quot;</span>  <span class="c1"># Alternative: &quot;ctp_night_cor&quot;</span>
                        <span class="n">label</span> <span class="o">+=</span> <span class="s2">&quot; night&quot;</span>
                    <span class="k">case</span> <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span>
                        <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ctp_unc01&quot;</span>
                    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">product</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">,</span> <span class="n">region</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">clouds</span><span class="o">=</span><span class="n">clouds</span><span class="p">)</span>
                <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;bin&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">plot_kwargs</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
            <span class="c1"># Labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.82</span><span class="p">,</span>
                <span class="mf">0.88</span><span class="p">,</span>
                <span class="n">mask</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                <span class="n">weight</span><span class="o">=</span><span class="s2">&quot;bold&quot;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="mf">0.78</span><span class="p">,</span>
                <span class="mf">0.96</span><span class="p">,</span>
                <span class="n">clouds</span> <span class="o">+</span> <span class="s2">&quot; clouds&quot;</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/532373a5247d8292eff5bf7cba0ce2b83434c51cf402ea720e5dfde185ec594c.png" src="../../_images/532373a5247d8292eff5bf7cba0ce2b83434c51cf402ea720e5dfde185ec594c.png" />
<img alt="../../_images/cf531228d15f7fc47646fe31cc68044b043c07a63e7e4c74a0cac015a629b823.png" src="../../_images/cf531228d15f7fc47646fe31cc68044b043c07a63e7e4c74a0cac015a629b823.png" />
<img alt="../../_images/c76984fc223e35470a4c24ae4221988951fa57d11ac7e5575aa96ccab57fc308.png" src="../../_images/c76984fc223e35470a4c24ae4221988951fa57d11ac7e5575aa96ccab57fc308.png" />
<img alt="../../_images/409e386e6917dd56ce7075aa7d7f0e1771ce4c2fcf31d4e854bcb9ff1bec1d12.png" src="../../_images/409e386e6917dd56ce7075aa7d7f0e1771ce4c2fcf31d4e854bcb9ff1bec1d12.png" />
</div>
</div>
<p><em><strong>Figure caption:</strong> Distribution of cloud top pressure uncertainty over land for high (top) and low clouds (bottom), in the by deep tropics, subtropics, mid-latitudes, and polar regions during the period of interest. The red line represents the CLARA-A3 dataset, while the light blue dotted lines indicate CCI nighttime data.</em></p>
<p>The CLARA-A3 distributions of cloud top pressure uncertainty have a peak between 10 and 20 hPa. Over the ocean, uncertainties above 50 hPa are negligible. However, over land, a secondary peak occurs around 100 hPa, which is attributed to gridboxes with only a few cloudy observations (not shown). It is interesting to note that the uncertainty of high-level cloud top pressure is smallest in the midlatitudes. Furthermore, the uncertainty for low-level clouds over land is largest.</p>
<p>While the CCI cloud top pressure uncertainty distribution during daytime is in a similar range as the one of CLARA-A3, the CCI distributions during nighttime start only at values larger than 75 or even 100 hPa and reach values up to 150 hPa. This may be understandable for clouds over land in general, as the CCI cloud top pressure of low-level clouds is around 700 hPa during nighttime (compared to 900 hPa during daytime) and the peak in high-level clouds is even smaller than during daytime. However, over ocean, the distributions are much more similar during day-and nighttime, so one would expect similar uncertainties.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Some key resources and further reading were linked throughout this assessment.</p>
<p>The CDS catalogue entry for the data used is:</p>
<ul class="simple">
<li><p>Cloud properties global gridded monthly and daily data from 1979 to present derived from satellite observations:
<a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-cloud-properties?tab=overview">https://cds.climate.copernicus.eu/datasets/satellite-cloud-properties?tab=overview</a></p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>, prepared by <a class="reference external" href="https://www.bopen.eu/">B-Open</a></p></li>
</ul>
<p>The GEWEX Cloud Assessment:</p>
<ul class="simple">
<li><p>The Global Energy and Water Exchanges (GEWEX) program is a core project of the World Climate Research Programme (WCRP). The first GEWEX Cloud Assessment was published in 2012 and it provided the first coordinated inter-comparison of publicly available, global
cloud products [<a class="reference external" href="https://doi.org/10.1175/BAMS-D-12-00117.1">3</a>-<a class="reference external" href="https://www.wcrp-climate.org/documents/GEWEX_Cloud_Assessment_2012.pdf">4</a>]. The database associated with the GEWEX Cloud Assessment
has revealed its usefulness for the assessment of new datasets. Since in the last decade existing
cloud property retrievals have been revised and new retrievals have been developed, this exercise has been recently repeated with 11 global cloud products derived from measurements of multi-spectral imagers, IR sounders, and lidar <a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a>. The first cloud assessment included products from ATSR, while the most recent assessment includes CLARA-A2. However, the CLARA-A2 version (V2.1) in the CDS is a later, improved version compared to the one provided in the updated GEWEX cloud assessment (V2.0). The updated cloud assessment database is available at <a class="reference external" href="https://gewexca.aeris-data.fr/">this link</a>.</p></li>
</ul>
</section>
<section id="reference-useful-material">
<h3>Reference/Useful material<a class="headerlink" href="#reference-useful-material" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://link.springer.com/article/10.1007/s10712-024-09824-0">[1]</a> Stubenrauch, C.J., Kinne, S., Mandorli, G. et al. Lessons Learned from the Updated GEWEX Cloud Assessment Database. Surv Geophys (2024). <a class="reference external" href="https://doi.org/10.1007/s10712-024-09824-0">https://doi.org/10.1007/s10712-024-09824-0</a></p>
<p><a class="reference external" href="https://doi.org/10.1029/94JD02430">[2]</a> Liao, X., W. B. Rossow, and D. Rind (1995), Comparison between SAGE II and ISCCP high-level clouds: 2. Locating cloud tops, J. Geophys. Res., 100(D1), 1137‚Äì1147, doi:10.1029/94JD02430.</p>
<p><a class="reference external" href="https://doi.org/10.1175/BAMS-D-12-00117.1">[3]</a> Stubenrauch, C. J., and Coauthors, 2013: Assessment of Global Cloud Datasets from Satellites: Project and Database Initiated by the GEWEX Radiation Panel. Bull. Amer. Meteor. Soc., 94, 1031‚Äì1049, <a class="reference external" href="https://doi.org/10.1175/BAMS-D-12-00117.1">https://doi.org/10.1175/BAMS-D-12-00117.1</a></p>
<p><a class="reference external" href="https://www.wcrp-climate.org/documents/GEWEX_Cloud_Assessment_2012.pdf">[4]</a> Stubenrauch CJ, Rossow WB, Kinne S, GEWEX Cloud Assessment Team (2012) Assessment of Global Cloud Datasets from Satellites, A Project of the World Climate Research Programme Global Energy and Water Cycle Experiment (GEWEX) Radiation Panel, WCRP report.</p>
<p><a class="reference external" href="https://doi.org/10.5194/amt-12-703-2019">[5]</a> Liu Z, Kar J, Zeng S, Tackett J, Vaughan M, Avery M, Pelon J, Getzewich B, Lee K-P, Magill B, Omar A, Lucker P, Trepte C, Winker D (2019) Discriminating between clouds and aerosols in the CALIOP version 4.1 data products. Atmos Meas Tech 12:703‚Äì734. <a class="reference external" href="https://doi.org/10.5194/amt-12-703-2019">https://doi.org/10.5194/amt-12-703-2019</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Atmosphere_Physics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Atmosphere_Physics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.1. </span>Atmosphere Physics</p>
      </div>
    </a>
    <a class="right-next"
       href="../Atmospheric_Composition/Atmospheric_Composition.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.2. </span>Atmospheric Composition</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-intercomparison-of-cloud-top-altitude-distributions-from-satellite-retrievals">üåç Use case: Intercomparison of cloud top altitude distributions from satellite retrievals</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-parameters-to-use-and-setup-code">Choose the parameters to use and setup code</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">Import libraries</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-parameters">Set parameters</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-the-data-and-check-quality">Download the data and check quality</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-request">Define request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">Functions to cache</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#show-clara-a3-quality">Show CLARA-A3 quality</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">Download and transform</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">Results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cloud-top-pressure">Cloud top pressure</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cloud-top-pressure-uncertainty">Cloud top pressure uncertainty</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#reference-useful-material">Reference/Useful material</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>