
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.4.1. Drought effect on LAI in Yunnan &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Land_Biosphere/satellite_satellite-lai-fapar_extremes-detection_q02';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.5. Land Hydrology" href="../Land_Hydrology/Land_Hydrology.html" />
    <link rel="prev" title="1.4. Land Biosphere" href="Land_Biosphere.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">⚠️This is under development!⚠️</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Land_Biosphere.html">1.4. Land Biosphere</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.4.1. Drought effect on LAI in Yunnan</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Land_Biosphere/satellite_satellite-lai-fapar_extremes-detection_q02.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Land_Biosphere/satellite_satellite-lai-fapar_extremes-detection_q02.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Drought effect on LAI in Yunnan</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-utilize-satellite-derived-data-to-study-the-effect-of-drought-periods-on-vegetation">🌍 Use case: Utilize satellite derived data to study the effect of drought periods on vegetation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">❓ Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-and-download-data">1. Request and download data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-parameters">Set parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-requests">Define requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">Download and transform</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completeness-analysis">2. Completeness analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-data">Filter data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drought-effect-on-lai">3. Drought effect on LAI</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-and-monthly-mean">Spatial and monthly mean</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#standardized-lai-anomaly">Standardized LAI anomaly</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="drought-effect-on-lai-in-yunnan">
<h1><span class="section-number">1.4.1. </span>Drought effect on LAI in Yunnan<a class="headerlink" href="#drought-effect-on-lai-in-yunnan" title="Link to this heading">#</a></h1>
<p>Production date: 04-Jul-2025</p>
<p>Produced by: Amaya Camila Trigoso Barrientos (VUB)</p>
<section id="use-case-utilize-satellite-derived-data-to-study-the-effect-of-drought-periods-on-vegetation">
<h2>🌍 Use case: Utilize satellite derived data to study the effect of drought periods on vegetation<a class="headerlink" href="#use-case-utilize-satellite-derived-data-to-study-the-effect-of-drought-periods-on-vegetation" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question-s">
<h2>❓ Quality assessment question(s)<a class="headerlink" href="#quality-assessment-question-s" title="Link to this heading">#</a></h2>
<p><strong>Does version 3 of the C3S LAI dataset (derived from SPOT satellite imagery) provide sufficient temporal and spatial completeness to capture the impact of the 2009–2010 drought on vegetation in Yunnan Province?</strong></p>
<p>The Leaf Area Index (LAI) and Fraction of Absorbed Photosynthetically Active Radiation (fAPAR) dataset, provided by the Climate Data Store (C3S), offers 10-daily gridded observations from 1981 to the present. It includes effective LAI values derived from multiple satellite sensors across different product versions. Effective LAI is defined as half the total surface area of photosynthetically active plant elements per unit of horizontal ground area. It relates to true LAI through a canopy-dependent structure factor. As a key biophysical parameter, LAI is widely used to assess vegetation status, monitor ecosystem dynamics, and inform environmental and agricultural decision-making.</p>
<p>This quality assessment focuses on version 3 of the LAI product. The data employed was derived from the System Pour l’Observation de la Terre (SPOT) satellite, Vegetation (VGT) sensor and has spatial resolution of 1 km and a 10-day temporal resolution (dekadal). The dataset is evaluated over Yunnan Province, China, in the context of the 2009–2010 drought. The objective is to determine whether the product’s spatial and temporal completeness is sufficient to detect drought-related changes in LAI, which serves as a proxy for vegetation health. This is particularly relevant in Yunnan, a biologically rich and forested region influenced by subtropical monsoon systems, where seasonal rainfall variability plays a critical role in vegetation dynamics.</p>
</section>
<section id="quality-assessment-statement">
<h2>📢 Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>Applying a relaxed quality filter (bitmask 0x9C1) significantly increases LAI data availability during the wet season in Yunnan, maintaining over 84% completeness. However, this comes at the cost of increased uncertainty, as it includes pixels affected by albedo-related issues.</p></li>
<li><p>The conservative filter (bitmask 0xFC1), which excludes all flagged data, severely limits completeness during wet months—particularly from June to August—and especially in densely vegetated areas such as evergreen and mixed forests. However, this filter can be applied during the dry season with high completeness, while maintaining higher standards of data reliability.</p></li>
<li><p>The analysis of spatial and monthly mean LAI in Yunnan successfully captured the effects of drought on vegetation health in 2010, with several months showing the lowest values when compared to other years between 2007 and 2013. In contrast, 2009 did not yet show a clear reduction in LAI, likely because the drought’s effects had not fully materialized or were masked by the averaging of localized impacts across the diverse region.</p></li>
<li><p>The standardized LAI anomaly analysis effectively revealed below-normal vegetation conditions in southern—particularly southeastern—Yunnan between March and May 2010, and identified strong negative anomalies in northern and central Yunnan in November 2010.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>📋 Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>The analysis and results are organised in the following steps, which are detailed in the sections below:</p>
<p><strong><a class="reference internal" href="#satellite-satellite-lai-fapar-extremes-detection-q02-section-1"><span class="std std-ref">1. Request and download data</span></a></strong></p>
<ul class="simple">
<li><p>Download LAI data from the SPOT satellite (VGT sensor) for the period 2007–2013.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-lai-fapar-extremes-detection-q02-section-2"><span class="std std-ref">2. Completeness analysis</span></a></strong></p>
<ul class="simple">
<li><p>Apply two distinct quality-masking approaches to filter the data.</p></li>
<li><p>Plot the percentage of valid LAI values over time for each approach.</p></li>
<li><p>Map LAI across Yunnan to compare the results from the two quality-masking methods.</p></li>
<li><p>Analyze the outcomes in relation to the dataset Documentation.</p></li>
</ul>
<p><strong><a class="reference internal" href="#satellite-satellite-lai-fapar-extremes-detection-q02-section-3"><span class="std std-ref">3. Drought effect on LAI</span></a></strong></p>
<ul class="simple">
<li><p>Calculate the spatial and monthly mean LAI, and plot the values for each year over the months of the year.</p></li>
<li><p>Map LAI anomalies in 2010 relative to the reference years 2007–2008 and 2012–2013.</p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>📈 Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="request-and-download-data">
<span id="satellite-satellite-lai-fapar-extremes-detection-q02-section-1"></span><h3>1. Request and download data<a class="headerlink" href="#request-and-download-data" title="Link to this heading">#</a></h3>
<section id="import-packages">
<h4>Import packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely.geometry</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">regionmask</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.feature</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfeature</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">reqlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">rioxarray</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">animation</span><span class="p">,</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearSegmentedColormap</span><span class="p">,</span> <span class="n">ListedColormap</span><span class="p">,</span> <span class="n">BoundaryNorm</span><span class="p">,</span> <span class="n">Normalize</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.cm</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">calendar</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CDSAPI_RC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/trigoso_camila/.cdsapirc&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="set-parameters">
<h4>Set parameters<a class="headerlink" href="#set-parameters" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year_start</span> <span class="o">=</span> <span class="mi">2007</span>
<span class="n">year_stop</span> <span class="o">=</span> <span class="mi">2013</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-requests">
<h4>Define requests<a class="headerlink" href="#define-requests" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-lai-fapar&quot;</span>
<span class="n">base_request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;lai&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sensor&quot;</span><span class="p">:</span> <span class="s2">&quot;vgt&quot;</span><span class="p">,</span>
    <span class="s2">&quot;horizontal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;1km&quot;</span><span class="p">,</span>
    <span class="s2">&quot;product_version&quot;</span><span class="p">:</span> <span class="s2">&quot;v3&quot;</span><span class="p">,</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">53</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">135</span><span class="p">],</span>
<span class="p">}</span>

<span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year_start</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;ME&quot;</span><span class="p">):</span>
    <span class="n">requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">base_request</span>
        <span class="o">|</span> <span class="p">{</span>
            <span class="s2">&quot;satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;spot&quot;</span><span class="p">,</span>
            <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
            <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nominal_day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;20&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">day</span><span class="p">)],</span>
        <span class="p">}</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mask_dataset_with_shapefile</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="c1"># Load and reproject the shapefile to EPSG:4326</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/yunnan_china&quot;</span><span class="p">)</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

    <span class="c1"># Ensure dataset has a CRS</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">crs</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

    <span class="c1"># Create mask from shapefile</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">invert</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Create a boolean mask (True where valid, False outside the shape)</span>
    <span class="n">spatial_mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>

    <span class="c1"># Apply the mask to the original dataset (similar to ds.where(...))</span>
    <span class="n">ds_masked</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">spatial_mask</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_masked</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-and-transform">
<h4>Download and transform<a class="headerlink" href="#download-and-transform" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">requests</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">mask_dataset_with_shapefile</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 84/84 [00:19&lt;00:00,  4.40it/s]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="completeness-analysis">
<span id="satellite-satellite-lai-fapar-extremes-detection-q02-section-2"></span><h3>2. Completeness analysis<a class="headerlink" href="#completeness-analysis" title="Link to this heading">#</a></h3>
<section id="filter-data">
<h4>Filter data<a class="headerlink" href="#filter-data" title="Link to this heading">#</a></h4>
<p>In this step, the dataset was spatially subsetted using a shapefile of Yunnan, an inland province in southwestern China. The shapefile was sourced from the <a class="reference external" href="https://naturalearth.s3.amazonaws.com/10m_cultural/ne_10m_admin_1_states_provinces.zip" rel="noreferrer" target="_blank">Natural Earth, Admin 1 – States, Provinces Shapefile</a>.</p>
<p>To filter out unreliable data, two distinct quality-masking strategies were applied:</p>
<ul class="simple">
<li><p><strong>Conservative:</strong> Retains only the highest-quality retrievals by applying bitmask 0xFC1. This mask excludes data flagged with any of the following bits: 0, 6, 7, 8, 9, 10, and 11, corresponding to missing input data, untrusted retrievals, unusable observations, inconsistent inputs, high albedo uncertainty (both snow and non-snow), and unreliable uncertainty estimates.</p></li>
<li><p><strong>Relaxed filter:</strong> Permits retrievals with high albedo uncertainty (considered still usable), using bitmask 0x9C1. This mask excludes a smaller subset of flags: bits 0, 6, 7, 8, and 11, while allowing data flagged only for high albedo uncertainty in non-snow and snow conditions (bits 9 and 10).</p></li>
</ul>
<p>These bitmasks are defined in Table 2, with flag definitions detailed in Table 7 of the <a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-lai-fapar/D3.3.9-v3.0_PUGS_CDR_LAI_FAPAR_MULTI_SENSOR_v3.0_PRODUCTS_v1.0.1.pdf" rel="noreferrer" target="_blank">Product User Guide and Specification PUGS</a>.</p>
<p>The goal of this comparison was to assess how different treatments of uncertainty flags affect data completeness over Yunnan, particularly during periods of increased retrieval uncertainty such as the rainy season.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">clip_to_shapefile</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">shapefile_path</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clips an xarray dataset to a region defined by a shapefile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1: Load shapefile and ensure it&#39;s in EPSG:4326</span>
    <span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shapefile_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span> <span class="o">!=</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">:</span>
        <span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Assign CRS to the dataset if not already</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Step 3: Clip dataset using shapefile</span>
    <span class="n">ds_clipped</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_clipped</span>

<span class="k">def</span><span class="w"> </span><span class="nf">filter_conservative</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters the dataset using a strict quality mask:</span>
<span class="sd">    Only keeps retrievals with all critical flags unset (bitmask 0xFC1).</span>
<span class="sd">    Requirement Table 2, PUGS: Best possible data with uncertainties.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quality_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;retrieval_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFC1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">lai_mask</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">quality_mask</span> <span class="o">&amp;</span> <span class="n">lai_mask</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">filter_relaxed</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Filters the dataset using a relaxed quality mask:</span>
<span class="sd">    Allows uncertainty (bitmask 0x9C1).</span>
<span class="sd">    Requirement Table 2, PUGS: Ignore all issues caused by high albedo uncertainties</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">quality_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;retrieval_flag&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;int&quot;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0x9C1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="n">lai_mask</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">quality_mask</span> <span class="o">&amp;</span> <span class="n">lai_mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Clip to ROI</span>
<span class="n">ds_clipped</span> <span class="o">=</span> <span class="n">clip_to_shapefile</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/yunnan_china&quot;</span><span class="p">)</span>

<span class="c1"># Step 2a: Apply strict quality filtering</span>
<span class="n">ds_conservative</span> <span class="o">=</span> <span class="n">filter_conservative</span><span class="p">(</span><span class="n">ds_clipped</span><span class="p">)</span>

<span class="c1"># Step 2b: Apply relaxed quality filtering</span>
<span class="n">ds_relaxed</span> <span class="o">=</span> <span class="n">filter_relaxed</span><span class="p">(</span><span class="n">ds_clipped</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#With conservative filter 0xFC1</span>
<span class="n">ds_conservative</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_conservative</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ds_conservative</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]))</span>

<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/yunnan_china&quot;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="c1"># Step 1: Use the original ds_yunnan to assign CRS if needed</span>
<span class="n">ds_conservative</span> <span class="o">=</span> <span class="n">ds_conservative</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Create a dummy DataArray to match spatial dims (lat/lon), e.g., filled with ones</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">ds_conservative</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Clip the dummy array to get a clean mask of the region</span>
<span class="n">clipped</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Step 4: This gives us a proper mask of where the region is defined</span>
<span class="n">region_mask</span> <span class="o">=</span> <span class="n">clipped</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>

<span class="c1"># Step 5: Broadcast to full shape (time, lat, lon)</span>
<span class="n">region_mask_3d</span> <span class="o">=</span> <span class="n">region_mask</span><span class="o">.</span><span class="n">broadcast_like</span><span class="p">(</span><span class="n">ds_conservative</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">])</span>

<span class="n">valid_mask</span> <span class="o">=</span> <span class="n">ds_conservative</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">region_mask_3d</span>
<span class="n">valid_counts</span> <span class="o">=</span> <span class="n">valid_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">total_yunnan_pixels</span> <span class="o">=</span> <span class="n">region_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">valid_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">valid_counts</span> <span class="o">/</span> <span class="n">total_yunnan_pixels</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide_output tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#With conservative filter 0xFC1</span>
<span class="c1"># Step 5: Extract months from time coordinate</span>
<span class="n">months</span> <span class="o">=</span> <span class="n">valid_percentage</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

<span class="c1"># Step 6: Create rainbow colormap for months (1=red, 12=blue)</span>
<span class="c1"># Using a custom colormap that goes from red to blue through rainbow</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  <span class="c1"># 12 colors for 12 months</span>
<span class="n">month_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">months</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

<span class="c1"># Step 7: Create the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">valid_percentage</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">valid_percentage</span><span class="p">,</span> 
                    <span class="n">c</span><span class="o">=</span><span class="n">month_colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Percentage of Valid LAI Values Over Time (conservative filter)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Valid LAI (%)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add a colorbar to show month mapping</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span> 
                          <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/fig/yunnan_percentage_valid_conservative0xFC1.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<figure class="align-default" id="fig-completeness-conservative" style="width: 100%">
<img alt="../../_images/4ab8c1cf-a5fe-4180-8597-36d9d5372994.png" src="../../_images/4ab8c1cf-a5fe-4180-8597-36d9d5372994.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.4.1.1 </span><span class="caption-text">Percentage of valid LAI values inside Yunnan area appliying the conservative mask (0xFC1). This percentage is plotted over time the points color coded for the month of each respective timestamp.</span><a class="headerlink" href="#fig-completeness-conservative" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#With 0x9C1 flag</span>
<span class="n">ds_relaxed</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds_relaxed</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ds_relaxed</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]))</span>

<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/yunnan_china&quot;</span><span class="p">)</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>
<span class="c1"># Step 1: Use the original ds_yunnan to assign CRS if needed</span>
<span class="n">ds_relaxed</span> <span class="o">=</span> <span class="n">ds_relaxed</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Create a dummy DataArray to match spatial dims (lat/lon), e.g., filled with ones</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">ds_relaxed</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">dummy</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># Step 3: Clip the dummy array to get a clean mask of the region</span>
<span class="n">clipped</span> <span class="o">=</span> <span class="n">dummy</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">gdf</span><span class="o">.</span><span class="n">geometry</span><span class="p">,</span> <span class="n">gdf</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Step 4: This gives us a proper mask of where the region is defined</span>
<span class="n">region_mask</span> <span class="o">=</span> <span class="n">clipped</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>

<span class="c1"># Step 5: Broadcast to full shape (time, lat, lon)</span>
<span class="n">region_mask_3d</span> <span class="o">=</span> <span class="n">region_mask</span><span class="o">.</span><span class="n">broadcast_like</span><span class="p">(</span><span class="n">ds_relaxed</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">])</span>

<span class="n">valid_mask</span> <span class="o">=</span> <span class="n">ds_relaxed</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">region_mask_3d</span>
<span class="n">valid_counts</span> <span class="o">=</span> <span class="n">valid_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">total_yunnan_pixels</span> <span class="o">=</span> <span class="n">region_mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

<span class="n">valid_percentage</span> <span class="o">=</span> <span class="p">(</span><span class="n">valid_counts</span> <span class="o">/</span> <span class="n">total_yunnan_pixels</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide_output tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#With 0x9C1 flag</span>

<span class="c1"># Step 5: Extract months from time coordinate</span>
<span class="n">months</span> <span class="o">=</span> <span class="n">valid_percentage</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span>

<span class="c1"># Step 6: Create rainbow colormap for months (1=red, 12=blue)</span>
<span class="c1"># Using a custom colormap that goes from red to blue through rainbow</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>  <span class="c1"># 12 colors for 12 months</span>
<span class="n">month_colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">colors</span><span class="p">[</span><span class="n">month</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">months</span><span class="o">.</span><span class="n">values</span><span class="p">]</span>

<span class="c1"># Step 7: Create the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">valid_percentage</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="n">valid_percentage</span><span class="p">,</span> 
                    <span class="n">c</span><span class="o">=</span><span class="n">month_colors</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Percentage of Valid LAI Values Over Time (relaxed filter)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Valid LAI (%)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Time&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># Add a colorbar to show month mapping</span>
<span class="n">sm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">rainbow</span><span class="p">,</span> 
                          <span class="n">norm</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">12</span><span class="p">))</span>
<span class="n">sm</span><span class="o">.</span><span class="n">set_array</span><span class="p">([])</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/fig/yunnan_percentage_valid_relaxed_0x9C1.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<figure class="align-default" id="fig-completeness-relaxed" style="width: 100%">
<img alt="../../_images/06c74548-52e2-453d-b462-948ccbde39b9.png" src="../../_images/06c74548-52e2-453d-b462-948ccbde39b9.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.4.1.2 </span><span class="caption-text">Percentage of valid LAI values inside Yunnan area appliying the relaxed mask (0x9C1). This percentage is plotted over time the points color coded for the month of each respective timestamp.</span><a class="headerlink" href="#fig-completeness-relaxed" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Updated color list:</span>
<span class="c1"># 0–0.2: white</span>
<span class="c1"># 0.2–0.4: light yellow → 0.6: yellow → 0.8: deep yellow-green</span>
<span class="c1"># 0.8–2.0: greens (dense vegetation)</span>

<span class="n">color_list</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>  <span class="c1"># 0.0–0.2: white (bare)</span>
    <span class="s2">&quot;#ffffcc&quot;</span><span class="p">,</span>  <span class="c1"># 0.2–0.4: light yellow</span>
    <span class="s2">&quot;#ffeda0&quot;</span><span class="p">,</span>  <span class="c1"># 0.4–0.6: yellow</span>
    <span class="s2">&quot;#addd8e&quot;</span><span class="p">,</span>  <span class="c1"># 0.6–0.8: yellow-green</span>
    <span class="s2">&quot;#74c476&quot;</span><span class="p">,</span>  <span class="c1"># 0.8–1.0: healthy green</span>
    <span class="s2">&quot;#41ab5d&quot;</span><span class="p">,</span>  <span class="c1"># 1.0–1.2: darker green</span>
    <span class="s2">&quot;#238b45&quot;</span><span class="p">,</span>  <span class="c1"># 1.2–1.4: deep green</span>
    <span class="s2">&quot;#006d2c&quot;</span><span class="p">,</span>  <span class="c1"># 1.4–1.6: forest green</span>
    <span class="s2">&quot;#00441b&quot;</span><span class="p">,</span>  <span class="c1"># 1.6–2.0: very dark green</span>
<span class="p">]</span>

<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">]</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">color_list</span><span class="p">),</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">custom_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">(</span><span class="n">color_list</span><span class="p">)</span>
<span class="n">custom_cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s2">&quot;dimgray&quot;</span><span class="p">)</span>
<span class="n">custom_cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="s2">&quot;lightgray&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_lai_comparison</span><span class="p">(</span><span class="n">ds_conservative</span><span class="p">,</span> <span class="n">ds_relaxed</span><span class="p">,</span> <span class="n">date</span><span class="p">,</span> <span class="n">custom_cmap</span><span class="p">,</span> <span class="n">norm</span><span class="p">,</span> <span class="n">bounds</span><span class="p">,</span> <span class="n">output_path</span><span class="p">):</span>
    <span class="c1"># 1. Extract LAI data for the given date</span>
    <span class="n">lai_conservative</span> <span class="o">=</span> <span class="n">ds_conservative</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date</span><span class="p">)[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span>
    <span class="n">lai_relaxed</span> <span class="o">=</span> <span class="n">ds_relaxed</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date</span><span class="p">)[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span>

    <span class="c1"># 2. Create subplot with PlateCarree projection</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
                             <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
                             <span class="n">dpi</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>

    <span class="c1"># 3. Plot Conservative</span>
    <span class="n">im0</span> <span class="o">=</span> <span class="n">lai_conservative</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Conservative Filter&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">gl0</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">gl0</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="n">gl0</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># 4. Plot Relaxed</span>
    <span class="n">im1</span> <span class="o">=</span> <span class="n">lai_relaxed</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
        <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span>
    <span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relaxed Filter&quot;</span><span class="p">)</span>
    <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">gl1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">gl1</span><span class="o">.</span><span class="n">top_labels</span> <span class="o">=</span> <span class="n">gl1</span><span class="o">.</span><span class="n">right_labels</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">gl1</span><span class="o">.</span><span class="n">left_labels</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Avoid duplicate y-axis labels</span>

    <span class="c1"># 5. Shared colorbar</span>
    <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.92</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>
    <span class="n">cb</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
    <span class="n">cb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;Effective LAI [m²/m²]&quot;</span><span class="p">)</span>

    <span class="c1"># 6. Final formatting</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LAI Comparison on </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2"> (Yunnan)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">])</span>

    <span class="c1"># 7. Save &amp; show</span>
    <span class="n">save_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">/yunnan_LAI_comparison_</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">.png&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_path</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide_output tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_lai_comparison</span><span class="p">(</span>
    <span class="n">ds_conservative</span><span class="o">=</span><span class="n">ds_conservative</span><span class="p">,</span>
    <span class="n">ds_relaxed</span><span class="o">=</span><span class="n">ds_relaxed</span><span class="p">,</span>
    <span class="n">date</span><span class="o">=</span><span class="s2">&quot;2007-08-10&quot;</span><span class="p">,</span>
    <span class="n">custom_cmap</span><span class="o">=</span><span class="n">custom_cmap</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
    <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/fig&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/data/wp5/.tmp/ipykernel_1751394/3934487235.py:43: UserWarning: This figure includes Axes that are not compatible with tight_layout, so results might be incorrect.
  plt.tight_layout(rect=[0, 0, 0.9, 0.95])
</pre></div>
</div>
<img alt="../../_images/e48c9b9974a2143d5d0241637a49613d2c4ca642cd49f3ff55188ebb8af77a30.png" src="../../_images/e48c9b9974a2143d5d0241637a49613d2c4ca642cd49f3ff55188ebb8af77a30.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-comparison" style="width: 100%">
<img alt="../../_images/8fba81fa-a581-42f8-8d1f-b7e5e210458b.png" src="../../_images/8fba81fa-a581-42f8-8d1f-b7e5e210458b.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.4.1.3 </span><span class="caption-text">Example illustrating differences in data completeness under different uncertainty flag approaches. The selected date, August 10, 2007, falls within the wet season of a non-drought year.</span><a class="headerlink" href="#fig-comparison" title="Link to this image">#</a></p>
</figcaption>
</figure>
<figure class="align-default" id="fig-land-cover" style="width: 80%">
<img alt="../../_images/58c59c75-ae9e-4470-a5cf-7aa13dda224f.png" src="../../_images/58c59c75-ae9e-4470-a5cf-7aa13dda224f.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.4.1.4 </span><span class="caption-text">Land cover map of Yunnan based on MODIS Land Surface Type data product -MCD12Q1. Figure reproduced from Kim et al. (2017) <a class="reference external" href="https://doi.org/10.1007/s11629-016-3971-x" rel="noreferrer" target="_blank">[2]</a>.</span><a class="headerlink" href="#fig-land-cover" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Using the conservative filter, the percentage of valid LAI data in Yunnan drops significantly between June and August, reaching levels below 20%. Adjacent months such as May and September also show reduced data completeness (see <a class="reference internal" href="#fig-completeness-conservative"><span class="std std-numref">Fig. 1.4.1.1</span></a>). This pattern corresponds to Yunnan’s marked wet and dry seasons <a class="reference external" href="https://doi.org/10.1016/j.chnaes.2013.09.004" rel="noreferrer" target="_blank">[1]</a>, where the rainy season leads to a higher frequency of missing observations and albedo-related uncertainties, mainly due to cloud cover and wet canopy conditions.</p>
<p>In contrast, when applying the relaxed filter, the percentage of valid LAI data remains consistently above 84% throughout the period studied (2007–2013) (see <a class="reference internal" href="#fig-completeness-relaxed"><span class="std std-numref">Fig. 1.4.1.2</span></a>). This improvement is due to the relaxed mask allowing pixels flagged only for high albedo uncertainty in both non-snow and snow conditions (bits 9 and 10). In this context, bit 9 often relates to reflectance disturbances caused by clouds or wet vegetation, which are prevalent in Yunnan during the rainy season. As shown in Figure 15 of the <a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-lai-fapar/D2.3.9-v3.0_PQAR_CDR_LAI_FAPAR_MULTI_SENSOR_v3.0_PRODUCTS_v1.1.pdf" rel="noreferrer" target="_blank">PQAR</a>, the study area is frequently affected by the activation of bit 9, especially during wet months. It can also be observed that the dry months at the end of the year (November–December) exhibit higher completeness in <a class="reference internal" href="#fig-completeness-relaxed"><span class="std std-numref">Fig. 1.4.1.2</span></a>, but the difference between wet and dry seasons is significantly less pronounced than under the conservative filter.</p>
<p>By examining the maps comparing the conservative and relaxed approaches (like the example in <a class="reference internal" href="#fig-comparison"><span class="std std-numref">Fig. 1.4.1.3</span></a>) across different dates, it was observed that areas with missing values under the conservative approach often correspond to regions showing high LAI in the relaxed approach. When compared with the land cover map (<a class="reference internal" href="#fig-land-cover"><span class="std std-numref">Fig. 1.4.1.4</span></a>), these missing values tend to occur in evergreen broadleaf forests and mixed forest areas—regions characterized by dense vegetation.</p>
<p>In summary, maximizing data completeness during the rainy season requires a trade-off: accepting pixels with higher uncertainty (e.g., flagged by bit 9) improves spatial and temporal coverage. In contrast, data from the dry season tend to be both more complete and more reliable, requiring less compromise on uncertainty. For this assessment, the relaxed filter was used for the following steps since we wanted to observe the effect of drought both in wet and dry season and also to capture the dense canopy areas of Yunnan.</p>
</section>
</section>
<section id="drought-effect-on-lai">
<span id="satellite-satellite-lai-fapar-extremes-detection-q02-section-3"></span><h3>3. Drought effect on LAI<a class="headerlink" href="#drought-effect-on-lai" title="Link to this heading">#</a></h3>
<section id="spatial-and-monthly-mean">
<h4>Spatial and monthly mean<a class="headerlink" href="#spatial-and-monthly-mean" title="Link to this heading">#</a></h4>
<p>Yunnan Province is positioned at the intersection of two major monsoon systems, the Indian monsoon and the East Asian monsoon, as well as the Qinghai-Tibet Plateau <a class="reference external" href="https://doi.org/10.1016/j.chnaes.2013.09.004" rel="noreferrer" target="_blank">[1]</a>. These monsoons bring heavy rainfall during a distinct wet season, but due to the region’s varied topography, precipitation is unevenly distributed, often leading to water shortages during the dry season. Natural vegetation and wetlands help buffer this imbalance by storing and gradually releasing water. However, ongoing droughts have revealed the degradation of these ecosystems. Climate change is expected to intensify both the frequency and severity of droughts across Southeast Asia, including Yunnan <a class="reference external" href="https://doi.org/10.1007/s11629-016-3971-x" rel="noreferrer" target="_blank">[2]</a>.</p>
<p>Yunnan has historically faced frequent droughts, with severe events occurring every two to three years between 1950 and 2014. The drought from autumn 2009 to spring 2010 was the most extreme since meteorological records began in 1959. It caused widespread ecological and agricultural disruption—drying up rivers and reservoirs, triggering large-scale crop failures, leading to the death of rare plant species, and altering water quality in plateau lakes <a class="reference external" href="https://doi.org/10.1038/s41598-024-58068-w" rel="noreferrer" target="_blank">[3]</a>.</p>
<p>Drought impacts on vegetation—such as reduced leaf growth, early senescence, and plant mortality—can be detected at regional scales using satellite-derived Leaf Area Index (LAI) data <a class="reference external" href="https://doi.org/10.1007/s11629-016-3971-x" rel="noreferrer" target="_blank">[2]</a>. In the specific case of Yunnan, commonly used products include GLASS LAI (derived from MODIS surface reflectance) <a class="reference external" href="https://doi.org/10.1007/s11629-016-3971-x" rel="noreferrer" target="_blank">[2]</a> and MODIS LAI <a class="reference external" href="https://doi.org/10.1038/s41598-024-58068-w" rel="noreferrer" target="_blank">[3]</a>, both of which are valuable for monitoring vegetation responses to drought.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lai_mean_spatial</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds_relaxed</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">])</span>

<span class="n">lai_mean_spatial</span> <span class="o">=</span> <span class="n">lai_mean_spatial</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">month</span><span class="o">=</span><span class="n">lai_mean_spatial</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="p">,</span>
    <span class="n">year</span><span class="o">=</span><span class="n">lai_mean_spatial</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>
<span class="p">)</span>

<span class="n">monthly_mean</span> <span class="o">=</span> <span class="n">lai_mean_spatial</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_df</span> <span class="o">=</span> <span class="n">monthly_mean</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">to_pandas</span><span class="p">()</span><span class="o">.</span><span class="n">unstack</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/monthly_mean_LAI_by_year.csv&quot;</span><span class="p">)</span><span class="c1">#Downloaded so I do not have to run again if kernel dies</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide_output tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rename column 0 to &#39;LAI&#39;</span>
<span class="n">monthly_df</span> <span class="o">=</span> <span class="n">monthly_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;0&#39;</span><span class="p">:</span> <span class="s1">&#39;LAI&#39;</span><span class="p">})</span>

<span class="c1"># Setup</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">years</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">monthly_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>

<span class="c1"># Normalize to a fixed range and map to a subset of the colormaps</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">Normalize</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">years</span><span class="p">),</span> <span class="n">vmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">years</span><span class="p">))</span>

<span class="c1"># Use a limited range of the colormaps for better visual balance</span>
<span class="n">blue_cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">)</span>
<span class="n">red_cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ScalarMappable</span><span class="p">(</span><span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">)</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">monthly_df</span><span class="p">[</span><span class="n">monthly_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
    
    <span class="c1"># Slice the colormap manually (0.4 to 0.8 range)</span>
    <span class="n">color_val</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">year</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2010</span><span class="p">]:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Reds</span><span class="p">(</span><span class="n">norm</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>  <span class="c1"># Red: stay in 0.4–0.8 range</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="p">(</span><span class="mf">0.4</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">color_val</span><span class="p">)</span>  <span class="c1"># Blue: stay in 0.4–0.8 range</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">subset</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span> <span class="n">subset</span><span class="p">[</span><span class="s1">&#39;LAI&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Final touches</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Month&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Monthly Mean LAI&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Monthly Mean LAI by Year&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Year&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/fig/monthly_mean_LAI.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s2">&quot;tight&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<img alt="../../_images/80ebac769296fb19535faeb48b789f50864824dc03f5ddc85cbeec9b498ce928.png" src="../../_images/80ebac769296fb19535faeb48b789f50864824dc03f5ddc85cbeec9b498ce928.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-monthly-mean" style="width: 100%">
<img alt="../../_images/ef12d856-4e28-4480-be35-17ff2efc8975.png" src="../../_images/ef12d856-4e28-4480-be35-17ff2efc8975.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.4.1.5 </span><span class="caption-text">Monthly mean Leaf Area Index (LAI) for each year from 2007 to 2013, plotted by calendar month.</span><a class="headerlink" href="#fig-monthly-mean" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>The spatial and monthly mean LAI (v3 form the CS3) in Yunnan was calculated. The values for the year 2009 appear to be around what is normal for that month in other non-drought years. However It can be observed that many months of 2010 are well below the values for the same month in other years. This can be because the drought had a stronger effect after a long time and started showing more in 2010. Also because the spatial mean averages out a big diverse area and more localized impacts on 2009 are not represented.</p>
<p>The spatial and monthly mean LAI (Version 3 from the CS3 dataset) in Yunnan was calculated. LAI values for 2009 appear to be within the typical range for that time of year when compared to other non-drought years. However, many months in 2010 show visibly lower values than the corresponding months in other years. This may be due to the delayed impact of the drought, with vegetation stress becoming more pronounced over time. Additionally, because the spatial mean averages conditions across a large and ecologically diverse area, localized drought effects in 2009 may be obscured in the overall average.</p>
</section>
<section id="standardized-lai-anomaly">
<h4>Standardized LAI anomaly<a class="headerlink" href="#standardized-lai-anomaly" title="Link to this heading">#</a></h4>
<p>To identify areas in Yunnan where the Leaf Area Index (LAI) in 2010 was lower than in other non-drought years during the same dekad, the following standardized anomaly equation was applied:</p>
<p><span class="math notranslate nohighlight">\(\text{LAI anomaly} = \frac{\text{LAI}_t - \overline{\text{LAI}}}{\delta_{\text{LAI}}}\)</span></p>
<p>where:</p>
<p><span class="math notranslate nohighlight">\(\text{LAI}_t\)</span> = LAI 2010 for a specific dekad for that pixel</p>
<p><span class="math notranslate nohighlight">\(\overline{\text{LAI}}\)</span> = Mean LAI 2007-2008 and 2012-2013 for that same dekad for that pixel</p>
<p><span class="math notranslate nohighlight">\(\delta_{\text{SMI}}\)</span> = Standard deviation LAI 2007-2008 and 2012-2013 for that same dekad for that pixel</p>
<p>This method is similar to the standardized anomaly index calculated by Zhang et al. (2024). The reference periods 2007–2008 and 2012–2013 were chosen because they experienced minimal drought events and are adjacent to the drought years under investigation (2009–2010). This proximity helps control for long-term changes, such as those driven by human activity, that might otherwise skew the analysis <a class="reference external" href="https://doi.org/10.1038/s41598-024-58068-w" rel="noreferrer" target="_blank">[3]</a>. For example, northwestern Yunnan was a key region in the Grain-for-Green Programme, which may have significantly influenced vegetation dynamics <a class="reference external" href="https://doi.org/10.1016/j.scitotenv.2016.09.026" rel="noreferrer" target="_blank">[4]</a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da</span><span class="o">=</span><span class="n">ds_relaxed</span><span class="p">[</span><span class="s2">&quot;LAI&quot;</span><span class="p">]</span>
<span class="c1"># Step 1: Select time range</span>
<span class="n">da_normal</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span>
    <span class="n">time</span><span class="o">=</span><span class="p">((</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2007</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2008</span><span class="p">))</span> <span class="o">|</span>
         <span class="p">((</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&gt;=</span> <span class="mi">2012</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">&lt;=</span> <span class="mi">2013</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># Step 2: Create &#39;dekad&#39; coordinate</span>
<span class="n">dekad_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">da_normal</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">da_normal</span> <span class="o">=</span> <span class="n">da_normal</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">month</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">da_normal</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">data</span><span class="p">),</span>  <span class="c1"># &lt;--- fixed here</span>
    <span class="n">dekad</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">dekad_idx</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Step 3: Create composite month-dekad key</span>
<span class="n">month_vals</span> <span class="o">=</span> <span class="n">da_normal</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">data</span>
<span class="n">month_dekad_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">month_vals</span><span class="p">,</span> <span class="n">dekad_idx</span><span class="p">)]</span>

<span class="n">da_normal</span> <span class="o">=</span> <span class="n">da_normal</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">month_dekad</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">month_dekad_labels</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Step 4–5: Group and calculate</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">da_normal</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;month_dekad&quot;</span><span class="p">)</span>
<span class="n">mean_normal</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">std_normal</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select data for 2009</span>
<span class="n">da_2009</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2009</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># Create dekad and month labels</span>
<span class="n">dekad_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">da_2009</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">month_vals</span> <span class="o">=</span> <span class="n">da_2009</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">data</span>
<span class="n">month_dekad_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">month_vals</span><span class="p">,</span> <span class="n">dekad_idx</span><span class="p">)]</span>

<span class="c1"># Assign new coordinates</span>
<span class="n">da_2009</span> <span class="o">=</span> <span class="n">da_2009</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">month</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">month_vals</span><span class="p">),</span>
    <span class="n">dekad</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">dekad_idx</span><span class="p">),</span>
    <span class="n">month_dekad</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">month_dekad_labels</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Group by month_dekad and calculate mean</span>
<span class="n">lai_2009</span> <span class="o">=</span> <span class="n">da_2009</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;month_dekad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select data for 2010</span>
<span class="n">da_2010</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2010</span><span class="p">))</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># Create dekad and month labels</span>
<span class="n">dekad_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">da_2010</span><span class="o">.</span><span class="n">time</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">month_vals</span> <span class="o">=</span> <span class="n">da_2010</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">data</span>
<span class="n">month_dekad_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">m</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">month_vals</span><span class="p">,</span> <span class="n">dekad_idx</span><span class="p">)]</span>

<span class="c1"># Assign new coordinates</span>
<span class="n">da_2010</span> <span class="o">=</span> <span class="n">da_2010</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">month</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">month_vals</span><span class="p">),</span>
    <span class="n">dekad</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">dekad_idx</span><span class="p">),</span>
    <span class="n">month_dekad</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">month_dekad_labels</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Group by month_dekad and calculate mean</span>
<span class="n">lai_2010</span> <span class="o">=</span> <span class="n">da_2010</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;month_dekad&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace zeros in std with NaNs to avoid division by zero</span>
<span class="n">std_normal_safe</span> <span class="o">=</span> <span class="n">std_normal</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">std_normal</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># Calculate SMA safely 2009</span>
<span class="n">lai_anom_2009</span> <span class="o">=</span> <span class="p">(</span><span class="n">lai_2009</span> <span class="o">-</span> <span class="n">mean_normal</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_normal_safe</span>
<span class="n">lai_anom_2009</span> <span class="o">=</span> <span class="n">lai_anom_2009</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lai_anom_2009</span><span class="p">))</span>  <span class="c1"># Replace inf/-inf with NaN</span>

<span class="c1"># Calculate SMA safely 2010</span>
<span class="n">lai_anom_2010</span> <span class="o">=</span> <span class="p">(</span><span class="n">lai_2010</span> <span class="o">-</span> <span class="n">mean_normal</span><span class="p">)</span> <span class="o">/</span> <span class="n">std_normal_safe</span>
<span class="n">lai_anom_2010</span> <span class="o">=</span> <span class="n">lai_anom_2010</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">lai_anom_2010</span><span class="p">))</span>  <span class="c1"># Replace inf/-inf with NaN</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define custom colormap and boundaries</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;#e12d62&quot;</span><span class="p">,</span>  <span class="c1"># &lt;-2</span>
    <span class="s2">&quot;#ff8c95&quot;</span><span class="p">,</span>  <span class="c1"># -2 to -1.5</span>
    <span class="s2">&quot;#ffdfc8&quot;</span><span class="p">,</span>  <span class="c1"># -1.5 to -1</span>
    <span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>  <span class="c1"># -1 to 1</span>
    <span class="s2">&quot;#a9eb5f&quot;</span><span class="p">,</span>  <span class="c1"># 1 to 1.5</span>
    <span class="s2">&quot;#3ba521&quot;</span><span class="p">,</span>  <span class="c1"># 1.5 to 2</span>
    <span class="s2">&quot;#006e13&quot;</span>   <span class="c1"># &gt;= 2</span>
<span class="p">]</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>  <span class="c1"># Define boundaries</span>

<span class="c1"># Create colormap and norm</span>
<span class="n">cmap</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span>
<span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>  <span class="c1"># Gray for no data</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">mcolors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">bounds</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span> <span class="n">clip</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide_output tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extract time labels for titles</span>
<span class="n">time_labels</span> <span class="o">=</span> <span class="n">lai_anom_2010</span><span class="p">[</span><span class="s1">&#39;month_dekad&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># e.g., [&#39;01-1&#39;, &#39;01-2&#39;, ..., &#39;12-3&#39;]</span>

<span class="c1"># Set up the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
    <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
    <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="mi">97</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">BORDERS</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightgray&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">)</span>

<span class="c1"># Initial plot: first time slice</span>
<span class="n">initial_data</span> <span class="o">=</span> <span class="n">lai_anom_2010</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">month_dekad</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
    <span class="n">lai_anom_2010</span><span class="o">.</span><span class="n">longitude</span><span class="p">,</span>
    <span class="n">lai_anom_2010</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span>
    <span class="n">initial_data</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LAI Anomaly</span><span class="se">\n</span><span class="si">{</span><span class="n">time_labels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Colorbar with bounds and ticks</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">im</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
    <span class="n">fraction</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
    <span class="n">ticks</span><span class="o">=</span><span class="n">ticks</span><span class="p">,</span>
    <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span>
<span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;LAI Anomaly&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

<span class="c1"># Update function for animation frames</span>
<span class="k">def</span><span class="w"> </span><span class="nf">update</span><span class="p">(</span><span class="n">frame_idx</span><span class="p">):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">lai_anom_2010</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">month_dekad</span><span class="o">=</span><span class="n">frame_idx</span><span class="p">)</span>
    <span class="c1"># pcolormesh expects flattened data array</span>
    <span class="n">im</span><span class="o">.</span><span class="n">set_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">title</span><span class="o">.</span><span class="n">set_text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LAI Anomaly</span><span class="se">\n</span><span class="si">{</span><span class="n">time_labels</span><span class="p">[</span><span class="n">frame_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">im</span><span class="p">,</span>

<span class="c1"># Create animation object</span>
<span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">update</span><span class="p">,</span> <span class="n">frames</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">time_labels</span><span class="p">),</span> <span class="n">blit</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">500</span>
<span class="p">)</span>

<span class="c1"># Save animation as GIF</span>
<span class="n">ani</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/data/wp5/trigoso_camila/LeafIndex/fig/yunnan_animation_lai_anom2010.gif&quot;</span><span class="p">,</span> <span class="n">writer</span><span class="o">=</span><span class="s1">&#39;pillow&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<img alt="../../_images/de541d53f68a7995ff89ef6df4ad1a1f124fd1584a9003a2b36b075a2b262272.png" src="../../_images/de541d53f68a7995ff89ef6df4ad1a1f124fd1584a9003a2b36b075a2b262272.png" />
</div>
</details>
</div>
<figure class="align-default" id="fig-anomaly" style="width: 100%">
<img alt="../../_images/21c65897-6b5a-4b9e-88db-ebd175c7bf93.gif" src="../../_images/21c65897-6b5a-4b9e-88db-ebd175c7bf93.gif" />
<figcaption>
<p><span class="caption-number">Fig. 1.4.1.6 </span><span class="caption-text">Animated map of Leaf Area Index (LAI) anomalies over Yunnan Province for each dekad (10-day period) of 2010. The first number in the title is the month and the second the number of dekad.</span><a class="headerlink" href="#fig-anomaly" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>In January 2010, more zones in Yunnan exhibited positive LAI anomalies than negative ones. However, from mid-February to early March, negative anomalies increased, particularly in southern and central Yunnan. By mid- to late March, negative LAI anomalies had expanded significantly, covering a larger portion of the province. In the third dekad of March, almost all of Yunnan experienced lower LAI values compared to the same dekads in adjacent non-drought years.</p>
<p>During April and May, the spatial pattern of anomalies became more mixed, with both positive and negative values present. Nevertheless, the southern and especially southeastern regions continued to display persistent negative anomalies.</p>
<p>These observations are consistent with the findings of Zhang et al. (2024), who analyzed LAI anomalies along the Tropic of Cancer section of Yunnan, corresponding to the southern part of the province between 23–24°N latitude. Their study concluded that the vegetation in Yunnan was most severely impacted between March and May 2010, a period when the cumulative effects of drought and seasonal vegetation cycles contributed to the decline <a class="reference external" href="https://doi.org/10.1038/s41598-024-58068-w" rel="noreferrer" target="_blank">[3]</a>.</p>
<p>From late May to early June, coinciding with the onset of the wet season, there was an increase in positive anomalies. But this was short-lived — from mid-June to late July, negative anomalies returned, though they appeared more scattered (dotted) rather than forming large continuous blocks as seen during the peak of the dry season.</p>
<p>In August and September, conditions improved, with a greater presence of positive anomalies, especially by mid- to late September, when positive values became widespread.</p>
<p>By late October, the trend reversed again, with negative anomalies emerging, particularly in the northwest. These became significantly more severe in November, eventually covering most of northwestern Yunnan by late November.</p>
<p>Finally, in December, vegetation conditions improved, with signs of greening in the southwest and near-normal LAI levels across much of the rest of the province.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>ℹ️ If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p>Zhu, H. &amp; Tan, Y. (2022). Flora and Vegetation of Yunnan, Southwestern China: Diversity, Origin and Evolution. Diversity, 14(5), 340. <a class="reference external" href="https://www.mdpi.com/1424-2818/14/5/340" rel="noreferrer" target="_blank"></a></p></li>
<li><p>Qian, L.-S., Chen, J.-H., Deng, T., &amp; Sun, H. (2020). Plant diversity in Yunnan: Current status and future directions. Plant Diversity, 42(4), 281–291. <a class="reference external" href="https://doi.org/10.1016/j.pld.2020.07.006" rel="noreferrer" target="_blank"></a></p></li>
<li><p>Lan, T., &amp; Yan, X. (2024). Analysis of drought characteristics and causes in Yunnan Province in the last 60 years (1961–2020). Journal of Hydrometeorology, 25, 177–190. <a class="reference external" href="https://doi.org/10.1175/JHM-D-23-0092.1" rel="noreferrer" target="_blank"></a></p></li>
</ul>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
</ul>
<p>Documentation:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-lai-fapar/D3.3.9-v3.0_PUGS_CDR_LAI_FAPAR_MULTI_SENSOR_v3.0_PRODUCTS_v1.0.1.pdf" rel="noreferrer" target="_blank">Product User Guide and Specification (PUGS) - Multi-sensor CDR LAI and fAPAR v3.0</a></p></li>
<li><p><a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-lai-fapar/D1.4.4-v3.0_ATBD_CDR_LAI_FAPAR_MULTI_SENSOR_v3.0_PRODUCTS_v1.0.1.pdf" rel="noreferrer" target="_blank">Algorithm Theoretical Basis Document (ATBD) - Multi-sensor CDR LAI and fAPAR v3.0</a></p></li>
<li><p><a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-lai-fapar/D2.2.9-v3.0_PQAD_CDR_LAI_FAPAR_MULTI_SENSOR_v3.0_PRODUCTS_v1.1.pdf" rel="noreferrer" target="_blank">Product Quality Assurance Document (PQAD) - Multi-sensor LAI and fAPAR v3.0</a></p></li>
<li><p><a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-lai-fapar/D2.3.9-v3.0_PQAR_CDR_LAI_FAPAR_MULTI_SENSOR_v3.0_PRODUCTS_v1.1.pdf" rel="noreferrer" target="_blank">Product Quality Assessment Report (PQAR) - Multi-sensor LAI and fAPAR v3.0</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.1016/j.chnaes.2013.09.004" rel="noreferrer" target="_blank">[1]</a> Yu, W., Shao, M., Ren, M., Zhou, H., Jiang, Z., &amp; Li, D. (2013). Analysis on spatial and temporal characteristics of drought in Yunnan Province. Acta Ecologica Sinica, 33(6), 317–324.</p>
<p><a class="reference external" href="https://doi.org/10.1007/s11629-016-3971-x" rel="noreferrer" target="_blank">[2]</a> Kim, K., Wang, M.-c., Ranjitkar, S., Liu, S.-h., Xu, J.-c., &amp; Zomer, R. J. (2017). Using leaf area index (LAI) to assess vegetation response to drought in Yunnan province of China. J. Mt. Sci. 14, 1863–1872.</p>
<p><a class="reference external" href="https://doi.org/10.1038/s41598-024-58068-w" rel="noreferrer" target="_blank">[3]</a> Zhang, Y., Gu, T., He, S., Cheng, F., Wang, J., Ye, H., Zhang, Y., Su, H., &amp; Li, Q. (2024). Extreme drought along the tropic of cancer (Yunnan section) and its impact on vegetation. Sci Rep 14, 7508.</p>
<p><a class="reference external" href="https://doi.org/10.1016/j.scitotenv.2016.09.026" rel="noreferrer" target="_blank">[4]</a> Wang, J., Peng, J., Zhao, M., Liu, Y., &amp; Chen, Y. (2017). Significant trade-off for the impact of Grain-for-Green Programme on ecosystem services in North-western Yunnan, China. Science of The Total Environment, 574, 57–64.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Land_Biosphere"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Land_Biosphere.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.4. </span>Land Biosphere</p>
      </div>
    </a>
    <a class="right-next"
       href="../Land_Hydrology/Land_Hydrology.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.5. </span>Land Hydrology</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-utilize-satellite-derived-data-to-study-the-effect-of-drought-periods-on-vegetation">🌍 Use case: Utilize satellite derived data to study the effect of drought periods on vegetation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">❓ Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#request-and-download-data">1. Request and download data</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#set-parameters">Set parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-requests">Define requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">Download and transform</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#completeness-analysis">2. Completeness analysis</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-data">Filter data</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#drought-effect-on-lai">3. Drought effect on LAI</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-and-monthly-mean">Spatial and monthly mean</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#standardized-lai-anomaly">Standardized LAI anomaly</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>