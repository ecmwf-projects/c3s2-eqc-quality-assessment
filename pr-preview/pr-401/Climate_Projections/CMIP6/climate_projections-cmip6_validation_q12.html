
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.1.1. Biases in temperature trends at different pressure levels using CMIP6 across latitudinal bands &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Climate_Projections/CMIP6/climate_projections-cmip6_validation_q12';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.2. CORDEX" href="../CORDEX/CORDEX.html" />
    <link rel="prev" title="5.1. CMIP6" href="CMIP6.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Satellite_ECVs/satellite.html">1. Quality assessments for Satellite Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../climate.html">5. Quality assessments for Climate Projections</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="CMIP6.html">5.1. CMIP6</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">5.1.1. Biases in temperature trends at different pressure levels using CMIP6 across latitudinal bands</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FClimate_Projections/CMIP6/climate_projections-cmip6_validation_q12.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Climate_Projections/CMIP6/climate_projections-cmip6_validation_q12.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Biases in temperature trends at different pressure levels using CMIP6 across latitudinal bands</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-pressure-levels-dependencies-of-temperature-trends-biases-informing-model-developers-and-model-output-users">üåç Use case: Pressure-levels dependencies of temperature trends biases: informing model developers and model output users</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-requests-and-functions-definition">1. Parameters, requests and functions definition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1.1. Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-parameters">1.2. Define Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-models">1.3. Define models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-era5-request">1.4. Define ERA5 request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-model-requests">1.5. Define model requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">1.6. Functions to cache</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-and-processing">2. Downloading and processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-era5">2.1. Download and transform ERA5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-models">2.2. Download and transform models</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">3. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-plotting-functions">3.1. Define plotting functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-climatology-maps">3.2. Plot climatology maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-mean-bias-maps">3.3. Plot mean bias maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-trend-maps">3.4. Plot trend maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-trend-bias-maps">3.5. Plot trend bias maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion-climatologies">3.6. Results summary and discussion - Climatologies</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion-trends">3.7. Results summary and discussion - Trends</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="biases-in-temperature-trends-at-different-pressure-levels-using-cmip6-across-latitudinal-bands">
<h1><span class="section-number">5.1.1. </span>Biases in temperature trends at different pressure levels using CMIP6 across latitudinal bands<a class="headerlink" href="#biases-in-temperature-trends-at-different-pressure-levels-using-cmip6-across-latitudinal-bands" title="Link to this heading">#</a></h1>
<p>Production date: 27-06-2025</p>
<p>Produced by: CMCC foundation - Euro-Mediterranean Center on Climate Change. Albert Martinez Boti and Lorenzo Sangelantoni.</p>
<section id="use-case-pressure-levels-dependencies-of-temperature-trends-biases-informing-model-developers-and-model-output-users">
<h2>üåç Use case: Pressure-levels dependencies of temperature trends biases: informing model developers and model output users<a class="headerlink" href="#use-case-pressure-levels-dependencies-of-temperature-trends-biases-informing-model-developers-and-model-output-users" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>‚ùì Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How is warming propagating across pressure levels and different latitudinal bands?</strong></p></li>
<li><p><strong>Is there signal consistence between CMIP6 ensemble results and ERA5, and among CMIP6 ensemble GCMs?‚Äã</strong></p></li>
</ul>
<p>The vertical profile of temperature trends is widely recognised as an important fingerprint of climate change (e.g., <a class="reference external" href="https://doi.org/10.1002/joc.1756">[1]</a>,<a class="reference external" href="https://doi.org/10.1126/science.274.5290.1170">[2]</a>),<a class="reference external" href="https://doi.org/10.1073/pnas.1305332110">[3]</a>. One of the most studied features of this vertical structure is the amplified warming in the tropical upper troposphere compared to the surface, commonly referred to as tropical tropospheric amplification <a class="reference external" href="https://doi.org/10.1126/science.1114867">[4]</a>. This behaviour is consistent with the basic theory of moist adiabatic processes, which predicts stronger warming in the tropical free troposphere than near the surface due to latent heat release during deep convection <a class="reference external" href="https://doi.org/10.1175/1520-0469%281979%29036%3C0415:ALRRAT%3E2.0.CO;2">[5]</a>.</p>
<p>While tropical amplification has been widely studied, other regions and their representation in CMIP6 models remain less explored. To develop a more comprehensive evaluation framework, it is essential to assess how warming propagates vertically across pressure levels and latitudinal bands. Understanding the vertical structure of temperature trends across these bands provides critical insights into model performance and the physical processes driving climate change. This vertical perspective is key for model developers to identify and diagnose persistent biases, such as errors in atmospheric circulation, lapse rates, and vertical energy transport, and thereby improve model simulations.</p>
<p>This assessment evaluates temperature mean and trend biases across multiple pressure levels using the full ensemble of <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview">CMIP6</a> models available through the Copernicus Climate Data Store (CDS). Model outputs are compared against the <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-complete?tab=doc">ERA5</a> reanalysis, which is used as the reference product. The analysis is performed over latitudinal bands‚Äîincluding Global, Northern and Southern hemispheres, Tropics, Extratropics, and Polar regions‚Äîto characterise spatial variability in biases and explore their dependence on latitude and atmospheric dynamics.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>Model spread in mean temperature climatology increases with altitude, especially above the tropopause, highlighting substantial uncertainty in simulating its height and structure‚Äîcritical for model evaluation and development.</p></li>
<li><p>The median of CMIP6 climatological temperatures shows predominantly cold biases across all latitudinal bands, largest near 250‚Äì200 hPa. Near-surface and lower-stratosphere biases are smaller (though the spread is high), except in polar regions, where both the bias and the spread increase.</p></li>
<li><p>Temperature trends show robust tropospheric warming and stratospheric cooling across all latitudinal bands in both ERA5 and CMIP6. CMIP6 generally exhibits stronger warming trends than ERA5.</p></li>
<li><p>Tropical amplification of trends is evident, with trend magnitudes stronger in CMIP6 than in ERA5 (not necessarily the amplification). Amplification is also high when considering the southern-hemisphere for both ERA5 and CMIP6.</p></li>
<li><p>Trend magnitudes and structures vary with dataset processing, leading to moderate to low confidence in tropospheric warming rates (IPCC AR5 [6]).</p></li>
<li><p>ERA5 is used as the reference dataset to reduce inhomogeneities, though the use of multiple datasets is recommended to capture reference products uncertainties (as in <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0998.1">[7]</a>)</p></li>
</ul>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/c201a935-456d-4a9d-a389-f0e33525963d.png"><img alt="Visual abstract" src="../../_images/c201a935-456d-4a9d-a389-f0e33525963d.png" style="width: 900px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 5.1.1.1 </span><span class="caption-text">Vertical profiles of the annual mean temperature trend (1979-2014). Each subplot corresponds to a latitudinal band (Global, Northern Hemisphere, Southern Hemisphere, Tropics, Extratropics, and Polar). ERA5 is shown as a green line, the CMIP6 ensemble median as a solid black line, individual CMIP6 models as grey dashed lines, and the ensemble spread as a grey shaded area. ERA5 points with non-significant trends (p-value &gt; 0.05) are marked with green crosses. For the CMIP6 ensemble median, trend significance is assessed using agreement categories based on the approach described in the <a class="reference external" href="https://www.ipcc.ch/report/ar6/wg1/downloads/report/IPCC_AR6_WGI_Atlas.pdf">IPCC AR6 Atlas</a> (pp. 1945‚Äì1950). Black crosses indicate pressure levels where fewer than 66% of models show statistically significant trends (p-value &lt; 0.05). If over 66% of the models are significant but fewer than 80% agree on the sign of the trend, a black dot is placed on the CMIP6 ensemble median to indicate low directional agreement.</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>A subset of 33 models from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview">CMIP6</a> are used to assess temperature trends and climatology at different pressure levels, comparing them with those derived from
the <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-complete?tab=doc">ERA5</a> reference product. The analysis is performed across the following latitudinal bands:</p>
<ul class="simple">
<li><p>Global (90¬∞S to 90¬∞N)</p></li>
<li><p>Northern-hemisphere (0¬∞S to 90¬∞N)</p></li>
<li><p>Southern-hemisphere (90¬∞S to 0¬∞N)</p></li>
<li><p>Tropics (23.5¬∞S to 23.5¬∞N)</p></li>
<li><p>Extratropics (23.5¬∞ to 66.5¬∞ in both hemispheres)</p></li>
<li><p>Polar (66.5¬∞ to 90¬∞ in both hemispheres)</p></li>
</ul>
<p>For each latitudinal band, temperature climatology and trends are calculated at the following pressure levels: 925, 850, 700, 600, 500, 400, 300, 250, 200, 150, 100, 70, and 50 hPa. Results are presented using subplots‚Äîone per band‚Äîshowing the vertical profiles of climatology and trends for each CMIP6 model alongside ERA5, following an approach similar to <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0998.1">[7]</a>, who analysed ground- and satellite-based temperature trends over 1979‚Äì2018. Biases in both climatology and trends are also shown. The analysis period is 1979‚Äì2014.</p>
<p>The analysis and results follow the next outline:</p>
<p><strong><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1"><span class="std std-ref">1. Parameters, requests and functions definition</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-1"><span class="std std-ref">1.1. Import packages</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-2"><span class="std std-ref">1.2. Define Parameters</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-3"><span class="std std-ref">1.3. Define models</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-4"><span class="std std-ref">1.4. Define ERA5 request</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-5"><span class="std std-ref">1.5. Define model requests</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-6"><span class="std std-ref">1.6. Functions to cache</span></a></p></li>
</ul>
<p><strong><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-2"><span class="std std-ref">2. Downloading and processing</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-2-1"><span class="std std-ref">2.1. Download and transform ERA5</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-2-2"><span class="std std-ref">2.2. Download and transform models</span></a></p></li>
</ul>
<p><strong><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3"><span class="std std-ref">3. Plot and describe results</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-1"><span class="std std-ref">3.1. Define plotting functions</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-2"><span class="std std-ref">3.2. Plot climatology maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-3"><span class="std std-ref">3.3. Plot mean bias maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-4"><span class="std std-ref">3.4. Plot trend maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-5"><span class="std std-ref">3.5. Plot trend bias maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-6"><span class="std std-ref">3.6. Results summary and discussion - Climatologies</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-7"><span class="std std-ref">3.7. Results summary and discussion - Trends</span></a></p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="parameters-requests-and-functions-definition">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1"></span><h3>1. Parameters, requests and functions definition<a class="headerlink" href="#parameters-requests-and-functions-definition" title="Link to this heading">#</a></h3>
<section id="import-packages">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-1"></span><h4>1.1. Import packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.stats</span><span class="w"> </span><span class="kn">import</span> <span class="n">linregress</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy.mpl.gridliner</span><span class="w"> </span><span class="kn">import</span> <span class="n">Gridliner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">FixedLocator</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">signal</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;hatch.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-parameters">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-2"></span><h4>1.2. Define Parameters<a class="headerlink" href="#define-parameters" title="Link to this heading">#</a></h4>
<p>In the ‚ÄúDefine Parameters‚Äù section, various customisable options for the notebook are specified:</p>
<ul class="simple">
<li><p>The start and end years of the historical period can be adjusted using the parameters <code class="docutils literal notranslate"><span class="pre">year_start</span></code> and <code class="docutils literal notranslate"><span class="pre">year_stop</span></code>. The default period (1979‚Äì2014) is selected to ensure consistency with the satellite era in ERA5, which began assimilating satellite observations in 1979.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">chunk</span></code> selection allows the user to define if dividing into chunks when downloading the data on their local machine. Although it does not significantly affect the analysis, it is recommended to keep the default value for optimal performance.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">variable</span></code> and <code class="docutils literal notranslate"><span class="pre">collection_id</span></code> are not customisable for this assessment and are set to ‚Äòtemperature‚Äô and ‚ÄòCMIP6‚Äô. Expert users can use this notebook as a guide to create similar analyses for other variables or model sets (such as CORDEX).</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time period</span>
<span class="n">year_start</span> <span class="o">=</span> <span class="mi">1979</span>
<span class="n">year_stop</span> <span class="o">=</span> <span class="mi">2014</span>
<span class="k">assert</span> <span class="n">year_start</span> <span class="o">&gt;=</span> <span class="mi">1979</span>

<span class="c1"># Interpolation method</span>
<span class="n">interpolation_method</span> <span class="o">=</span> <span class="s2">&quot;bilinear&quot;</span>

<span class="c1"># Chunks for download</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># Variable</span>
<span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;temperature&quot;</span>
<span class="k">assert</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">)</span> 

<span class="c1">#Collection id</span>
<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;CMIP6&quot;</span>
<span class="k">assert</span> <span class="n">collection_id</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CMIP6&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-models">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-3"></span><h4>1.3. Define models<a class="headerlink" href="#define-models" title="Link to this heading">#</a></h4>
<p>The following climate analyses are performed considering the CMIP6 models that have available both the historical and SSP5-8.5 experiments within the Climate Data Store (<a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview">CDS</a>).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models_cmip6</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;access_cm2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;awi_cm_1_1_mr&quot;</span><span class="p">,</span> <span class="s2">&quot;canesm5&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;canesm5_canoe&quot;</span><span class="p">,</span> <span class="s2">&quot;ciesm&quot;</span><span class="p">,</span> <span class="s2">&quot;cmcc_cm2_sr5&quot;</span><span class="p">,</span> <span class="s2">&quot;cesm2&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cmcc_esm2&quot;</span><span class="p">,</span> <span class="s2">&quot;cnrm_cm6_1&quot;</span><span class="p">,</span> <span class="s2">&quot;cnrm_cm6_1_hr&quot;</span><span class="p">,</span> <span class="s2">&quot;cnrm_esm2_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ec_earth3_cc&quot;</span><span class="p">,</span> <span class="s2">&quot;ec_earth3_veg_lr&quot;</span><span class="p">,</span>  <span class="s2">&quot;fgoals_g3&quot;</span><span class="p">,</span> <span class="s2">&quot;fgoals_f3_l&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fio_esm_2_0&quot;</span><span class="p">,</span> <span class="s2">&quot;gfdl_esm4&quot;</span><span class="p">,</span> <span class="s2">&quot;hadgem3_gc31_ll&quot;</span><span class="p">,</span> <span class="s2">&quot;hadgem3_gc31_mm&quot;</span><span class="p">,</span>
    <span class="s2">&quot;iitm_esm&quot;</span><span class="p">,</span> <span class="s2">&quot;inm_cm4_8&quot;</span><span class="p">,</span> <span class="s2">&quot;inm_cm5_0&quot;</span><span class="p">,</span> <span class="s2">&quot;ipsl_cm6a_lr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;kiost_esm&quot;</span><span class="p">,</span> <span class="s2">&quot;miroc6&quot;</span><span class="p">,</span> <span class="s2">&quot;miroc_es2l&quot;</span><span class="p">,</span> <span class="s2">&quot;mcm_ua_1_0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mpi_esm1_2_lr&quot;</span><span class="p">,</span> <span class="s2">&quot;mri_esm2_0&quot;</span><span class="p">,</span> <span class="s2">&quot;nesm3&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;noresm2_mm&quot;</span><span class="p">,</span> <span class="s2">&quot;taiesm1&quot;</span><span class="p">,</span> <span class="s2">&quot;ukesm1_0_ll&quot;</span><span class="p">,</span> 
<span class="p">)</span>

<span class="n">level_name_era5</span><span class="o">=</span><span class="s2">&quot;pressure_level&quot;</span>
<span class="n">level_name_cmip6</span><span class="o">=</span><span class="s2">&quot;level&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-era5-request">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-4"></span><h4>1.4. Define ERA5 request<a class="headerlink" href="#define-era5-request" title="Link to this heading">#</a></h4>
<p>Within this notebook, ERA5 serves as the reference product. In this section, we set the required parameters for the cds-api data-request of ERA5.</p>
<p><code class="docutils literal notranslate"><span class="pre">request_era_ps_mask</span></code> is used to retrieve surface pressure data used to identify and mask out pressure levels below the surface.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_era</span> <span class="o">=</span> <span class="p">(</span>
    
    <span class="s2">&quot;reanalysis-era5-pressure-levels-monthly-means&quot;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;monthly_averaged_reanalysis&quot;</span><span class="p">],</span>
        <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;00:00&quot;</span><span class="p">],</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span>  <span class="c1"># Include D(year-1)</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
        <span class="s2">&quot;pressure_level&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;50&quot;</span><span class="p">,</span><span class="s2">&quot;70&quot;</span><span class="p">,</span><span class="s2">&quot;100&quot;</span><span class="p">,</span>
            <span class="s2">&quot;150&quot;</span><span class="p">,</span> <span class="s2">&quot;200&quot;</span><span class="p">,</span><span class="s2">&quot;250&quot;</span><span class="p">,</span>
            <span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;400&quot;</span><span class="p">,</span><span class="s2">&quot;500&quot;</span><span class="p">,</span>
            <span class="s2">&quot;600&quot;</span><span class="p">,</span> <span class="s2">&quot;700&quot;</span><span class="p">,</span><span class="s2">&quot;850&quot;</span><span class="p">,</span>
            <span class="s2">&quot;925&quot;</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">)</span>

<span class="n">request_era_ps_mask</span> <span class="o">=</span> <span class="p">(</span>
    
    <span class="s2">&quot;reanalysis-era5-single-levels-monthly-means&quot;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;monthly_averaged_reanalysis&quot;</span><span class="p">],</span>
        <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;00:00&quot;</span><span class="p">],</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;surface_pressure&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">],</span>  <span class="c1"># Include D(year-1)</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-model-requests">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-5"></span><h4>1.5. Define model requests<a class="headerlink" href="#define-model-requests" title="Link to this heading">#</a></h4>
<p>In this section we set the required parameters for the cds-api data-request.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_cmip6</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1">#&quot;format&quot;: &quot;zip&quot;,</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;historical&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;air_temperature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">],</span>  <span class="c1"># Include D(year-1)</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
    <span class="s2">&quot;level&quot;</span><span class="p">:</span> <span class="p">[</span>
            <span class="s2">&quot;50&quot;</span><span class="p">,</span><span class="s2">&quot;70&quot;</span><span class="p">,</span><span class="s2">&quot;100&quot;</span><span class="p">,</span>
            <span class="s2">&quot;150&quot;</span><span class="p">,</span> <span class="s2">&quot;200&quot;</span><span class="p">,</span><span class="s2">&quot;250&quot;</span><span class="p">,</span>
            <span class="s2">&quot;300&quot;</span><span class="p">,</span> <span class="s2">&quot;400&quot;</span><span class="p">,</span><span class="s2">&quot;500&quot;</span><span class="p">,</span>
            <span class="s2">&quot;600&quot;</span><span class="p">,</span> <span class="s2">&quot;700&quot;</span><span class="p">,</span><span class="s2">&quot;850&quot;</span><span class="p">,</span>
            <span class="s2">&quot;925&quot;</span><span class="p">,</span> <span class="s2">&quot;1000&quot;</span><span class="p">,</span>
        <span class="p">],</span>
<span class="p">}</span>
<span class="n">model_requests</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_cmip6</span><span class="p">:</span>
        <span class="n">model_requests</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;projections-cmip6&quot;</span><span class="p">,</span>
            <span class="n">download</span><span class="o">.</span><span class="n">split_request</span><span class="p">(</span><span class="n">request_cmip6</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">},</span> <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">),</span>
        <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="functions-to-cache">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-1-6"></span><h4>1.6. Functions to cache<a class="headerlink" href="#functions-to-cache" title="Link to this heading">#</a></h4>
<p>In this section, functions that will be executed in the caching phase are defined. Caching is the process of storing copies of files in a temporary storage location, so that they can be accessed more quickly. This process also checks if the user has already downloaded a file, avoiding redundant downloads.</p>
<p>Description of the main functions:</p>
<ul class="simple">
<li><p><strong><code class="docutils literal notranslate"><span class="pre">compute_band_trends_clim</span></code></strong>: Computes vertical profiles of temperature climatology and trends. It first calculates annual means, then calls <code class="docutils literal notranslate"><span class="pre">get_latband_mean</span></code>, which averages over longitudes for each latitude within the band, and subsequently across those latitudes. The resulting time series is passed to <code class="docutils literal notranslate"><span class="pre">compute_trends_clim</span></code> to estimate the climatology and linear trend.</p></li>
<li><p><strong><code class="docutils literal notranslate"><span class="pre">compute_trends_clim</span></code></strong>: Computes the climatology and linear trend of a time series using ordinary least squares regression.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">lat_start</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat_max</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
    <span class="n">lat_end</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
    
    <span class="c1"># Ensure correct slicing order for descending or ascending latitude</span>
    <span class="n">lat_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">lat_start</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">lat_end</span><span class="o">.</span><span class="n">item</span><span class="p">()),</span> <span class="nb">max</span><span class="p">(</span><span class="n">lat_start</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">lat_end</span><span class="o">.</span><span class="n">item</span><span class="p">()))</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_symmetric_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">north</span> <span class="o">=</span> <span class="n">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=</span><span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="n">lat_max</span><span class="p">)</span>
    <span class="n">south</span> <span class="o">=</span> <span class="n">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=-</span><span class="n">lat_max</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=-</span><span class="n">lat_min</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">north</span><span class="p">,</span> <span class="n">south</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;dummy&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;dummy&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">round_plev</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;plev&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">coords</span><span class="p">:</span>
        <span class="n">rounded_plev</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;plev&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">decimals</span><span class="o">=</span><span class="n">decimals</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">plev</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;plev&quot;</span><span class="p">,</span> <span class="n">rounded_plev</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_trends_clim</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">obs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">linregress_ufunc</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">slope</span><span class="p">,</span> <span class="n">p_value</span>

    <span class="n">da</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">da_clim</span><span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float64&#39;</span><span class="p">)</span>  
    <span class="n">slope</span><span class="p">,</span> <span class="n">pval</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">apply_ufunc</span><span class="p">(</span>
        <span class="n">linregress_ufunc</span><span class="p">,</span>
        <span class="n">da</span><span class="p">,</span>  <span class="c1"># shape: (pressure_level, band, time)</span>
        <span class="n">time</span><span class="p">,</span>
        <span class="n">input_core_dims</span><span class="o">=</span><span class="p">[[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]],</span>
        <span class="n">output_core_dims</span><span class="o">=</span><span class="p">[[],</span> <span class="p">[]],</span>
        <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">dask</span><span class="o">=</span><span class="s1">&#39;parallelized&#39;</span><span class="p">,</span>
        <span class="n">output_dtypes</span><span class="o">=</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;clim&quot;</span><span class="p">:</span><span class="n">da_clim</span><span class="p">,</span>
            <span class="s2">&quot;slope&quot;</span><span class="p">:</span> <span class="n">slope</span><span class="p">,</span>
            <span class="s2">&quot;p&quot;</span><span class="p">:</span><span class="n">pval</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># harmonize pressure coordinate name</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;plev&quot;</span><span class="p">:</span> <span class="s2">&quot;pressure_level&quot;</span><span class="p">})</span>
    
    <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;signif&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_band_trends_clim</span><span class="p">(</span>
    <span class="n">ds</span><span class="p">,</span> <span class="n">year_start</span><span class="p">,</span> <span class="n">year_stop</span><span class="p">,</span> <span class="n">obs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="n">obs</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
        <span class="n">ds_ps_mask</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
            <span class="o">*</span><span class="n">request_era_ps_mask</span><span class="p">,</span>
            <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">masked_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">pressure_level</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;pressure_level&quot;</span><span class="p">,</span> <span class="n">ds</span><span class="o">.</span><span class="n">pressure_level</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">level</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">pressure_level</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">ds_ps_mask</span><span class="p">[</span><span class="s1">&#39;sp&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">level</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">pressure_level</span><span class="o">=</span><span class="p">[</span><span class="n">level</span><span class="p">])</span>
            <span class="n">masked_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

        <span class="c1"># Concatenate along pressure_level</span>
        <span class="n">mask_levels</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">masked_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;pressure_level&#39;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask_levels</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">convert_calendar</span><span class="p">(</span><span class="s1">&#39;proleptic_gregorian&#39;</span><span class="p">,</span> <span class="n">align_on</span><span class="o">=</span><span class="s1">&#39;date&#39;</span><span class="p">,</span> <span class="n">use_cftime</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;areacella&#39;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s1">&#39;areacella&#39;</span><span class="p">)</span>
    <span class="c1"># Compute means for each band</span>
    <span class="n">latband_mean_global</span> <span class="o">=</span> <span class="n">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">latband_mean_NH</span> <span class="o">=</span> <span class="n">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>
    <span class="n">latband_mean_SH</span> <span class="o">=</span> <span class="n">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">latband_mean_tropics</span> <span class="o">=</span> <span class="n">get_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=-</span><span class="mf">23.5</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mf">23.5</span><span class="p">)</span>
    <span class="n">latband_mean_extratropics</span> <span class="o">=</span> <span class="n">get_symmetric_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=</span><span class="mf">23.5</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mf">66.5</span><span class="p">)</span>
    <span class="n">latband_mean_polar</span> <span class="o">=</span> <span class="n">get_symmetric_latband_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lat_min</span><span class="o">=</span><span class="mf">66.5</span><span class="p">,</span> <span class="n">lat_max</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

    <span class="c1"># Add a new coordinate for each band and concatenate</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">latband_mean_global</span><span class="p">,</span> <span class="n">latband_mean_NH</span><span class="p">,</span> <span class="n">latband_mean_SH</span><span class="p">,</span><span class="n">latband_mean_tropics</span><span class="p">,</span> <span class="n">latband_mean_extratropics</span><span class="p">,</span> <span class="n">latband_mean_polar</span><span class="p">],</span>
        <span class="n">dim</span><span class="o">=</span><span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">([</span><span class="s2">&quot;Global&quot;</span><span class="p">,</span><span class="s2">&quot;Northern-hemisphere&quot;</span><span class="p">,</span> <span class="s2">&quot;Southern-hemisphere&quot;</span><span class="p">,</span>
                          <span class="s2">&quot;Tropics&quot;</span><span class="p">,</span> <span class="s2">&quot;Extratropics&quot;</span><span class="p">,</span> <span class="s2">&quot;Polar&quot;</span><span class="p">],</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;band&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;band&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;YS&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">round_plev</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">decimals</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">})</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>  <span class="c1"># single chunk over time</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">compute_trends_clim</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span><span class="n">obs</span><span class="o">=</span><span class="n">obs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="downloading-and-processing">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-2"></span><h3>2. Downloading and processing<a class="headerlink" href="#downloading-and-processing" title="Link to this heading">#</a></h3>
<section id="download-and-transform-era5">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-2-1"></span><h4>2.1. Download and transform ERA5<a class="headerlink" href="#download-and-transform-era5" title="Link to this heading">#</a></h4>
<p>In this section, the <code class="docutils literal notranslate"><span class="pre">download.download_and_transform</span></code> function from the ‚Äòc3s_eqc_automatic_quality_control‚Äô package is used to retrieve ERA5 monthly reference data, compute annual means, calculate latitudinal band averages, and derive the climatology and linear trend at each pressure level for each latitudinal band. Results are cached to avoid redundant downloads and repeated processing.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transform_func_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;year_start&quot;</span><span class="p">:</span> <span class="n">year_start</span><span class="p">,</span>
    <span class="s2">&quot;year_stop&quot;</span><span class="p">:</span> <span class="n">year_stop</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">ds_era5</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="o">*</span><span class="n">request_era</span><span class="p">,</span>
    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
    <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">compute_band_trends_clim</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span>
    <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;obs&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-and-transform-models">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-2-2"></span><h4>2.2. Download and transform models<a class="headerlink" href="#download-and-transform-models" title="Link to this heading">#</a></h4>
<p>In this section, the <code class="docutils literal notranslate"><span class="pre">download.download_and_transform</span></code> function from the ‚Äòc3s_eqc_automatic_quality_control‚Äô package is employed to download monthly data from the CMIP6 models, compute annual means, calculate latitudinal band averages, and derive the climatology and linear trend at each pressure level for each latitudinal band. Results are cached to avoid redundant downloads and repeated processing.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">model_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="n">chunks</span> <span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="s2">&quot;transform_chunks&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;transform_func&quot;</span><span class="p">:</span>  <span class="n">compute_band_trends_clim</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">requests</span> <span class="ow">in</span> <span class="n">model_requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
        <span class="o">*</span><span class="n">requests</span><span class="p">,</span>
        <span class="o">**</span><span class="n">model_kwargs</span><span class="p">,</span>
        <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span>
    <span class="p">)</span>
    <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]))</span>

<span class="n">ds_models</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;minimal&#39;</span><span class="p">,</span> <span class="n">compat</span><span class="o">=</span><span class="s1">&#39;override&#39;</span><span class="p">)</span>

<span class="c1">#1000hPa are excluded (too close to surface)</span>
<span class="n">ds_era5</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pressure_level</span><span class="o">=</span><span class="n">ds_era5</span><span class="o">.</span><span class="n">pressure_level</span> <span class="o">!=</span> <span class="mi">100000</span><span class="p">)</span>
<span class="n">ds_models</span> <span class="o">=</span> <span class="n">ds_models</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">pressure_level</span><span class="o">=</span><span class="n">ds_models</span><span class="o">.</span><span class="n">pressure_level</span> <span class="o">!=</span> <span class="mi">100000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model=&#39;access_cm2&#39;
model=&#39;awi_cm_1_1_mr&#39;
model=&#39;canesm5&#39;
model=&#39;canesm5_canoe&#39;
model=&#39;ciesm&#39;
model=&#39;cmcc_cm2_sr5&#39;
model=&#39;cesm2&#39;
model=&#39;cmcc_esm2&#39;
model=&#39;cnrm_cm6_1&#39;
model=&#39;cnrm_cm6_1_hr&#39;
model=&#39;cnrm_esm2_1&#39;
model=&#39;ec_earth3_cc&#39;
model=&#39;ec_earth3_veg_lr&#39;
model=&#39;fgoals_g3&#39;
model=&#39;fgoals_f3_l&#39;
model=&#39;fio_esm_2_0&#39;
model=&#39;gfdl_esm4&#39;
model=&#39;hadgem3_gc31_ll&#39;
model=&#39;hadgem3_gc31_mm&#39;
model=&#39;iitm_esm&#39;
model=&#39;inm_cm4_8&#39;
model=&#39;inm_cm5_0&#39;
model=&#39;ipsl_cm6a_lr&#39;
model=&#39;kiost_esm&#39;
model=&#39;miroc6&#39;
model=&#39;miroc_es2l&#39;
model=&#39;mcm_ua_1_0&#39;
model=&#39;mpi_esm1_2_lr&#39;
model=&#39;mri_esm2_0&#39;
model=&#39;nesm3&#39;
model=&#39;noresm2_mm&#39;
model=&#39;taiesm1&#39;
model=&#39;ukesm1_0_ll&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plot-and-describe-results">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3"></span><h3>3. Plot and describe results<a class="headerlink" href="#plot-and-describe-results" title="Link to this heading">#</a></h3>
<p>This section will display the following results:</p>
<ul class="simple">
<li><p><strong>Vertical profiles of the climatology</strong> for each latitudinal band, including ERA5, the median of the CMIP6 models, and the model spread.</p></li>
<li><p><strong>Vertical profiles of the mean bias</strong> for each latitudinal band, showing the median of the CMIP6 model biases and their spread.</p></li>
<li><p><strong>Vertical profiles of the trend</strong> for each latitudinal band, including ERA5, the median of the CMIP6 models, and the spread.</p></li>
<li><p><strong>Vertical profiles of the trend bias</strong> for each latitudinal band, showing the median of the CMIP6 model biases and their spread.</p></li>
</ul>
<section id="define-plotting-functions">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-1"></span><h4>3.1. Define plotting functions<a class="headerlink" href="#define-plotting-functions" title="Link to this heading">#</a></h4>
<p>The function <strong><code class="docutils literal notranslate"><span class="pre">plot_profile</span></code></strong> is used to display vertical profiles of the climatology and trend for each latitudinal band. When the <code class="docutils literal notranslate"><span class="pre">bias</span></code> option is set to False, ERA5 is shown as a green line, the CMIP6 ensemble median as a solid black line, individual CMIP6 models as grey dashed lines, and the model spread as a grey shaded area. When <code class="docutils literal notranslate"><span class="pre">bias=True</span></code>, the function instead plots the corresponding biases: the median CMIP6 bias is shown in blue, individual model biases in grey dashed lines, and their spread as a blue shaded area.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">FixedLocator</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_profile</span><span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_models</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;trend&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="n">band_latlon</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;90¬∞S to 90¬∞N&quot;</span><span class="p">,</span> <span class="s2">&quot;0¬∞S to 90¬∞N&quot;</span><span class="p">,</span> <span class="s2">&quot;90¬∞S to 0¬∞N&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;23.5¬∞S to 23.5¬∞N&quot;</span><span class="p">,</span> <span class="s2">&quot;23.5¬∞ to 66.5¬∞ - both hemisperes&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;66.5¬∞ to 90¬∞ -both hemisperes&quot;</span><span class="p">)</span>    
    
    <span class="n">bands</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="o">.</span><span class="n">band</span><span class="o">.</span><span class="n">values</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="o">.</span><span class="n">pressure_level</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Convert pressure to hPa if needed</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">pressure</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>  <span class="c1"># assume Pa -&gt; convert to hPa</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">pressure</span> <span class="o">/</span> <span class="mf">100.0</span>

    <span class="c1"># Sort pressure descending</span>
    <span class="n">sort_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">pressure</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">pressure_desc</span> <span class="o">=</span> <span class="n">pressure</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">]</span>

    <span class="c1"># Setup according to plot type</span>
    <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mf">3.15576e17</span>  <span class="c1"># from K/ns to K/decade</span>
        <span class="n">var_key</span> <span class="o">=</span> <span class="s1">&#39;slope&#39;</span>
        <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="o">-</span><span class="mf">273.15</span>  <span class="c1"># Kelvin to Celsius</span>
        <span class="n">var_key</span> <span class="o">=</span> <span class="s1">&#39;clim&#39;</span>
        <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;plot_type must be &#39;trend&#39; or &#39;mean&#39;&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">axes</span> <span class="o">=</span> <span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">band_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span><span class="p">:</span>
            <span class="n">era5_vals</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="n">var_key</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="n">cmip6_band</span> <span class="o">=</span> <span class="n">ds_models</span><span class="p">[</span><span class="n">var_key</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">factor</span>
            <span class="k">if</span> <span class="n">bias</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
                <span class="n">cmip6_signif</span> <span class="o">=</span> <span class="n">ds_models</span><span class="p">[</span><span class="s1">&#39;signif&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="n">era5_signif</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="s1">&#39;signif&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="n">cmip6_signif</span> <span class="o">=</span> <span class="n">cmip6_signif</span><span class="p">[:,</span> <span class="n">sort_idx</span><span class="p">]</span>
                <span class="n">era5_signif</span> <span class="o">=</span> <span class="n">era5_signif</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># mean</span>
            <span class="n">era5_vals</span> <span class="o">=</span> <span class="n">ds_era5</span><span class="p">[</span><span class="n">var_key</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">factor</span>
            <span class="n">cmip6_band</span> <span class="o">=</span> <span class="n">ds_models</span><span class="p">[</span><span class="n">var_key</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">band</span><span class="o">=</span><span class="n">band_name</span><span class="p">)</span><span class="o">.</span><span class="n">values</span> <span class="o">+</span> <span class="n">factor</span>

        <span class="n">era5_vals</span> <span class="o">=</span> <span class="n">era5_vals</span><span class="p">[</span><span class="n">sort_idx</span><span class="p">]</span>
        <span class="n">cmip6_band</span> <span class="o">=</span> <span class="n">cmip6_band</span><span class="p">[:,</span> <span class="n">sort_idx</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">bias</span><span class="p">:</span>
            <span class="c1"># Compute model biases</span>
            <span class="n">bias_models</span> <span class="o">=</span> <span class="n">cmip6_band</span> <span class="o">-</span> <span class="n">era5_vals</span>
            <span class="n">bias_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">bias_models</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">bias_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">bias_models</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Zero line always for bias</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Plot individual model biases</span>
            <span class="k">for</span> <span class="n">model_bias</span> <span class="ow">in</span> <span class="n">bias_models</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_bias</span><span class="p">,</span> <span class="n">pressure_desc</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Plot bias median and spread</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bias_median</span><span class="p">,</span> <span class="n">pressure_desc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias Median&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span>
                <span class="n">pressure_desc</span><span class="p">,</span>
                <span class="n">bias_median</span> <span class="o">-</span> <span class="n">bias_std</span><span class="p">,</span>
                <span class="n">bias_median</span> <span class="o">+</span> <span class="n">bias_std</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias Spread&#39;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Zero line for trends only</span>
            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="n">cmip6_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">cmip6_band</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">cmip6_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">cmip6_band</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="c1"># Plot individual CMIP6 models</span>
            <span class="k">for</span> <span class="n">model_vals</span> <span class="ow">in</span> <span class="n">cmip6_band</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_vals</span><span class="p">,</span> <span class="n">pressure_desc</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># CMIP6 median + spread</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmip6_median</span><span class="p">,</span> <span class="n">pressure_desc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CMIP6 Median&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span>
                <span class="n">pressure_desc</span><span class="p">,</span>
                <span class="n">cmip6_median</span> <span class="o">-</span> <span class="n">cmip6_std</span><span class="p">,</span>
                <span class="n">cmip6_median</span> <span class="o">+</span> <span class="n">cmip6_std</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
                <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CMIP6 Spread&#39;</span>
            <span class="p">)</span>

            <span class="c1"># ERA5 line</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">era5_vals</span><span class="p">,</span> <span class="n">pressure_desc</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span><span class="p">:</span>
                <span class="c1"># === Significance markers only here ===</span>
                <span class="n">nonsig_mask_era5</span> <span class="o">=</span> <span class="n">era5_signif</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">era5_vals</span><span class="p">[</span><span class="n">nonsig_mask_era5</span><span class="p">],</span> <span class="n">pressure_desc</span><span class="p">[</span><span class="n">nonsig_mask_era5</span><span class="p">],</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;ERA5 not significant (p‚â•0.05)&#39;</span><span class="p">)</span>

                <span class="n">frac_signif</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">cmip6_signif</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">nonsig_ensemble_mask</span> <span class="o">=</span> <span class="n">frac_signif</span> <span class="o">&lt;</span> <span class="mf">0.66</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cmip6_median</span><span class="p">[</span><span class="n">nonsig_ensemble_mask</span><span class="p">],</span> <span class="n">pressure_desc</span><span class="p">[</span><span class="n">nonsig_ensemble_mask</span><span class="p">],</span>
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CMIP6 median not significant (less than 66% members with p&lt;0.05)&#39;</span><span class="p">)</span>

                <span class="n">sign_ensemble_mask</span> <span class="o">=</span> <span class="n">frac_signif</span> <span class="o">&gt;=</span> <span class="mf">0.66</span>
                
                <span class="k">if</span> <span class="n">sign_ensemble_mask</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
                    <span class="c1"># For pressures where at least 66% of models are significant:</span>
                    <span class="n">pressures_signif</span> <span class="o">=</span> <span class="n">pressure_desc</span><span class="p">[</span><span class="n">sign_ensemble_mask</span><span class="p">]</span>
                    <span class="n">cmip6_trends_signif_pressures</span> <span class="o">=</span> <span class="n">cmip6_band</span><span class="p">[:,</span> <span class="n">sign_ensemble_mask</span><span class="p">]</span>  <span class="c1"># shape (models, n_signif_pressures)</span>

                    <span class="n">n_models</span> <span class="o">=</span> <span class="n">cmip6_trends_signif_pressures</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># Count models with positive and negative trend signs (ALL models, regardless of significance)</span>
                    <span class="n">pos_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmip6_trends_signif_pressures</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">neg_count</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmip6_trends_signif_pressures</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

                    <span class="c1"># Calculate sign ratio as max count divided by total number of models</span>
                    <span class="n">sign_ratio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">pos_count</span><span class="p">,</span> <span class="n">neg_count</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_models</span>

                    <span class="c1"># Find pressures where sign agreement &lt; 0.80</span>
                    <span class="n">low_sign_agreement_mask</span> <span class="o">=</span> <span class="n">sign_ratio</span> <span class="o">&lt;</span> <span class="mf">0.80</span>

                    <span class="n">pressures_low_sign</span> <span class="o">=</span> <span class="n">pressures_signif</span><span class="p">[</span><span class="n">low_sign_agreement_mask</span><span class="p">]</span>
                    <span class="n">median_low_sign</span> <span class="o">=</span> <span class="n">cmip6_median</span><span class="p">[</span><span class="n">sign_ensemble_mask</span><span class="p">][</span><span class="n">low_sign_agreement_mask</span><span class="p">]</span>

                    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">median_low_sign</span><span class="p">,</span> <span class="n">pressures_low_sign</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="s1">&#39;CMIP6 median significant but &lt;80% models share sign&#39;</span><span class="p">)</span>


        
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">pressure_desc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pressure_desc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="n">yscale</span><span class="p">)</span>
        <span class="n">desired_ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">925</span><span class="p">,</span> <span class="mi">850</span><span class="p">,</span> <span class="mi">700</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
        <span class="n">ticks_to_use</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">desired_ticks</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pressure_desc</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">FixedLocator</span><span class="p">(</span><span class="n">ticks_to_use</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="si">}</span><span class="s2"> hPa&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ticks_to_use</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">band_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">band_latlon</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="c1"># X-axis limits and labels</span>
        <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.6</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bias</span> <span class="k">else</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.6</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bias</span> <span class="k">else</span> <span class="mf">0.6</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Trend (K/decade)&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bias</span> <span class="k">else</span> <span class="s1">&#39;Trend Bias (K/decade)&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">80</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bias</span> <span class="k">else</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">25</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bias</span> <span class="k">else</span> <span class="mi">8</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span> <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Climatology (¬∞C)&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">bias</span> <span class="k">else</span> <span class="s1">&#39;Climatology Bias (K)&#39;</span><span class="p">)</span>

        <span class="c1"># Y-axis label only for first column</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">((</span><span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pressure level (hPa)&#39;</span><span class="p">)</span>

    <span class="c1"># Collect handles for shared legend</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
        <span class="n">handles</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
    <span class="n">by_label</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span> <span class="n">handles</span><span class="p">))</span>

    <span class="n">ncols_legend</span> <span class="o">=</span> <span class="mi">4</span> <span class="k">if</span> <span class="n">plot_type</span> <span class="o">==</span> <span class="s1">&#39;trend&#39;</span> <span class="k">else</span> <span class="mi">2</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">by_label</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">by_label</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="n">ncols_legend</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-climatology-maps">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-2"></span><h4>3.2. Plot climatology maps<a class="headerlink" href="#plot-climatology-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_profile()</span></code> function to display the vertical profiles of the climatology for each latitudinal band, including ERA5, the median of the CMIP6 models, and the model spread.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_profile</span><span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_models</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/5918cb341518aeceb6c2d162c12d796926200376271f8c2b1531ae8241ea682d.png" src="../../_images/5918cb341518aeceb6c2d162c12d796926200376271f8c2b1531ae8241ea682d.png" />
</div>
</div>
<div>
    <div style="max-width">
    <p><strong>Fig 1.</strong> 
        Vertical profiles of the annual mean temperature climatology (1979-2014). Each subplot shows a latitudinal band (Global, Northern and Southern hemispheres, Tropics, Extratropics, and Polar). ERA5 is shown as a green line, the CMIP6 median as a solid black line, individual CMIP6 models as grey dashed lines, and the spread of models as a grey shaded area.
</div></section>
<section id="plot-mean-bias-maps">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-3"></span><h4>3.3. Plot mean bias maps<a class="headerlink" href="#plot-mean-bias-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_profile()</span></code> function to display the vertical profiles of the mean bias for each latitudinal band, showing the median of the CMIP6 model biases and their spread.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_profile</span><span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_models</span><span class="p">,</span><span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/7c992ad088bf34756f94548e2101fdc651eab95f93d050ce38ab6a45e51ad6d1.png" src="../../_images/7c992ad088bf34756f94548e2101fdc651eab95f93d050ce38ab6a45e51ad6d1.png" />
</div>
</div>
<div>
    <div style="max-width">
    <p><strong>Fig 2.</strong> 
        Vertical profiles of the mean bias of the annual mean temperature (1979-2014). Each subplot shows a latitudinal band (Global, Northern and Southern hemispheres, Tropics, Extratropics, and Polar). The CMIP6 median is shown as a solid blue line, individual CMIP6 models as grey dashed lines, and the spread of models as a blue shaded area.
</div></section>
<section id="plot-trend-maps">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-4"></span><h4>3.4. Plot trend maps<a class="headerlink" href="#plot-trend-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_profile()</span></code> function to display the vertical profiles of the trend for each latitudinal band, including ERA5, the median of the CMIP6 models, and the spread</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_profile</span><span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_models</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;trend&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/09fa312ba8712a8766da8385e766e0c5a25a2d8b659ab0253931987c9a5e67a9.png" src="../../_images/09fa312ba8712a8766da8385e766e0c5a25a2d8b659ab0253931987c9a5e67a9.png" />
</div>
</div>
<div>
  <div style="max-width">
    <p><strong>Fig 3.</strong> 
      Vertical profiles of the annual mean temperature trend (1979-2014). Each subplot corresponds to a latitudinal band (Global, Northern Hemisphere, Southern Hemisphere, Tropics, Extratropics, and Polar). ERA5 is shown as a green line, the CMIP6 ensemble median as a solid black line, individual CMIP6 models as grey dashed lines, and the ensemble spread as a grey shaded area. ERA5 points with non-significant trends (p-value > 0.05) are marked with green crosses. For the CMIP6 ensemble median, trend significance is assessed using agreement categories based on the approach described in the <a href=https://www.ipcc.ch/report/ar6/wg1/downloads/report/IPCC_AR6_WGI_Atlas.pdf target="_blank">IPCC AR6 Atlas</a> (pp. 1945‚Äì1950). Black crosses indicate pressure levels where fewer than 66% of models show statistically significant trends (p-value < 0.05). If over 66% of the models are significant but fewer than 80% agree on the sign of the trend, a black dot is placed on the CMIP6 ensemble median to indicate low directional agreement.
    </p>
  </div>
</div></section>
<section id="plot-trend-bias-maps">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-5"></span><h4>3.5. Plot trend bias maps<a class="headerlink" href="#plot-trend-bias-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_profile()</span></code> function to display the vertical profiles of the trend bias for each latitudinal band, showing the median of the CMIP6 model biases and their spread.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_profile</span><span class="p">(</span><span class="n">ds_era5</span><span class="p">,</span> <span class="n">ds_models</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="s1">&#39;trend&#39;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span><span class="n">bias</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/623b6b70497f5ce2fde7118cf3e86d39db71e1e6b6b41b3eaf09b68bcbdaa0fa.png" src="../../_images/623b6b70497f5ce2fde7118cf3e86d39db71e1e6b6b41b3eaf09b68bcbdaa0fa.png" />
</div>
</div>
<div>
    <div style="max-width">
    <p><strong>Fig 4.</strong> 
        Vertical profiles of the trend bias of the annual mean temperature (1979-2014). Each subplot shows a latitudinal band (Global, Northern and Southern hemispheres, Tropics, Extratropics, and Polar). The CMIP6 median is shown as a solid blue line, individual CMIP6 models as grey dashed lines, and the spread of models as a blue shaded area.
</div></section>
<section id="results-summary-and-discussion-climatologies">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-6"></span><h4>3.6. Results summary and discussion - Climatologies<a class="headerlink" href="#results-summary-and-discussion-climatologies" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Vertical temperature profiles are broadly consistent across latitudinal bands, with the tropopause‚Äîdefined as the level where the temperature inversion begins‚Äîoccurring at lower pressures in the tropics and higher pressures in colder regions (e.g. polar and extratropical).</p></li>
<li><p>Biases are predominantly cold, with the median of the model biases showing the largest discrepancies around 250‚Äì200 hPa, where CMIP6 models exhibit a sharper temperature transition than ERA5. Near-surface and stratospheric median biases are generally smaller, except in polar regions.</p></li>
<li><p>Model spread increases with altitude, particularly in the stratosphere, highlighting reduced inter-model agreement at higher levels.</p></li>
<li><p>The large spread near the tropopause underscores the substantial uncertainty in simulating its height and structure, which may have important implications for model evaluation and development.</p></li>
</ul>
</section>
<section id="results-summary-and-discussion-trends">
<span id="climate-projections-cmip6-validation-q12-climate-projections-cmip6-validation-q12-section-3-7"></span><h4>3.7. Results summary and discussion - Trends<a class="headerlink" href="#results-summary-and-discussion-trends" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>Tropospheric warming and stratospheric cooling are robust signals of climate change consistent with greenhouse gas forcing. Both ERA5 and CMIP6 reproduce this behaviour across all latitudinal bands.</p></li>
<li><p>The vertical profile of temperature trends is a well-established fingerprint of climate change <a class="reference external" href="https://doi.org/10.1073/pnas.1305332110">[3]</a>. However, its magnitude and structure are highly sensitive to dataset-specific processing and homogenisation methods [6], limiting the robustness of long-term trend assessments.</p></li>
<li><p>As stated in IPCC AR5 [6]: ‚ÄúThere is only medium to low confidence in the rate of change of tropospheric warming and its vertical structure. Estimates of tropospheric warming rates encompass surface temperature warming rate estimates.‚Äù</p></li>
<li><p>Tropical amplification‚Äîenhanced warming in the upper tropical troposphere relative to the surface‚Äîis evident in both ERA5 and CMIP6, although CMIP6 tends to show a stronger signal.</p></li>
<li><p>Amplification varies across latitudinal bands. CMIP6 models display amplification in all regions except the polar zones, whereas ERA5 shows amplification everywhere except in the polar and Northern Hemisphere bands, where warming is stronger near the surface. However, in the global and extratropical bands, both CMIP6 and ERA5 exhibit minimal amplification.</p></li>
<li><p>Differences between CMIP6 and ERA5 can be linked to biases in surface warming <a class="reference external" href="https://doi.org/10.1002/grl.50465">[8]</a>. Studies using models with prescribed SSTs (e.g. <a class="reference external" href="https://doi.org/10.1088/1748-9326/ab9af7">[9]</a>) report reduced biases. In addition, upper-troposphere trend estimates can vary depending on the analysis period, due to factors such as ozone changes.</p></li>
<li><p>Alternative reference datasets, such as <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/insitu-observations-igra-baseline-network?tab=overview">RHARM</a> available through the CDS, could have been used in this assessment. However, they may be better suited for regional to local-scale studies because, despite extensive harmonisation efforts <a class="reference external" href="https://doi.org/10.1029/2021JD035220">[10]</a>, these datasets still exhibit residual inconsistencies‚Äîsuch as limited station coverage, short time series, and sensitivity to data selection criteria.</p></li>
<li><p>ERA5 is used as the reference dataset in this analysis to minimise temporal and vertical inhomogeneities, although it is not free from biases. Given the uncertainties associated with individual datasets, using multiple reference products‚Äîincluding those external to the CDS‚Äîwould be advisable for this type of assessment. For example, <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0998.1">[7]</a> compared tropospheric and stratospheric trends using both ground- and satellite-based observations.</p></li>
</ul>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Some key resources and further reading were linked throughout this assessment.</p>
<p>The CDS catalogue entries for the data used were:</p>
<ul class="simple">
<li><p>CMIP6 climate projections (Monthly - Air temperature): <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview">https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview</a></p></li>
<li><p>ERA5 monthly averaged data on pressure levels from 1940 to present (Temperature): <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-pressure-levels-monthly-means?tab=overview">https://cds.climate.copernicus.eu/datasets/reanalysis-era5-pressure-levels-monthly-means?tab=overview</a></p></li>
<li><p>ERA5 monthly averaged data on single levels from 1940 to present (Surface pressure): <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels-monthly-means?tab=overview">https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels-monthly-means?tab=overview</a></p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/">B-Open</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.1002/joc.1756">[1]</a> Santer, B.D., Thorne, P.W., Haimberger, L., Taylor, K.E., Wigley, T.M.L., Lanzante, J.R., Solomon, S., Free, M., Gleckler, P.J., Jones, P.D., Karl, T.R., Klein, S.A., Mears, C., Nychka, D., Schmidt, G.A., Sherwood, S.C. and Wentz, F.J., 2008. Consistency of modelled and observed temperature trends in the tropical troposphere. Int. J. Climatol., 28: 1703-1722. <a class="reference external" href="https://doi.org/10.1002/joc.1756">https://doi.org/10.1002/joc.1756</a></p>
<p><a class="reference external" href="https://doi.org/10.1126/science.274.5290.1170">[2]</a> Simon F. B. Tett et al., 1996. Human Influence on the Atmospheric Vertical Temperature Structure: Detection and Observations.Science274,1170-1173. <a class="reference external" href="https://doi.org/10.1126/science.274.5290.1170">https://doi.org/10.1126/science.274.5290.1170</a></p>
<p><a class="reference external" href="https://doi.org/10.1073/pnas.1305332110">[3]</a> Santer, B.D., Painter, J.F., Bonfils, C., Mears, C.A., Solomon, S., Wigley, T.M.L., Gleckler,P.J., Schmidt, G.A., Doutriaux,C., Gillett, N.P., Taylor,K.E., Thorne, P.W., and Wentz, F.J., 2013. Human and natural influences on the changing thermal structure of the atmosphere, Proc. Natl. Acad. Sci. U.S.A. 110 (43) 17235-17240. <a class="reference external" href="https://doi.org/10.1073/pnas.1305332110">https://doi.org/10.1073/pnas.1305332110</a></p>
<p><a class="reference external" href="https://doi.org/10.1126/science.1114867">[4]</a> B. D. Santer et al., 2005. Amplification of Surface Temperature Trends and Variability in the Tropical Atmosphere.Science309,1551-1556. <a class="reference external" href="https://doi.org/10.1126/science.1114867">https://doi.org/10.1126/science.1114867</a></p>
<p><a class="reference external" href="https://doi.org/10.1175/1520-0469%281979%29036%3C0415:ALRRAT%3E2.0.CO;2">[5]</a> Stone, P. H., and Carlson, J. H., 1979. Atmospheric lapse rate regimes and their parameterization. J. Atmos. Sci., 36, 415‚Äì423. <a class="reference external" href="https://doi.org/10.1175/1520-0469%281979%29036">https://doi.org/10.1175/1520-0469(1979)036</a>&lt;0415:ALRRAT&gt;<a class="reference external" href="http://2.0.CO">2.0.CO</a>;2 .</p>
<p>[6] Hartmann, D. L., et al., 2013. Observations: Atmosphere and surface. Climate Change 2013: The Physical Science Basis, T. F. Stocker et al., Eds., Cambridge University Press, 159‚Äì254.</p>
<p><a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0998.1">[7]</a> Steiner, A. K. et al., 2020. Observed Temperature Changes in the Troposphere and Stratosphere from 1979 to 2018. J. Climate, 33, 8165‚Äì8194, <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0998.1">https://doi.org/10.1175/JCLI-D-19-0998.1</a></p>
<p><a class="reference external" href="https://doi.org/10.1002/grl.50465">[8]</a> Mitchell, D. M., Thorne, P. W., Stott, P. A., and Gray, L. J., 2013. Revisiting the controversial issue of tropical tropospheric temperature trends, Geophys. Res. Lett., 40, 2801‚Äì2806, <a class="reference external" href="https://doi.org/10.1002/grl.50465">https://doi.org/10.1002/grl.50465</a></p>
<p><a class="reference external" href="https://doi.org/10.1088/1748-9326/ab9af7">[9]</a> Dann M. Mitchell et al., 2020. The vertical profile of recent tropical temperature trends: Persistent model biases in the context of internal variability. Environ. Res. Lett. 15 1040b4. <a class="reference external" href="https://doi.org/10.1088/1748-9326/ab9af7">https://doi.org/10.1088/1748-9326/ab9af7</a></p>
<p><a class="reference external" href="https://doi.org/10.1029/2021JD035220">[10]</a> Madonna, F., Tramutola, E., SY, S., Serva, F., Proto, M., Rosoldi, M., et al., 2022. The new Radiosounding HARMonization (RHARM) data set of homogenized radiosounding temperature, humidity, and wind profiles with uncertainties. Journal of Geophysical Research: Atmospheres, 127, e2021JD035220. <a class="reference external" href="https://doi.org/10.1029/2021JD035220">https://doi.org/10.1029/2021JD035220</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Climate_Projections/CMIP6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="CMIP6.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.1. </span>CMIP6</p>
      </div>
    </a>
    <a class="right-next"
       href="../CORDEX/CORDEX.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.2. </span>CORDEX</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-pressure-levels-dependencies-of-temperature-trends-biases-informing-model-developers-and-model-output-users">üåç Use case: Pressure-levels dependencies of temperature trends biases: informing model developers and model output users</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-requests-and-functions-definition">1. Parameters, requests and functions definition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1.1. Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-parameters">1.2. Define Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-models">1.3. Define models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-era5-request">1.4. Define ERA5 request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-model-requests">1.5. Define model requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">1.6. Functions to cache</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-and-processing">2. Downloading and processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-era5">2.1. Download and transform ERA5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-models">2.2. Download and transform models</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">3. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-plotting-functions">3.1. Define plotting functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-climatology-maps">3.2. Plot climatology maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-mean-bias-maps">3.3. Plot mean bias maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-trend-maps">3.4. Plot trend maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-trend-bias-maps">3.5. Plot trend bias maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion-climatologies">3.6. Results summary and discussion - Climatologies</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion-trends">3.7. Results summary and discussion - Trends</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>