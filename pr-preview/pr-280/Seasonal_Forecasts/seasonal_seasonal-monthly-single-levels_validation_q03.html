
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>4.1. Reliability of seasonal forecasts &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_validation_q03';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="5. Climate projections" href="../Climate_Projections/climate.html" />
    <link rel="prev" title="4. Seasonal forecasts" href="seasonal.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">⚠️This is under development!⚠️</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Satellite Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Satellite_ECVs/satellite.html">1. Quality assessments for Satellite Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Seasonal Forecasts</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active"><a class="current reference internal" href="#">4.1. Reliability of seasonal forecasts</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSeasonal_Forecasts/seasonal_seasonal-monthly-single-levels_validation_q03.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_validation_q03.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reliability of seasonal forecasts</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-initial-assessment-of-the-reliability-of-forecast-probabilities-by-a-climate-services-provider">🌍 Use case: Initial assessment of the reliability of forecast probabilities by a climate services provider</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">❓ Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-data-to-use-and-setup-code">1.Choose the data to use and setup code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-data-retrieval-and-area-averages">2. ERA5 data retrieval and area averages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-hindcast-data-retrieval-and-area-average">3. Seasonal hindcast data retrieval and area average</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">4. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-the-results">How to read the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-libraries-used">Code libraries used</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="reliability-of-seasonal-forecasts">
<h1><span class="section-number">4.1. </span>Reliability of seasonal forecasts<a class="headerlink" href="#reliability-of-seasonal-forecasts" title="Link to this heading">#</a></h1>
<p>Production date: 07-06-2024</p>
<p>Produced by: Johannes Langvatn (METNorway)</p>
<section id="use-case-initial-assessment-of-the-reliability-of-forecast-probabilities-by-a-climate-services-provider">
<h2>🌍 Use case: Initial assessment of the reliability of forecast probabilities by a climate services provider<a class="headerlink" href="#use-case-initial-assessment-of-the-reliability-of-forecast-probabilities-by-a-climate-services-provider" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>❓ Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How reliable are the probabilities of the seasonal forecasts for different regions and parameters of interest</strong></p></li>
</ul>
<p>Seasonal forecasts are inherently probabilistic and should be interpreted and evaluated as such. Reliability, a key attribute of a forecast system, measures how closely the conditional mean of the observations aligns with the corresponding forecast. This notebook provides estimates of forecast reliability. It should be noted that reliability is only one of several attributes measuring the goodness of a forecast system <a class="reference external" href="https://doi.org/10.1175/1520-0434(1993)008%3C0281:WIAGFA%3E2.0.CO;2.">Murphy, 1993 [1]</a>.</p>
</section>
<section id="quality-assessment-statement">
<h2>📢 Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>The reliability of the 1-month, 2-meter air temperature forecasts for June, July, and August in the climatological upper tercile varies across different regions.</p></li>
<li><p>Reliability diagrams are useful tools for assessing the quality of probabilistic forecasts.</p></li>
<li><p>Reliability is just one of several metrics used to evaluate a forecast, and should be considered alongside other attributes such as sharpness, discrimination, and resolution.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>📋 Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>This notebook follows the approach suggested by <a class="reference external" href="https://doi.org/10.1098/rsif.2013.1162">Weisheimer and Palmer (2014) [2]</a>. which was later applied and slightly modified by <a class="reference external" href="https://doi.org/10.1029/2021GL094662">Manzanas et al. (2022) [3]</a>. Reliability diagrams are constructed for forecasts of 2-meter air temperature reaching the climatological upper tercile, based on SEAS5 (ECMWF) single-level seasonal forecasts. These are then compared with ERA5 single-level data, which is considered the reference or ‘truth.
There are several methods for constructing reliability diagrams. Since the primary focus is on verifying probabilities for a specific region, it is important to assess the actual forecast. This approach results in a relatively small data sample (e.g., 24 years of hindcasts x 3 months per season), meaning the results may not be very robust. To address this, <a class="reference external" href="https://doi.org/10.1098/rsif.2013.1162">Weisheimer and Palmer (2014) [2]</a> suggested calculating a linear regression of the reliability line, weighted by the sample size in each bin. The uncertainty of the slope of the reliability line was further estimated using bootstrapping. Based on the characteristics of the reliability line and its associated uncertainty, the forecasts were categorized into five reliability categories: “perfect,” “still very useful for decision-making,” “marginally useful,” “not useful,” and “dangerously useless” (see below for more details and/or <a class="reference external" href="https://doi.org/10.1098/rsif.2013.1162">Weisheimer and Palmer (2014) [2]</a></p>
<p>This notebook calculates, presents, and discusses the reliability diagrams for a specific region: northern Europe. For this region, an alternative method of constructing the reliability diagram, similar to the approach shown on the <a class="reference external" href="https://charts.ecmwf.int/products/seasonal_system5_verification_reliability_2mtm?area=EURO&amp;amp;base_time=201712010000&amp;amp;stats=BRVT67&amp;amp;valid_time=201801010000">ECMWF web pages</a>, is also presented and compared. Finally, the reliability categories for a range of regions worldwide are calculated and summarized in a table.</p>
<p><strong><a class="reference internal" href="#seasonal-seasonal-monthly-single-levels-validation-q03-section-1"><span class="std std-ref">1. Choose data to use and setup code:</span></a></strong></p>
<ul class="simple">
<li><p>Choose a selection of forecast systems and versions, hindcast period (normally 1993-2016), regions and parametre to compute reliability for.</p></li>
<li><p>Choose an example region for computing the reliability without computing the area average</p></li>
</ul>
<p><strong><a class="reference internal" href="#seasonal-seasonal-monthly-single-levels-validation-q03-section-2"><span class="std std-ref">2. ERA5 data retrieval and area averages:</span></a></strong></p>
<ul class="simple">
<li><p>Retrieve reanalysis-data for the selected parameters above, from the data catalogue ”ERA5 monthly averaged data on single levels from 1940 to present”</p></li>
<li><p>Compute the 2 m temperature anomaly by computing the climatology subtracting climatology from the reanalysis.</p></li>
<li><p>Compute the spatial mean of 2 m temperature anomaly for each selected region.</p></li>
</ul>
<p><strong><a class="reference internal" href="#seasonal-seasonal-monthly-single-levels-validation-q03-section-3"><span class="std std-ref">3. Seasonal hindcast data retrieval and area average:</span></a></strong></p>
<ul class="simple">
<li><p>Retrieve hindcast data for all ensemble members for the selected parameters above, from the data catalogue ”Seasonal forecast monthly statistics on single levels”</p></li>
<li><p>Compute the 2 m temperature anomaly by computing the climatology subtracting climatology from the hindcast.</p></li>
<li><p>Compute the spatial mean of 2 m temperature anomaly for each selected region.</p></li>
</ul>
<p><strong><a class="reference internal" href="#seasonal-seasonal-monthly-single-levels-validation-q03-section-4"><span class="std std-ref">4. Plot and describe results:</span></a></strong></p>
<ul class="simple">
<li><p>The forecasted frequency of 2 m temperature anomaly being warmer than climatology is calculated</p></li>
<li><p>The observation if the month was warmer in the reanalysis than the reanalysed climatology is noted</p></li>
<li><p>The reliability is then computed by bootstrapping from the pool of forecasted frequency and their respective observations</p></li>
<li><p>This is then plotted as confidence intervals of (12.5%, 87.5%) in the reliability plots</p></li>
<li><p>The reliability is also computed for the example region</p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>📈 Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="choose-the-data-to-use-and-setup-code">
<span id="seasonal-seasonal-monthly-single-levels-validation-q03-section-1"></span><h3>1.Choose the data to use and setup code<a class="headerlink" href="#choose-the-data-to-use-and-setup-code" title="Link to this heading">#</a></h3>
<p>First we import the needed code packages, and set the seaborn plot-style for matplotlib to use for plotting</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">regionmask</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In this section, the customisable options of the notebook are set. These variables consists of:</p>
<ul class="simple">
<li><p>Model forecast system</p>
<ul>
<li><p>forecast centre</p></li>
<li><p>system version</p></li>
</ul>
</li>
<li><p>Time</p>
<ul>
<li><p>first year of the model hindcast</p></li>
<li><p>last year of the model hindcast</p></li>
<li><p>forecast month</p></li>
<li><p>number of months leadtime for hindcast</p></li>
</ul>
</li>
<li><p>Regions of interest</p>
<ul>
<li><p>number of SREX region (see <a class="reference external" href="https://regionmask.readthedocs.io/en/stable/defined_scientific.html#srex-regions">SREX in the regionmask-module</a> for choices)</p></li>
</ul>
</li>
<li><p>Weather parametre</p>
<ul>
<li><p>name of variable in grib-file</p></li>
<li><p>name of variable in CADS-api</p></li>
</ul>
</li>
<li><p>Download parameters</p>
<ul>
<li><p>chunk size of the data</p></li>
<li><p>number of concurrent request for parallel download</p></li>
</ul>
</li>
<li><p>Combination of originating centre and model system (Operational forecast model systems per March 2024):</p>
<ul>
<li><p>centre = “ecmwf”, system = “51”</p></li>
<li><p>centre = “ukmo”, system = “602”</p></li>
<li><p>centre = “meteo_france”, system = “8”</p></li>
<li><p>centre = “dwd”, system = “21”</p></li>
<li><p>centre = “cmcc”, system = “35”</p></li>
<li><p>centre = “ncep”, system = “2”</p></li>
<li><p>centre = “jma”, system = “3”</p></li>
<li><p>centre = “eccc”, system = “2”</p></li>
<li><p>centre = “eccc”, system = “3”</p></li>
</ul>
</li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ecmwf&quot;</span><span class="p">:</span> <span class="s2">&quot;51&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">year_start_hindcast</span> <span class="o">=</span> <span class="mi">1993</span>
<span class="n">year_stop_hindcast</span> <span class="o">=</span> <span class="mi">2016</span>
<span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
<span class="n">leadtime_month</span> <span class="o">=</span> <span class="mi">2</span>
<span class="c1"># reanalysis_month is month + leadtime_month - 1 (since leadtime_month 1 for May is May)</span>
<span class="n">reanalysis_month</span> <span class="o">=</span> <span class="p">[</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">]</span>
<span class="n">var_grb</span> <span class="o">=</span> <span class="s1">&#39;t2m&#39;</span>
<span class="n">var_api</span> <span class="o">=</span> <span class="s1">&#39;2m_temperature&#39;</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">n_jobs</span> <span class="o">=</span> <span class="mi">1</span> 
<span class="n">region_masks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">example_region</span> <span class="o">=</span> <span class="mi">11</span>
<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;seasonal-monthly-single-levels&quot;</span>
<span class="n">collection_id_reanalysis</span> <span class="o">=</span> <span class="s2">&quot;reanalysis-era5-single-levels-monthly-means&quot;</span>

<span class="c1"># Construct the common request to be sent to CADS</span>
<span class="n">common_request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;grib&quot;</span><span class="p">,</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">89.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">179.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">89.5</span><span class="p">,</span> <span class="mf">179.5</span><span class="p">],</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">var_api</span><span class="p">,</span>
    <span class="s2">&quot;grid&quot;</span><span class="p">:</span> <span class="s2">&quot;1/1&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">all_datasets</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Define functions needed later to find correct bins for the observations, computing the reliability, and plotting the results</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">score</span><span class="p">(</span><span class="n">coeff_lower</span><span class="p">,</span> <span class="n">coeff_middle</span><span class="p">,</span> <span class="n">coeff_higher</span><span class="p">):</span>
    <span class="c1"># Scores defined in the Weisheimer paper</span>
    <span class="k">if</span> <span class="n">coeff_lower</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">/</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">coeff_lower</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">coeff_higher</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">coeff_higher</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;perfect&quot;</span><span class="p">,</span> <span class="mi">5</span>
        <span class="k">return</span> <span class="s2">&quot;still very useful for decision-making&quot;</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">coeff_middle</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;still very useful for decision-making&quot;</span><span class="p">,</span> <span class="mi">4</span>
    <span class="k">elif</span> <span class="n">coeff_lower</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;marginally useful&quot;</span><span class="p">,</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">coeff_higher</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">coeff_lower</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span> 
        <span class="k">return</span> <span class="s2">&quot;not useful&quot;</span><span class="p">,</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">coeff_higher</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="s2">&quot;dangerously useless&quot;</span><span class="p">,</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="s2">&quot;Error&quot;</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">find_correct_bin</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">value</span> <span class="o">-</span> <span class="n">array</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">])</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># Non-Vectorized version</span>
    <span class="c1"># index = np.abs(array-value).argmin()</span>
    <span class="k">return</span> <span class="n">index</span>


<span class="k">def</span><span class="w"> </span><span class="nf">bootstrap_coefficients</span><span class="p">(</span><span class="n">total_observations</span><span class="p">,</span> <span class="n">observations_x</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="c1"># could be cleaner, faster, but 1000 is fast.</span>
    <span class="n">coefficients</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">observations_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>
        <span class="n">non_observations_i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">utplukk</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">total_observations</span><span class="p">)):</span>
            <span class="n">random_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">total_observations</span><span class="p">))</span>
            <span class="n">forecasted_frequency</span><span class="p">,</span> <span class="n">observed</span> <span class="o">=</span> <span class="n">total_observations</span><span class="p">[</span><span class="n">random_index</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">find_correct_bin</span><span class="p">(</span><span class="n">observations_x</span><span class="p">,</span> <span class="n">forecasted_frequency</span><span class="p">)</span>
    
            <span class="n">observations_i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">observed</span>
            <span class="n">non_observations_i</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">observed</span> 
        <span class="n">indices</span> <span class="o">=</span> <span class="n">observations_i</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
        <span class="n">hit_rate_i</span> <span class="o">=</span> <span class="n">observations_i</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">observations_i</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">+</span><span class="n">non_observations_i</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
        <span class="n">regr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
        <span class="c1"># Tips to change weights to achieve what you want (No weights to focus on climatology (mostly))</span>
        <span class="n">regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">observations_x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">hit_rate_i</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">observations_i</span><span class="o">+</span><span class="n">non_observations_i</span><span class="p">)[</span><span class="n">indices</span><span class="p">])</span>
        <span class="n">coefficients</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">regr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">coefficients</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_reliability</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">non_observations</span><span class="p">,</span> <span class="n">observed_values</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">region_mask</span><span class="p">,</span>
                     <span class="n">var_grb</span><span class="o">=</span><span class="n">var_grb</span><span class="p">,</span> <span class="n">leadtime_month</span> <span class="o">=</span> <span class="n">leadtime_month</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">average_forecast</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">list_of_values</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">observed_values</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_of_values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">average_forecast</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">list_of_values</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">observations</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">observations_x</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="n">hit_rate</span> <span class="o">=</span> <span class="n">observations</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">observations</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">+</span><span class="n">non_observations</span><span class="p">[</span><span class="n">indices</span><span class="p">])</span>
    <span class="n">regr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>

    <span class="n">regr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">average_forecast</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="n">hit_rate</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">observations</span><span class="o">+</span><span class="n">non_observations</span><span class="p">)[</span><span class="n">indices</span><span class="p">])</span>
    <span class="n">coeff_true</span> <span class="o">=</span> <span class="n">regr</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plot</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">sizing</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span><span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">observed_values</span><span class="p">])</span>
        <span class="n">norm_sizing</span> <span class="o">=</span> <span class="p">(</span><span class="n">sizing</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">sizing</span><span class="p">))</span><span class="o">*</span><span class="mi">750</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reliability plot for season JJA leadtime </span><span class="si">{</span><span class="n">leadtime_month</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">var_grb</span><span class="si">}</span><span class="s2">, from </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> in Area </span><span class="si">{</span><span class="n">region_mask</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">x_range</span><span class="p">,</span> <span class="s2">&quot;b--&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">average_forecast</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">hit_rate</span><span class="p">,</span> <span class="s2">&quot;r--&quot;</span><span class="p">)</span>
        <span class="n">scatter</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">average_forecast</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">hit_rate</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">norm_sizing</span><span class="p">[</span><span class="n">indices</span><span class="p">],</span> <span class="n">c</span> <span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">handles</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">scatter</span><span class="o">.</span><span class="n">legend_elements</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="s2">&quot;sizes&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">labels</span><span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">sizing</span><span class="p">[</span><span class="n">indices</span><span class="p">]):</span>
            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">mathdefault{</span><span class="si">%d</span><span class="s1">}$&#39;</span><span class="o">%</span><span class="k">size</span>)
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x_range</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">coeff_true</span><span class="o">*</span><span class="n">x_range</span><span class="o">+</span><span class="mf">0.33</span> <span class="o">-</span> <span class="mf">0.33</span><span class="o">*</span><span class="n">coeff_true</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">1.01</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Forecast probability&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Observed probability&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">x_range</span><span class="o">*</span><span class="mf">0.5</span> <span class="o">+</span> <span class="mf">0.33</span><span class="o">/</span><span class="mi">2</span> <span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x_range</span><span class="o">&lt;=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span> <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x_range</span><span class="o">*</span><span class="mf">.5</span> <span class="o">+</span> <span class="mf">.33</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">x_range</span> <span class="o">&gt;=</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quantiles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">x_range</span><span class="o">*</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.33</span> <span class="o">-</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">x_range</span><span class="o">*</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.33</span> <span class="o">-</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mf">0.33</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">coeff_true</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="era5-data-retrieval-and-area-averages">
<span id="seasonal-seasonal-monthly-single-levels-validation-q03-section-2"></span><h3>2. ERA5 data retrieval and area averages<a class="headerlink" href="#era5-data-retrieval-and-area-averages" title="Link to this heading">#</a></h3>
<p>In this section the ERA5 reanalysis data are downloaded, the anomaly is computed and this is transformed into regional anomaly means for the regions defined in section 1. For the chosen ‘example_region’ a dataset is prepared with anomaly values for each grid cell.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_reanalysis</span> <span class="o">=</span> <span class="n">common_request</span> <span class="o">|</span> <span class="p">{</span>
    <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_averaged_reanalysis&quot;</span><span class="p">,</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">example_data</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ERA5&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">example_region</span><span class="p">:</span> <span class="p">{}}}</span>
<span class="n">model_type</span> <span class="o">=</span> <span class="s2">&quot;reanalysis&quot;</span>
<span class="n">years</span> <span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">year_start_hindcast</span><span class="p">,</span> <span class="n">year_stop_hindcast</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id_reanalysis</span><span class="p">,</span>
    <span class="n">request_reanalysis</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">years</span><span class="p">))},</span>
    <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
    <span class="n">cached_open_mfdataset_kwargs</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;combine&quot;</span><span class="p">:</span> <span class="s2">&quot;nested&quot;</span><span class="p">,</span>
        <span class="s2">&quot;concat_dim&quot;</span><span class="p">:</span> <span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
<span class="c1"># Store the downloaded dataset in the dictionary</span>
<span class="n">all_datasets</span><span class="p">[</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>
<span class="n">all_datasets_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ERA5&quot;</span><span class="p">:</span> <span class="p">{}}</span>

<span class="n">year_span</span> <span class="o">=</span> <span class="n">year_stop_hindcast</span> <span class="o">-</span> <span class="n">year_start_hindcast</span>
<span class="k">for</span> <span class="n">region_mask</span> <span class="ow">in</span> <span class="n">region_masks</span><span class="p">:</span>
    <span class="n">all_datasets_dict</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">reanalysis_month</span><span class="p">:</span>
        <span class="n">reanalysis</span> <span class="o">=</span> <span class="n">all_datasets</span><span class="p">[</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">forecast_reference_time</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">year_span</span><span class="o">*</span><span class="mi">12</span> <span class="o">+</span> <span class="n">month</span><span class="p">,</span> <span class="mi">12</span> <span class="p">))</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">defined_regions</span><span class="o">.</span><span class="n">ar6</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">reanalysis</span><span class="p">)</span>
        <span class="n">re_ds</span> <span class="o">=</span> <span class="n">reanalysis</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">mask</span><span class="o">==</span><span class="n">region_mask</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="n">var_grb</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">region_mask</span> <span class="o">==</span> <span class="n">example_region</span><span class="p">:</span>
            <span class="n">climatology</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">re_ds</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">)</span>
            <span class="n">example_ds</span> <span class="o">=</span> <span class="n">re_ds</span> <span class="o">-</span> <span class="n">climatology</span>
            <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">example_ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;upper&quot;</span> <span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">example_ds</span> <span class="p">}</span>
        <span class="n">re_ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">re_ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">re_ds</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">)</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">climatology</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span>
        <span class="n">re_ds</span> <span class="o">-=</span> <span class="n">climatology</span>
        <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">re_ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">all_datasets_dict</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;upper&quot;</span> <span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">re_ds</span> <span class="p">}</span>
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:00&lt;00:00, 61.97it/s]
Downloading file &#39;IPCC-WGI-reference-regions-v4.zip&#39; from &#39;https://github.com/regionmask/regionmask/raw/v0.13.0/data/IPCC-WGI-reference-regions-v4.zip&#39; to &#39;/data/wp3/.cache/regionmask/v0.13.0&#39;.
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="seasonal-hindcast-data-retrieval-and-area-average">
<span id="seasonal-seasonal-monthly-single-levels-validation-q03-section-3"></span><h3>3. Seasonal hindcast data retrieval and area average<a class="headerlink" href="#seasonal-hindcast-data-retrieval-and-area-average" title="Link to this heading">#</a></h3>
<p>In this section the seasonal data are downloaded, the anomaly is computed and this is transformed into regional anomaly means for the regions defined in section 1. For the chosen ‘example_region’ a dataset is prepared with anomaly values for each grid cell.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_seasonal</span> <span class="o">=</span> <span class="n">common_request</span> <span class="o">|</span> <span class="p">{</span>
    <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">months</span><span class="p">],</span>
    <span class="s2">&quot;leadtime_month&quot;</span><span class="p">:</span> <span class="n">leadtime_month</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">centre</span><span class="p">,</span> <span class="n">system</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model_type</span> <span class="o">=</span> <span class="s2">&quot;hindcast&quot;</span>
    <span class="n">all_datasets</span><span class="p">[</span><span class="n">model_type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">centre</span><span class="o">+</span><span class="n">system</span><span class="p">:</span> <span class="kc">None</span><span class="p">}</span>
    <span class="n">request_seasonal</span><span class="p">[</span><span class="s2">&quot;system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">system</span>
    <span class="n">request_seasonal</span><span class="p">[</span><span class="s2">&quot;originating_centre&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">centre</span>
    <span class="n">years</span> <span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">year_start_hindcast</span><span class="p">,</span> <span class="n">year_stop_hindcast</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
        <span class="n">collection_id</span><span class="p">,</span>
        <span class="n">request_seasonal</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">years</span><span class="p">))},</span>
        <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="n">n_jobs</span><span class="o">=</span><span class="n">n_jobs</span><span class="p">,</span>
        <span class="n">backend_kwargs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;time_dims&quot;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s2">&quot;forecastMonth&quot;</span><span class="p">,</span>
                <span class="s2">&quot;indexing_time&quot;</span> <span class="k">if</span> <span class="n">centre</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;ukmo&quot;</span><span class="p">,</span> <span class="s2">&quot;jma&quot;</span><span class="p">,</span> <span class="s2">&quot;ncep&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">},</span>
        <span class="n">cached_open_mfdataset_kwargs</span><span class="o">=</span><span class="p">{</span>
            <span class="s2">&quot;concat_dim&quot;</span><span class="p">:</span> <span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">)</span>
    <span class="c1"># Store the downloaded dataset in the dictionary</span>
    <span class="n">all_datasets</span><span class="p">[</span><span class="n">model_type</span><span class="p">][</span><span class="n">centre</span><span class="o">+</span><span class="n">system</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>

<span class="k">for</span> <span class="n">system</span><span class="p">,</span><span class="n">centre</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">system</span><span class="o">+</span><span class="n">centre</span>
    <span class="n">all_datasets_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">example_data</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">example_region</span><span class="p">:</span> <span class="p">{}}</span>
    <span class="k">for</span> <span class="n">region_mask</span> <span class="ow">in</span> <span class="n">region_masks</span><span class="p">:</span>
        <span class="n">all_datasets_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">region_mask</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">forecast_month</span><span class="p">,</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">reanalysis_month</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">regionmask</span><span class="o">.</span><span class="n">defined_regions</span><span class="o">.</span><span class="n">ar6</span><span class="o">.</span><span class="n">all</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">all_datasets</span><span class="p">[</span><span class="s2">&quot;hindcast&quot;</span><span class="p">][</span><span class="n">model</span><span class="p">])</span>
            <span class="n">forecast_ds</span> <span class="o">=</span> <span class="n">all_datasets</span><span class="p">[</span><span class="s2">&quot;hindcast&quot;</span><span class="p">][</span><span class="n">model</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">forecast_reference_time</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">forecast_month</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">year_span</span><span class="p">)</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">reanalysis_month</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">reanalysis_month</span><span class="p">)))</span>
            <span class="n">forecast_ds</span> <span class="o">=</span> <span class="n">forecast_ds</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">mask</span><span class="o">==</span><span class="n">region_mask</span><span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="n">var_grb</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">region_mask</span> <span class="o">==</span> <span class="n">example_region</span><span class="p">:</span>
                <span class="n">climatology</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">forecast_ds</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">)</span>
                <span class="n">example_ds</span> <span class="o">=</span> <span class="n">forecast_ds</span> <span class="o">-</span> <span class="n">climatology</span>
                <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">example_ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="n">example_data</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;upper&quot;</span> <span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">example_ds</span> <span class="p">}</span>
            <span class="n">forecast_ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">forecast_ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">climatology</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">forecast_ds</span><span class="p">,</span> <span class="n">time_name</span><span class="o">=</span><span class="s2">&quot;forecast_reference_time&quot;</span><span class="p">)</span>
            <span class="n">climatology</span> <span class="o">=</span> <span class="n">climatology</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">climatology</span><span class="o">.</span><span class="n">dims</span><span class="p">))</span>
            <span class="n">forecast_ds</span> <span class="o">-=</span> <span class="n">climatology</span>
            <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">forecast_ds</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="p">[</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">all_datasets_dict</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;upper&quot;</span> <span class="p">:</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">forecast_ds</span> <span class="p">}</span>
            
</pre></div>
</div>
</div>
</details>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:00&lt;00:00, 42.49it/s]
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
Error while converting 1 to months for forecastMonth.
 Units will not be converted.

Traceback:
Unable to convert from &#39;Unit(&#39;1&#39;)&#39; to &#39;Unit(&#39;months&#39;)&#39;.
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-and-describe-results">
<span id="seasonal-seasonal-monthly-single-levels-validation-q03-section-4"></span><h3>4. Plot and describe results<a class="headerlink" href="#plot-and-describe-results" title="Link to this heading">#</a></h3>
<p>In this section the reliability of the spatially averaged anomalies are computed for all regions, and plotted for the ‘example_region’. Then the reliability for each grid cell is computed and plotted for the ‘example_region’. The reliability scores is then summarized in a table and the results are discussed</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tercile</span> <span class="o">=</span> <span class="s2">&quot;upper&quot;</span>
<span class="n">operator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">less_equal</span> <span class="k">if</span> <span class="s2">&quot;lower&quot;</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span>
<span class="n">operator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">greater_equal</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observations_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">0.9</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>

<span class="k">for</span> <span class="n">system</span><span class="p">,</span><span class="n">centre</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">system</span><span class="o">+</span><span class="n">centre</span>
    <span class="n">results</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">model_dict</span> <span class="o">=</span> <span class="n">all_datasets_dict</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">region_mask</span> <span class="ow">in</span> <span class="n">region_masks</span><span class="p">:</span>
        <span class="n">total_observations</span> <span class="o">=</span> <span class="p">[[],[]]</span>
        <span class="n">observed_values</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">observations_x</span><span class="p">]</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>
        <span class="n">non_observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_span</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">reanalysis_month</span><span class="p">:</span>
                <span class="c1"># upper should be replaced by a flag for upper/lower</span>
                <span class="n">limit_forecast</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="n">tercile</span><span class="p">]</span>
                <span class="n">limit_reanalysis</span> <span class="o">=</span> <span class="n">all_datasets_dict</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="n">tercile</span><span class="p">]</span>
                <span class="c1"># The NaNs are an artifact of the masking</span>
                <span class="n">nonnan</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">limit_forecast</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

                <span class="n">values</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="s2">&quot;dataset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">forecast_reference_time</span><span class="o">=</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="n">re_values</span> <span class="o">=</span> <span class="n">all_datasets_dict</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="s2">&quot;dataset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">forecast_reference_time</span> <span class="o">=</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
                <span class="c1"># If upper/lower is chosen dynamically, this must also be updated to be compared dynamically, maybe </span>
                <span class="n">forecasted_frequency</span> <span class="o">=</span> <span class="p">((</span><span class="n">operator</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">limit_forecast</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">nonnan</span><span class="p">]</span>
                <span class="n">observed</span> <span class="o">=</span> <span class="p">((</span><span class="n">operator</span><span class="p">(</span><span class="n">re_values</span><span class="p">,</span> <span class="n">limit_reanalysis</span><span class="p">)))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">nonnan</span><span class="p">]</span>
        
                <span class="n">idx</span> <span class="o">=</span> <span class="n">find_correct_bin</span><span class="p">(</span><span class="n">observations_x</span><span class="p">,</span> <span class="n">forecasted_frequency</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">forecasted_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">forecasted_frequency</span><span class="p">):</span>
                    <span class="n">observed_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecasted_value</span><span class="p">)</span>
                <span class="n">observations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">observed</span>
                <span class="n">non_observations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">observed</span> 
                <span class="n">total_observations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecasted_frequency</span><span class="p">)</span>
                <span class="n">total_observations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observed</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
                
        <span class="n">new_observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">total_observations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">total_observations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">coefficients</span> <span class="o">=</span> <span class="n">bootstrap_coefficients</span><span class="p">(</span><span class="n">new_observations</span><span class="p">,</span> <span class="n">observations_x</span><span class="p">,</span> <span class="n">N</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coefficients</span><span class="p">),</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.875</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">region_mask</span> <span class="o">!=</span> <span class="n">example_region</span><span class="p">:</span>
            <span class="n">coeff_true</span> <span class="o">=</span> <span class="n">plot_reliability</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">non_observations</span><span class="p">,</span> <span class="n">observed_values</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">region_mask</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coeff_true</span> <span class="o">=</span> <span class="n">plot_reliability</span><span class="p">(</span><span class="n">quantiles</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">non_observations</span><span class="p">,</span> <span class="n">observed_values</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">region_mask</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        <span class="n">results</span><span class="p">[</span><span class="n">model</span><span class="p">][</span><span class="n">region_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span><span class="p">(</span><span class="n">quantiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coeff_true</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/435b64ebbf800324a2c5f1595ba6db7687a11f8ad24e07454f8cc0f1d10229ab.png" src="../_images/435b64ebbf800324a2c5f1595ba6db7687a11f8ad24e07454f8cc0f1d10229ab.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observations_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">26</span><span class="p">)</span>

<span class="k">for</span> <span class="n">system</span><span class="p">,</span><span class="n">centre</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">system</span><span class="o">+</span><span class="n">centre</span>
    <span class="n">model_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">[</span><span class="n">model</span><span class="p">]</span>
    <span class="n">region_mask</span> <span class="o">=</span> <span class="n">example_region</span>
    <span class="n">total_observations</span> <span class="o">=</span> <span class="p">[[],[]]</span>
    <span class="n">observed_values</span> <span class="o">=</span> <span class="p">[[]</span> <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">observations_x</span><span class="p">]</span>
    <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>
    <span class="n">non_observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">observations_x</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">year_span</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">reanalysis_month</span><span class="p">:</span>
            <span class="c1"># upper should be replaced by a flag for upper/lower</span>
            <span class="n">limit_forecast</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="n">tercile</span><span class="p">]</span>
            <span class="n">limit_reanalysis</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="n">tercile</span><span class="p">]</span>
            <span class="c1"># The NaNs are an artifact of the masking</span>
            <span class="n">nonnan</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">limit_forecast</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

            <span class="n">values</span> <span class="o">=</span> <span class="n">model_dict</span><span class="p">[</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="s2">&quot;dataset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">forecast_reference_time</span><span class="o">=</span><span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="n">re_values</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">][</span><span class="n">region_mask</span><span class="p">][</span><span class="n">month</span><span class="p">][</span><span class="s2">&quot;dataset&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">forecast_reference_time</span> <span class="o">=</span> <span class="n">year</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
            <span class="c1"># If upper/lower is chosen dynamically, this must also be updated to be compared dynamically, maybe </span>
            <span class="n">forecasted_frequency</span> <span class="o">=</span> <span class="p">((</span><span class="n">operator</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">limit_forecast</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">nonnan</span><span class="p">]</span>
            <span class="n">observed</span> <span class="o">=</span> <span class="p">((</span><span class="n">operator</span><span class="p">(</span><span class="n">re_values</span><span class="p">,</span> <span class="n">limit_reanalysis</span><span class="p">)))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()[</span><span class="n">nonnan</span><span class="p">]</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="n">find_correct_bin</span><span class="p">(</span><span class="n">observations_x</span><span class="p">,</span> <span class="n">forecasted_frequency</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">forecasted_value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">forecasted_frequency</span><span class="p">):</span>
                <span class="n">observed_values</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecasted_value</span><span class="p">)</span>
            <span class="n">observations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="n">observed</span>
            <span class="n">non_observations</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">observed</span> 
            <span class="n">total_observations</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">forecasted_frequency</span><span class="p">)</span>
            <span class="n">total_observations</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">observed</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
            
    <span class="n">new_observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">total_observations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">total_observations</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span><span class="o">.</span><span class="n">T</span>
    
    <span class="n">coeff_true</span> <span class="o">=</span> <span class="n">plot_reliability</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">observations</span><span class="p">,</span> <span class="n">non_observations</span><span class="p">,</span> <span class="n">observed_values</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">region_mask</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">coeff_true</span><span class="p">),</span> <span class="p">[</span><span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.875</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/37f040cfb4707c4d31169e04af06ff2da1608708848c82e3407155bfaeb14fef.png" src="../_images/37f040cfb4707c4d31169e04af06ff2da1608708848c82e3407155bfaeb14fef.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regionmask</span><span class="o">.</span><span class="n">defined_regions</span><span class="o">.</span><span class="n">srex</span><span class="p">[</span><span class="n">region_masks</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/1a3a7d62f3ad1ca877bb0cfb25a005a5640a68ebe1db705557daa04ef5acafd7.png" src="../_images/1a3a7d62f3ad1ca877bb0cfb25a005a5640a68ebe1db705557daa04ef5acafd7.png" />
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;| JJA - 2 metre air temperature | Score |&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;|----|----|&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="s2">&quot;ecmwf51&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;| &quot;</span><span class="o">+</span><span class="n">regionmask</span><span class="o">.</span><span class="n">defined_regions</span><span class="o">.</span><span class="n">srex</span><span class="p">[</span><span class="n">region</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span><span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s2">) | &quot;</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">value</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">) |&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>| JJA - 2 metre air temperature | Score |
|----|----|
| Alaska/N.W. Canada (1) | still very useful for decision-making (4) |
| Canada/Greenl./Icel. (2) | perfect (5) |
| W. North America (3) | still very useful for decision-making (4) |
| C. North America (4) | still very useful for decision-making (4) |
| E. North America (5) | perfect (5) |
| Central America/Mexico (6) | still very useful for decision-making (4) |
| Amazon (7) | still very useful for decision-making (4) |
| N.E. Brazil (8) | perfect (5) |
| Coast South America (9) | perfect (5) |
| S.E. South America (10) | perfect (5) |
| N. Europe (11) | perfect (5) |
| C. Europe (12) | still very useful for decision-making (4) |
| S. Europe/Mediterranean (13) | perfect (5) |
| Sahara (14) | not useful (2) |
| W. Africa (15) | still very useful for decision-making (4) |
| E. Africa (16) | marginally useful (3) |
| S. Africa (17) | still very useful for decision-making (4) |
| N. Asia (18) | still very useful for decision-making (4) |
| W. Asia (19) | still very useful for decision-making (4) |
| C. Asia (20) | still very useful for decision-making (4) |
| Tibetan Plateau (21) | still very useful for decision-making (4) |
| E. Asia (22) | perfect (5) |
| S. Asia (23) | perfect (5) |
| S.E. Asia (24) | perfect (5) |
| N. Australia (25) | not useful (2) |
| S. Australia/New Zealand (26) | still very useful for decision-making (4) |
</pre></div>
</div>
</div>
</div>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>JJA - 2 metre air temperature</p></th>
<th class="head"><p>Score</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Alaska/N.W. Canada (1)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>Canada/Greenl./Icel. (2)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-even"><td><p>W. North America (3)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>C. North America (4)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-even"><td><p>E. North America (5)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-odd"><td><p>Central America/Mexico (6)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-even"><td><p>Amazon (7)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>N.E. Brazil (8)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-even"><td><p>Coast South America (9)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-odd"><td><p>S.E. South America (10)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-even"><td><p>N. Europe (11)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-odd"><td><p>C. Europe (12)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-even"><td><p>S. Europe/Mediterranean (13)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-odd"><td><p>Sahara (14)</p></td>
<td><p>not useful (2)</p></td>
</tr>
<tr class="row-even"><td><p>W. Africa (15)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>E. Africa (16)</p></td>
<td><p>marginally useful (3)</p></td>
</tr>
<tr class="row-even"><td><p>S. Africa (17)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>N. Asia (18)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-even"><td><p>W. Asia (19)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>C. Asia (20)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-even"><td><p>Tibetan Plateau (21)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
<tr class="row-odd"><td><p>E. Asia (22)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-even"><td><p>S. Asia (23)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-odd"><td><p>S.E. Asia (24)</p></td>
<td><p>perfect (5)</p></td>
</tr>
<tr class="row-even"><td><p>N. Australia (25)</p></td>
<td><p>not useful (2)</p></td>
</tr>
<tr class="row-odd"><td><p>S. Australia/New Zealand (26)</p></td>
<td><p>still very useful for decision-making (4)</p></td>
</tr>
</tbody>
</table>
</div>
<section id="how-to-read-the-results">
<h4>How to read the results<a class="headerlink" href="#how-to-read-the-results" title="Link to this heading">#</a></h4>
<p>The reliability diagram shows the frequency with which an event occurs for a given forecasted probability. In the case of a perfectly reliable forecast, the forecasted probability and the observed frequency of occurrence should be equal, and the plotted reliability line (red dashed line connecting the red circles) should align with the diagonal line (dashed blue). The horizontal and vertical solid blue lines represent the climatology of the dataset (1/3 for terciles). When the red reliability line falls within the blue shaded area, the forecast demonstrates skill compared to the climatology (indicated by a positive Brier Skill Score). Additional information about the sharpness of the forecast can be inferred from the sizes of the red circles. Larger circles indicate that a certain probability is frequently forecasted. If the forecasts are consistently different from the climatological value, they are considered sharp. A forecast that is both different from the climatological value and reliable has the potential to be very useful.
The results for our specific case (Figure 1) show a strong correspondence between the forecasted probability (averaged into 5 bins on the x-axis) and the conditional observed frequency (on the y-axis). This plot is based on a total of 72 pairs of forecasts and observations, derived from 24 years of hindcasts, with forecasts for June initiated in May, for July initiated in June, and for August initiated in July. Due to the limited data sample, only a few bins can be constructed. To quantify the reliability, we use the slope of the estimated reliability line (red solid line), weighting the bins by the number of forecasts in each bin, following <a class="reference external" href="https://doi.org/10.1098/rsif.2013.1162">Weisheimer and Palmer (2014) [2]</a> Additionally, the uncertainty in the estimated slope is calculated using bootstrapping, represented by the red shaded area. As shown in the plot, the forecasts for this region, season, and lead time are perfectly reliable, meaning that when the forecast predicts a probability of x%, the event will occur approximately x% of the time, averaged over a large sample.</p>
<p>It should be noted that the reliability calculations are sensitive to sample size as e.g. discussed by <a class="reference external" href="https://doi.org/10.1029/2021GL094662">Manzanas et al. (2022) [3]</a>. The small data sample may therefore not yield very robust results. One alternative is to calculate the reliability diagram in a similar way, but instead of using the region average, include the forecasts and probabilities for each grid cell within the region, as done on the <a class="reference external" href="https://charts.ecmwf.int/products/seasonal_system5_verification_reliability_2mtm?area=EURO&amp;amp;base_time=201712010000&amp;amp;stats=BRVT67&amp;amp;valid_time=201801010000">ECMWF web pages</a>. This approach increases the data sample size and produces more robust results. However, the trade-off is that we are no longer verifying the forecasts based on region averages. For comparison, we also show an example of this approach (Figure 2). With a larger data sample, more bins can be included, providing more detailed information. In this case, the slope of the reliability line is below one, but still falls within the blue shaded area, indicating positive skill compared to climatology.
Finally, using the first approach (Figure 1), the slope of the reliability line and its associated uncertainty are calculated for several regions. The forecasts are then categorized into ‘perfect,’ ‘still very useful for decision-making,’ ‘marginally useful,’ ‘not useful,’ and ‘dangerously useless,’ similar to the method outlined by <a class="reference external" href="https://doi.org/10.1098/rsif.2013.1162">Weisheimer and Palmer (2014) [2]</a>. The results are summarized in the table. This provides an estimate of the reliability of forecasts for different regions around the world during the summer period with a 1-month lead time. For many regions, the forecasts show a perfect reliability score or are still very useful. However, it should be noted that reliability is just one of many factors used to evaluate the quality of a probabilistic forecast. For example, a forecast that always predicts climatology is reliable but would offer no added value to the user. On the other hand, a forecast that is reliable but different from the climatology can potentially be very useful. Therefore, reliability should be considered alongside other verification metrics, e.g. related to sharpness.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>ℹ️ If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Seasonal forecast monthly statistics on single levels: <a class="reference external" href="https://doi.org/10.24381/cds.68dd14c3">10.24381/cds.68dd14c3</a></p></li>
<li><p>ERA5 monthly averaged data on single levels from 1940 to present:  <a class="reference external" href="https://doi.org/10.24381/cds.f17050d7">10.24381/cds.f17050d7</a></p></li>
<li><p>UK Met Office on reliability: <a class="reference external" href="https://www.metoffice.gov.uk/research/climate/seasonal-to-decadal/gpc-outlooks/user-guide/interpret-reliability">https://www.metoffice.gov.uk/research/climate/seasonal-to-decadal/gpc-outlooks/user-guide/interpret-reliability</a></p></li>
</ul>
</section>
<section id="code-libraries-used">
<h3>Code libraries used<a class="headerlink" href="#code-libraries-used" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>regionmask</p></li>
<li><p>xarray</p></li>
<li><p>numpy</p></li>
<li><p>pyplot from matplotlib</p></li>
<li><p>linear_model from sklearn</p></li>
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>, prepared by <a class="reference external" href="https://www.bopen.eu/">BOpen</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.1175/1520-0434(1993)008%3C0281:WIAGFA%3E2.0.CO;2">[1]</a> - Murphy, Allan H. “What Is a Good Forecast? An Essay on the Nature of Goodness in Weather Forecasting”, Weather and Forecasting 8, 2 (1993): 281-293, doi:
<a class="reference external" href="https://doi.org/10.1175/1520-0434(1993)008">https://doi.org/10.1175/1520-0434(1993)008</a>&lt;0281:WIAGFA&gt;<a class="reference external" href="http://2.0.CO">2.0.CO</a>;2</p>
<p><a class="reference external" href="https://doi.org/10.1098/rsif.2013.1162">[2]</a> - Weisheimer A. and Palmer T. N.. 2014 On the reliability of seasonal climate forecasts <em>J. R. Soc.</em> Interface. <strong>11:</strong> 20131162.
<a class="reference external" href="http://doi.org/10.1098/rsif.2013.1162">http://doi.org/10.1098/rsif.2013.1162</a></p>
<p><a class="reference external" href="https://doi.org/10.1029/2021GL094662">[3]</a> - Manzanas, R., Torralba, V., Lledó, L., &amp; Bretonnière, P. A. (2022). On the reliability of global seasonal forecasts: Sensitivity to ensemble size, hindcast length and region definition. Geophysical Research Letters, 49, e2021GL094662.
<a class="reference external" href="https://doi.org/10.1029/2021GL094662">https://doi.org/10.1029/2021GL094662</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Seasonal_Forecasts"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="seasonal.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">4. </span>Seasonal forecasts</p>
      </div>
    </a>
    <a class="right-next"
       href="../Climate_Projections/climate.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Climate projections</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-initial-assessment-of-the-reliability-of-forecast-probabilities-by-a-climate-services-provider">🌍 Use case: Initial assessment of the reliability of forecast probabilities by a climate services provider</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">❓ Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-data-to-use-and-setup-code">1.Choose the data to use and setup code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-data-retrieval-and-area-averages">2. ERA5 data retrieval and area averages</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonal-hindcast-data-retrieval-and-area-average">3. Seasonal hindcast data retrieval and area average</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">4. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#how-to-read-the-results">How to read the results</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-libraries-used">Code libraries used</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>