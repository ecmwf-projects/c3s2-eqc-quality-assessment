
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.1.1. Satellite Earth‚Äôs outgoing longwave and shortwave radiation budget intercomparison for climate monitoring &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Atmosphere_Physics/satellite_satellite-earth-radiation-budget_climate-monitoring_q01';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.2. Atmospheric Composition" href="../Atmospheric_Composition/Atmospheric_Composition.html" />
    <link rel="prev" title="1.1. Atmosphere Physics" href="Atmosphere_Physics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.1.1. Satellite Earth‚Äôs outgoing longwave and shortwave radiation budget intercomparison for climate monitoring</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Atmosphere_Physics/satellite_satellite-earth-radiation-budget_climate-monitoring_q01.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Atmosphere_Physics/satellite_satellite-earth-radiation-budget_climate-monitoring_q01.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Satellite Earth‚Äôs outgoing longwave and shortwave radiation budget intercomparison for climate monitoring</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-consistency-assessment-of-earth-radiation-budget-products">üåç Use case: Consistency assessment of Earth Radiation Budget products</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-data-to-use-and-setup-code">1. Choose the data to use and setup code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">2. Download and transform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-weighted-means-and-anomaly-scatter-plots">3. Spatial weighted means and anomaly scatter plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-time-weighted-means">4. Plot time weighted means</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-spatial-weighted-zonal-means">5. Plot spatial weighted zonal means</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-applications">Discussion and applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="satellite-earth-s-outgoing-longwave-and-shortwave-radiation-budget-intercomparison-for-climate-monitoring">
<h1><span class="section-number">1.1.1. </span>Satellite Earth‚Äôs outgoing longwave and shortwave radiation budget intercomparison for climate monitoring<a class="headerlink" href="#satellite-earth-s-outgoing-longwave-and-shortwave-radiation-budget-intercomparison-for-climate-monitoring" title="Link to this heading">#</a></h1>
<p>Production date: 11-06-2025</p>
<p>Last Review: 20-02-2026</p>
<p>Produced by: CNR-ISMAR, Andrea Storto, Vincenzo de Toma, Claudia Allegrini and Gian Luigi Liberti</p>
<section id="use-case-consistency-assessment-of-earth-radiation-budget-products">
<h2>üåç Use case: Consistency assessment of Earth Radiation Budget products<a class="headerlink" href="#use-case-consistency-assessment-of-earth-radiation-budget-products" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question-s">
<h2>‚ùì Quality assessment question(s)<a class="headerlink" href="#quality-assessment-question-s" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How consistent are the Earth Radiation Budget products provided by C3S?</strong></p></li>
</ul>
<p>The Earth Radiation Budget (ERB) Outgoing Longwave Radiation (OLR) and Outgoing Shortwave Radiation (OSR) products provide estimates of the radiative flux components leaving the Earth system at the top of the atmosphere (TOA), and are fundamental for climate monitoring and model evaluation. These quantities are also central for estimating the Earth‚Äôs Energy Imbalance (EEI), evaluating climate feedbacks, and attributing climate variability and change.
Despite their common physical target, ERB products differ substantially in terms of satellite sensors, spectral coverage, angular-distribution models, calibration strategies, spatial resolution, temporal coverage, swath width, and gap-filling approaches. These differences directly affect data quality, particularly in regions characterised by strong angular anisotropy, complex cloud regimes, or persistent data gaps, such as the polar regions and areas with frequent deep convection.
Consequently, inter-comparison of ERB products requires careful consideration of their respective retrieval methodologies and sampling characteristics, as well as explicit attention to data quality aspects such as spatial completeness, temporal homogeneity, and sensitivity to surface and cloud conditions (<a class="reference external" href="https://doi.org/10.1175/2008JCLI2637.1" rel="noreferrer" target="_blank">[1]</a>, <a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">[2]</a>, <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1038/ngeo1375" rel="noreferrer" target="_blank">[4]</a>).</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>Important differences among products arise from well-documented characteristics of the underlying instruments and retrieval algorithms, including spectral sampling, angular-distribution models, cloud detection, calibration stability, and, more generally, steps of the processing chain. These differences are most pronounced at high latitudes, over bright surfaces, and in persistently cloudy regions, where uncertainties in anisotropy corrections and cloud properties are largest (<a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">[2]</a>, <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1029/2012JD017997" rel="noreferrer" target="_blank">[5]</a>).</p></li>
<li><p>Products with limited temporal coverage or without gap-filling (e.g.ERS-2, ENVISAT, Sentinel) exhibit reduced suitability for applications requiring closed global energy budgets, such as direct estimation of Earth‚Äôs Energy Imbalance, unless additional assumptions or data fusion approaches are applied (<a class="reference external" href="https://doi.org/10.1038/ngeo1375" rel="noreferrer" target="_blank">[4]</a>, <a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">[6]</a>).</p></li>
<li><p>The combined use of multiple ERB products is therefore recommended only for advanced users and for carefully selected periods and applications, with explicit consideration of data quality limitations documented in the respective product validation reports.</p></li>
<li><p>Spatial patterns in some products, particularly those derived from narrow‚Äêswath instruments (e.g. ERS‚Äê2 ATSR‚Äê2/AATSR), exhibit sampling‚Äêrelated artefacts such as track‚Äêlike features in time‚Äêmean and bias maps. These features are the footprint of representativeness limitations associated with the swath width and the orbital sampling rather than systematic retrieval biases, and are reduced in wide‚Äêswath products such as AVHRR‚Äêbased CLARA‚ÄêA3, CERES, HIRS, or Sentinel (<a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">[2]</a>, <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>).</p></li>
</ul>
</div>
<p>As one of the main outcomes of this assessment, we provide the synthesis given by the construction of the globally averaged time series of monthly mean Net Top of the Atmosphere Radiation (see description in the Methodology section for its calculation). There are two main features: the sharp peak in ERS-2 data at the beginning of the time series, and another peak in 2020. The first one can be explained by the switch of the Near Infra Red channel onboard of NOAA satellites (from 3.7 to 1.6 micrometres), while the second feature is due to a known bias of Sentinel products in both components (about 6 W m<sup>-2</sup> for the OLR, and about 4 W m<sup>-2</sup> for the OSR).</p>
<figure class="align-default" id="id1">
<img alt="../../_images/b0c7fd31-c954-4277-b9db-4b9cfeb173ac.png" src="../../_images/b0c7fd31-c954-4277-b9db-4b9cfeb173ac.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.1.1.1 </span><span class="caption-text">Monthly mean time series Net Top Of the Atmosphere Radiation (NTOAR) globally averaged. The ensemble mean is reported in black, with grey shading indicating the ensemble standard deviation, and a different colour represents each product (see methodology below).</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>In this notebook, we inter-compare the following Earth Radiation Budget Products, available through the Climate Data Store (CDS) by C3S:</p>
<ol class="arabic simple">
<li><p>NASA CERES EBAF (<strong>CERES</strong>): The Cloud and Earth‚Äôs Radiant Energy System (CERES) Energy Balanced And Filled (EBAF) provides a state-of-the-art Climate Data Record (CDR) of monthly mean top-of-atmosphere radiative fluxes, with global (1 degree spatial resolution) coverage. Here we consider only complete years, so the time coverage spans from January 2001 to December 2023.</p></li>
<li><p>NOAA/NCEI HIRS OLR (<strong>HIRS</strong>): produced by the NOAA/NCEI from the High Resolution Infrared Radiation Sounder instruments on board the NOAA and MetOp satellites, and new generation infrared hyperspectral sounder radiance data, including from the Infrared Atmospheric Sounding Interferometer (IASI) since 2007 and the Cross-track Infrared Sounder (CrIS) since 2012. Here, we assess monthly means of the Outgoing Longwave Radiation (OLR) with global (2.5 degrees spatial resolution) coverage, spanning from January 1979 to December 2023.</p></li>
<li><p>EUMETSAT CLARA-A3 (<strong>CLARA-A3</strong>): The ‚ÄúCLARA product family‚Äù refers to European Organisation for the Exploitation of Meteorological Satellites CM SAF CLARA-A3 data record (CM SAF cLoud, Albedo and surface RAdiation dataset from AVHRR data - Edition 3). It merges the AVHRR-sensor data from a variety of satellites into a combined TCDR. Here, we assess the monthly means of TOA Reflected Solar Flux and TOA Outgoing Longwave Radiation, with global (0.25 degree spatial resolution) coverage, spanning from January 1979 to December 2020.</p></li>
<li><p>ESA/C3S CCI (<strong>ESA ERS2, ESA ENVISAT, SENTINEL 3A, SENTINEL 3B, SENTINEL 3A_3B</strong>): The CCI product family refers to the European Space Agency Cloud_cci Earth radiation data record, with global (0.5 degree spatial resolution) coverage. This record comprises observations from the Along Track Scanning Radiometer (ATSR) series of instruments, flown onboard ESA Earth Observation satellites, ERS-2 (spanning complete years from January 1997 to December 2002), and Envisat (spanning from January 2003 to December 2011). The Copernicus Climate Change Service (C3S) part covers the Interim Climate Data Record (ICDR) extension of the ESA Cloud_cci dataset. It is based on observations from the Sea and Land Surface Temperature Radiometer (SLSTR), flown on board the ESA Sentinel 3A (spanning from January 2017 to December 2021) and 3B satellites (spanning from January 2019 to December 2012). In addition to data from each individual satellite, a merged product from both satellites is also provided from the launch of Sentinel-3B (a complete-year period spanning from January 2019 to December 2021).</p></li>
</ol>
<p>CERES is the only product which gives also the incoming shortwave radiation: thus, to evaluate the Net Top Of the Atmosphere Radiation (which we consider here to be close to the Earth‚Äôs Energy Imbalance due to missing data), the ensemble mean budget was built using outgoing longwave and outgoing shortwave from each product, and the incoming shortwave from CERES, and then averaging across the product dimension.</p>
<p>The analysis and results are organised in the following steps, which are detailed in the sections below:</p>
<p><strong><a class="reference internal" href="#satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-1"><span class="std std-ref">1. Choose the data to use and setup code</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-2"><span class="std std-ref">2. Download and transform</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-3"><span class="std std-ref">3. Spatial weighted means and anomaly scatter plots</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-4"><span class="std std-ref">4. Plot time weighted means</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-5"><span class="std std-ref">5. Plot spatial weighted zonal means</span></a></strong></p>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="choose-the-data-to-use-and-setup-code">
<span id="satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-1"></span><h3>1. Choose the data to use and setup code<a class="headerlink" href="#choose-the-data-to-use-and-setup-code" title="Link to this heading">#</a></h3>
<p>In this section, we import the required packages and define the dataset names for use in the following sections. Processing functions are also defined. We select only complete years for each dataset to ensure a fair comparison across products. Ancillary functions and corresponding keyword arguments to preprocess inhomogeneities along the time dimension are also defined here. We also define a set of regions to investigate time-series of spatially averaged anomalies and climatologies: the global domain (0,360 for longitude, -90,90 for latitude), the northern high-latitudes (60,90 for latitude, 0,360 for longitude), the northern mid-latitudes (30,60 for latitude, 0,360 for longitude), the tropics (-30,30 for latitude, 0,360 for longitude) and southern analogues.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CDSAPI_RC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/detoma_vincenzo/.cdsapirc&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">crs</span> <span class="k">as</span> <span class="n">ccrs</span><span class="p">,</span> <span class="n">feature</span> <span class="k">as</span> <span class="n">cfeature</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.mpl.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cticker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">diagnostics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Variable to analyse</span>
<span class="n">variables</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">,</span> <span class="s2">&quot;outgoing_shortwave&quot;</span><span class="p">,</span> <span class="s2">&quot;incoming_shortwave&quot;</span><span class="p">]</span>
<span class="n">request_dicts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>

    <span class="c1"># Region for timeseries</span>
    <span class="n">region_slices</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;global&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
        <span class="s2">&quot;northern high-latitudes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
        <span class="s2">&quot;northern mid-latitudes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
        <span class="s2">&quot;tropics&quot;</span> <span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
        <span class="s2">&quot;southern mid-latitudes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
        <span class="s2">&quot;southern high-latitudes&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">)},</span>
    <span class="p">}</span>

    <span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-earth-radiation-budget&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">varnames</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;olr&quot;</span><span class="p">,</span> <span class="s2">&quot;toa_lw_all_mon&quot;</span><span class="p">}</span> <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;outgoing_longwave&quot;</span> <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;rsf&quot;</span><span class="p">,</span> <span class="s2">&quot;toa_sw_all_mon&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-earth-radiation-budget&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
    <span class="n">varnames</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">{</span><span class="s2">&quot;olr&quot;</span><span class="p">,</span> <span class="s2">&quot;toa_lw_all_mon&quot;</span><span class="p">,</span> <span class="s2">&quot;LW_flux&quot;</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;outgoing_longwave&quot;</span>
        <span class="k">else</span> <span class="p">{</span><span class="s2">&quot;rsf&quot;</span><span class="p">,</span> <span class="s2">&quot;toa_sw_all_mon&quot;</span><span class="p">,</span> <span class="s2">&quot;SW_flux&quot;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">request_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;CERES&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2001-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;ceres_ebaf&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;nasa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">_radiation&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Sentinel 3A&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2017-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;c3s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;slstr_on_sentinel_3a&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;interim_climate_data_record&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Sentinel 3B&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;c3s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;slstr_on_sentinel_3b&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;interim_climate_data_record&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;Sentinel 3A_3B&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2019-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2021-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;c3s&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;slstr_on_sentinel_3a_3b&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;interim_climate_data_record&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ESA ENVISAT&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;2003-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2011-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;esa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;aatsr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;ESA ERS2&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;1997-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2002-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;esa&quot;</span><span class="p">,</span>
            <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;atsr2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;cci&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all_variables&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;CLARA_A3&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;1979-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;clara_a3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;eumetsat&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">_radiation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s2">&quot;HIRS&quot;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;1979-01&quot;</span><span class="p">,</span>
            <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2023-12&quot;</span><span class="p">,</span>
            <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
            <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;noaa_ncei&quot;</span><span class="p">,</span>
            <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;hirs&quot;</span><span class="p">,</span>
            <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
            <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
            <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2_7_reprocessed&quot;</span><span class="p">,</span>
            <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">_radiation&quot;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">request_dicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request_dict</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">preprocess_time</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">and</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
        <span class="c1"># Could not decode</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time_coverage_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="n">time</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="n">xarray_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;drop_variables&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;time_bounds&quot;</span><span class="p">,</span> <span class="s2">&quot;record_status&quot;</span><span class="p">],</span>
    <span class="s2">&quot;preprocess&quot;</span><span class="p">:</span> <span class="n">preprocess_time</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In the following cell, we redefine the spatial weighted mean to account for the possibility of masking data and allow changing the default behaviour for treating NaNs.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-define spatial_weighted_mean to apply common masks on the target grid</span>
<span class="k">def</span><span class="w"> </span><span class="nf">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regrid</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regrid</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask</span><span class="p">)),</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-and-transform">
<span id="satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-2"></span><h3>2. Download and transform<a class="headerlink" href="#download-and-transform" title="Link to this heading">#</a></h3>
<p>The code below will download the products. Notice the definition of common periods for the different products, and their inclusion in the mean map dictionary. A custom function to build the mean map over a specified period is also defined here. When the variable to download is the shortwave component, we skip the HIRS dataset because only the longwave is available in it. Moreover, incoming shortwave radiation is only available for CERES data.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="o">=</span><span class="kc">True</span>
<span class="n">skipna</span><span class="o">=</span><span class="kc">True</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">start_var</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">stop_var</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">DS</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">variable</span><span class="p">,</span> <span class="n">request_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">request_dicts</span><span class="p">):</span>
    <span class="n">Ds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">start_prod</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">stop_prod</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;HIRS&quot;</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">!=</span> <span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;CERES&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">==</span><span class="s2">&quot;incoming_shortwave&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
    
        <span class="n">start</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
        <span class="n">start_prod</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">start</span>
        <span class="n">stop_prod</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop</span>
        
        <span class="n">requests</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">update_request_date</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">stringify_dates</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    
        <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
            <span class="n">collection_id</span><span class="p">,</span>
            <span class="n">requests</span><span class="p">,</span>
            <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">xarray_kwargs</span><span class="p">,</span>
            <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Ds</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>
    <span class="n">start_var</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">start_prod</span>
    <span class="n">stop_var</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop_prod</span>
    <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span>

<span class="n">clara_a3_start</span><span class="p">,</span> <span class="n">clara_a3_end</span> <span class="o">=</span><span class="s2">&quot;1980-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-12&quot;</span>
<span class="n">ceres_start</span><span class="p">,</span> <span class="n">ceres_end</span> <span class="o">=</span> <span class="s2">&quot;2001-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2023-12&quot;</span>
<span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span> <span class="o">=</span> <span class="s2">&quot;2003-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2011-12&quot;</span> 
<span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span> <span class="o">=</span> <span class="s2">&quot;2019-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2021-12&quot;</span>
<span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span> <span class="o">=</span> <span class="s2">&quot;1997-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2002-12&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">mean_map_period</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
    <span class="n">time_coord</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">time_coord</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">attrs</span><span class="p">)})</span>
    <span class="n">ds_map</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_map</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In the following cell, we define functions to ease the handling of different variable names and to homogenise the longitude dimension. Then, we build mean maps across overlapping periods, without masking them for now, since we‚Äôll use them to create common masks for each period.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">variable</span><span class="o">==</span><span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">:</span>
        <span class="n">varnames</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;olr&quot;</span><span class="p">,</span> <span class="s2">&quot;toa_lw_all_mon&quot;</span><span class="p">,</span> <span class="s2">&quot;LW_flux&quot;</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="k">elif</span> <span class="n">variable</span><span class="o">==</span><span class="s2">&quot;outgoing_shortwave&quot;</span><span class="p">:</span>
        <span class="n">varnames</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;rsf&quot;</span><span class="p">,</span> <span class="s2">&quot;toa_sw_all_mon&quot;</span><span class="p">,</span> <span class="s2">&quot;SW_flux&quot;</span><span class="p">}</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">varnames</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;solar_mon&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        
    <span class="p">(</span><span class="n">varname</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">varnames</span>
    <span class="k">return</span> <span class="n">varname</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fix_lon_0_360</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">lon_name</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert longitude coordinates from [-180, 180] to [0, 360).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    da : xr.DataArray or xr.Dataset</span>
<span class="sd">        Input object with a longitude coordinate.</span>
<span class="sd">    lon_name : str</span>
<span class="sd">        Name of the longitude coordinate.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    xr.DataArray or xr.Dataset</span>
<span class="sd">        Object with longitudes in [0, 360).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">da</span><span class="p">[</span><span class="n">lon_name</span><span class="p">]</span>

    <span class="c1"># Check if longitudes look like [-180, 180]</span>
    <span class="k">if</span> <span class="n">lon</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
            <span class="p">{</span><span class="n">lon_name</span><span class="p">:</span> <span class="p">(</span><span class="n">lon</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)}</span>
        <span class="p">)</span><span class="o">.</span><span class="n">sortby</span><span class="p">(</span><span class="n">lon_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">da</span>

<span class="n">ds_maps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p3</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p4</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_maps_p5</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">variable</span><span class="p">,</span> <span class="n">request_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">request_dicts</span><span class="p">):</span>
    <span class="n">da_maps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_maps_p1</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_maps_p2</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_maps_p3</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_maps_p4</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_maps_p5</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;HIRS&quot;</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">!=</span> <span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;CERES&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product</span> <span class="ow">and</span> <span class="n">variable</span><span class="o">==</span><span class="s2">&quot;incoming_shortwave&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
    
        <span class="n">start</span> <span class="o">=</span> <span class="n">start_var</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">stop_var</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
        
        <span class="n">varname</span><span class="o">=</span><span class="n">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
        
        <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s2">&quot;CERES&quot;</span><span class="p">:</span>
            <span class="n">regrid</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">da_obj</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regrid</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">fix_lon_0_360</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
        <span class="n">da_maps</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">curr_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
        <span class="n">ceres_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">ceres_start</span><span class="p">,</span> <span class="n">ceres_end</span><span class="p">)</span>
        <span class="n">clara_a3_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">clara_a3_start</span><span class="p">,</span> <span class="n">clara_a3_end</span><span class="p">)</span>
        <span class="n">esa_envisat_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">)</span>
        <span class="n">sentinel_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">)</span>
        <span class="n">esa_ers2_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">clara_a3_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">and</span> <span class="n">clara_a3_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
            <span class="n">da_maps_p1</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">clara_a3_start</span><span class="p">,</span> <span class="n">clara_a3_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span>
            <span class="n">da_maps_p1</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da_maps_p1</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ceres_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">and</span> <span class="n">ceres_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
            <span class="n">da_maps_p2</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ceres_start</span><span class="p">,</span> <span class="n">ceres_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span>
            <span class="n">da_maps_p2</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da_maps_p2</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">esa_envisat_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">and</span> <span class="n">esa_envisat_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
            <span class="n">da_maps_p3</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span> 
            <span class="n">da_maps_p3</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da_maps_p3</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sentinel_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">and</span> <span class="n">sentinel_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
            <span class="n">da_maps_p4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span> 
            <span class="n">da_maps_p4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da_maps_p4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">esa_ers2_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">and</span> <span class="n">esa_ers2_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
            <span class="n">da_maps_p5</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">mean_map_period</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">,</span> <span class="n">W</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="n">skipna</span><span class="p">)</span> 
            <span class="n">da_maps_p5</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da_maps_p5</span><span class="p">[</span><span class="n">product</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">),</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>

    <span class="n">ds_maps_p1</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps_p1</span>
    <span class="n">ds_maps_p2</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps_p2</span>
    <span class="n">ds_maps_p3</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps_p3</span>
    <span class="n">ds_maps_p4</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps_p4</span>
    <span class="n">ds_maps_p5</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps_p5</span>
    <span class="n">ds_maps</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Here, we gather periods together and define functions to build a common mask for each period, then put them together.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Build common masks for each overlapping period before further calculations</span>
<span class="n">ds_periods_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds_maps_p1</span><span class="p">,</span> <span class="n">ds_maps_p2</span><span class="p">,</span> <span class="n">ds_maps_p3</span><span class="p">,</span> <span class="n">ds_maps_p4</span><span class="p">,</span> <span class="n">ds_maps_p5</span><span class="p">]</span>
<span class="n">periods</span> <span class="o">=</span> <span class="p">[</span><span class="n">clara_a3_time</span><span class="p">,</span> <span class="n">ceres_time</span><span class="p">,</span> <span class="n">esa_envisat_time</span><span class="p">,</span> <span class="n">sentinel_time</span><span class="p">,</span> <span class="n">esa_ers2_time</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_common_mask</span><span class="p">(</span><span class="n">ds_maps_var</span><span class="p">):</span>
    <span class="n">products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_maps_var</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ds_maps_var</span><span class="p">[</span><span class="n">p</span><span class="p">]),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span><span class="p">],</span>
        <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;product&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">mask</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="s2">&quot;product&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">masks_periods</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">ds_maps</span> <span class="ow">in</span> <span class="n">ds_periods_list</span><span class="p">:</span>
    <span class="n">mask_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">,</span> <span class="s2">&quot;outgoing_shortwave&quot;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_maps</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">mask_var</span> <span class="o">=</span> <span class="n">build_common_mask</span><span class="p">(</span><span class="n">ds_maps</span><span class="p">[</span><span class="n">variable</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">mask_var</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mask_dict</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask_var</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">masks_periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">continue</span>
    <span class="n">mask_period</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">mask_dict</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">mask_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span>
        <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">mask_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())})</span>
    <span class="n">masks_periods</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mask_period</span><span class="p">)</span>

<span class="n">period_masks</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span> <span class="n">masks_periods</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;CERES&quot;</span><span class="p">:</span> <span class="n">masks_periods</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">:</span> <span class="n">masks_periods</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
    <span class="s2">&quot;Sentinel-3&quot;</span><span class="p">:</span> <span class="n">masks_periods</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">:</span> <span class="n">masks_periods</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
<span class="p">}</span>
<span class="n">listmasks</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds_maps</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds_maps</span><span class="o">.</span><span class="n">keys</span><span class="p">()]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Here, we build the time series over specified common periods, with appropriate masking.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_timeseries</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_timeseries_p1</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_timeseries_p2</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_timeseries_p3</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_timeseries_p4</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ds_timeseries_p5</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_period_mask</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
    <span class="n">mask_period</span> <span class="o">=</span> <span class="n">period_masks</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask_period</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="s2">&quot;variable&quot;</span> <span class="ow">in</span> <span class="n">mask_period</span><span class="o">.</span><span class="n">dims</span> <span class="ow">and</span> <span class="n">variable</span> <span class="ow">in</span> <span class="n">mask_period</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mask_period</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">variable</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_regional_timeseries</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">):</span>
    <span class="n">dataarrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">slices</span> <span class="ow">in</span> <span class="n">region_slices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dall</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
        <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">&#39;regrid&#39;</span><span class="p">:</span> <span class="n">regrid</span><span class="p">,</span> <span class="s1">&#39;ds_obj&#39;</span><span class="p">:</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="s1">&#39;SKIP&#39;</span><span class="p">:</span> <span class="n">SKIP</span><span class="p">})</span>
        <span class="n">da_ts</span> <span class="o">=</span> <span class="n">spatial_weighted_mean</span><span class="p">(</span>
            <span class="n">da</span><span class="p">,</span>
            <span class="n">lon_slice</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lon_slice&#39;</span><span class="p">],</span>
            <span class="n">lat_slice</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lat_slice&#39;</span><span class="p">],</span>
            <span class="n">regrid</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;regrid&#39;</span><span class="p">],</span>
            <span class="n">ds_obj</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;ds_obj&#39;</span><span class="p">],</span>
            <span class="n">SKIP</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;SKIP&#39;</span><span class="p">],</span>
            <span class="n">mask</span><span class="o">=</span><span class="n">mask_common</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da_ts</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataarrays</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">build_period_timeseries</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">):</span>
    <span class="n">da_sel</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
    <span class="n">da_ts</span> <span class="o">=</span> <span class="n">build_regional_timeseries</span><span class="p">(</span><span class="n">da_sel</span><span class="p">,</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">)</span>
    <span class="n">da_ts</span> <span class="o">=</span> <span class="n">da_ts</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)})</span>
    <span class="k">return</span> <span class="n">da_ts</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_overlap_range</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">da</span><span class="o">.</span><span class="n">dims</span> <span class="ow">or</span> <span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">start_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
    <span class="n">end_ts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">tmax</span> <span class="o">&lt;</span> <span class="n">start_ts</span> <span class="ow">or</span> <span class="n">tmin</span> <span class="o">&gt;</span> <span class="n">end_ts</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">overlap_start</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tmin</span><span class="p">,</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>
    <span class="n">overlap_end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">tmax</span><span class="p">,</span> <span class="n">end_ts</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">overlap_start</span><span class="p">,</span> <span class="n">overlap_end</span>

<span class="c1"># Period-specific inclusion lists for annual-cycle plots</span>
<span class="n">period_products</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;CLARA_A3&quot;</span><span class="p">,</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">},</span>
    <span class="s2">&quot;CERES&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;CERES&quot;</span><span class="p">,</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">},</span>
    <span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ESA ENVISAT&quot;</span><span class="p">,</span> <span class="s2">&quot;CERES&quot;</span><span class="p">,</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">,</span> <span class="s2">&quot;CLARA_A3&quot;</span><span class="p">},</span>
    <span class="s2">&quot;Sentinel-3&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;CERES&quot;</span><span class="p">,</span> <span class="s2">&quot;Sentinel 3A&quot;</span><span class="p">,</span> <span class="s2">&quot;Sentinel 3B&quot;</span><span class="p">,</span> <span class="s2">&quot;Sentinel 3A_3B&quot;</span><span class="p">,</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">},</span>
    <span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ESA ERS2&quot;</span><span class="p">,</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">,</span> <span class="s2">&quot;CLARA_A3&quot;</span><span class="p">},</span>
<span class="p">}</span>

<span class="k">for</span> <span class="n">variable</span><span class="p">,</span> <span class="n">request_dict</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">variables</span><span class="p">,</span> <span class="n">request_dicts</span><span class="p">):</span>
    <span class="n">da_timeseries</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_timeseries_p1</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_timeseries_p2</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_timeseries_p3</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_timeseries_p4</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">da_timeseries_p5</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;HIRS&quot;</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">!=</span> <span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">if</span> <span class="s2">&quot;CERES&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;incoming_shortwave&quot;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

        <span class="n">start</span> <span class="o">=</span> <span class="n">start_var</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">stop_var</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>

        <span class="n">varname</span> <span class="o">=</span> <span class="n">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>

        <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;CERES&quot;</span><span class="p">:</span>
            <span class="n">regrid</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">da_obj</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regrid</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>

        <span class="n">mask_da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">da_full</span> <span class="o">=</span> <span class="n">build_regional_timeseries</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">mask_da</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">da_full</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>
        <span class="n">da_timeseries</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_full</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>

        <span class="n">overlap</span> <span class="o">=</span> <span class="n">get_overlap_range</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">clara_a3_start</span><span class="p">,</span> <span class="n">clara_a3_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">period_products</span><span class="p">[</span><span class="s2">&quot;CLARA-A3&quot;</span><span class="p">]:</span>
            <span class="n">mask_common</span> <span class="o">=</span> <span class="n">get_period_mask</span><span class="p">(</span><span class="s2">&quot;CLARA-A3&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">da_timeseries_p1</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_period_timeseries</span><span class="p">(</span>
                <span class="n">da</span><span class="p">,</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">get_overlap_range</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ceres_start</span><span class="p">,</span> <span class="n">ceres_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">period_products</span><span class="p">[</span><span class="s2">&quot;CERES&quot;</span><span class="p">]:</span>
            <span class="n">mask_common</span> <span class="o">=</span> <span class="n">get_period_mask</span><span class="p">(</span><span class="s2">&quot;CERES&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">da_timeseries_p2</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_period_timeseries</span><span class="p">(</span>
                <span class="n">da</span><span class="p">,</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">get_overlap_range</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">period_products</span><span class="p">[</span><span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">]:</span>
            <span class="n">mask_common</span> <span class="o">=</span> <span class="n">get_period_mask</span><span class="p">(</span><span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">da_timeseries_p3</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_period_timeseries</span><span class="p">(</span>
                <span class="n">da</span><span class="p">,</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">get_overlap_range</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">period_products</span><span class="p">[</span><span class="s2">&quot;Sentinel-3&quot;</span><span class="p">]:</span>
            <span class="n">mask_common</span> <span class="o">=</span> <span class="n">get_period_mask</span><span class="p">(</span><span class="s2">&quot;Sentinel-3&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">da_timeseries_p4</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_period_timeseries</span><span class="p">(</span>
                <span class="n">da</span><span class="p">,</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">overlap</span> <span class="o">=</span> <span class="n">get_overlap_range</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">overlap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">period_products</span><span class="p">[</span><span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">]:</span>
            <span class="n">mask_common</span> <span class="o">=</span> <span class="n">get_period_mask</span><span class="p">(</span><span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">da_timeseries_p5</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">build_period_timeseries</span><span class="p">(</span>
                <span class="n">da</span><span class="p">,</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">overlap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">ds_timeseries_p1</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries_p1</span>
    <span class="n">ds_timeseries_p2</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries_p2</span>
    <span class="n">ds_timeseries_p3</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries_p3</span>
    <span class="n">ds_timeseries_p4</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries_p4</span>
    <span class="n">ds_timeseries_p5</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries_p5</span>
    <span class="n">ds_timeseries</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Here, we define a function to ensure all datasets share the same time convention.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">fix_time</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">to_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_period</span><span class="p">(</span><span class="s2">&quot;M&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_timestamp</span><span class="p">()</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">t</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>

<span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">variables</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ds_timeseries</span><span class="p">,</span> <span class="n">ds_timeseries_p1</span><span class="p">,</span> <span class="n">ds_timeseries_p2</span><span class="p">,</span> <span class="n">ds_timeseries_p3</span><span class="p">,</span> <span class="n">ds_timeseries_p4</span><span class="p">,</span> <span class="n">ds_timeseries_p5</span><span class="p">]:</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="n">v</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">ds</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fix_time</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="n">v</span><span class="p">][</span><span class="n">k</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="spatial-weighted-means-and-anomaly-scatter-plots">
<span id="satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-3"></span><h3>3. Spatial weighted means and anomaly scatter plots<a class="headerlink" href="#spatial-weighted-means-and-anomaly-scatter-plots" title="Link to this heading">#</a></h3>
<p>Below, we calculate and plot spatially weighted means for the different earth radiation budget products, in terms of monthly climatologies, although the sampling period of each dataset is, in general, different from the others (i.e. CERES: 2001-2023, Sentinel 3A: 2017-2021, Sentinel 3B: 2019-2021, Sentinel 3A_3B: 2019-2021, ESA_Envisat: 2003-2011, CLARA_A3: 1979-2020, HIRS: 1979-2023). We therefore selected a set of periods of common overlaps in which to carry out this comparison. The same periods will be used for other diagnostics, such as the mean maps and the zonal mean monthly-climatological profiles.</p>
<p>The pronounced seasonality in OLR is mostly linked to the larger land area in the Northern Hemisphere, whereas that in OSR is mainly linked to the solar cycle.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">concat_ts</span><span class="p">(</span><span class="n">ts_dict</span><span class="p">,</span> <span class="n">allowed_products</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ts_dict</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">ts_dict</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ts_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="k">if</span> <span class="n">allowed_products</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">allowed_products</span> <span class="k">if</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">ts_dict</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">ts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span><span class="n">ts_dict</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">products</span><span class="p">],</span>
        <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">products</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">ts</span>

<span class="n">lw_products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">sw_products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">lw_ts</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">],</span> <span class="n">lw_products</span><span class="p">)</span>
<span class="n">sw_ts</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">],</span> <span class="n">sw_products</span><span class="p">)</span>

<span class="n">lw_ts_p1</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p1</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">])</span>
<span class="n">lw_ts_p2</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p2</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">])</span>
<span class="n">lw_ts_p3</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p3</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">])</span>
<span class="n">lw_ts_p4</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p4</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">])</span>
<span class="n">lw_ts_p5</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p5</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">])</span>

<span class="n">sw_ts_p1</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p1</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">])</span>
<span class="n">sw_ts_p2</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p2</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">])</span>
<span class="n">sw_ts_p3</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p3</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">])</span>
<span class="n">sw_ts_p4</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p4</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">])</span>
<span class="n">sw_ts_p5</span> <span class="o">=</span> <span class="n">concat_ts</span><span class="p">(</span><span class="n">ds_timeseries_p5</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">])</span>

<span class="n">periods_info</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;CLARA-A3&quot;</span><span class="p">,</span> <span class="n">clara_a3_start</span><span class="p">,</span> <span class="n">clara_a3_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;CERES&quot;</span><span class="p">,</span> <span class="n">ceres_start</span><span class="p">,</span> <span class="n">ceres_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">,</span> <span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Sentinel-3&quot;</span><span class="p">,</span> <span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">,</span> <span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">),</span>
 <span class="p">]</span>

<span class="n">lw_ts_periods</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span> <span class="n">lw_ts_p1</span><span class="p">,</span>
    <span class="s2">&quot;CERES&quot;</span><span class="p">:</span> <span class="n">lw_ts_p2</span><span class="p">,</span>
    <span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">:</span> <span class="n">lw_ts_p3</span><span class="p">,</span>
    <span class="s2">&quot;Sentinel-3&quot;</span><span class="p">:</span> <span class="n">lw_ts_p4</span><span class="p">,</span>
    <span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">:</span> <span class="n">lw_ts_p5</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">sw_ts_periods</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CLARA-A3&quot;</span><span class="p">:</span> <span class="n">sw_ts_p1</span><span class="p">,</span>
    <span class="s2">&quot;CERES&quot;</span><span class="p">:</span> <span class="n">sw_ts_p2</span><span class="p">,</span>
    <span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">:</span> <span class="n">sw_ts_p3</span><span class="p">,</span>
    <span class="s2">&quot;Sentinel-3&quot;</span><span class="p">:</span> <span class="n">sw_ts_p4</span><span class="p">,</span>
    <span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">:</span> <span class="n">sw_ts_p5</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Here, we define the function to plot the monthly climatology over the specified period.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_period_climatology</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">period_label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">title_prefix</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ts</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ts</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">climatology</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">climatology</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">t</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title_prefix</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">period_label</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">start</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">stop</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>And the plots follow, in different areas.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">periods_info</span><span class="p">:</span>
    <span class="n">plot_period_climatology</span><span class="p">(</span><span class="n">lw_ts_periods</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="s2">&quot;OLR annual cycle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/b0d366d87e7a5d5cef1c5075a8dfa73f207c5fcdbc003b68836db0f445c7ef60.png" src="../../_images/b0d366d87e7a5d5cef1c5075a8dfa73f207c5fcdbc003b68836db0f445c7ef60.png" />
<img alt="../../_images/fca7f93df163f9392e6ba517f2e7d5f8bd7dda1c44de7cbfbeb732c1c47f2439.png" src="../../_images/fca7f93df163f9392e6ba517f2e7d5f8bd7dda1c44de7cbfbeb732c1c47f2439.png" />
<img alt="../../_images/80114f9784b01df6da52d84d2906d84b473dd048bc511ce81a47e1fd06d205f3.png" src="../../_images/80114f9784b01df6da52d84d2906d84b473dd048bc511ce81a47e1fd06d205f3.png" />
<img alt="../../_images/c492836e43301847472c3256727c14f68dadfedf19dd760a4533b90ec731f1ce.png" src="../../_images/c492836e43301847472c3256727c14f68dadfedf19dd760a4533b90ec731f1ce.png" />
<img alt="../../_images/31d47bd350d7b39ece3b685746ed0eee816c73a95ab0a33b285db41a8b064277.png" src="../../_images/31d47bd350d7b39ece3b685746ed0eee816c73a95ab0a33b285db41a8b064277.png" />
</div>
</div>
<p>Differences in the annual cycle amplitude across datasets partly reflect data quality and sampling effects rather than purely physical variability. Overall, there is a high degree of agreement among CERES, CLARA-A3 and HIRS across all regions, with respect to what is observed when considering also ERS-2, ENVISAT and Sentinel products. These latter seem to have systematically higher climatological OLR values during hemispheric wintertime in both the northern and southern high-latitude regions, due to a seasonally varying masking of these regions. In ENVISAT, this effect is amplified by the fact that, due to its relatively reduced swath width, there is an extreme latitudinalband which is never sampled by measurements (see also the zonal mean analysis section). Despite the global region presenting typical biased values against CLARA-A3, HIRS and CERES, which are in agreement with the dataset documentation (see the <a class="reference external" href="https://confluence.ecmwf.int/pages/viewpage.action?pageId=304239287" rel="noreferrer" target="_blank">ERB CCI -ICDR: Product Quality Assurance Report (PQAR)</a>). There is no documentation available to search for further details necessary to explain Southern Hemisphere differences in ESA products (ENVISAT, Sentinel) - see section 4 of the <a class="reference external" href="https://confluence.ecmwf.int/pages/viewpage.action?pageId=304239290#heading-4Summaryofvalidationresults" rel="noreferrer" target="_blank">ERB CCI-ICDR: Product Quality Assurance Document (PQAD</a>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">periods_info</span><span class="p">:</span>
    <span class="n">plot_period_climatology</span><span class="p">(</span><span class="n">sw_ts_periods</span><span class="p">[</span><span class="n">label</span><span class="p">],</span> <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="s2">&quot;OSR annual cycle&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/c5c3a9882ebbfc8b9993a0fe98c7e545d03c8adb7f6b02c45fd3117958a48474.png" src="../../_images/c5c3a9882ebbfc8b9993a0fe98c7e545d03c8adb7f6b02c45fd3117958a48474.png" />
<img alt="../../_images/a4f61fd073406b040c04616b23f04ebe8022daf75c5336c7d5003cbd39695f46.png" src="../../_images/a4f61fd073406b040c04616b23f04ebe8022daf75c5336c7d5003cbd39695f46.png" />
<img alt="../../_images/1bf664ac0bc8b3cbf3f0bb3a2286e548d40c780db1c97185bb69ccf20c7eb792.png" src="../../_images/1bf664ac0bc8b3cbf3f0bb3a2286e548d40c780db1c97185bb69ccf20c7eb792.png" />
</div>
</div>
<p>Discrepancies among OSR products are generally smaller than for OLR, reflecting the stronger observational constraint provided by reflected solar radiation. Nevertheless, differences increase poleward and over bright surfaces, consistent with known sensitivities of shortwave flux retrievals to cloud optical properties, surface albedo, and anisotropy corrections. Products derived from AATSR (ERS-2, Sentinel, ENVISAT) sensors tend to exhibit slightly higher OSR in bright subtropical and high‚Äêlatitude regions than AVHRR-based ones (CERES, CLARA-A3), in line with their documented validation characteristics (<a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0212.1" rel="noreferrer" target="_blank">[7]</a>; <a class="reference external" href="https://doi.org/10.1080/17538947.2023.2198262" rel="noreferrer" target="_blank">[8]</a>).</p>
<p>In the following cell, we define the function to build anomalies by subtracting from each dataset its climatology over the full-coverage period.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">build_anomalies</span><span class="p">(</span><span class="n">ts_all</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">ts_all</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">sizes</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="n">anom_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="n">ts_product</span> <span class="o">=</span> <span class="n">ts_all</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">product</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ts_product</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">climatology</span> <span class="o">=</span> <span class="n">ts_product</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">anom</span> <span class="o">=</span> <span class="p">(</span><span class="n">ts_product</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span> <span class="o">-</span> <span class="n">climatology</span><span class="p">)</span>
        <span class="n">anom_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">anom</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="p">[</span><span class="n">product</span><span class="p">]))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">anom_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">anom_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;product&quot;</span><span class="p">)</span>


<span class="n">lw_anom</span> <span class="o">=</span> <span class="n">build_anomalies</span><span class="p">(</span><span class="n">lw_ts</span><span class="p">)</span>
<span class="n">sw_anom</span> <span class="o">=</span> <span class="n">build_anomalies</span><span class="p">(</span><span class="n">sw_ts</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>And here we scatter-plot anomalies showing month by month variability, colour-coding the years, over different regions</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lw_anom</span> <span class="o">=</span> <span class="n">lw_anom</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">lw_anom</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">region</span><span class="o">=</span><span class="n">lw_anom</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">))</span>
<span class="n">sw_anom</span> <span class="o">=</span> <span class="n">sw_anom</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">sw_anom</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">),</span> <span class="n">region</span><span class="o">=</span><span class="n">sw_anom</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;str&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">lw_anom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lw_anom</span><span class="o">.</span><span class="n">region</span><span class="p">)):</span>
        <span class="n">reg_lw</span> <span class="o">=</span> <span class="n">lw_anom</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
        <span class="n">reg_lw</span> <span class="o">=</span> <span class="n">reg_lw</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">reg_lw</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">})</span>

        <span class="n">t4</span> <span class="o">=</span> <span class="n">reg_lw</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span>
            <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Apply formatting to all facet axes</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">t4</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

        <span class="c1"># Add global title</span>
        <span class="n">t4</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;OLR monthly anomalies (period climatology removed) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;in region </span><span class="si">{</span><span class="n">lw_anom</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/41104fe11bd81f5aa77de312de8853f0dad07d14d6fbb496825d9791a4b24064.png" src="../../_images/41104fe11bd81f5aa77de312de8853f0dad07d14d6fbb496825d9791a4b24064.png" />
<img alt="../../_images/728a84389ccd9ec13c558f4d2c0baa951429b04494215c642afb3514966190d6.png" src="../../_images/728a84389ccd9ec13c558f4d2c0baa951429b04494215c642afb3514966190d6.png" />
<img alt="../../_images/a18118d3c533b1e71075f8ec69317e16a4aad8319880bc94fdad1cc07e8ea2e3.png" src="../../_images/a18118d3c533b1e71075f8ec69317e16a4aad8319880bc94fdad1cc07e8ea2e3.png" />
<img alt="../../_images/fea57d58a9ad758133e601520108db01a726896967f057e6681da01eac014f5b.png" src="../../_images/fea57d58a9ad758133e601520108db01a726896967f057e6681da01eac014f5b.png" />
<img alt="../../_images/f3665167e8dfa94a39a997879d30a3a4e56e035ad54d63e72e753539c46c5433.png" src="../../_images/f3665167e8dfa94a39a997879d30a3a4e56e035ad54d63e72e753539c46c5433.png" />
<img alt="../../_images/d0eeeb7db08cb8a129d70f6364ebe1d9d17dbd00d770552270b8023c8c1cd66f.png" src="../../_images/d0eeeb7db08cb8a129d70f6364ebe1d9d17dbd00d770552270b8023c8c1cd66f.png" />
</div>
</div>
<p>The anomaly scatter plots show that Sentinel products, ERS-2 and ENVISAT have a higher degree of variability than longer records such as CLARA-A3, CERES and HIRS. Furthermore, it appears evident from the year colour-coding that there‚Äôs a general increasing trend in the OLR, which is more pronounced in the northern regions than in the southern ones, which have reflections in globally-averaged values.</p>
<p>Same as above, but for the shortwave.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">sw_anom</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lw_anom</span><span class="o">.</span><span class="n">region</span><span class="p">)):</span>
        <span class="n">reg_sw</span> <span class="o">=</span> <span class="n">sw_anom</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
        <span class="n">reg_sw</span> <span class="o">=</span> <span class="n">reg_sw</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;year&#39;</span><span class="p">:</span> <span class="n">reg_sw</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">})</span>

        <span class="n">t5</span> <span class="o">=</span> <span class="n">reg_sw</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">,</span>
            <span class="n">col</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span>
            <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
            <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Apply formatting to all facet axes</span>
        <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">t5</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">],</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelrotation</span><span class="o">=</span><span class="mi">45</span><span class="p">)</span>

        <span class="c1"># Add global title</span>
        <span class="n">t5</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;OSR monthly anomalies (period climatology removed) &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;in region </span><span class="si">{</span><span class="n">lw_anom</span><span class="o">.</span><span class="n">region</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span>
        <span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/438632fac1536f1309c2a5d6ec0e27233abbd8950ad47e4dfc3d0e323c9cbe0f.png" src="../../_images/438632fac1536f1309c2a5d6ec0e27233abbd8950ad47e4dfc3d0e323c9cbe0f.png" />
<img alt="../../_images/10e26b62445d063bba091f886551fed347be5607b3f9f231b5848a510b34b0af.png" src="../../_images/10e26b62445d063bba091f886551fed347be5607b3f9f231b5848a510b34b0af.png" />
<img alt="../../_images/543897856ff433c437a58660d19687c349a7050a5b7ad64358e843403e69367f.png" src="../../_images/543897856ff433c437a58660d19687c349a7050a5b7ad64358e843403e69367f.png" />
<img alt="../../_images/907ae940e6272f2ce1769f745e42e898b6814bf00328ef5a9421a6c97e8adca2.png" src="../../_images/907ae940e6272f2ce1769f745e42e898b6814bf00328ef5a9421a6c97e8adca2.png" />
<img alt="../../_images/5bc98eec1f8727c646a1fb7d06755ca4c0044689daed643b89614d323a7cc798.png" src="../../_images/5bc98eec1f8727c646a1fb7d06755ca4c0044689daed643b89614d323a7cc798.png" />
<img alt="../../_images/8542cd744d477765bb30fe1d86ed080e241b24cce32593b446d4298f28bc80af.png" src="../../_images/8542cd744d477765bb30fe1d86ed080e241b24cce32593b446d4298f28bc80af.png" />
</div>
</div>
<p>OSR anomaly scatter plots exhibit larger relative spread across products than OLR, reflecting the stronger sensitivity of reflected shortwave radiation to cloud and aerosols‚Äô optical properties, surface radiative properties, and observation/illumination geometry. The temporal variability, even for the longest records, is characterised by a stationary behaviour, without signs of increasing or decreasing trends, nor in latitudinal bands, nor globally. For datasets with limited temporal extent, anomalies may be dominated by the particular seasonal and cloud regimes sampled during the available years, leading, also here, to representativeness limitations rather than systematic retrieval errors.
Inter‚Äêproduct differences in OSR anomalies should be interpreted with caution, particularly when comparing short records against multi‚Äêdecadal references such as CERES‚ÄêEBAF (<a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0212.1" rel="noreferrer" target="_blank">[7]</a>; <a class="reference external" href="https://doi.org/10.1080/17538947.2023.2198262" rel="noreferrer" target="_blank">[8]</a>).</p>
<p>Below, we calculate the Net Top of the Atmosphere Radiation, which is the unclosed ‚ÄúEarth Energy Imbalance‚Äù (EEI), due to missing data.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_nohirs</span> <span class="o">=</span> <span class="n">sw_ts</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">values</span>
<span class="n">res_var</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">p</span>  <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">request_dicts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span> <span class="o">!=</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">]</span>

<span class="n">prod</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">product</span> <span class="ow">in</span> <span class="n">p</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;HIRS&quot;</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">lw_ds_complete</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
    <span class="n">sw_ds_complete</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
    <span class="n">sw_ds_in_complete</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="s1">&#39;incoming_shortwave&#39;</span><span class="p">][</span><span class="s1">&#39;CERES&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">product</span> <span class="o">!=</span> <span class="s2">&quot;CERES&quot;</span><span class="p">:</span>
        <span class="n">sw_ds_complete</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">sw_ds_complete</span><span class="p">,</span> <span class="n">sw_ds_in_complete</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">lw_ds_complete</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">lw_ds_complete</span><span class="p">,</span> <span class="n">sw_ds_in_complete</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
    <span class="n">lw_ds</span> <span class="o">=</span> <span class="n">lw_ds_complete</span><span class="c1">#.groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True)</span>
    <span class="n">sw_ds</span> <span class="o">=</span> <span class="n">sw_ds_complete</span><span class="c1">#.groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True)</span>
    <span class="n">sw_ds_in</span> <span class="o">=</span> <span class="n">sw_ds_in_complete</span><span class="c1">#.groupby(&#39;time.month&#39;).mean(&#39;time&#39;, skipna=True)</span>
    <span class="n">sw_ds_in</span> <span class="o">=</span> <span class="n">fix_lon_0_360</span><span class="p">(</span><span class="n">sw_ds_in</span><span class="p">)</span>
    <span class="n">lw_ds</span> <span class="o">=</span> <span class="n">fix_lon_0_360</span><span class="p">(</span><span class="n">lw_ds</span><span class="p">)</span>
    <span class="n">sw_ds</span> <span class="o">=</span> <span class="n">fix_lon_0_360</span><span class="p">(</span><span class="n">sw_ds</span><span class="p">)</span>
    <span class="n">sw_ds_in</span> <span class="o">=</span> <span class="n">fix_time</span><span class="p">(</span><span class="n">sw_ds_in</span><span class="p">)</span>
    <span class="n">sw_ds</span> <span class="o">=</span> <span class="n">fix_time</span><span class="p">(</span><span class="n">sw_ds</span><span class="p">)</span>
    <span class="n">lw_ds</span> <span class="o">=</span> <span class="n">fix_time</span><span class="p">(</span><span class="n">lw_ds</span><span class="p">)</span>
    <span class="n">shortname_out</span> <span class="o">=</span> <span class="n">get_varname</span><span class="p">(</span><span class="n">sw_ds</span><span class="p">,</span> <span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">)</span>
    <span class="n">longname</span> <span class="o">=</span> <span class="n">get_varname</span><span class="p">(</span><span class="n">lw_ds</span><span class="p">,</span> <span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">)</span>
    <span class="n">shortname_in</span> <span class="o">=</span> <span class="n">get_varname</span><span class="p">(</span><span class="n">sw_ds_in</span><span class="p">,</span> <span class="s1">&#39;incoming_shortwave&#39;</span><span class="p">)</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sw_ds</span><span class="p">[</span><span class="n">shortname_out</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">sw_ds_in</span><span class="p">[</span><span class="n">shortname_in</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lw_ds</span><span class="p">[</span><span class="n">longname</span><span class="p">])</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">fix_time</span><span class="p">(</span><span class="n">da</span><span class="p">)</span>
    <span class="n">mask_da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">dataarrays</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">slices</span> <span class="ow">in</span> <span class="n">region_slices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">dall</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
        <span class="n">da_sel</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lon_slice&#39;</span><span class="p">],</span> <span class="n">latitude</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lat_slice&#39;</span><span class="p">])</span>
        <span class="n">mask_sel</span> <span class="o">=</span> <span class="n">mask_da</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lon_slice&#39;</span><span class="p">],</span> <span class="n">latitude</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lat_slice&#39;</span><span class="p">])</span>
        <span class="n">da_sel</span> <span class="o">=</span> <span class="n">da_sel</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask_sel</span><span class="p">))</span>
        <span class="n">da_ts</span> <span class="o">=</span> <span class="n">da_sel</span><span class="o">.</span><span class="n">weighted</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">da_sel</span><span class="o">.</span><span class="n">latitude</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">180.</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">([</span><span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">],</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da_ts</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">]))</span>
    
    <span class="n">da_reg</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataarrays</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span>
    <span class="n">prod</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_reg</span>
    <span class="n">res_var</span><span class="p">[</span><span class="s1">&#39;EEI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prod</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>CERES is used here as a reference for incoming shortwave radiation and as a benchmark for Net Top Of the Atmosphere Radiation, consistent with its design objective of achieving TOA energy balance within uncertainty (<a class="reference external" href="https://doi.org/10.1175/2008JCLI2637.1" rel="noreferrer" target="_blank">[1]</a>,  <a class="reference external" href="https://doi.org/10.1038/ngeo1375" rel="noreferrer" target="_blank">[4]</a>). Specifically, NTOAR is calculated for each of the datasets in this notebook as the difference between the net shortwave and net longwave components, but the net shortwave is always calculated using the incoming component from CERES-EBAF.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ensmean</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res_var</span><span class="p">[</span><span class="s1">&#39;EEI&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">)</span>
<span class="n">ensstd</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res_var</span><span class="p">[</span><span class="s1">&#39;EEI&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;product&#39;</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res_var</span><span class="p">[</span><span class="s1">&#39;EEI&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">p</span><span class="p">})</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">res</span><span class="p">,</span> <span class="n">ensmean</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;EnsMean&#39;</span><span class="p">])],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>And here we show the time series for the ensemble mean and for each member, alongside the ensemble standard deviation as a grey shading. This is done in every one of the regions defined in previous analyses. The EEI is the small difference between the sunlight the Earth absorbs and the thermal (longwave) plus reflected (shortwave) radiation it emits, and represents a fundamental ‚Äúengine‚Äù of climate change. Even a tiny positive imbalance (on the order of 0.5-1 W m<sup>-2</sup>, according to recent estimates <a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">[6]</a>) sustained year after year is what drives ocean heat uptake, ice melt, sea-level rise and ultimately the global temperature increase.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">region</span><span class="p">)):</span>
    <span class="n">figure</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">figure</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">product</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">res</span><span class="o">.</span><span class="n">product</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">==</span> <span class="s1">&#39;EnsMean&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">res</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">res</span><span class="o">.</span><span class="n">product</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">t3</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;EnsMean&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;EnsMean&#39;</span><span class="p">)</span> <span class="c1">#.resample(time=&#39;1M&#39;).mean()</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;Net</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="s2">&quot;Top Of the Atmosphere</span><span class="se">\n</span><span class="s2">&quot;</span>
    <span class="sa">r</span><span class="s2">&quot;Radiation = $\langle (sw_{\mathrm</span><span class="si">{out}</span><span class="s2">} - sw_{\mathrm</span><span class="si">{in}</span><span class="s2">}^{[\mathrm</span><span class="si">{CERES}</span><span class="s2">]}) - lw \rangle$&quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[W m$^{-2}$]&quot;</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">ensmean</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">ensmean</span> <span class="o">-</span> <span class="n">ensstd</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="p">(</span><span class="n">ensmean</span> <span class="o">+</span> <span class="n">ensstd</span><span class="p">)</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="n">j</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Ens. Std. Dev.&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.15</span><span class="p">))</span>
    <span class="n">figure</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;NTOAR Time series - </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">region</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/e352e3e949d67c57b8198bd0be5b7fea9fb68f8479611b6b5a563a74def7e898.png" src="../../_images/e352e3e949d67c57b8198bd0be5b7fea9fb68f8479611b6b5a563a74def7e898.png" />
<img alt="../../_images/df8da0adcc859ee170f97bbdabb85f9b368fe2058c431e87e8b252ae25c69d67.png" src="../../_images/df8da0adcc859ee170f97bbdabb85f9b368fe2058c431e87e8b252ae25c69d67.png" />
<img alt="../../_images/84c4fa7c28f9a3c9c6bd317d84495aaca128a1aef3f74dc66216ade299f1d6fd.png" src="../../_images/84c4fa7c28f9a3c9c6bd317d84495aaca128a1aef3f74dc66216ade299f1d6fd.png" />
<img alt="../../_images/d85b1e74abd415c43e15f31a9977c59cf1024f559a08367cd3e0bcfc31823ebc.png" src="../../_images/d85b1e74abd415c43e15f31a9977c59cf1024f559a08367cd3e0bcfc31823ebc.png" />
<img alt="../../_images/b0e21a52d9bea46aa63faf3501c3a601b3b71cef482228b9c62a179625034e0c.png" src="../../_images/b0e21a52d9bea46aa63faf3501c3a601b3b71cef482228b9c62a179625034e0c.png" />
<img alt="../../_images/a1bd48cd8284beac86f5272cb706ecc669c1660bbe2413bac26f3fad08e4fc3d.png" src="../../_images/a1bd48cd8284beac86f5272cb706ecc669c1660bbe2413bac26f3fad08e4fc3d.png" />
</div>
</div>
<p>The globally averaged time series of monthly mean Net Top of the Atmosphere Radiation (NTOAR) presents two main high-variability temporal spikes: the ERS-2 one at the beginning of the time series, and another peak in 2020, clearly due to Sentinel data. The first one can be explained by the switch of the Near Infra Red channel onboard of NOAA satellites (from 3.7 to 1.6 micrometres), which changed the type of available information: the 1.6 channel allows for a better distinction between different types of clouds (ice or water). Water clouds absorb less radiation compared to ice clouds, and assuming overestimation with respect to ice clouds with the 3.7 channel, this may explain the jump, see the PVIR.
The second feature is due to a known bias of sentinel products in both components (about 6 W m<sup>-2</sup> for the OLR, and about 4 W m<sup>-2</sup> for the OSR - see this PQAR). Outlier peaks apart, the global average of NTOAR indicates a small seasonal cycle (about 20 W m<sup>-2</sup> peak-to-peak), oscillating around zero. The tropical domain is characterised by a range of variability entirely negative, correctly indicating that on average, this is the region of net radiation gain, while mid-latitudes and high-latitudes are respectively almost in balance and losing radiation.</p>
</section>
<section id="plot-time-weighted-means">
<span id="satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-4"></span><h3>4. Plot time weighted means<a class="headerlink" href="#plot-time-weighted-means" title="Link to this heading">#</a></h3>
<p>Below, we calculate and plot time-weighted means for the different radiation budget products, with their proper masking. The dataset in each left column is taken as a reference; it is shown with its absolute values, while the others are shown as differences with respect to this one. Please note that different periods were considered in order to make a fair comparison between products which have a different temporal extent.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">plot_maps_with_reference</span><span class="p">(</span><span class="n">da_all</span><span class="p">,</span> <span class="n">ref_product</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">levels_abs</span><span class="p">,</span> <span class="n">cmap_abs</span><span class="p">,</span> <span class="n">label_abs</span><span class="p">):</span>
    <span class="n">products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">da_all</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ref_product</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">products</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">ref</span> <span class="o">=</span> <span class="n">da_all</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">ref_product</span><span class="p">)</span>
    <span class="n">other_products</span> <span class="o">=</span> <span class="p">[</span><span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">products</span> <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">ref_product</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">other_products</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">anomalies</span> <span class="o">=</span> <span class="n">da_all</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">other_products</span><span class="p">)</span> <span class="o">-</span> <span class="n">ref</span>
    <span class="n">plot_arrays</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">anomalies</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_products</span><span class="p">]</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_product</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">ref_product</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">other_products</span><span class="p">]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">plot_arrays</span><span class="p">)</span>
    <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">ncols</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="mi">180</span><span class="p">)}</span>
    <span class="p">)</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">im_abs</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">im_diff</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">diff_limit</span> <span class="o">=</span> <span class="mi">15</span> <span class="k">if</span> <span class="s2">&quot;OLR&quot;</span> <span class="ow">in</span> <span class="n">title</span> <span class="k">else</span> <span class="mi">35</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">da_i</span><span class="p">,</span> <span class="n">t_i</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">plot_arrays</span><span class="p">,</span> <span class="n">titles</span><span class="p">)):</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">im_abs</span> <span class="o">=</span> <span class="n">da_i</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_abs</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels_abs</span><span class="p">,</span>
                <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
                <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t_i</span><span class="si">}</span><span class="s2">, range=(</span><span class="si">{</span><span class="n">da_i</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">da_i</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">im_diff</span> <span class="o">=</span> <span class="n">da_i</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span>
                <span class="n">vmin</span><span class="o">=-</span><span class="n">diff_limit</span><span class="p">,</span>
                <span class="n">vmax</span><span class="o">=</span><span class="n">diff_limit</span><span class="p">,</span>
                <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
                <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;50m&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t_i</span><span class="si">}</span><span class="s2">, range=(</span><span class="si">{</span><span class="n">da_i</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">da_i</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s2">&quot;compressed&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">im_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cax_abs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_abs</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax_abs</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label_abs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">im_diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cax_diff</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_diff</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax_diff</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Bias [W m-2]&quot;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">ds_maps</span><span class="p">,</span> <span class="n">times</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">ds_periods_list</span><span class="p">,</span> <span class="n">periods</span><span class="p">)):</span>
    <span class="n">mask_period</span> <span class="o">=</span> <span class="n">masks_periods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">masks_periods</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">p_to_show</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds_maps</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">p_to_show</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

    <span class="n">p_to_show_whirs</span> <span class="o">=</span> <span class="n">p_to_show</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">if</span> <span class="s2">&quot;HIRS&quot;</span> <span class="ow">in</span> <span class="n">p_to_show_whirs</span><span class="p">:</span>
        <span class="n">p_to_show_whirs</span> <span class="o">=</span> <span class="n">p_to_show_whirs</span>
    <span class="k">if</span> <span class="s2">&quot;HIRS&quot;</span> <span class="ow">in</span> <span class="n">p_to_show</span><span class="p">:</span>
        <span class="n">p_to_show</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;HIRS&quot;</span><span class="p">)</span>
    <span class="n">lw_maps</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_maps</span><span class="p">[</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_to_show_whirs</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">p_to_show_whirs</span><span class="p">})</span>
    <span class="k">if</span> <span class="n">mask_period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;outgoing_longwave&quot;</span> <span class="ow">in</span> <span class="n">mask_period</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="n">lw_maps_masked</span> <span class="o">=</span> <span class="n">lw_maps</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask_period</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;outgoing_longwave&#39;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lw_maps_masked</span> <span class="o">=</span> <span class="n">lw_maps</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_to_show_whirs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ref_lw</span> <span class="o">=</span> <span class="n">p_to_show_whirs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plot_maps_with_reference</span><span class="p">(</span>
            <span class="n">lw_maps_masked</span><span class="p">,</span>
            <span class="n">ref_product</span><span class="o">=</span><span class="n">ref_lw</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean map on the period </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2"> (OLR)&quot;</span><span class="p">,</span>
            <span class="n">levels_abs</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="n">cmap_abs</span><span class="o">=</span><span class="s2">&quot;nipy_spectral&quot;</span><span class="p">,</span>
            <span class="n">label_abs</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;longwave [W m-2]&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">p_to_show</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">sw_maps</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_maps</span><span class="p">[</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_to_show</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">p_to_show</span><span class="p">})</span>
        <span class="k">if</span> <span class="n">mask_period</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;outgoing_shortwave&quot;</span> <span class="ow">in</span> <span class="n">mask_period</span><span class="o">.</span><span class="n">variable</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="n">sw_maps_masked</span> <span class="o">=</span> <span class="n">sw_maps</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask_period</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s1">&#39;outgoing_shortwave&#39;</span><span class="p">)))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sw_maps_masked</span> <span class="o">=</span> <span class="n">sw_maps</span>
        <span class="n">ref_sw</span> <span class="o">=</span> <span class="n">p_to_show</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">plot_maps_with_reference</span><span class="p">(</span>
            <span class="n">sw_maps_masked</span><span class="p">,</span>
            <span class="n">ref_product</span><span class="o">=</span><span class="n">ref_sw</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mean map on the period </span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2"> (OSR)&quot;</span><span class="p">,</span>
            <span class="n">levels_abs</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
            <span class="n">cmap_abs</span><span class="o">=</span><span class="s2">&quot;gist_ncar&quot;</span><span class="p">,</span>
            <span class="n">label_abs</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;net shortwave [W m-2]&quot;</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/8f1a366e3e292f4ce0dbce9fd36e0a4f5cc5519fa0760699fb1e98be25455f3f.png" src="../../_images/8f1a366e3e292f4ce0dbce9fd36e0a4f5cc5519fa0760699fb1e98be25455f3f.png" />
<img alt="../../_images/e3f75ab79d47ba3483cd3b905c32f6528671812c6c3726e16124392f55182b9a.png" src="../../_images/e3f75ab79d47ba3483cd3b905c32f6528671812c6c3726e16124392f55182b9a.png" />
<img alt="../../_images/bc9a3a51fb9094718e6bafa5821c3745b7b50ca35f4972b32a2be60de8346ed2.png" src="../../_images/bc9a3a51fb9094718e6bafa5821c3745b7b50ca35f4972b32a2be60de8346ed2.png" />
<img alt="../../_images/39712d0df7941ba182f6561f5e707548e77d96ea19c1b4505bce250c6ce8fe78.png" src="../../_images/39712d0df7941ba182f6561f5e707548e77d96ea19c1b4505bce250c6ce8fe78.png" />
<img alt="../../_images/8f1fb412d67baefa33928f09333e26d497c9f1582e8fdb855997c350b3b538e0.png" src="../../_images/8f1fb412d67baefa33928f09333e26d497c9f1582e8fdb855997c350b3b538e0.png" />
<img alt="../../_images/58cdb7e9c1a28bcf8414bd596e5ca286fa151eb602d82f5888c27a3b28f47579.png" src="../../_images/58cdb7e9c1a28bcf8414bd596e5ca286fa151eb602d82f5888c27a3b28f47579.png" />
<img alt="../../_images/51fbf20edae637acdae4482af1548a0f4a7f902b094457e741ce155cb4d5e031.png" src="../../_images/51fbf20edae637acdae4482af1548a0f4a7f902b094457e741ce155cb4d5e031.png" />
<img alt="../../_images/f0a232c231be6975fe4352f2bc70de347d1895445624e493f6b5e4702aeac95b.png" src="../../_images/f0a232c231be6975fe4352f2bc70de347d1895445624e493f6b5e4702aeac95b.png" />
</div>
</div>
<p>Time-averaged spatial maps show a higher degree of consistency among CLARA-A3, CERES and HIRS, which have lower bias worldwide than Sentinel, ERS-2 and ENVISAT. Common features among the bias maps are, especially for the OLR, higher values over mountain areas such as the Tibetan Plateau and the North American continent, and over desert areas, such as south of the Sahara and the Atacama, while the OSR shows a pronounced anomaly in the Tropical Pacific, offshore Chile. Maps where CERES is referenced against ERS-2, ENVISAT and Sentinel show a stripe-like pattern, especially in polar regions, which is probably due to the different types of orbit of the satellite (heliosynchronous or precessing orbit).</p>
</section>
<section id="plot-spatial-weighted-zonal-means">
<span id="satellite-satellite-earth-radiation-budget-climate-monitoring-q01-section-5"></span><h3>5. Plot spatial weighted zonal means<a class="headerlink" href="#plot-spatial-weighted-zonal-means" title="Link to this heading">#</a></h3>
<p>The code below calculates and plots weighted zonal means for the radiation budget products. For comparison, different periods are shown consistently with different temporal overlapping windows.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">monthly_zonal_climatology</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">regrid</span><span class="p">:</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">mask_common</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask_common</span><span class="p">))</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">da</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.month&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">period_bounds</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;CLARA-A3&quot;</span><span class="p">,</span> <span class="n">clara_a3_start</span><span class="p">,</span> <span class="n">clara_a3_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;CERES&quot;</span><span class="p">,</span> <span class="n">ceres_start</span><span class="p">,</span> <span class="n">ceres_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ESA-ENVISAT&quot;</span><span class="p">,</span> <span class="n">esa_envisat_start</span><span class="p">,</span> <span class="n">esa_envisat_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Sentinel-3&quot;</span><span class="p">,</span> <span class="n">sentinel_start</span><span class="p">,</span> <span class="n">sentinel_end</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;ESA-ERS2&quot;</span><span class="p">,</span> <span class="n">esa_ers2_start</span><span class="p">,</span> <span class="n">esa_ers2_end</span><span class="p">),</span>
 <span class="p">]</span>
<span class="n">zonal_clim</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">period_bounds</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">,</span> <span class="s2">&quot;outgoing_shortwave&quot;</span><span class="p">]:</span>
        <span class="n">clim_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">products_plot</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="s2">&quot;CERES&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">]:</span>
            <span class="k">continue</span>
        <span class="n">ref_varname</span> <span class="o">=</span> <span class="n">get_varname</span><span class="p">(</span><span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="s2">&quot;CERES&quot;</span><span class="p">],</span> <span class="n">variable</span><span class="p">)</span>
        <span class="n">da_obj</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="s2">&quot;CERES&quot;</span><span class="p">][</span><span class="n">ref_varname</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;HIRS&quot;</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">!=</span> <span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="s2">&quot;CERES&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">product</span> <span class="ow">and</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;incoming_shortwave&quot;</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">prod_start</span> <span class="o">=</span> <span class="n">start_var</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
            <span class="n">prod_stop</span> <span class="o">=</span> <span class="n">stop_var</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
            <span class="n">curr_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">prod_start</span><span class="p">,</span> <span class="n">prod_stop</span><span class="p">)</span>
            <span class="n">period_time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">period_time</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_time</span> <span class="ow">or</span> <span class="n">period_time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">curr_time</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">varname</span> <span class="o">=</span> <span class="n">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
            <span class="n">regrid</span> <span class="o">=</span> <span class="kc">False</span> <span class="k">if</span> <span class="n">product</span> <span class="o">==</span> <span class="s2">&quot;CERES&quot;</span> <span class="k">else</span> <span class="kc">True</span>
            <span class="n">mask_common</span> <span class="o">=</span> <span class="n">get_period_mask</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
            <span class="n">clim</span> <span class="o">=</span> <span class="n">monthly_zonal_climatology</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">mask_common</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">)</span>
            <span class="n">clim_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clim</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="p">[</span><span class="n">product</span><span class="p">]))</span>
            <span class="n">products_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">clim_list</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">clim_all</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">clim_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;product&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;product&quot;</span><span class="p">:</span> <span class="n">products_plot</span><span class="p">})</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">products_plot</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">zonal_clim</span><span class="p">[(</span><span class="n">variable</span><span class="p">,</span> <span class="n">label</span><span class="p">)]</span> <span class="o">=</span> <span class="n">clim_all</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The results are shown in an Hovmoller plot, with the latitude on the y-axis and the month on the x-axis. As for the mean maps, the first panel in each column is in absolute value, while the others show the bias relative to the first.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span> <span class="ow">in</span> <span class="n">period_bounds</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;outgoing_longwave&quot;</span><span class="p">,</span> <span class="s2">&quot;outgoing_shortwave&quot;</span><span class="p">]:</span>
        <span class="n">clim_all</span> <span class="o">=</span> <span class="n">zonal_clim</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="n">variable</span><span class="p">,</span> <span class="n">label</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">clim_all</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="c1">#t = clim_all.plot(col=&quot;month&quot;, y=&quot;latitude&quot;, hue=&quot;product&quot;, col_wrap=6, figsize=(15, 7))</span>
        <span class="c1">#for n, ax in enumerate(t.axs.flatten()):</span>
        <span class="c1">#    ax.grid()</span>
        <span class="c1">#    ax.set_xlabel(f&quot;{variable} [W m-2]&quot;)</span>
        <span class="c1">#    if n &lt; 6:</span>
        <span class="c1">#        ax.set_xlabel(&#39;&#39;)</span>
        <span class="c1">#    ax.set_ylim(-90,90)</span>
        <span class="c1">#t.fig.suptitle(f&quot;Monthly climatological zonal mean ({label} {start[:4]}-{stop[:4]}) - {variable}&quot;, y=1.02)</span>
        <span class="n">products</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">clim_all</span><span class="o">.</span><span class="n">product</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">products</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="n">ref_product</span> <span class="o">=</span> <span class="n">products</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">clim_all</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">ref_product</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">products</span><span class="p">)</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="n">ncols</span><span class="p">))</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">),</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
        <span class="n">im_abs</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">im_diff</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">diff_limit</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="n">variable</span><span class="o">==</span><span class="s1">&#39;outgoing_longwave&#39;</span> <span class="k">else</span> <span class="mi">25</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">products</span><span class="p">):</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">im_abs</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;month&quot;</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;turbo&quot;</span><span class="p">,</span>
                    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2">, range=(</span><span class="si">{</span><span class="n">ref</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">ref</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">clim_all</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="n">p</span><span class="p">)</span> <span class="o">-</span> <span class="n">ref</span>
                <span class="n">im_diff</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="s2">&quot;month&quot;</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span>
                    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">vmin</span><span class="o">=-</span><span class="n">diff_limit</span><span class="p">,</span>
                    <span class="n">vmax</span><span class="o">=</span><span class="n">diff_limit</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">p</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">ref_product</span><span class="si">}</span><span class="s2">, range=(</span><span class="si">{</span><span class="n">diff</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">diff</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span><span class="s1">&#39;Feb&#39;</span><span class="p">,</span><span class="s1">&#39;Mar&#39;</span><span class="p">,</span><span class="s1">&#39;Apr&#39;</span><span class="p">,</span><span class="s1">&#39;May&#39;</span><span class="p">,</span><span class="s1">&#39;Jun&#39;</span><span class="p">,</span><span class="s1">&#39;Jul&#39;</span><span class="p">,</span><span class="s1">&#39;Aug&#39;</span><span class="p">,</span><span class="s1">&#39;Sep&#39;</span><span class="p">,</span><span class="s1">&#39;Oct&#39;</span><span class="p">,</span><span class="s1">&#39;Nov&#39;</span><span class="p">,</span><span class="s1">&#39;Dec&#39;</span><span class="p">])</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Lat [degrees]&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="n">ncols</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Month&quot;</span> <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">nrows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">ncols</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">delaxes</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s2">&quot;compressed&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">im_abs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cax_abs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_abs</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax_abs</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> [W m-2]&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">im_diff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cax_diff</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.35</span><span class="p">])</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im_diff</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax_diff</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Bias [W m-2]&quot;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Monthly climatological zonal mean (</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">start</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">stop</span><span class="p">[:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">) - </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/eb728b308c8115a20ec440f98fb82d17f2607e616b5962aceee47a8ef089928b.png" src="../../_images/eb728b308c8115a20ec440f98fb82d17f2607e616b5962aceee47a8ef089928b.png" />
<img alt="../../_images/7aeecf495e67ba583d7cac99674da7b650dedfda2b4fef6c5dadccf38fb3ed4b.png" src="../../_images/7aeecf495e67ba583d7cac99674da7b650dedfda2b4fef6c5dadccf38fb3ed4b.png" />
<img alt="../../_images/4e1a5d8ccad9d841e24fbb2da1e62b8f5bfad52ce037aaa5ff349e811a21091c.png" src="../../_images/4e1a5d8ccad9d841e24fbb2da1e62b8f5bfad52ce037aaa5ff349e811a21091c.png" />
<img alt="../../_images/db44e71b682c1e67dcd2905fd647383dc8ba97ac40e9f98cb94a9f5a73d66629.png" src="../../_images/db44e71b682c1e67dcd2905fd647383dc8ba97ac40e9f98cb94a9f5a73d66629.png" />
<img alt="../../_images/d9cb7d85cd1500e883cc94522cc97e8b2ef9f9f2608ce6ca933edf53b1789cc6.png" src="../../_images/d9cb7d85cd1500e883cc94522cc97e8b2ef9f9f2608ce6ca933edf53b1789cc6.png" />
<img alt="../../_images/8f4fe65a97a079399144c20926f3659978835d9e1ecc1d9ef43a935998eed478.png" src="../../_images/8f4fe65a97a079399144c20926f3659978835d9e1ecc1d9ef43a935998eed478.png" />
<img alt="../../_images/6cb57e76ef8bcc1daa1b6d04f3b4f1aaa439d97a57f0f0b37fa8a8486e8b7f3b.png" src="../../_images/6cb57e76ef8bcc1daa1b6d04f3b4f1aaa439d97a57f0f0b37fa8a8486e8b7f3b.png" />
<img alt="../../_images/e465a7cdd9deb0ab55d435dde2b40057b25019e4be121919a3d221257177784b.png" src="../../_images/e465a7cdd9deb0ab55d435dde2b40057b25019e4be121919a3d221257177784b.png" />
</div>
</div>
<p>Zonal averages indicate consistency on main climatological features among the products, with systematic deviations emerging poleward (e.g., south of 50¬∞S and north of 50¬∞N). These discrepancies are consistent with increased uncertainty in cloud detection and classification, surface characterisation, and anisotropy corrections at high latitudes, particularly for products not specifically optimised for TOA flux closure. Remarkable differences in OLR zonal means persist with ERS-2, ENVISAT, and Sentinel products. Take, for example, the comparison of the CERES dataset with the ESA‚ÄëENVISAT, CLARA‚ÄëA3, and HIRS datasets. As described in Section‚ÄØ4 of the <a class="reference external" href="https://climate.esa.int/media/documents/Cloud_Algorithm-Theoretical-Baseline-Document-ATBD_v6.2.pdf#page=19.16" rel="noreferrer" target="_blank">Cloud_cci ATBD v6.2</a>, differences in sampling density, sensor spectral capabilities, and the non‚Äëlinear aggregation of pixel‚Äëlevel fluxes play a central role in shaping these biases. The ERS-2/ENVISAT/Sentinel products in general show moderate, latitude‚Äëdependent deviations from the dataset chosen as reference, reflecting the limited sampling of AATSR  and SLSTR sensors, and the sensitivity of broadband fluxes to cloud‚Äëtop retrieval uncertainties. CLARA‚ÄëA3 exhibits small and spatially smooth differences, consistent with the dense AVHRR sampling and the stability of its Level‚Äë3 processing chain. In contrast, the larger HIRS‚ÄëCERES discrepancies highlight the impact of coarse spatial resolution and differing radiative assumptions. Together, these diagnostics reinforce the interpretation that high‚Äëlatitude biases arise from a combination of algorithmic and sampling factors inherent to the various sensor systems (<a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1029/2012JD017997" rel="noreferrer" target="_blank">[5]</a>).</p>
<section id="discussion-and-applications">
<h4>Discussion and applications<a class="headerlink" href="#discussion-and-applications" title="Link to this heading">#</a></h4>
<p>The differences identified across the OLR and OSR datasets primarily reflect known characteristics of the satellite instruments and retrieval algorithms used to construct the various climate data records. For OLR, the spread between the CERES EBAF record and the HIRS and CLARA-A3 products is consistent with the long-recognised sensitivity of longwave flux retrievals to spectral sampling, cloud detection, and scene-dependent angular corrections (<a class="reference external" href="https://doi.org/10.1175/2008JCLI2637.1" rel="noreferrer" target="_blank">[1]</a>, <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1029/2012JD017997" rel="noreferrer" target="_blank">[5]</a>). CERES derives broadband fluxes using detailed angular-distribution models (ADMs) developed specifically for top-of-atmosphere applications <a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">[2]</a>. In contrast, HIRS and the AVHRR-based CLARA-A3 rely on narrower channels and empirical regressions to estimate broadband longwave radiation, a known source of latitudinal and surface-type‚Äìdependent discrepancies documented in their validation reports (HIRS PVR, CLARA-A3 PVR). These differences help explain the stronger gradients observed in the CLARA-A3 OLR fields and the slight warm-scene bias in HIRS over subtropical dry regions.</p>
<p>Additional spatial structures visible in the ERS-2 (ATSR-2/AATSR) maps, when compared with CLARA-A3, manifest as track-like or striping features that do not correspond to known geophysical patterns. These features are consistent with sampling artefacts related to the narrow swath width and orbit characteristics of the ATSR-2 instrument.
ATSR-2 provides high radiometric accuracy and dual-view observations but samples the Earth with a relatively narrow swath, resulting in sparse spatial coverage when averaged over limited time periods. In the absence of extensive gap-filling, this can leave residual orbit‚Äêrelated traces in climatological and bias maps. In contrast, the AVHRR instruments underlying CLARA-A3 have a much wider swath and denser spatial sampling, which tends to smooth out such sampling artefacts when forming long-term means, despite their more limited angular information. The presence of these traces should therefore be interpreted as a representativeness and sampling limitation rather than as a systematic bias in the radiative flux retrievals. Similar sampling‚Äêrelated features in narrow‚Äêswath ERB products have been documented in previous intercomparisons and validation studies (<a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">[2]</a>, <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1080/17538947.2023.2198262" rel="noreferrer" target="_blank">[8]</a>).</p>
<p>The Sentinel-3 SLSTR (3A, 3B, and the merged 3A+3B) interim CDRs show overall good consistency with the CERES reference but display enhanced variability in the tropics and over land surfaces, likely due to the spectral characteristics of the sensors (atmospheric windows), and their consequent high-sensitivity to the reconstruction of the diurnal cycle. However, this behaviour is in line with their validation documentation, which highlights sensitivity to cloud screening and to the limited temporal extent of the interim SLSTR record relative to multi-decadal products (<a class="reference external" href="https://confluence.ecmwf.int/x/6FLlEw" rel="noreferrer" target="_blank">CERES Quality Summary</a>, <a class="reference external" href="https://confluence.ecmwf.int/x/ulIiEg" rel="noreferrer" target="_blank">Sentinel Quality Assurance Document</a>). The relatively short data period (2017‚Äì2021) also means that interannual variability associated with ENSO events ‚Äî known to modulate tropical OLR <a class="reference external" href="https://doi.org/10.1002/2017JD027002" rel="noreferrer" target="_blank">[9]</a> ‚Äî can disproportionately influence the mean differences when compared to long records such as CERES or HIRS.</p>
<p>For OSR, discrepancies among products similarly reflect differences in sensor spectral coverage, calibration stability in the visible and near-infrared, and the treatment of anisotropy in the shortwave domain. CERES shortwave fluxes benefit from scene-dependent ADMs and long-term calibration stability <a class="reference external" href="https://doi.org/10.1175/2008JCLI2637.1" rel="noreferrer" target="_blank">[1]</a>, <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a>, <a class="reference external" href="https://doi.org/10.1038/ngeo1375" rel="noreferrer" target="_blank">[4]</a>, which contribute to the coherent latitudinal reflection patterns typically used as a benchmark. The CLARA-A3 product, derived from AVHRR, shows slightly higher reflected shortwave radiation in bright subtropical and high-latitude regions, consistent with known limitations in AVHRR-based angular corrections and cloud-phase retrievals noted in its product validation reports. Similarly, OSR from ESA‚Äôs ENVISAT AATSR and from SLSTR shows small but systematic differences over marine stratocumulus regions‚Äîareas where shortwave anisotropy and cloud optical properties strongly influence flux retrievals. These patterns are consistent with prior evaluations of shortwave absorption and model‚Äìobservation differences <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0212.1" rel="noreferrer" target="_blank">[7]</a>, <a class="reference external" href="https://doi.org/10.1080/17538947.2023.2198262" rel="noreferrer" target="_blank">[8]</a>.</p>
<p>Overall, the magnitude and spatial structure of the inter-product differences observed here align with previously documented behaviour of broadband radiation datasets and with theoretical expectations derived from radiative-transfer and climate-feedback studies <a class="reference external" href="https://doi.org/10.1073/pnas.1412190111" rel="noreferrer" target="_blank">[10]</a>, <a class="reference external" href="https://doi.org/10.1175/JCLI3799.1" rel="noreferrer" target="_blank">[11]</a>, <a class="reference external" href="https://doi.org/10.1038/nclimate2876" rel="noreferrer" target="_blank">[12]</a>, <a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">[6]</a>. The consistency of many features across independent retrievals‚Äîparticularly the subtropical shortwave reflection maxima and the tropical longwave minima‚Äîsupports the robustness of these products for climatological analyses, while the remaining discrepancies can be traced to well-understood algorithmic and instrumental differences identified in the respective validation reports.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
<li><p><strong>CERES (Clouds and the Earth‚Äôs Radiant Energy System)</strong>
CERES-EBAF product documentation, algorithm theoretical basis documents (ATBDs), and data quality summaries provide detailed descriptions of broadband flux retrievals, angular-distribution models, calibration, and uncertainty estimates.
<a class="reference external" href="https://ceres.larc.nasa.gov" rel="noreferrer" target="_blank">CERES Page</a></p></li>
<li><p><strong>NOAA HIRS OLR Climate Data Record</strong>
Product and validation reports describing the construction of the HIRS OLR CDR, including spectral regression methods, sampling limitations, and known sources of uncertainty.
<a class="reference external" href="https://www.ncei.noaa.gov/products/climate-data-records/outgoing-longwave-radiation-monthly" rel="noreferrer" target="_blank">HIRS Page</a></p></li>
<li><p><strong>CLARA-A3 (Cloud, Albedo and Radiation Dataset)</strong>
Comprehensive documentation on AVHRR-based radiation and cloud products, including sampling characteristics, limitations at high latitudes, and validation results.
<a class="reference external" href="https://www.cmsaf.eu/EN/Products/AvailableProducts/Climate_Data_records/Climate_Data_Records_node.html" rel="noreferrer" target="_blank">CM SAF Page</a></p></li>
<li><p><strong>ESA Cloud Climate Change Initiative (Cloud_cci)</strong>
Algorithm descriptions and product validation reports for ATSR-2, AATSR, and SLSTR-based cloud and radiation products, with emphasis on swath geometry and cloud property retrievals.
<a class="reference external" href="https://climate.esa.int/en/projects/cloud/" rel="noreferrer" target="_blank">ESA CCI Page</a></p></li>
<li><p><strong>C3S global energy balance and Earth Energy Imbalance indicators</strong>
Background material explaining how ERB products are used within C3S to support climate indicators and assessments.
<a class="reference external" href="https://climate.copernicus.eu/climate-indicators" rel="noreferrer" target="_blank">Climate Indicators</a></p></li>
<li><p><a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-earth-radiation-budget/C3S2_312a_Lot1.4.0.3_202306_Tutorial_ECV_EarthRadiationBudget_final.mp4" rel="noreferrer" target="_blank">Tutorial on the Earth Radiation Budget (ERB) Essential Climate Variable</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.1175/2008JCLI2637.1" rel="noreferrer" target="_blank">[1]</a> Loeb, N. G., Wielicki, B. A., Doelling, D. R., Smith, G. L., Keyes, D. F., Kato, S., ‚Ä¶ &amp; Wong, T. (2009). Toward optimal closure of the Earth‚Äôs top-of-atmosphere radiation budget. Journal of Climate, 22(3), 748-766 <a class="reference external" href="https://doi.org/10.1175/2008JCLI2637.1" rel="noreferrer" target="_blank">https://doi.org/10.1175/2008JCLI2637.1</a></p>
<p><a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">[2]</a> Wielicki, B. A., Barkstrom, B. R., Harrison, E. F., Lee III, R. B., Smith, G. L., &amp; Cooper, J. E. (1996). Clouds and the Earth‚Äôs Radiant Energy System (CERES): An Earth observing system experiment. Bulletin of the American Meteorological Society, 77(5), 853-868. <a class="reference external" href="https://doi.org/10.1175/1520-0477%281996%29077%3C0853:CATERE%3E2.0.CO;2" rel="noreferrer" target="_blank">https://doi.org/10.1175/1520-0477(1996)077&lt;0853:CATERE&gt;2.0.CO;2</a></p>
<p><a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">[3]</a> Loeb, N. G., Wielicki, B. A., Su, W., Loukachine, K., Sun, W., Wong, T., ‚Ä¶ &amp; Lin, B. (2012). Advances in understanding top-of-atmosphere radiation variability from satellite observations. Surveys in Geophysics, 33(3-4), 359-385 <a class="reference external" href="https://doi.org/10.1007/s10712-012-9175-1" rel="noreferrer" target="_blank">https://doi.org/10.1007/s10712-012-9175-1</a></p>
<p><a class="reference external" href="https://doi.org/10.1038/ngeo1375" rel="noreferrer" target="_blank">[4]</a> Loeb, N. G., J. M. Lyman, G. C. Johnson, R. P. Allan, D. R. Doelling, T. Wong, B. J. Soden, and G. L. Stephens, 2012: Observed changes in top-of-the-atmosphere radiation and upper-ocean heating consistent within uncertainty. Nat. Geosci., 5, 110‚Äì113, <a class="reference external" href="https://doi.org/10.1038/ngeo1375" rel="noreferrer" target="_blank">https://doi.org/10.1038/ngeo1375</a></p>
<p><a class="reference external" href="https://doi.org/10.1029/2012JD017997" rel="noreferrer" target="_blank">[5]</a> Susskind, J., G. Molnar, L. Iredell, et al., 2012: Interannual variability of outgoing longwave radiation as observed by AIRS and CERES. J. Geophys. Res. Atmos., 117, D23107, <a class="reference external" href="https://doi.org/10.1029/2012JD017997" rel="noreferrer" target="_blank">https://doi.org/10.1029/2012JD017997</a></p>
<p><a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">[6]</a> von Schuckmann, K. and Coauthors, 2023: Heat stored in the Earth system 1960‚Äì2020: where does the energy go? Earth System Science Data, 15(4), 1675-1709, <a class="reference external" href="https://doi.org/10.5194/essd-15-1675-2023" rel="noreferrer" target="_blank">https://doi.org/10.5194/essd-15-1675-2023</a></p>
<p><a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0212.1" rel="noreferrer" target="_blank">[7]</a> Schwarz, M., D. Folini, S. Yang, and M. Wild, 2019: The Annual Cycle of Fractional Atmospheric Shortwave Absorption in Observations and Models: Spatial Structure, Magnitude, and Timing. J. Climate, 32, 6729‚Äì6748, <a class="reference external" href="https://doi.org/10.1175/JCLI-D-19-0212.1" rel="noreferrer" target="_blank">https://doi.org/10.1175/JCLI-D-19-0212.1</a></p>
<p><a class="reference external" href="https://doi.org/10.1080/17538947.2023.2198262" rel="noreferrer" target="_blank">[8]</a> Yang, S., Zhang, X., Guan, S., Zhao, W., Duan, Y., Yao, Y., ‚Ä¶ Jiang, B. (2023). A review and comparison of surface incident shortwave radiation from multiple data sources: satellite retrievals, reanalysis data and GCM simulations. International Journal of Digital Earth, 16(1), 1332‚Äì1357. <a class="reference external" href="https://doi.org/10.1080/17538947.2023.2198262" rel="noreferrer" target="_blank">https://doi.org/10.1080/17538947.2023.2198262</a></p>
<p><a class="reference external" href="https://doi.org/10.1002/2017JD027002" rel="noreferrer" target="_blank">[9]</a> Su, W., N. G. Loeb, L. Liang, N. Liu, and C. Liu (2017), The El Ni√±o‚ÄìSouthern Oscillation effect on tropical outgoing longwave radiation: A daytime versus nighttime perspective, J. Geophys. Res. Atmos., 122, 7820‚Äì7833, <a class="reference external" href="https://doi.org/10.1002/2017JD027002" rel="noreferrer" target="_blank">https://doi.org/10.1002/2017JD027002</a></p>
<p><a class="reference external" href="https://doi.org/10.1073/pnas.1412190111" rel="noreferrer" target="_blank">[10]</a> Donohoe, A., Armour, K. C., Pendergrass, A. G., &amp; Battisti, D. S. (2014). Shortwave and longwave radiative contributions to global warming under increasing CO2. Proceedings of the National Academy of Sciences, 111(47), 16700-16705. <a class="reference external" href="https://doi.org/10.1073/pnas.1412190111" rel="noreferrer" target="_blank">https://doi.org/10.1073/pnas.1412190111</a></p>
<p><a class="reference external" href="https://doi.org/10.1175/JCLI3799.1" rel="noreferrer" target="_blank">[11]</a> Soden, B. J., and I. M. Held, 2006: An Assessment of Climate Feedbacks in Coupled Ocean‚ÄìAtmosphere Models. J. Climate, 19, 3354‚Äì3360, <a class="reference external" href="https://doi.org/10.1175/JCLI3799.1" rel="noreferrer" target="_blank">https://doi.org/10.1175/JCLI3799.1</a></p>
<p><a class="reference external" href="https://doi.org/10.1038/nclimate2876" rel="noreferrer" target="_blank">[12]</a> von Schuckmann, K., and Coauthors, 2016: An imperative to monitor Earth‚Äôs energy balance. Nat. Climate Change, 6, 138‚Äì144, <a class="reference external" href="https://doi.org/10.1038/nclimate2876" rel="noreferrer" target="_blank">https://doi.org/10.1038/nclimate2876</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Atmosphere_Physics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Atmosphere_Physics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.1. </span>Atmosphere Physics</p>
      </div>
    </a>
    <a class="right-next"
       href="../Atmospheric_Composition/Atmospheric_Composition.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.2. </span>Atmospheric Composition</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-consistency-assessment-of-earth-radiation-budget-products">üåç Use case: Consistency assessment of Earth Radiation Budget products</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#choose-the-data-to-use-and-setup-code">1. Choose the data to use and setup code</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform">2. Download and transform</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-weighted-means-and-anomaly-scatter-plots">3. Spatial weighted means and anomaly scatter plots</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-time-weighted-means">4. Plot time weighted means</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-spatial-weighted-zonal-means">5. Plot spatial weighted zonal means</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-applications">Discussion and applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>