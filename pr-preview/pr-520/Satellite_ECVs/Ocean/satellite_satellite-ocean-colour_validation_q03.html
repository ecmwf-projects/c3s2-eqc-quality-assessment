
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.6.1. Validation of ocean colour observations for harmful algal bloom application &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Ocean/satellite_satellite-ocean-colour_validation_q03';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Insitu Observations" href="../../In_Situ/insitu.html" />
    <link rel="prev" title="1.6. Ocean" href="Ocean.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Ocean.html">1.6. Ocean</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.6.1. Validation of ocean colour observations for harmful algal bloom application</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Ocean/satellite_satellite-ocean-colour_validation_q03.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Ocean/satellite_satellite-ocean-colour_validation_q03.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Validation of ocean colour observations for harmful algal bloom application</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-detection-of-harmful-algal-bloom">üåç Use case: <em>Detection of harmful algal bloom</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-code-and-choose-the-satellite-data-to-use">1. Set up the code and choose the satellite data to use</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">Import libraries</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-of-satellite-data-requests">Setup of satellite data requests</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-data-retrieval-and-computation-of-satellite-derived-indicators-of-habs">2. Satellite data retrieval and computation of satellite-derived indicators of HABs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-retrieval-and-filtering">Data retrieval and filtering</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#computation-of-satellite-derived-indicators-of-k-brevis-habs">Computation of satellite-derived indicators of <em>K. brevis</em> HABs</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-extraction-of-in-situ-k-brevis-cell-concentrations">3. Download and extraction of <em>in situ K. brevis</em> cell concentrations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">Download data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-filtering-and-subsetting">Data filtering and subsetting</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-and-in-situ-data-coupling-accuracy-assessment-and-result-visualisation-functions">4. Satellite and <em>in situ</em> data coupling, accuracy assessment, and result visualisation functions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-and-in-situ-data-coupling">Satellite and <em>in situ</em> data coupling</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy-metrics-function">Accuracy metrics function</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hab-non-hab-classification-and-accuracy-calculation">HAB/non-HAB classification and accuracy calculation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-for-result-visualisation">Functions for result visualisation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#display-and-discuss-results">5. Display and discuss results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#display-results">Display results</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#chlorophyll-anomaly-chl-anom">Chlorophyll anomaly (chl_anom)</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#particulate-backscattering-ratio-at-560-nm-bbp-560-ratio">Particulate backscattering ratio at 560 nm (bbp_560_ratio)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="validation-of-ocean-colour-observations-for-harmful-algal-bloom-application">
<h1><span class="section-number">1.6.1. </span>Validation of ocean colour observations for harmful algal bloom application<a class="headerlink" href="#validation-of-ocean-colour-observations-for-harmful-algal-bloom-application" title="Link to this heading">#</a></h1>
<p>Production Date: 15-11-2025<br />
Produced by: Chiara Volta (ENEA, Italy)</p>
<section id="use-case-detection-of-harmful-algal-bloom">
<h2>üåç Use case: <em>Detection of harmful algal bloom</em><a class="headerlink" href="#use-case-detection-of-harmful-algal-bloom" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>‚ùì Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<p><strong>How well do ocean colour observations detect <em>Karenia brevis</em> harmful bloom on the West Florida Shelf?</strong></p>
<p>The Ocean Colour dataset version 6.0, distributed by the Copernicus Climate Change Service (C3S), includes two variables: the chlorophyll-a mass concentration (chlor_a) and the remote sensing reflectance (Rrs) at six visible wavelengths, from October 1997 to the present <a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-ocean-colour/v6.0/WP2-FDDP-2022-04_C3S2-Lot3_PUGS-of-v6.0-OceanColour-product_v1.1_FINAL.pdf" rel="noreferrer" target="_blank">[1]</a>.<br />
Ocean colour observations have long supported the detection of algal blooms, enabling broader and more frequent coverage than in situ sampling <a class="reference external" href="https://link.springer.com/chapter/10.1007/978-1-4020-3100-7_12" rel="noreferrer" target="_blank">[2]</a> <a class="reference external" href="https://doi.org/10.1016/j.ecolind.2025.113244" rel="noreferrer" target="_blank">[3]</a>. Moreover, as harmful algal blooms (HABs) are expected to increase in frequency, intensity and duration due to both climatic and non-climatic drivers (e.g., increasing temperature, higher nutrient inputs from river runoff) <a class="reference external" href="https://www.ipcc.ch/srocc/chapter/chapter-5" rel="noreferrer" target="_blank">[4]</a>, these observations are increasingly valuable for environmental monitoring and decision-making.<br />
Here, the goal is to evaluate how accurately the Ocean Colour products can identify the HABs of <em>Karenia brevis</em> (<em>K. brevis</em>), a toxic dinoflagellate responsible for severe ecological and economic damage on the West Florida Shelf (WFS) <a class="reference external" href="https://doi.org/10.1007/s10646-008-0241-x" rel="noreferrer" target="_blank">[5]</a> <a class="reference external" href="https://doi.org/10.1016/j.fishres.2020.105678" rel="noreferrer" target="_blank">[6]</a> <a class="reference external" href="https://doi.org/10.1016/j.jenvman.2023.119811" rel="noreferrer" target="_blank">[7]</a>.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>The Ocean Colour dataset version 6.0 enables the calculation of two satellite-derived indicators that can be used to detect <em>Karenia brevis</em> bloom conditions on the West Florida Shelf: chlorophyll anomaly (chl_anom) and particulate backscattering ratio at 560 nm (bbp_560_ratio).</p></li>
<li><p>The two satellite-derived indicators achieve an overall accuracy above 60% against <em>in situ</em> observations for both <em>Karenia brevis</em> blooms and non-blooms conditions, with bbp_560_ratio outperforming chl_anom.</p></li>
<li><p>Sensitivity differs between the two indicators, with chl_anom more accurate in detecting <em>Karenia brevis</em> harmful blooms and bbp_560_ratio more accurate in detecting non-bloom waters.</p></li>
<li><p>The two satellite-derived indicators capture the spatial distribution of <em>Karenia brevis</em> harmful blooms, although moderate events or areas affected by non-algal particles may be misclassified.</p></li>
<li><p>The performance of the two indicators is strongly shaped by fixed thresholds, highlighting the need for regionally tuned or adaptive threshold strategies.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>This notebook provides an assessment of the ability of the Ocean Colour dataset version 6.0 to identify the HABs of <em>K. brevis</em> on the WFS. A daily HAB event analysed in a previous study <a class="reference external" href="https://doi.org/10.1016/j.hal.2022.102289" rel="noreferrer" target="_blank">[8]</a> is used as test case.<br />
The analysis follows the approach described in <a class="reference external" href="https://doi.org/10.1016/S1568-9883%2802%2900083-5" rel="noreferrer" target="_blank">[9]</a> and <a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a>, where chlor_a and Rrs at 560 nm data are used to calculate satellite-derived <em>K. brevis</em> HAB indicators: chlorophyll-a concentration anomaly (chl_anom) and total particulate backscattering ratio at 560 nm (bbp_560_ratio). The satellite-derived indicators are then compared with <em>in situ K. brevis</em> cell concentrations obtained from the Florida Fish and Wildlife Conservation Commission (FWC) Open Data portal to classify each pixel as a <em>K. brevis</em> bloom or non-bloom and to compute accuracy metrics that evaluate how effectively the satellite indicators detect bloom events.</p>
<p>The analysis and results are detailed in the sections below:</p>
<p><a class="reference internal" href="#satellite-satellite-ocean-colour-validation-q03-section-1"><span class="std std-ref">1. Set up the code and choose the satellite data to use</span></a></p>
<ul class="simple">
<li><p>Import libraries</p></li>
<li><p>Setup of satellite data requests</p></li>
</ul>
<p><a class="reference internal" href="#satellite-satellite-ocean-colour-validation-q03-section-2"><span class="std std-ref">2. Satellite data retrieval and computation of satellite-derived indicators of HABs</span></a></p>
<ul class="simple">
<li><p>Data retrieval and filtering</p></li>
<li><p>Computation of satellite-derived indicators of <em>K. brevis</em> HABs</p></li>
</ul>
<p><a class="reference internal" href="#satellite-satellite-ocean-colour-validation-q03-section-3"><span class="std std-ref">3. Download and extraction of in situ K. brevis cell concentrations</span></a></p>
<ul class="simple">
<li><p>Download data</p></li>
<li><p>Data filtering and subsetting</p></li>
</ul>
<p><a class="reference internal" href="#satellite-satellite-ocean-colour-validation-q03-section-4"><span class="std std-ref">4. Satellite and in situ data coupling, accuracy assessment, and result visualisation functions</span></a></p>
<ul class="simple">
<li><p>Satellite and <em>in situ</em> data coupling</p></li>
<li><p>Accuracy metrics function</p></li>
<li><p>HAB/non-HAB classification and accuracy calculation</p></li>
<li><p>Functions for result visualisation</p></li>
</ul>
<p><a class="reference internal" href="#satellite-satellite-ocean-colour-validation-q03-section-5"><span class="std std-ref">5. Display and discuss results</span></a></p>
<ul class="simple">
<li><p>Display results</p></li>
<li><p>Discussion</p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="set-up-the-code-and-choose-the-satellite-data-to-use">
<span id="satellite-satellite-ocean-colour-validation-q03-section-1"></span><h3>1. Set up the code and choose the satellite data to use<a class="headerlink" href="#set-up-the-code-and-choose-the-satellite-data-to-use" title="Link to this heading">#</a></h3>
<section id="import-libraries">
<h4>Import libraries<a class="headerlink" href="#import-libraries" title="Link to this heading">#</a></h4>
<p>Besides the standard libraries used for managing and visualising multidimensional arrays, the <a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom function</a> <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code> is imported to download satellite data. The <code class="docutils literal notranslate"><span class="pre">requests</span></code> and <code class="docutils literal notranslate"><span class="pre">datetime</span></code> modules are used to download and manage observed <em>K. brevis</em> cell concentrations from the FWC website, while  <code class="docutils literal notranslate"><span class="pre">Geod</span></code> and <code class="docutils literal notranslate"><span class="pre">confusion_matrix</span></code> are used to compare satellite and <em>in situ</em> data.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">download</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.feature</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cfeature</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyproj</span><span class="w"> </span><span class="kn">import</span> <span class="n">Geod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">FutureWarning</span><span class="p">)</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">UserWarning</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="setup-of-satellite-data-requests">
<h4>Setup of satellite data requests<a class="headerlink" href="#setup-of-satellite-data-requests" title="Link to this heading">#</a></h4>
<p>The analysis in this notebook uses satellite-derived chlor_a and Rrs at 560 nm data acquired during the HAB of <em>K. brevis</em> identified on 14th July 2014 over the WFS by <a class="reference external" href="https://doi.org/10.1016/j.hal.2022.102289" rel="noreferrer" target="_blank">[8]</a>, along with chlor_a data from the same area over the two-month period ending two weeks prior to the HAB event, which are required to calculate chlorophyll anomaly (see ‚ÄòComputation of satellite-derived indicators of <em>K. brevis</em> HABs‚Äô section below).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Client configuration</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CDSAPI_RC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/calmanti_sandro/.cdsapirc&quot;</span><span class="p">)</span>

<span class="c1"># Define region</span>
<span class="n">lon_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mf">85.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">81.5</span><span class="p">)</span>
<span class="n">lat_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mf">27.5</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">)</span>

<span class="c1"># # Set satellite data requests</span>
<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;satellite-ocean-colour&quot;</span>

<span class="n">request_event</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;mass_concentration_of_chlorophyll_a&quot;</span><span class="p">,</span> <span class="s2">&quot;remote_sensing_reflectance&quot;</span><span class="p">],</span>
    <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;regular_latitude_longitude_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2014&quot;</span><span class="p">],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;07&quot;</span><span class="p">],</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;30&quot;</span><span class="p">],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;6_0&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">requests_event</span> <span class="o">=</span> <span class="p">[</span><span class="n">request_event</span><span class="p">]</span>

<span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;mass_concentration_of_chlorophyll_a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;regular_latitude_longitude_grid&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;6_0&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">date</span> <span class="o">=</span> <span class="s2">&quot;2014-07-30&quot;</span>
<span class="n">stop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">date</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">weeks</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">months</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">requests_sat</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">request</span>
    <span class="o">|</span> <span class="p">{</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y&quot;</span><span class="p">),</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%m&quot;</span><span class="p">),</span>
        <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">),</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="satellite-data-retrieval-and-computation-of-satellite-derived-indicators-of-habs">
<span id="satellite-satellite-ocean-colour-validation-q03-section-2"></span><h3>2. Satellite data retrieval and computation of satellite-derived indicators of HABs<a class="headerlink" href="#satellite-data-retrieval-and-computation-of-satellite-derived-indicators-of-habs" title="Link to this heading">#</a></h3>
<section id="data-retrieval-and-filtering">
<h4>Data retrieval and filtering<a class="headerlink" href="#data-retrieval-and-filtering" title="Link to this heading">#</a></h4>
<p>Data for the daily HAB event and the two-month period required for the analysis are downloaded and organised into two separate datasets. Data are then filtered by retaining only measurements for which chlor_a falls within the valid range of 0.01‚Äì100 mg m<sup>-3</sup> <a class="reference external" href="https://doi.org/10.3390/s19194285" rel="noreferrer" target="_blank">[11]</a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_event</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">requests_event</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="n">lon_slice</span><span class="p">},</span>
    <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id</span><span class="p">,</span>
    <span class="n">requests_sat</span><span class="p">,</span>
    <span class="n">transform_func</span><span class="o">=</span><span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="n">lon_slice</span><span class="p">},</span>
    <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="computation-of-satellite-derived-indicators-of-k-brevis-habs">
<h4>Computation of satellite-derived indicators of <em>K. brevis</em> HABs<a class="headerlink" href="#computation-of-satellite-derived-indicators-of-k-brevis-habs" title="Link to this heading">#</a></h4>
<p>Two satellite-derived <em>K. brevis</em> HAB indicators are computed: chl_anom and bbp_560_ratio.<br />
The chl_anom is calculated as the difference between chlor_a values from the satellite image acquired during the daily HAB event (<a class="reference external" href="https://doi.org/10.1016/j.hal.2022.102289" rel="noreferrer" target="_blank">[8]</a>) and the mean over two months ending two weeks prior to the image, as outlined in <a class="reference external" href="https://doi.org/10.1016/S1568-9883%2802%2900083-5" rel="noreferrer" target="_blank">[9]</a>.<br />
The bbp_560_ratio is computed by adapting the equation for bbp ratio at 555 nm from <a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a>. This approach relies on the same assumption made by <a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a>, namely that the difference between Rrs at 555 nm and Rrs at 560 nm is negligible, and is motivated by the fact that Rrs at 555 nm is not available in the Ocean Colour dataset.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data filtering</span>
<span class="n">ds_chl_event</span> <span class="o">=</span> <span class="n">ds_event</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_event</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_event</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0e2</span><span class="p">))</span>
<span class="n">ds_Rrs_560_event</span> <span class="o">=</span> <span class="n">ds_event</span><span class="p">[</span><span class="s2">&quot;Rrs_560&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds_event</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds_event</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0e2</span><span class="p">))</span>
<span class="n">ds_chl</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">1.0e-2</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;chlor_a&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mf">1.0e2</span><span class="p">))</span>

<span class="c1"># chl_anom calculation</span>
<span class="n">chl_anom</span> <span class="o">=</span> <span class="n">ds_chl_event</span> <span class="o">-</span> <span class="n">ds_chl</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>

<span class="c1"># bbp_560_ratio calculation</span>
<span class="n">bbp_560_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mf">0.00182</span> <span class="o">+</span> <span class="p">(</span><span class="mf">2.058</span><span class="o">*</span><span class="n">ds_Rrs_560_event</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="mf">0.3</span><span class="o">*</span><span class="p">(</span><span class="n">ds_chl_event</span><span class="o">**</span><span class="mf">0.62</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mf">0.002</span><span class="o">+</span><span class="mf">0.02</span><span class="o">*</span><span class="p">(</span><span class="mf">0.5</span><span class="o">-</span><span class="mf">0.25</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ds_chl_event</span><span class="p">))))</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="download-and-extraction-of-in-situ-k-brevis-cell-concentrations">
<span id="satellite-satellite-ocean-colour-validation-q03-section-3"></span><h3>3. Download and extraction of <em>in situ K. brevis</em> cell concentrations<a class="headerlink" href="#download-and-extraction-of-in-situ-k-brevis-cell-concentrations" title="Link to this heading">#</a></h3>
<section id="download-data">
<h4>Download data<a class="headerlink" href="#download-data" title="Link to this heading">#</a></h4>
<p>Historical <em>K. brevis</em> cell concentrations from the FWC Open Data portal are retrieved using the FWC REST API. All available records from 2007 to 2014 are downloaded in batches to account for API limits.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">base_url</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;https://gis.myfwc.com/mapping/rest/services/Open_Data/&quot;</span>
    <span class="s2">&quot;Historic_Harmful_Algal_Bloom_Events_2007___2014/MapServer/6/query&quot;</span><span class="p">)</span>

<span class="n">all_records</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">step</span> <span class="o">=</span> <span class="mi">2000</span>

<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;where&quot;</span><span class="p">:</span> <span class="s2">&quot;1=1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;outFields&quot;</span><span class="p">:</span> <span class="s2">&quot;*&quot;</span><span class="p">,</span>
        <span class="s2">&quot;f&quot;</span><span class="p">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
        <span class="s2">&quot;resultOffset&quot;</span><span class="p">:</span> <span class="n">offset</span><span class="p">,</span>
        <span class="s2">&quot;resultRecordCount&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">,</span>
        <span class="s2">&quot;returnGeometry&quot;</span><span class="p">:</span> <span class="s2">&quot;false&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">feats</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;features&quot;</span><span class="p">,</span> <span class="p">[])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">feats</span><span class="p">:</span>
        <span class="k">break</span>
    <span class="n">all_records</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">f</span><span class="p">[</span><span class="s2">&quot;attributes&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">feats</span><span class="p">])</span>
    <span class="n">offset</span> <span class="o">+=</span> <span class="n">step</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_records</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;SAMPLE_DATE&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;SAMPLE_DATE&quot;</span><span class="p">],</span> <span class="n">unit</span><span class="o">=</span><span class="s2">&quot;ms&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="data-filtering-and-subsetting">
<h4>Data filtering and subsetting<a class="headerlink" href="#data-filtering-and-subsetting" title="Link to this heading">#</a></h4>
<p>The FWC dataset is filtered to include only positive <em>K. brevis</em> cell counts collected at shallow depths (‚â§2 m) over the WFS region. The resulting subset is used for subsequent analysis.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lat_max</span> <span class="o">=</span> <span class="mf">30.5</span>
<span class="n">lat_min</span> <span class="o">=</span> <span class="mf">27.5</span>
<span class="n">lon_max</span> <span class="o">=</span> <span class="o">-</span><span class="mf">81.5</span>
<span class="n">lon_min</span> <span class="o">=</span> <span class="o">-</span><span class="mf">85.5</span>

<span class="n">latitude_min</span><span class="p">,</span> <span class="n">latitude_max</span> <span class="o">=</span> <span class="n">lat_min</span><span class="p">,</span> <span class="n">lat_max</span> 
<span class="n">longitude_min</span><span class="p">,</span> <span class="n">longitude_max</span> <span class="o">=</span> <span class="n">lon_min</span><span class="p">,</span> <span class="n">lon_max</span> 

<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">latitude_min</span><span class="p">,</span> <span class="n">latitude_max</span><span class="p">))</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">between</span><span class="p">(</span><span class="n">longitude_min</span><span class="p">,</span> <span class="n">longitude_max</span><span class="p">))</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;DEPTH&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;COUNT_&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">df_filt</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="satellite-and-in-situ-data-coupling-accuracy-assessment-and-result-visualisation-functions">
<span id="satellite-satellite-ocean-colour-validation-q03-section-4"></span><h3>4. Satellite and <em>in situ</em> data coupling, accuracy assessment, and result visualisation functions<a class="headerlink" href="#satellite-and-in-situ-data-coupling-accuracy-assessment-and-result-visualisation-functions" title="Link to this heading">#</a></h3>
<section id="satellite-and-in-situ-data-coupling">
<h4>Satellite and <em>in situ</em> data coupling<a class="headerlink" href="#satellite-and-in-situ-data-coupling" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">extract_satellite_values</span></code> function is used to pair <em>in situ</em> measurements with satellite-derived data. For each <em>in situ</em> sample collected within ¬±7 days of the satellite image date, the function identifies the nearest valid satellite pixel only if <em>in situ</em> location is within the spatial resolution of the Ocean Colour dataset (‚âà 4km, <a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-ocean-colour/v6.0/WP2-FDDP-2022-04_C3S2-Lot3_PUGS-of-v6.0-OceanColour-product_v1.1_FINAL.pdf" rel="noreferrer" target="_blank">[1]</a>) <a class="reference external" href="https://doi.org/10.1016/j.hal.2022.102289" rel="noreferrer" target="_blank">[8]</a>. The resulting dataset contains only the coupled satellite‚Äì<em>in situ</em> pairs and is used for subsequent analysis of HAB indicators.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Function for satellite and in situ data coupling</span>
<span class="n">geod</span> <span class="o">=</span> <span class="n">Geod</span><span class="p">(</span><span class="n">ellps</span><span class="o">=</span><span class="s2">&quot;WGS84&quot;</span><span class="p">)</span>   
<span class="k">def</span><span class="w"> </span><span class="nf">extract_satellite_values</span><span class="p">(</span><span class="n">chl_anom</span><span class="p">,</span> <span class="n">bbp_560_ratio</span><span class="p">,</span> <span class="n">df_filt</span><span class="p">):</span>
    <span class="n">extracted</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">chl_anom</span><span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">chl_anom</span><span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">chl_anom</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df_filt</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="n">time_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">times</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;SAMPLE_DATE&quot;</span><span class="p">]))</span>
        <span class="k">if</span> <span class="n">time_diff</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">timedelta64</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s2">&quot;7D&quot;</span><span class="p">)):</span>
            <span class="k">continue</span> 
        <span class="n">nearest_time</span> <span class="o">=</span> <span class="n">times</span><span class="p">[</span><span class="n">time_diff</span><span class="o">.</span><span class="n">argmin</span><span class="p">()]</span>       
        <span class="n">sub_chl</span> <span class="o">=</span> <span class="n">chl_anom</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">nearest_time</span><span class="p">)</span>
        <span class="n">sub_bbp</span> <span class="o">=</span> <span class="n">bbp_560_ratio</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">nearest_time</span><span class="p">)</span>
        <span class="n">lat2d</span><span class="p">,</span> <span class="n">lon2d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">indexing</span><span class="o">=</span><span class="s2">&quot;ij&quot;</span><span class="p">)</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">lat2d</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">lat2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">d_m</span> <span class="o">=</span> <span class="n">geod</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">],</span> <span class="n">lon2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lat2d</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
                <span class="n">dist</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">d_m</span> <span class="o">/</span> <span class="mi">1000</span> 
        <span class="k">if</span> <span class="n">dist</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="k">continue</span>          
        <span class="n">i_min</span><span class="p">,</span> <span class="n">j_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">dist</span><span class="o">.</span><span class="n">argmin</span><span class="p">(),</span> <span class="n">dist</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">chl_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sub_chl</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">i_min</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">j_min</span><span class="p">))</span>
        <span class="n">bbp_val</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">sub_bbp</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="n">i_min</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=</span><span class="n">j_min</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">chl_val</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">bbp_val</span><span class="p">):</span>
            <span class="k">continue</span>
        <span class="n">extracted</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s2">&quot;date&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;SAMPLE_DATE&quot;</span><span class="p">],</span>
            <span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;LATITUDE&quot;</span><span class="p">],</span>
            <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;LONGITUDE&quot;</span><span class="p">],</span>
            <span class="s2">&quot;cell_count&quot;</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s2">&quot;COUNT_&quot;</span><span class="p">],</span>
            <span class="s2">&quot;chl_anomaly&quot;</span><span class="p">:</span> <span class="n">chl_val</span><span class="p">,</span>
            <span class="s2">&quot;bbp_ratio&quot;</span><span class="p">:</span> <span class="n">bbp_val</span>
        <span class="p">})</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">extracted</span><span class="p">)</span>
    
<span class="c1"># Satellite data extraction</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">extract_satellite_values</span><span class="p">(</span><span class="n">chl_anom</span><span class="p">,</span> <span class="n">bbp_560_ratio</span><span class="p">,</span> <span class="n">df_filt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="accuracy-metrics-function">
<h4>Accuracy metrics function<a class="headerlink" href="#accuracy-metrics-function" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">accuracy_metrics</span></code> function computes accuracy statistics from paired <em>in situ</em> and satellite observations. For each satellite-derived indicator, the function extracts the number of true positives (TP) and true negatives (TN), which represent cases where satellite predictions and <em>in situ</em> observations agree; false positives (FP) when blooms are predicted but not observed <em>in situ</em>; and false negatives (FN) when blooms are observed <em>in situ</em>  but not predicted. From these values, the function calculates the accuracy in correctly identifying <em>in situ</em> blooms and non-blooms, following the method described in <a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a>: HAB accuracy is defined as the proportion of correctly predicted blooms over the total number of HAB conditions (true and false) detected, while non-HAB accuracy represents the ratio between the number of non-HAB correctly predicted and the total number of non-HABs identified. The overall accuracy, defined as the proportion of correctly predicted data among all observations, is also provided.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Accuracy metrics function</span>
<span class="k">def</span><span class="w"> </span><span class="nf">accuracy_metrics</span><span class="p">(</span><span class="n">df_filt</span><span class="p">,</span> <span class="n">pred</span><span class="p">):</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">df_filt</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">user_bloom</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">user_nonbloom</span> <span class="o">=</span> <span class="n">tn</span> <span class="o">/</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="n">tn</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">overall</span> <span class="o">=</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">tn</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">user_bloom</span><span class="p">,</span> <span class="n">user_nonbloom</span><span class="p">,</span> <span class="n">overall</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="hab-non-hab-classification-and-accuracy-calculation">
<h4>HAB/non-HAB classification and accuracy calculation<a class="headerlink" href="#hab-non-hab-classification-and-accuracy-calculation" title="Link to this heading">#</a></h4>
<p>To classify <em>in situ</em> observations and satellite-derived indicators as bloom or non-bloom, the thresholds suggested by <a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a> are applied. An <em>in situ</em> sample is considered a <em>K. brevis</em> HAB if cell concentration is equal to or greater than 100000 cells/l. For the chl_anom and the bbp_560_ratio, values greater than 2 mg m‚Åª¬≥ and lower than 2, respectively, are classified as <em>K. brevis</em> HABs. Based on this classification, each satellite-derived indicator is compared with the <em>in situ</em> data to quantify its ability to identify <em>K. brevis</em> HABs and non-HABs.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define thresholds</span>
<span class="n">THRESHOLDS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;cell_count&quot;</span><span class="p">:</span> <span class="mi">100000</span><span class="p">,</span> 
    <span class="s2">&quot;chl_anomaly&quot;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span>  
    <span class="s2">&quot;bbp_ratio&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">}</span>

<span class="c1"># HAB/non-HAB classification</span>
<span class="n">merged</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;cell_count&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">THRESHOLDS</span><span class="p">[</span><span class="s2">&quot;cell_count&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">merged</span><span class="p">[</span><span class="s2">&quot;sat_bloom_chl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;chl_anomaly&quot;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">THRESHOLDS</span><span class="p">[</span><span class="s2">&quot;chl_anomaly&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">merged</span><span class="p">[</span><span class="s2">&quot;sat_bloom_bbp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;bbp_ratio&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">THRESHOLDS</span><span class="p">[</span><span class="s2">&quot;bbp_ratio&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Computation of accuracy metrics for each satellite-derived indicator</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">alg</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;sat_bloom_chl&quot;</span><span class="p">,</span> <span class="s2">&quot;sat_bloom_bbp&quot;</span><span class="p">]:</span>
    <span class="n">results</span><span class="p">[</span><span class="n">alg</span><span class="p">]</span> <span class="o">=</span> <span class="n">accuracy_metrics</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="n">alg</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="functions-for-result-visualisation">
<h4>Functions for result visualisation<a class="headerlink" href="#functions-for-result-visualisation" title="Link to this heading">#</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">print_confusion_details</span></code> function is used to summarise the number of true/false positives (TP/FP) and negatives (TN/FN) identified by the two satellite-derived indicators for table visualisation. The <code class="docutils literal notranslate"><span class="pre">classify_confusion</span></code> function is used to locate each paired <em>in situ</em>-satellite data point for map visualisation. See ‚ÄòDisplay results‚Äô section below.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Count confusion matrix elements</span>
<span class="k">def</span><span class="w"> </span><span class="nf">print_confusion_details</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">):</span>
    <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_true</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span>
<span class="n">tn_chl</span><span class="p">,</span> <span class="n">fp_chl</span><span class="p">,</span> <span class="n">fn_chl</span><span class="p">,</span> <span class="n">tp_chl</span> <span class="o">=</span> <span class="n">print_confusion_details</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;sat_bloom_chl&quot;</span><span class="p">])</span>
<span class="n">tn_bbp</span><span class="p">,</span> <span class="n">fp_bbp</span><span class="p">,</span> <span class="n">fn_bbp</span><span class="p">,</span> <span class="n">tp_bbp</span> <span class="o">=</span> <span class="n">print_confusion_details</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;sat_bloom_bbp&quot;</span><span class="p">])</span>

<span class="c1"># Mapping</span>
<span class="k">def</span><span class="w"> </span><span class="nf">classify_confusion</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">sat_col</span><span class="p">):</span>
    <span class="n">conditions</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">sat_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># TN</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">sat_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># FP</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">sat_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span>  <span class="c1"># FN</span>
        <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">sat_col</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">),</span>  <span class="c1"># TP</span>
    <span class="p">]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="s2">&quot;TP&quot;</span><span class="p">]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">sat_col</span><span class="si">}</span><span class="s2">_confusion&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="n">conditions</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
<span class="n">merged_chl</span> <span class="o">=</span> <span class="n">classify_confusion</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="s2">&quot;sat_bloom_chl&quot;</span><span class="p">)</span>
<span class="n">merged_bbp</span> <span class="o">=</span> <span class="n">classify_confusion</span><span class="p">(</span><span class="n">merged</span><span class="p">,</span> <span class="s2">&quot;sat_bloom_bbp&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="display-and-discuss-results">
<span id="satellite-satellite-ocean-colour-validation-q03-section-5"></span><h3>5. Display and discuss results<a class="headerlink" href="#display-and-discuss-results" title="Link to this heading">#</a></h3>
<section id="display-results">
<h4>Display results<a class="headerlink" href="#display-results" title="Link to this heading">#</a></h4>
<p>Two tables summarise the performance of the satellite-derived indicators against <em>in situ</em> observations. The first table indicate the number of true positives (TP), true negatives (TN), false positive (FP) and false negative (FN), as well as the total correctly and incorrectly classified observations and the total number of paired <em>in situ</em>-satellite observations. The second table reports the detection accuracies for each indicator, expressed as the percentage of correctly identified HABs and non-HABs, along with total accuracy.
Two maps are also provided to visually assess the spatial performance of each indicator. Here, <em>K. brevis</em> HABs observed <em>in situ</em> are overlaid on the chl_anom and bbp_560_ratio maps using coloured markers to indicate TP (green), FP (orange), TN (cyan) and FN (red).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display table for confusion matrix elements</span>
<span class="n">tn_chl</span><span class="p">,</span> <span class="n">fp_chl</span><span class="p">,</span> <span class="n">fn_chl</span><span class="p">,</span> <span class="n">tp_chl</span> <span class="o">=</span> <span class="n">print_confusion_details</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;sat_bloom_chl&quot;</span><span class="p">])</span>
<span class="n">tn_bbp</span><span class="p">,</span> <span class="n">fp_bbp</span><span class="p">,</span> <span class="n">fn_bbp</span><span class="p">,</span> <span class="n">tp_bbp</span> <span class="o">=</span> <span class="n">print_confusion_details</span><span class="p">(</span><span class="n">merged</span><span class="p">[</span><span class="s2">&quot;obs_bloom&quot;</span><span class="p">],</span> <span class="n">merged</span><span class="p">[</span><span class="s2">&quot;sat_bloom_bbp&quot;</span><span class="p">])</span>

<span class="n">rows</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;True Positive (TP)&quot;</span><span class="p">,</span> <span class="s2">&quot;True Negative (TN)&quot;</span><span class="p">,</span> <span class="s2">&quot;False Positive (FP)&quot;</span><span class="p">,</span> <span class="s2">&quot;False Negative (FN)&quot;</span><span class="p">,</span> <span class="s2">&quot;Correctly classified&quot;</span><span class="p">,</span> <span class="s2">&quot;Incorrectly Classified&quot;</span><span class="p">,</span> <span class="s2">&quot;Total&quot;</span><span class="p">]</span>
<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">tp_chl</span><span class="p">,</span> <span class="n">tp_bbp</span><span class="p">],</span>
    <span class="p">[</span><span class="n">tn_chl</span><span class="p">,</span> <span class="n">tn_bbp</span><span class="p">],</span>
    <span class="p">[</span><span class="n">fp_chl</span><span class="p">,</span> <span class="n">fp_bbp</span><span class="p">],</span>
    <span class="p">[</span><span class="n">fn_chl</span><span class="p">,</span> <span class="n">fn_bbp</span><span class="p">],</span>
    <span class="p">[(</span><span class="n">tp_chl</span><span class="o">+</span><span class="n">tn_chl</span><span class="p">),</span> <span class="p">(</span><span class="n">tp_bbp</span> <span class="o">+</span> <span class="n">tn_bbp</span><span class="p">)],</span>
    <span class="p">[(</span><span class="n">fp_chl</span><span class="o">+</span><span class="n">fn_chl</span><span class="p">),</span> <span class="p">(</span><span class="n">fp_bbp</span> <span class="o">+</span> <span class="n">fn_bbp</span><span class="p">)],</span>
    <span class="p">[(</span><span class="n">tp_chl</span> <span class="o">+</span> <span class="n">tn_chl</span> <span class="o">+</span> <span class="n">fp_chl</span> <span class="o">+</span> <span class="n">fn_chl</span><span class="p">),</span> <span class="p">(</span><span class="n">tp_bbp</span> <span class="o">+</span> <span class="n">tn_bbp</span> <span class="o">+</span> <span class="n">fp_bbp</span> <span class="o">+</span> <span class="n">fn_bbp</span><span class="p">)]</span>
<span class="p">]</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_tuples</span><span class="p">([</span>
    <span class="p">(</span><span class="s2">&quot;Satellite-derived indicator (counts):&quot;</span><span class="p">,</span> <span class="s2">&quot;chl_anom&quot;</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;Satellite-derived indicator (counts):&quot;</span><span class="p">,</span> <span class="s2">&quot;bbp_560_ratio&quot;</span><span class="p">)])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">rows</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">styled_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">style</span>
    <span class="o">.</span><span class="n">set_table_styles</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;15px&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;padding&#39;</span><span class="p">,</span> <span class="s1">&#39;5px&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;padding-right&#39;</span><span class="p">,</span> <span class="s1">&#39;50px&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;15px&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;padding&#39;</span><span class="p">,</span> <span class="s1">&#39;5px&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;padding-right&#39;</span><span class="p">,</span> <span class="s1">&#39;50px&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(5) th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-top&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(5) td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-top&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(1) th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-top&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(1) td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-top&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(7) th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-top&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(7) td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-top&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(7) th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(7) td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;border-bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;2px solid #cccccc&#39;</span><span class="p">)]}]))</span>
<span class="n">display</span><span class="p">(</span><span class="n">styled_table</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Display table for accuracy</span>
<span class="n">table_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">alg_to_indicator</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sat_bloom_chl&quot;</span><span class="p">:</span> <span class="s2">&quot;chl_anom&quot;</span><span class="p">,</span> <span class="s2">&quot;sat_bloom_bbp&quot;</span><span class="p">:</span> <span class="s2">&quot;bbp_560_ratio&quot;</span><span class="p">}</span>
<span class="k">for</span> <span class="n">alg</span><span class="p">,</span> <span class="p">(</span><span class="n">ua_b</span><span class="p">,</span> <span class="n">ua_nb</span><span class="p">,</span> <span class="n">oa</span><span class="p">)</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">table_data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">&quot;Satellite-derived indicator:&quot;</span><span class="p">:</span> <span class="n">alg_to_indicator</span><span class="p">[</span><span class="n">alg</span><span class="p">],</span>
        <span class="s2">&quot;HAB detection accuracy (%)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">ua_b</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">ua_b</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NaN&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;non-HAB detection accuracy (%)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">ua_nb</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">ua_nb</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NaN&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Total Accuracy (%)&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">round</span><span class="p">(</span><span class="n">oa</span><span class="o">*</span><span class="mi">100</span><span class="p">)</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="ow">not</span><span class="w"> </span><span class="n">pd</span><span class="o">.</span><span class="n">isna</span><span class="p">(</span><span class="n">oa</span><span class="p">)</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;NaN&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">})</span>
<span class="n">accuracy_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">table_data</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;Satellite-derived indicator:&quot;</span><span class="p">)</span>
<span class="n">styled_accuracy_table</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">accuracy_df</span><span class="o">.</span><span class="n">style</span>
    <span class="o">.</span><span class="n">set_table_styles</span><span class="p">([</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;th&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;15px&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;padding&#39;</span><span class="p">,</span> <span class="s1">&#39;10px&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;td&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;text-align&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;font-size&#39;</span><span class="p">,</span> <span class="s1">&#39;15px&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;padding&#39;</span><span class="p">,</span> <span class="s1">&#39;10px&#39;</span><span class="p">)]},</span>
        <span class="p">{</span><span class="s1">&#39;selector&#39;</span><span class="p">:</span> <span class="s1">&#39;tr:nth-child(1)&#39;</span><span class="p">,</span> <span class="s1">&#39;props&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;background-color&#39;</span><span class="p">,</span> <span class="s1">&#39;#f2f2f2&#39;</span><span class="p">)]}]))</span>
<span class="n">display</span><span class="p">(</span><span class="n">styled_accuracy_table</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">&quot;&lt;br&gt;&lt;br&gt;&lt;br&gt;&quot;</span><span class="p">))</span>

<span class="c1"># Display maps</span>
<span class="n">conf_colors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;TP&quot;</span><span class="p">:</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;FP&quot;</span><span class="p">:</span> <span class="s2">&quot;orange&quot;</span><span class="p">,</span> 
    <span class="s2">&quot;TN&quot;</span><span class="p">:</span> <span class="s2">&quot;cyan&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FN&quot;</span><span class="p">:</span> <span class="s2">&quot;red&quot;</span><span class="p">}</span>

<span class="n">conf_markers</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;TP&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FP&quot;</span><span class="p">:</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span>
    <span class="s2">&quot;TN&quot;</span><span class="p">:</span> <span class="s2">&quot;d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;FN&quot;</span><span class="p">:</span> <span class="s2">&quot;v&quot;</span><span class="p">}</span>

<span class="c1"># chl_anom-in situ data map</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()})</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">im1</span> <span class="o">=</span> <span class="p">(</span><span class="n">chl_anom</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">chl_anom</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;10m&quot;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">82</span><span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="s2">&quot;FN&quot;</span><span class="p">]:</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">merged_chl</span><span class="p">[</span><span class="n">merged_chl</span><span class="p">[</span><span class="s2">&quot;sat_bloom_chl_confusion&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">],</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">conf_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="n">conf_markers</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;chl_anom-based classification&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cbar1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">im1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
    <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
<span class="n">cbar1</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;chl_anom (mg m‚Åª¬≥)&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># bbp_560_ratio-in situ data map</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">im2</span> <span class="o">=</span> <span class="p">(</span><span class="n">bbp_560_ratio</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bbp_560_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span>
    <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;10m&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">85</span><span class="p">,</span> <span class="o">-</span><span class="mi">82</span><span class="p">,</span> <span class="mf">27.5</span><span class="p">,</span> <span class="mf">30.5</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="s2">&quot;FN&quot;</span><span class="p">]:</span>
    <span class="n">subset</span> <span class="o">=</span> <span class="n">merged_bbp</span><span class="p">[</span><span class="n">merged_bbp</span><span class="p">[</span><span class="s2">&quot;sat_bloom_bbp_confusion&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">],</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
        <span class="n">color</span><span class="o">=</span><span class="n">conf_colors</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
        <span class="n">marker</span><span class="o">=</span><span class="n">conf_markers</span><span class="p">[</span><span class="n">label</span><span class="p">],</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
        <span class="n">s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;bbp_560_ratio-based classification&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cbar2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
    <span class="n">im2</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
    <span class="n">fraction</span><span class="o">=</span><span class="mf">0.046</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>
<span class="n">cbar2</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s2">&quot;bbp_560_ratio [-]&quot;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># Add common legend</span>
<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="n">handles</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower center&quot;</span><span class="p">,</span>
    <span class="n">ncol</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">(</span><span class="n">rect</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
#T_5eb8d th {
  text-align: center;
  font-size: 15px;
  padding: 5px;
  padding-right: 50px;
}
#T_5eb8d td {
  text-align: center;
  font-size: 15px;
  padding: 5px;
  padding-right: 50px;
}
#T_5eb8d tr:nth-child(5) th {
  border-top: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(5) td {
  border-top: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(1) th {
  border-top: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(1) td {
  border-top: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(7) th {
  border-top: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(7) td {
  border-top: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(7) th {
  border-bottom: 2px solid #cccccc;
}
#T_5eb8d tr:nth-child(7) td {
  border-bottom: 2px solid #cccccc;
}
</style>
<table id="T_5eb8d">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_5eb8d_level0_col0" class="col_heading level0 col0" colspan="2">Satellite-derived indicator (counts):</th>
    </tr>
    <tr>
      <th class="blank level1" >&nbsp;</th>
      <th id="T_5eb8d_level1_col0" class="col_heading level1 col0" >chl_anom</th>
      <th id="T_5eb8d_level1_col1" class="col_heading level1 col1" >bbp_560_ratio</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_5eb8d_level0_row0" class="row_heading level0 row0" >True Positive (TP)</th>
      <td id="T_5eb8d_row0_col0" class="data row0 col0" >7</td>
      <td id="T_5eb8d_row0_col1" class="data row0 col1" >16</td>
    </tr>
    <tr>
      <th id="T_5eb8d_level0_row1" class="row_heading level0 row1" >True Negative (TN)</th>
      <td id="T_5eb8d_row1_col0" class="data row1 col0" >12</td>
      <td id="T_5eb8d_row1_col1" class="data row1 col1" >6</td>
    </tr>
    <tr>
      <th id="T_5eb8d_level0_row2" class="row_heading level0 row2" >False Positive (FP)</th>
      <td id="T_5eb8d_row2_col0" class="data row2 col0" >1</td>
      <td id="T_5eb8d_row2_col1" class="data row2 col1" >7</td>
    </tr>
    <tr>
      <th id="T_5eb8d_level0_row3" class="row_heading level0 row3" >False Negative (FN)</th>
      <td id="T_5eb8d_row3_col0" class="data row3 col0" >10</td>
      <td id="T_5eb8d_row3_col1" class="data row3 col1" >1</td>
    </tr>
    <tr>
      <th id="T_5eb8d_level0_row4" class="row_heading level0 row4" >Correctly classified</th>
      <td id="T_5eb8d_row4_col0" class="data row4 col0" >19</td>
      <td id="T_5eb8d_row4_col1" class="data row4 col1" >22</td>
    </tr>
    <tr>
      <th id="T_5eb8d_level0_row5" class="row_heading level0 row5" >Incorrectly Classified</th>
      <td id="T_5eb8d_row5_col0" class="data row5 col0" >11</td>
      <td id="T_5eb8d_row5_col1" class="data row5 col1" >8</td>
    </tr>
    <tr>
      <th id="T_5eb8d_level0_row6" class="row_heading level0 row6" >Total</th>
      <td id="T_5eb8d_row6_col0" class="data row6 col0" >30</td>
      <td id="T_5eb8d_row6_col1" class="data row6 col1" >30</td>
    </tr>
  </tbody>
</table>
</div><div class="output text_html"><br><br><br></div><div class="output text_html"><style type="text/css">
#T_c2aa2 th {
  text-align: center;
  font-size: 15px;
  padding: 10px;
}
#T_c2aa2 td {
  text-align: center;
  font-size: 15px;
  padding: 10px;
}
#T_c2aa2 tr:nth-child(1) {
  background-color: #f2f2f2;
}
</style>
<table id="T_c2aa2">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_c2aa2_level0_col0" class="col_heading level0 col0" >HAB detection accuracy (%)</th>
      <th id="T_c2aa2_level0_col1" class="col_heading level0 col1" >non-HAB detection accuracy (%)</th>
      <th id="T_c2aa2_level0_col2" class="col_heading level0 col2" >Total Accuracy (%)</th>
    </tr>
    <tr>
      <th class="index_name level0" >Satellite-derived indicator:</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_c2aa2_level0_row0" class="row_heading level0 row0" >chl_anom</th>
      <td id="T_c2aa2_row0_col0" class="data row0 col0" >88</td>
      <td id="T_c2aa2_row0_col1" class="data row0 col1" >55</td>
      <td id="T_c2aa2_row0_col2" class="data row0 col2" >63</td>
    </tr>
    <tr>
      <th id="T_c2aa2_level0_row1" class="row_heading level0 row1" >bbp_560_ratio</th>
      <td id="T_c2aa2_row1_col0" class="data row1 col0" >70</td>
      <td id="T_c2aa2_row1_col1" class="data row1 col1" >86</td>
      <td id="T_c2aa2_row1_col2" class="data row1 col2" >73</td>
    </tr>
  </tbody>
</table>
</div><div class="output text_html"><br><br><br></div><img alt="../../_images/1e0e5823554e4c288f77fa1c89dce20f02fffcd6c5a5366493760675b7ae6f60.png" src="../../_images/1e0e5823554e4c288f77fa1c89dce20f02fffcd6c5a5366493760675b7ae6f60.png" />
</div>
</div>
</section>
<section id="discussion">
<h4>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h4>
<section id="chlorophyll-anomaly-chl-anom">
<h5>Chlorophyll anomaly (chl_anom)<a class="headerlink" href="#chlorophyll-anomaly-chl-anom" title="Link to this heading">#</a></h5>
<p>Chl_anom achieves a total accuracy of 63%, correctly classifying 19 out of 30 paired <em>in situ</em>-satellite observations. Moreover, it correctly predicts 7 out of 9 <em>K. brevis</em> HABs observed <em>in situ</em> and 12 out of 22 observed non-HABs, resulting in HAB and non-HAB detection accuracy of 88% and 55%, respectively.<br />
The high HAB detection skill of chl_anom indicates that bloom conditions generally generate anomalies large enough to exceed the applied threshold, making this indicator sensitive to true <em>K. brevis</em> bloom events. However, results also reveal that some bloom-affected areas are misclassified as non-HABs of <em>K. brevis</em>, producing a relatively high number of false negatives. As shown in the classification map, these errors mainly occur near the edge of the bloom core, suggesting that moderate anomalies here may fall just below the chl_anom threshold applied.</p>
</section>
<section id="particulate-backscattering-ratio-at-560-nm-bbp-560-ratio">
<h5>Particulate backscattering ratio at 560 nm (bbp_560_ratio)<a class="headerlink" href="#particulate-backscattering-ratio-at-560-nm-bbp-560-ratio" title="Link to this heading">#</a></h5>
<p>Bbp_560_ratio achieves a higher total accuracy of 73%, correctly classifying 22 out of 30 paired <em>in situ</em>-satellite observations. Specifically, it correctly identifies 16 out of 23 <em>K. brevis</em> HABs observed <em>in situ</em> and 6 out of 7 non-HAB cases, corresponding to HAB and non-HAB detection accuracy of 70% and 86%, respectively.<br />
The high non-HAB accuracy indicates that bbp_560_ratio effectively captures the optical signature of non-bloom waters, reducing false alarms. But, its lower HAB detection skill suggests that some <em>K. brevis</em> blooms do not produce a sufficiently strong reduction in backscattering, likely when <em>K. brevis</em> cells are mixed with non-algal particles or other phytoplankton species <a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a>. However, its low false-negative rate highlights the potential value of this indicator for avoiding missed HAB events.</p>
<p>Overall, this assessment demonstrates that both chl_anom and bbp_560_ratio provide valuable yet complementary capabilities for satellite-based <em>K. brevis</em> HAB detection and suggests that combining information from the two indicators could improve overall HAB detection and reduce misclassification errors. Nonetheless, the performance of both indicators appears strongly shaped by their reliance on fixed thresholds, highlighting the need for regionally tuned or adaptive thresholds strategies. Detection skill could be further enhanced by including hyperspectral satellite data to develop species- or region-specific algorithms and/or applying machine-learning approaches that integrate multiple optical and environmental variables <a class="reference external" href="https://doi.org/10.3390/rs17040608" rel="noreferrer" target="_blank">[12]</a> <a class="reference external" href="https://doi.org/10.3390/rs13193863" rel="noreferrer" target="_blank">[13]</a>.</p>
</section>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>CDS catalogue entry used in this notebook is the <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-ocean-colour?tab=overview" rel="noreferrer" target="_blank">Ocean colour daily data from 1997 to present derived from satellite observations</a></p></li>
<li><p>Data download is from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-ocean-colour?tab=form" rel="noreferrer" target="_blank">CDS</a></p></li>
<li><p>Product Documentation is available on the <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-ocean-colour?tab=documentation" rel="noreferrer" target="_blank">CDS</a> website</p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>, prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
</ul>
<p>Further readings:</p>
<ul class="simple">
<li><p>Ocean Colour Monitoring Portals: <a class="reference external" href="https://marine.copernicus.eu/" rel="noreferrer" target="_blank">CMEMS</a>, <a class="reference external" href="https://hermes.acri.fr" rel="noreferrer" target="_blank">ESA-GlobColour Project</a>, <a class="reference external" href="https://climate.esa.int/en/projects/ocean-colour/" rel="noreferrer" target="_blank">ESA-OC-CCI</a>, <a class="reference external" href="https://sentiwiki.copernicus.eu/web/s3-mission" rel="noreferrer" target="_blank">ESA-Sentinel 3</a>, <a class="reference external" href="https://imos.org.au/facility/satellite-remote-sensing/ocean-colour" rel="noreferrer" target="_blank">IMOS</a>, <a class="reference external" href="https://oceancolor.gsfc.nasa.gov/#" rel="noreferrer" target="_blank">NASA</a>, <a class="reference external" href="https://coastwatch.noaa.gov/cwn/index.html" rel="noreferrer" target="_blank">NOAA CoastWatch</a>.</p></li>
<li><p>Use cases: <a class="reference external" href="https://user.eumetsat.int/search-view?sort=startDate%20desc&amp;amp;facets=%7B%22theme%22:%5B%22Marine%7COcean%20biogeochemistry%22%5D,%22contentTypes%22:%5B%22Resources%7CCase%20studies%22%5D%7D" rel="noreferrer" target="_blank">EUMETSAT</a>, <a class="reference external" href="https://climate.copernicus.eu/ocean" rel="noreferrer" target="_blank">C3S</a>.</p></li>
<li><p><a class="reference external" href="https://ioccg.org/" rel="noreferrer" target="_blank">International Ocean Colour Coordinating Group (IOCCG)</a>.</p></li>
<li><p><a class="reference external" href="https://haedat.iode.org/index.php" rel="noreferrer" target="_blank">Harmful Algae Event Database (HAEDAT)</a>.</p></li>
<li><p><a class="reference external" href="https://myfwc.com" rel="noreferrer" target="_blank">Florida Fish and Wildlife Conservation Commission</a>.</p></li>
<li><p>Groom, S., et al. (2019). <a class="reference external" href="https://www.frontiersin.org/journals/marine-science/articles/10.3389/fmars.2019.00485/full" rel="noreferrer" target="_blank">Satellite Ocean Colour: Current Status and Future Perspective</a>. Frontiers in Marine Science, 6.</p></li>
<li><p>IOCCG (2021). <a class="reference external" href="https://ioccg.org/wp-content/uploads/2021/05/ioccg_report_20-habs-2021-web.pdf" rel="noreferrer" target="_blank">Observation of Harmful Algal Blooms with Ocean Colour Radiometry</a>. Bernard, S., et al. (eds.), IOCCG Report Series, No. 20, International Ocean Colour Coordinating Group, Darthmouth, Canada.</p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-ocean-colour/v6.0/WP2-FDDP-2022-04_C3S2-Lot3_PUGS-of-v6.0-OceanColour-product_v1.1_FINAL.pdf" rel="noreferrer" target="_blank">[1]</a> Jackson, T., et al. (2023). C3S Ocean Colour Version 6.0: Product User Guide and Specification. Issue 1.1. E.U. Copernicus Climate Change Service. Document ref. WP2-FDDP-2022-04_C3S2-Lot3_PUGS-of-v6.0-OceanColour-product.</p>
<p><a class="reference external" href="https://link.springer.com/chapter/10.1007/978-1-4020-3100-7_12" rel="noreferrer" target="_blank">[2]</a> Stumpf, R.P., et al. (2007). Remote Sensing of Harmful Algal Blooms. In: Miller, R.L., et al. (eds.) Remote Sensing of Coastal Aquatic Environments. Remote Sensing and Digital Image Processing, vol. 7. Springer, Dordrecht, pp. 277-296.</p>
<p><a class="reference external" href="https://doi.org/10.1016/j.ecolind.2025.113244" rel="noreferrer" target="_blank">[3]</a> Caballero, C.B., et al. (2025). The need for advancing algal bloom forecasting using remote sensing and modeling: Progress and future directions. Ecological Indicators, 172.</p>
<p><a class="reference external" href="https://www.ipcc.ch/srocc/chapter/chapter-5" rel="noreferrer" target="_blank">[4]</a> Bindoff, N.L., et al. (2019). Changing Ocean, Marine Ecosystems, and Dependent Communities. In: IPCC Special Report on the Ocean and Cryosphere in a Changing Climate. H.-O. PoÃàrtner, et al. (eds.). Cambridge University Press, Cambridge, UK and New York, NY, USA, pp. 447-587.</p>
<p><a class="reference external" href="https://doi.org/10.1007/s10646-008-0241-x" rel="noreferrer" target="_blank">[5]</a> Pierce, R.H., and Henry, M.S. (2008). Harmful algal toxins of the Florida red tide (<em>Karenia Brevis</em>): natural chemical stressors in South Florida coastal ecosystems. Ecotoxicology 17, pp. 623-631.</p>
<p><a class="reference external" href="https://doi.org/10.1016/j.fishres.2020.105678" rel="noreferrer" target="_blank">[6]</a> B√©chard, A. (2020). Economics losses to fishery and seafood related businesses during harmful algal blooms. Fisheries Research, 230.</p>
<p><a class="reference external" href="https://doi.org/10.1016/j.jenvman.2023.119811" rel="noreferrer" target="_blank">[7]</a> Alvarez, S., et al. (2024). Non-linear impacts of harmful algae blooms on the coastal tourism economy. Journal of Environmental Management, 351.</p>
<p><a class="reference external" href="https://doi.org/10.1016/j.hal.2022.102289" rel="noreferrer" target="_blank">[8]</a> Hu, C., et al. (2022). <em>Karenia Brevis</em> bloom patterns on the west Florida shelf between 2003 and 2019: Integration of Field and satellite observations. Harmful Algae, 17, 102289.</p>
<p><a class="reference external" href="https://doi.org/10.1016/S1568-9883%2802%2900083-5" rel="noreferrer" target="_blank">[9]</a> Stumpf, R.P., et al. (2003). Monitoring <em>Karenia brevis</em> blooms in the Gulf of Mexico using satellite ocean colour imagery and other data. Harmful Algae, 2(2), pp. 147-160.</p>
<p><a class="reference external" href="https://doi.org/10.1016/j.rse.2008.11.003" rel="noreferrer" target="_blank">[10]</a> Tomlinson, M.C., et al. (2009). An evaluation of remote sensing techniques for enhanced detection of the toxic dinoflagellate, <em>Karenia brevis</em>. Remote Sensing of Environment, 113(3), 598-609.</p>
<p><a class="reference external" href="https://doi.org/10.3390/s19194285" rel="noreferrer" target="_blank">[11]</a> Sathyendranath, S., et al. (2019). An Ocean-Colour time series for use in climate studies: the experience of the Ocean-Colour Climate Change Initiative (OC-CCI). Sensors, 19, 4285.</p>
<p><a class="reference external" href="https://doi.org/10.3390/rs17040608" rel="noreferrer" target="_blank">[12]</a> Arias et al. (2025). Mapping Harmful Algae Blooms: The Potential of Hyperspectral Imaging Technologies. Remote Sensing, 17(4), 608.</p>
<p><a class="reference external" href="https://doi.org/10.3390/rs13193863" rel="noreferrer" target="_blank">[13]</a> Izadi et al. (2021). A Remote Sensing and Machine Learning-Based Approach to Forecast the Onset of Harmful Algal Bloom. Remote Sensing, 13(19), 3863.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Ocean"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Ocean.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.6. </span>Ocean</p>
      </div>
    </a>
    <a class="right-next"
       href="../../In_Situ/insitu.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Insitu Observations</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-detection-of-harmful-algal-bloom">üåç Use case: <em>Detection of harmful algal bloom</em></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-the-code-and-choose-the-satellite-data-to-use">1. Set up the code and choose the satellite data to use</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-libraries">Import libraries</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-of-satellite-data-requests">Setup of satellite data requests</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-data-retrieval-and-computation-of-satellite-derived-indicators-of-habs">2. Satellite data retrieval and computation of satellite-derived indicators of HABs</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-retrieval-and-filtering">Data retrieval and filtering</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#computation-of-satellite-derived-indicators-of-k-brevis-habs">Computation of satellite-derived indicators of <em>K. brevis</em> HABs</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-extraction-of-in-situ-k-brevis-cell-concentrations">3. Download and extraction of <em>in situ K. brevis</em> cell concentrations</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-data">Download data</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-filtering-and-subsetting">Data filtering and subsetting</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-and-in-situ-data-coupling-accuracy-assessment-and-result-visualisation-functions">4. Satellite and <em>in situ</em> data coupling, accuracy assessment, and result visualisation functions</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-and-in-situ-data-coupling">Satellite and <em>in situ</em> data coupling</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#accuracy-metrics-function">Accuracy metrics function</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#hab-non-hab-classification-and-accuracy-calculation">HAB/non-HAB classification and accuracy calculation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-for-result-visualisation">Functions for result visualisation</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#display-and-discuss-results">5. Display and discuss results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#display-results">Display results</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#chlorophyll-anomaly-chl-anom">Chlorophyll anomaly (chl_anom)</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#particulate-backscattering-ratio-at-560-nm-bbp-560-ratio">Particulate backscattering ratio at 560 nm (bbp_560_ratio)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>