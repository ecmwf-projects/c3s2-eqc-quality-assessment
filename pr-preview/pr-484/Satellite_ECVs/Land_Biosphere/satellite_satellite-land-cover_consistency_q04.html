
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.4.1. Satellite Land Cover consistency for Fire Management &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Land_Biosphere/satellite_satellite-land-cover_consistency_q04';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.5. Land Hydrology" href="../Land_Hydrology/Land_Hydrology.html" />
    <link rel="prev" title="1.4. Land Biosphere" href="Land_Biosphere.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Land_Biosphere.html">1.4. Land Biosphere</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.4.1. Satellite Land Cover consistency for Fire Management</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Land_Biosphere/satellite_satellite-land-cover_consistency_q04.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Land_Biosphere/satellite_satellite-land-cover_consistency_q04.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Satellite Land Cover consistency for Fire Management</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-using-land-cover-and-fire-products-to-monitor-post-fire-land-cover-changes">üåç Use case: Using land cover and fire products to monitor post-fire land cover changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-data-harmonisation">1. Download and Data Harmonisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-all-the-libraries-packages">Import all the libraries/packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-overview">Data Overview</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#land-cover-dataset"><strong>Land Cover Dataset</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-request-for-land-cover-dataset">Download request for land cover dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-function-for-land-cover-dataset">Download function for land cover dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#label-color-definition-and-class-correspondence-for-land-cover-dataset">Label Color Definition and Class Correspondence for Land Cover dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fire-dataset"><strong>Fire Dataset</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-request-for-fire-dataset">Download request for Fire dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-function-for-fire-dataset">Download function for Fire dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#harmonise-the-datasets-to-enable-correct-comparison"><strong>Harmonise the datasets to enable correct comparison</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#study-area"><strong>Study Area</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#clip-land-cover-and-fire-burned-area-datasets-to-amazon-boundaries">Clip land cover and fire burned area datasets to Amazon boundaries</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-satellite-land-cover-consistency-q04-code-section-2">2. Identification of Burned Areas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#land-cover-changes-between-20092012">3. Land Cover changes between 2009‚Äì2012</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-comparison-of-fire-and-land-cover-change">4. Cross-comparison of fire and land cover change</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#main-takeaways">5. Main-takeaways</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="satellite-land-cover-consistency-for-fire-management">
<h1><span class="section-number">1.4.1. </span>Satellite Land Cover consistency for Fire Management<a class="headerlink" href="#satellite-land-cover-consistency-for-fire-management" title="Link to this heading">#</a></h1>
<p>Production date: 22-10-2024</p>
<p>Produced by: In√™s Gir√£o (+ATLANTIC)</p>
<section id="use-case-using-land-cover-and-fire-products-to-monitor-post-fire-land-cover-changes">
<h2>üåç Use case: Using land cover and fire products to monitor post-fire land cover changes<a class="headerlink" href="#use-case-using-land-cover-and-fire-products-to-monitor-post-fire-land-cover-changes" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>‚ùì Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How consistent are Land Cover transitions with burned area signals?</strong></p></li>
</ul>
<p>Understanding the interaction between <strong>land cover change and fire disturbance</strong> is essential for assessing ecosystem dynamics, climate feedbacks, and landscape resilience. Both <strong>land cover</strong> and <strong>burned area</strong> are recognized as <em>Essential Climate Variables (ECVs)</em>, and their combined analysis provides valuable insights into the processes shaping terrestrial environments.</p>
<p>In this notebook, we use two complementary datasets distributed via the <a class="reference external" href="https://climate.copernicus.eu/" rel="noreferrer" target="_blank">Copernicus Climate Change Service (C3S)</a>:</p>
<ul class="simple">
<li><p>The <em><strong>Land Cover Classification Gridded Maps from 1992 to present derived from satellite observations</strong></em> (hereafter referred to as <strong>LC</strong>). These maps, produced at 300 m spatial resolution, describe annual land cover states and transitions across 22 global classes, following the FAO/UN Land Cover Classification System. The dataset ensures temporal consistency by integrating multiple Earth observation missions, including AVHRR, SPOT-VGT, PROBA-V, and Sentinel-3 OLCI/SLSTR, and is designed to support climate modelling and environmental monitoring.</p></li>
<li><p>The <em><strong>Fire burned area from 2001 to present derived from satellite observations</strong></em> (hereafter referred to as <strong>Fire</strong>),provides global burned area information. The product is based on MODIS surface reflectance and active fire detections and offers both <strong>pixel-level maps</strong> (250 m spatial resolution) with attributes such as date of the first detection, confidence level and land cover burned pixels and <strong>gridded products</strong> (0.25¬∞ resolution) with attributes such as burned area, standard error, fraction of obseserved and burnable area, number of patches and sum of burned area for each land cover category.</p></li>
</ul>
<p>This analysis focuses on evaluating the consistency between the LC dataset and the Fire dataset. Specifically, we will assess whether fire-related land cover transitions (e.g. forest to grassland, cropland to bare areas) detected in the LC maps are coherent with the burned area patterns reported by Fire. For this purpose, we selected the pixel product, as it provides the finest spatial detail (250 m). This makes it more suitable for direct comparison with the LC dataset at 300 m resolution, ensuring that fire signals can be analysed at aproximate scale and with explicit reference to land cover categories.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>The joint analysis of Fire and LC datasets reveals spatial associations between burned areas and subsequent land cover transitions, demonstrating the utility of cross-dataset integration for identifying post-disturbance patterns at regional scale.</p></li>
<li><p>Observed transitions (e.g., Forest  Agriculture, Forest  Grassland) are consistent with well-documented ecological trajectories and land-use pressures in the Amazon Basin.</p></li>
<li><p>The datasets are suitable for assessing the susceptibility of burned areas to longer-term land cover change, supporting analyses of ecosystem vulnerability and landscape-level fire impacts rather than short-term disturbance dynamics.</p></li>
<li><p>The LC product enforces a two-year persistence rule for transitions, such that only changes stable over consecutive years are recorded; short-lived or rapidly reversed post-fire changes are therefore excluded by design.This methodological constraint improves robustness against classification noise but limits the ability to detect immediate post-fire effects and early recovery processes.</p></li>
<li><p>Uncertainty related to cloud cover and sensor limitations primarily affects the burned-area product, which may result in under-detection or temporal imprecision of fire occurrence in persistently cloudy regions.</p></li>
<li><p>Consequently, while the combined products are appropriate for analysing long-term land-cover trajectories following fire, they are not sufficient for attributing rapid or fine-scale land-cover changes directly to individual fire events.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p><strong><a class="reference internal" href="#satellite-satellite-land-cover-consistency-q04-code-section-1"><span class="std std-ref">1. Download and Data Harmonisation</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-land-cover-consistency-q04-code-section-2"><span class="std std-ref">2. Identification of Burned Areas</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-land-cover-consistency-q04-code-section-3"><span class="std std-ref">3. Land Cover changes between 2009‚Äì2012</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-land-cover-consistency-q04-code-section-4"><span class="std std-ref">4. Cross-comparison of fire and land cover change</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-land-cover-consistency-q04-code-section-5"><span class="std std-ref">5. Main-takeaways</span></a></strong></p>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="download-and-data-harmonisation">
<span id="satellite-satellite-land-cover-consistency-q04-code-section-1"></span><h3>1. Download and Data Harmonisation<a class="headerlink" href="#download-and-data-harmonisation" title="Link to this heading">#</a></h3>
<p>Before we begin we must prepare our environment. This includes installing the Application Programming Interface (API) of the CDS, and importing the various python libraries that we will need.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CDSAPI_RC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;/data/wp5/girao_ines/.cdsapirc&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cdsapi</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">cdsapi</span><span class="o">.</span><span class="n">Client</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;‚úÖ Using CDS API config from girao_ines folder&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>‚úÖ Using CDS API config from girao_ines folder
</pre></div>
</div>
</div>
</div>
<section id="import-all-the-libraries-packages">
<h4>Import all the libraries/packages<a class="headerlink" href="#import-all-the-libraries-packages" title="Link to this heading">#</a></h4>
<p>We will be working with data in NetCDF format. To best handle this type of data we will use libraries for working with multidimensional arrays, in particular Xarray.
We will also need libraries for plotting and viewing data.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">geopandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">gpd</span> <span class="c1"># import vector geospatial data</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span> <span class="c1"># plot graphs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">patches</span> 
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span> <span class="c1"># perform trigonometric calculations</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shapely.geometry</span> <span class="c1"># work with geometric shapes</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">regionmask</span> <span class="c1"># transform attributes and geometries into specific regions</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span> 
<span class="kn">from</span><span class="w"> </span><span class="nn">shapely.vectorized</span><span class="w"> </span><span class="kn">import</span> <span class="n">contains</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">seaborn</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sns</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.colors</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mcolors</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dask.array</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">da</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">dask</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">MaxNLocator</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dask.diagnostics</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProgressBar</span>


<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span> <span class="c1"># predifined style of all graphical outputs</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="data-overview">
<h4>Data Overview<a class="headerlink" href="#data-overview" title="Link to this heading">#</a></h4>
<p>This study combines two satellite-based Essential Climate Variable (ECV) datasets from the <a class="reference external" href="https://cds.climate.copernicus.eu" rel="noreferrer" target="_blank">Copernicus Climate Data Store (CDS)</a> to investigate fire-related land cover transitions over the <strong>Amazon Basin</strong>.</p>
<hr class="docutils" />
<p><strong>1. Land Cover (LC) dataset</strong></p>
<p>The <em><strong>Land Cover Classification gridded maps from 1992 to present derived from satellite observations</strong></em> provide annual global maps at ~300 m spatial resolution (0.00278¬∞). Each map assigns one of <strong>22 global classes</strong> defined using the UN/FAO <strong>Land Cover Classification System (LCCS)</strong> (e.g., rainfed cropland, broadleaved forest, shrubland, grassland, urban areas, water bodies, permanent snow/ice).</p>
<p>The product is generated as a <strong>Level-4 dataset</strong> (derived geophysical variables) and is temporally consistent with the ESA Climate Change Initiative (CCI) Land Cover series (1992‚Äì2015). Annual updates from 2016 onwards are derived from Sentinel-3 OLCI/SLSTR, with backdating and updating using multi-sensor time series.</p>
<p>A key methodological feature  for this study is the <strong>‚Äútwo-year rule‚Äù</strong>, by which detected land cover changes must persist for at least two consecutive years before being confirmed. This rule avoids misclassifying temporary dynamics (e.g., seasonal vegetation cycles, short-term disturbances) as permanent transitions.</p>
<hr class="docutils" />
<p><strong>2. Fire burned area from 2001 to present derived from satellite observations dataset</strong></p>
<p>The <em><strong>Fire burned area from 2001 to present derived from satellite observations</strong></em> provides global burned area maps from 2001 onwards at <strong>250 m resolution</strong>. Two products are distributed:</p>
<ul class="simple">
<li><p><strong>Pixel product:</strong></p>
<ul>
<li><p><em>Date of first detection (Julian day)</em></p></li>
<li><p><em>Confidence level (0‚Äì100%)</em>, a per-pixel probability of correct burned detection</p></li>
<li><p><em>Land cover of burned pixels</em>, extracted from the ESA CCI LC dataset (v1.6.1)</p></li>
</ul>
</li>
<li><p><strong>Gridded product:</strong></p>
<ul>
<li><p>Sum of burned area,</p></li>
<li><p>Standard error (from pixel-level confidence aggregation),</p></li>
<li><p>Fraction of burnable and observed area,</p></li>
<li><p>Number of fire patches,</p></li>
<li><p>Burned area per vegetation class.</p></li>
</ul>
</li>
</ul>
<p>For this study, we select the <strong>pixel product</strong> because its spatial resolution is comparable to the LC dataset, enabling direct pixel-level consistency checks.</p>
<hr class="docutils" />
<p>This setup allows us to evaluate whether large fire events in the Amazon are reflected as persistent land cover transitions in the LC dataset. For illustration, we selected from the literature the year with the largest burned area in the Amazon Basin (2009) and used it as our example <a class="reference external" href="https://doi.org/10.3390/rs14020338" rel="noreferrer" target="_blank">(Silva Junior et al., 2022)</a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Years to download</span>
<span class="n">years_lc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2009</span><span class="p">,</span><span class="mi">2010</span><span class="p">,</span><span class="mi">2011</span><span class="p">,</span><span class="mi">2012</span><span class="p">]</span>
<span class="n">years_fire</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2009</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>At the end of the data request form on CDS, select <code class="docutils literal notranslate"><span class="pre">Show</span> <span class="pre">API</span> <span class="pre">request</span></code> to generate Python code, which can be pasted directly into a Jupyter Notebook cell. Running this cell will retrieve the requested files, provided that you have accepted the dataset‚Äôs <code class="docutils literal notranslate"><span class="pre">terms</span> <span class="pre">and</span> <span class="pre">conditions</span></code> on the CDS platform. It is advisable to define the desired time period and Area of Interest (AoI) explicitly when preparing the API request, as shown in the example cells below.</p>
</section>
<section id="land-cover-dataset">
<h4><strong>Land Cover Dataset</strong><a class="headerlink" href="#land-cover-dataset" title="Link to this heading">#</a></h4>
</section>
<section id="download-request-for-land-cover-dataset">
<h4>Download request for land cover dataset<a class="headerlink" href="#download-request-for-land-cover-dataset" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of requests to retrieve land cover data</span>
<span class="n">collection_id_lc</span> <span class="o">=</span> <span class="s2">&quot;satellite-land-cover&quot;</span>
<span class="n">request_lc</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;v2_0_7cds&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">2016</span> <span class="k">else</span> <span class="s2">&quot;v2_1_1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
        <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">82</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">]</span> <span class="c1"># Region of interest</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years_lc</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-function-for-land-cover-dataset">
<h4>Download function for land cover dataset<a class="headerlink" href="#download-function-for-land-cover-dataset" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download LC</span>
<span class="n">ds_lc</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id_lc</span><span class="p">,</span>
    <span class="n">request_lc</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/4 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 4/4 [00:00&lt;00:00,  4.58it/s]
/data/common/miniforge3/envs/wp5/lib/python3.12/site-packages/earthkit/data/readers/netcdf/fieldlist.py:202: FutureWarning: In a future version of xarray the default value for data_vars will change from data_vars=&#39;all&#39; to data_vars=None. This is likely to lead to different results when multiple datasets have matching variables with overlapping values. To opt in to new defaults and get rid of these warnings now use `set_options(use_new_combine_kwarg_defaults=True) or set data_vars explicitly.
  return xr.open_mfdataset(
</pre></div>
</div>
</div>
</div>
<p>Here we convert the <code class="docutils literal notranslate"><span class="pre">ds_lc</span> <span class="pre">dataset</span></code> that is indexed by a <code class="docutils literal notranslate"><span class="pre">time</span></code> coordinate into one indexed by <code class="docutils literal notranslate"><span class="pre">year</span></code>: it first adds a new coordinate <code class="docutils literal notranslate"><span class="pre">year</span></code> by extracting the calendar year from each timestamp in <code class="docutils literal notranslate"><span class="pre">time</span></code>, then replaces the <code class="docutils literal notranslate"><span class="pre">time</span></code> dimension with <code class="docutils literal notranslate"><span class="pre">year</span></code> across all variables and drops the original <code class="docutils literal notranslate"><span class="pre">time</span></code> variable. Use this when you have exactly one observation per year; if you have multiple timestamps within the same year (e.g., monthly or daily data), you should aggregate to unique years first (e.g., <code class="docutils literal notranslate"><span class="pre">groupby(&quot;time.year&quot;).mode()</span></code> for categorical variables), otherwise swapping dimensions will fail due to duplicate year labels and you‚Äôll lose sub-annual resolution.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Replace &#39;time&#39; with &#39;year&#39; as the main dimension</span>
<span class="n">ds_lc</span> <span class="o">=</span> <span class="n">ds_lc</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">ds_lc</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
<span class="n">ds_lc</span> <span class="o">=</span> <span class="n">ds_lc</span><span class="o">.</span><span class="n">swap_dims</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;year&quot;</span><span class="p">})</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="label-color-definition-and-class-correspondence-for-land-cover-dataset">
<h4>Label Color Definition and Class Correspondence for Land Cover dataset<a class="headerlink" href="#label-color-definition-and-class-correspondence-for-land-cover-dataset" title="Link to this heading">#</a></h4>
<p>To facilitate visual inspection of the Land Cover (LC) classes, we define a dictionary containing each class label (the ‚Äúkeys‚Äù), the corresponding color code (the ‚Äúcolors‚Äù), and the associated numeric identifier (the ‚Äúvalues‚Äù). In addition, we create a second dictionary to establish the correspondence between the original land cover classes provided in the metadata and the aggregated IPCC classes, as described in the Product User Guide (see resources).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define LC labels dictionary</span>
<span class="n">keys</span> <span class="o">=</span> <span class="n">ds_lc</span><span class="o">.</span><span class="n">lccs_class</span><span class="o">.</span><span class="n">flag_meanings</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">ds_lc</span><span class="o">.</span><span class="n">lccs_class</span><span class="o">.</span><span class="n">flag_colors</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">element</span> <span class="o">=</span> <span class="s2">&quot;#000000&quot;</span>
<span class="n">colors</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>
<span class="n">values</span> <span class="o">=</span> <span class="n">ds_lc</span><span class="o">.</span><span class="n">lccs_class</span><span class="o">.</span><span class="n">flag_values</span>

<span class="n">lccs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">keys</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">values</span><span class="p">)}</span>

<span class="c1"># Helper function to format the labels text</span>
<span class="k">def</span><span class="w"> </span><span class="nf">format_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">key</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>

<span class="n">lccs_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">format_key</span><span class="p">(</span><span class="n">key</span><span class="p">):</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">lccs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

<span class="c1"># Reverse mapping: code ‚Üí label (safe cast)</span>
<span class="n">code_to_label</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span> <span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">lccs_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define IPCC labels dictionary</span>
<span class="n">ipcc_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;No Data&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#000000&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
    <span class="s2">&quot;Agriculture&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#ffffcc&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">]),</span>
    <span class="s2">&quot;Forest&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#4c9900&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">170</span><span class="p">]),</span>
    <span class="s2">&quot;Grassland&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#ccff99&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="mi">130</span><span class="p">]),</span>
    <span class="s2">&quot;Settlement&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#ff0000&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">190</span><span class="p">]),</span>
    <span class="s2">&quot;Wetland&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#99ffff&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">180</span><span class="p">]),</span>
    <span class="s2">&quot;Other&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;#0000ff&quot;</span><span class="p">,</span> <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">121</span><span class="p">,</span> <span class="mi">122</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">151</span><span class="p">,</span> <span class="mi">152</span><span class="p">,</span> <span class="mi">153</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">201</span><span class="p">,</span> <span class="mi">202</span><span class="p">,</span> <span class="mi">210</span><span class="p">]),</span>
<span class="p">}</span>

<span class="c1"># Build a fast code -&gt; IPCC label map</span>
<span class="n">code_to_ipcc</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">_color</span><span class="p">,</span> <span class="n">codes</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ipcc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
        <span class="n">code_to_ipcc</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)]</span> <span class="o">=</span> <span class="n">label</span>

<span class="k">def</span><span class="w"> </span><span class="nf">label_for_code</span><span class="p">(</span><span class="n">c</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="c1"># Short label: &quot;Forest&quot; etc. If a code isn&#39;t in ipcc_dict, fall back gracefully.</span>
    <span class="k">return</span> <span class="n">code_to_ipcc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Class </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="fire-dataset">
<h4><strong>Fire Dataset</strong><a class="headerlink" href="#fire-dataset" title="Link to this heading">#</a></h4>
</section>
<section id="download-request-for-fire-dataset">
<h4>Download request for Fire dataset<a class="headerlink" href="#download-request-for-fire-dataset" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># List of requests to fire burned area data</span>
<span class="n">collection_id_fire</span> <span class="o">=</span> <span class="s2">&quot;satellite-fire-burned-area&quot;</span>
<span class="n">request_fire</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;esa_cci&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sensor&quot;</span><span class="p">:</span> <span class="s2">&quot;modis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;pixel_variables&quot;</span><span class="p">,</span>
        <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;5_1_1cds&quot;</span><span class="p">,</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;01&quot;</span><span class="p">,</span> <span class="s2">&quot;02&quot;</span><span class="p">,</span> <span class="s2">&quot;03&quot;</span><span class="p">,</span> <span class="s2">&quot;04&quot;</span><span class="p">,</span> <span class="s2">&quot;05&quot;</span><span class="p">,</span> <span class="s2">&quot;06&quot;</span><span class="p">,</span> <span class="s2">&quot;07&quot;</span><span class="p">,</span> <span class="s2">&quot;08&quot;</span><span class="p">,</span> <span class="s2">&quot;09&quot;</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span> <span class="s2">&quot;11&quot;</span><span class="p">,</span> <span class="s2">&quot;12&quot;</span><span class="p">],</span>
        <span class="s2">&quot;nominal_day&quot;</span><span class="p">:</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">),</span>
        <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;south_america&quot;</span><span class="p">]</span> <span class="c1"># Region of interest</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years_fire</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-function-for-fire-dataset">
<h4>Download function for Fire dataset<a class="headerlink" href="#download-function-for-fire-dataset" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download fire burned area data</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="n">collection_id_fire</span><span class="p">,</span>
    <span class="n">request_fire</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1"># 2) Spatial cut to Amazon</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">),</span> <span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">82</span><span class="p">,</span> <span class="o">-</span><span class="mi">34</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  0%|          | 0/1 [00:00&lt;?, ?it/s]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 1/1 [00:00&lt;00:00,  6.97it/s]
</pre></div>
</div>
</div>
</div>
<p>The following code cleans up the temporal dimension of the <code class="docutils literal notranslate"><span class="pre">ds_fire</span></code> dataset so that it has a consistent <strong>monthly index</strong>. It starts by creating a canonical month label using the <strong>start date</strong> from each <code class="docutils literal notranslate"><span class="pre">time_bounds</span></code> interval, ensuring that every timestamp is aligned to the first day of its month. It then removes duplicates by grouping on this new monthly label and keeping a single record per month (you can change the reducer‚Äîe.g. <code class="docutils literal notranslate"><span class="pre">mean</span></code>, <code class="docutils literal notranslate"><span class="pre">sum</span></code>, <code class="docutils literal notranslate"><span class="pre">max</span></code>‚Äîif you want a different way of combining duplicates). After that, it reindexes the dataset onto a <strong>continuous monthly timeline</strong> (<code class="docutils literal notranslate"><span class="pre">freq=&quot;MS&quot;</span></code>) from the first to the last available month, inserting <code class="docutils literal notranslate"><span class="pre">NaN</span></code>s where months are missing so that the gaps remain visible in analysis and plots. Finally, it adds simple integer <strong><code class="docutils literal notranslate"><span class="pre">year</span></code></strong> and <strong><code class="docutils literal notranslate"><span class="pre">month</span></code></strong> coordinates, making it easier to filter, group, or aggregate by calendar units.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1) Canonical monthly label from time_bounds (start of month)</span>
<span class="n">canon_time</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">time_bounds</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">bounds</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">canon_time</span><span class="o">.</span><span class="n">data</span><span class="p">))</span>

<span class="c1"># 2) Collapse duplicates that map to the same month (choose reducer as needed)</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="c1"># 3) (Optional) ensure complete monthly index over the span</span>
<span class="n">full</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">ds_fire</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                     <span class="n">ds_fire</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                     <span class="n">freq</span><span class="o">=</span><span class="s2">&quot;MS&quot;</span><span class="p">)</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">full</span><span class="p">)</span>

<span class="c1"># 4) Add clean year/month coords (NOTE the `.values` to give NumPy arrays)</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span>
    <span class="n">year</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">ds_fire</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
    <span class="n">month</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">ds_fire</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">month</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/data/common/miniforge3/envs/wp5/lib/python3.12/site-packages/dask/array/core.py:4997: PerformanceWarning: Increasing number of chunks by factor of 11
  result = blockwise(
/data/common/miniforge3/envs/wp5/lib/python3.12/site-packages/dask/array/core.py:4997: PerformanceWarning: Increasing number of chunks by factor of 11
  result = blockwise(
/data/common/miniforge3/envs/wp5/lib/python3.12/site-packages/dask/array/core.py:4997: PerformanceWarning: Increasing number of chunks by factor of 11
  result = blockwise(
</pre></div>
</div>
</div>
</div>
</section>
<section id="harmonise-the-datasets-to-enable-correct-comparison">
<h4><strong>Harmonise the datasets to enable correct comparison</strong><a class="headerlink" href="#harmonise-the-datasets-to-enable-correct-comparison" title="Link to this heading">#</a></h4>
<p>To align the land cover dataset with fire burned area dataset, the former is used as the target grid (higher spatial resolution), while the later is resampled using a nearest interpolation algorithm (since it is a categorical variable).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_grid</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">ds_fire</span><span class="o">.</span><span class="n">data_vars</span><span class="p">))</span>

<span class="c1"># Align all years for land cover</span>
<span class="n">lc_aligned</span> <span class="o">=</span> <span class="n">ds_lc</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">target_grid</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>

<span class="c1"># Rewrap into Dataset so you keep the same structure</span>
<span class="n">ds_lc_aligned</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">:</span> <span class="n">lc_aligned</span><span class="p">})</span>

<span class="c1"># Rechunk for performance</span>
<span class="n">ds_lc_aligned</span> <span class="o">=</span> <span class="n">ds_lc_aligned</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="study-area">
<h4><strong>Study Area</strong><a class="headerlink" href="#study-area" title="Link to this heading">#</a></h4>
<p>For this study the Amazon boudaries were selected according to the delimitation proposed by <a class="reference external" href="https://publications.jrc.ec.europa.eu/repository/handle/JRC68635" rel="noreferrer" target="_blank">Eva &amp; Ober (2005)</a>.</p>
<p>The Amazonia sensu stricto delimitation corresponds to the core subregion of the Amazon, and has been defined by the limit of the Amazon Basin in the north, the 700 m contour in the west and the lowland Amazon rainforest biome (before exploitation) in the south and south-east.</p>
</section>
<section id="clip-land-cover-and-fire-burned-area-datasets-to-amazon-boundaries">
<h4>Clip land cover and fire burned area datasets to Amazon boundaries<a class="headerlink" href="#clip-land-cover-and-fire-burned-area-datasets-to-amazon-boundaries" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shapefile_url</span> <span class="o">=</span> <span class="s2">&quot;https://forobs.jrc.ec.europa.eu/static/amazon/amazonia_boundary_proposal_Eva_2005.zip&quot;</span>
<span class="n">amazon</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">shapefile_url</span><span class="p">)</span><span class="o">.</span><span class="n">to_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">)</span>

<span class="c1"># keep only the target class</span>
<span class="n">target</span> <span class="o">=</span> <span class="s2">&quot;Amazonia - sensu stricto&quot;</span>
<span class="n">amazon</span> <span class="o">=</span> <span class="n">amazon</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">amazon</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span> <span class="o">==</span> <span class="n">target</span><span class="o">.</span><span class="n">casefold</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">minx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">amazon</span><span class="o">.</span><span class="n">total_bounds</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># For LC</span>
<span class="n">ds_lc_aligned</span> <span class="o">=</span> <span class="n">ds_lc_aligned</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_lc_aligned</span> <span class="o">=</span> <span class="n">ds_lc_aligned</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_spatial_dims</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_lc_aligned</span> <span class="o">=</span> <span class="n">ds_lc_aligned</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">ds_lc_aligned</span> <span class="o">=</span> <span class="n">ds_lc_aligned</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">maxy</span><span class="p">,</span> <span class="n">miny</span><span class="p">))</span>

<span class="c1"># For Fire</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">write_crs</span><span class="p">(</span><span class="s2">&quot;EPSG:4326&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">set_spatial_dims</span><span class="p">(</span><span class="n">x_dim</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="n">y_dim</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>
<span class="n">ds_fire</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">),</span> <span class="n">latitude</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">maxy</span><span class="p">,</span> <span class="n">miny</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sequence for clipping</span>
<span class="n">geoms</span> <span class="o">=</span> <span class="n">amazon</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">values</span>

<span class="n">ds_lc_amazon</span> <span class="o">=</span> <span class="n">ds_lc_aligned</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geoms</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">ds_fire_amazon</span> <span class="o">=</span> <span class="n">ds_fire</span><span class="o">.</span><span class="n">rio</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">geoms</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The goal of this analysis is to evaluate the <strong>consistency between detected fire disturbances and land cover transitions</strong> over the Amazon Basin. By focusing on the year 2009, a period of unusually high burned area extent in the region, we can test whether large fire events are reflected as persistent land cover changes in subsequent years (2010‚Äì2012).</p>
<p>Our approach is structured in the following steps:</p>
<ul class="simple">
<li><p><strong>Identification of burned areas</strong></p>
<ul>
<li><p>Use the pixel product attributes (<em>date of first detection</em>, <em>confidence level</em>, <em>land cover of burned pixels</em>) to map burned areas for 2009.</p></li>
<li><p>Apply filtering based on confidence thresholds to ensure reliable detection.</p></li>
</ul>
</li>
<li><p><strong>Detection of land cover transitions</strong></p>
<ul>
<li><p>Analyse LC changes between 2009 and subsequent years (2010‚Äì2012).</p></li>
<li><p>Apply the ‚Äútwo-year rule‚Äù to confirm transitions</p></li>
</ul>
</li>
<li><p><strong>Cross-comparison of fire and land cover change</strong></p>
<ul>
<li><p>Overlay burned area pixels with LC transitions to assess spatial agreement.</p></li>
<li><p>Evaluate whether burned areas correspond to expected land cover changes in the LC dataset.</p></li>
<li><p>Identify mismatches (e.g., fires detected without subsequent LC change, or LC change without detected fire).</p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="satellite-satellite-land-cover-consistency-q04-code-section-2">
<span id="identification-of-burned-areas"></span><h3>2. Identification of Burned Areas<a class="headerlink" href="#satellite-satellite-land-cover-consistency-q04-code-section-2" title="Link to this heading">#</a></h3>
<p>The first step in our analysis is to identify the spatial extent of burned areas in 2009 using the Fire dataset pixel product-</p>
<p>This dataset provides three key layers for each month:</p>
<ul class="simple">
<li><p><strong>JD (Julian Day of first detection)</strong> ‚Äì indicates the day of year (1‚Äì366) when the pixel was detected as burned.</p></li>
<li><p><strong>CL (Confidence Level)</strong> ‚Äì a per-pixel probability (0‚Äì100) that the burned classification is correct.</p></li>
<li><p><strong>LC (Land Cover of burned pixel)</strong> ‚Äì the land cover type affected by fire, derived from the CCI Land Cover map.</p></li>
</ul>
<p>Not all burned detections are equally reliable. For example:</p>
<ul class="simple">
<li><p>Pixels with <strong>low confidence values (&lt;50%)</strong> may be false detections caused by cloud shadows or noise.</p></li>
<li><p>Pixels with <strong>high confidence values (‚â•80%)</strong> are more trustworthy, but some real fires may be missed if we filter too strictly.</p></li>
</ul>
<p>Therefore, we apply different <strong>confidence thresholds</strong> to evaluate how they affect the estimation of total burned pixels. This helps illustrate the trade-off between <strong>coverage</strong> and <strong>certainty</strong>.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jd</span> <span class="o">=</span> <span class="n">ds_fire_amazon</span><span class="p">[</span><span class="s2">&quot;JD&quot;</span><span class="p">]</span>   <span class="c1"># date of first detection</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">ds_fire_amazon</span><span class="p">[</span><span class="s2">&quot;CL&quot;</span><span class="p">]</span>   <span class="c1"># confidence level</span>

<span class="c1"># A pixel is burned if JD &gt; 0</span>
<span class="n">burned</span> <span class="o">=</span> <span class="n">jd</span> <span class="o">&gt;</span> <span class="mi">0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">burned_area_mask</span><span class="p">(</span><span class="n">threshold</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">burned</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">cl</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span>

<span class="n">thresholds</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">95</span><span class="p">]</span>
<span class="n">burned_area_counts</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">:</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="n">burned_area_mask</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">burned_pixels</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
    <span class="n">burned_area_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">burned_pixels</span><span class="p">)</span>

<span class="c1"># Plot results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">thresholds</span><span class="p">],</span> <span class="n">burned_area_counts</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Number of burned pixels&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Confidence Threshold (%)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/18e738b097a063685f9e2dfd5b966ff733287a8cd4450cf53a2590dfb2b54020.png" src="../../_images/18e738b097a063685f9e2dfd5b966ff733287a8cd4450cf53a2590dfb2b54020.png" />
</div>
</div>
<p>The plot shows how the estimated burned area for 2009 in the Amazon Basin decreases as the <strong>confidence threshold</strong> increases.</p>
<ul class="simple">
<li><p>At <strong>0%</strong>, all detections are included, resulting in ~65,000 burned pixels. This maximizes coverage but almost certainly includes false detections caused by noise, shadows, or algorithm uncertainties.</p></li>
<li><p>At <strong>50%</strong>, the total decreases to ~60,000 pixels, excluding the most uncertain detections but still keeping a relatively broad estimate.</p></li>
<li><p>At <strong>80%</strong>, the number drops further to ~52,000 pixels. At this level, we retain only those detections where the algorithm indicates high certainty.</p></li>
<li><p>At <strong>95%</strong>, the burned area falls to ~40,000 pixels, which is highly reliable but risks excluding a substantial portion of real fires.</p></li>
</ul>
<p>Given that the <strong>objective of this notebook is to assess whether detected fire disturbances correspond to persistent land cover transitions</strong>, we require a balance between reliability and coverage:</p>
<ul class="simple">
<li><p>Using <strong>too low a threshold</strong> may introduce noise that could falsely suggest land cover transitions.</p></li>
<li><p>Using <strong>too high a threshold</strong> may miss true fires, leading us to incorrectly conclude that some LC changes occurred without fire.</p></li>
</ul>
<p>For this reason, we adopt a <strong>confidence threshold of 80%</strong> as a <strong>reasonable compromise</strong>, ensuring that burned area detections are reliable while still capturing a substantial fraction of actual fire events.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Boolean mask: keep only detections with CL ‚â• 80</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">ds_fire_amazon</span><span class="p">[</span><span class="s2">&quot;CL&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">80</span>

<span class="c1"># Apply the mask to ALL variables in the dataset</span>
<span class="n">ds_fire_amazon</span><span class="o">=</span> <span class="n">ds_fire_amazon</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="land-cover-changes-between-20092012">
<span id="satellite-satellite-land-cover-consistency-q04-code-section-3"></span><h3>3. Land Cover changes between 2009‚Äì2012<a class="headerlink" href="#land-cover-changes-between-20092012" title="Link to this heading">#</a></h3>
<p>To evaluate the consistency between fire disturbances and land cover data, we first need to establish how land cover classes evolve over time. A good starting point is to describe the distribution of land cover classes in the Amazon for each year of interest (2009‚Äì2012).</p>
<p>The table below reports, for each class, the <strong>absolute number of pixels, their percentage of the total area, and year-to-2009 differences</strong>. This provides a baseline view of land cover stability and gradual changes.</p>
<p>In addition, we use a <strong>transition matrix</strong> to capture how pixels move between classes from 2009 to 2012. This allows us to complement the overall distributions with a more detailed perspective on stability (pixels that remain in the same class) versus change (pixels transitioning between classes).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2011</span><span class="p">,</span> <span class="mi">2012</span><span class="p">]</span>
<span class="n">ipcc_groups</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ipcc_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># desired class order</span>

<span class="n">records_counts</span><span class="p">,</span> <span class="n">records_perc</span> <span class="o">=</span> <span class="p">{},</span> <span class="p">{}</span>

<span class="c1"># Pre-compute all possible LC codes</span>
<span class="n">all_codes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">flag_values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

<span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">years</span><span class="p">:</span>
    <span class="c1"># Select year lazily</span>
    <span class="n">lc_year</span> <span class="o">=</span> <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year</span><span class="p">)</span>

    <span class="c1"># Histogram of codes (no .values, stays on dask until compute)</span>
    <span class="n">hist</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span>
        <span class="n">lc_year</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">all_codes</span><span class="p">),</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">all_codes</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">all_codes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">counts_arr</span> <span class="o">=</span> <span class="n">hist</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="c1"># Build dict: code ‚Üí count</span>
    <span class="n">code_counts</span> <span class="o">=</span> <span class="p">{</span><span class="nb">int</span><span class="p">(</span><span class="n">code</span><span class="p">):</span> <span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">all_codes</span><span class="p">,</span> <span class="n">counts_arr</span><span class="p">)}</span>

    <span class="c1"># Map to IPCC groups</span>
    <span class="n">group_counts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">code_counts</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">group</span> <span class="o">=</span> <span class="n">code_to_ipcc</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="s2">&quot;No Data&quot;</span><span class="p">)</span>
        <span class="n">group_counts</span><span class="p">[</span><span class="n">group</span><span class="p">]</span> <span class="o">=</span> <span class="n">group_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="n">count</span>

    <span class="c1"># Pandas Series aligned to ipcc_groups</span>
    <span class="n">s_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">group_counts</span><span class="p">)</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">ipcc_groups</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">s_perc</span>   <span class="o">=</span> <span class="n">s_counts</span> <span class="o">/</span> <span class="n">s_counts</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">records_counts</span><span class="p">[</span><span class="n">year</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_counts</span>
    <span class="n">records_perc</span><span class="p">[</span><span class="n">year</span><span class="p">]</span>   <span class="o">=</span> <span class="n">s_perc</span>

<span class="c1"># --- Assemble DataFrames ---</span>
<span class="n">df_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">records_counts</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">df_perc</span>   <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">records_perc</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
<span class="n">df_counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Year&quot;</span>
<span class="n">df_perc</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span>   <span class="o">=</span> <span class="s2">&quot;Year&quot;</span>

<span class="c1"># Change vs baseline year</span>
<span class="n">df_dcount</span> <span class="o">=</span> <span class="n">df_counts</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">df_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2009</span><span class="p">])</span>
<span class="n">df_dperc</span>  <span class="o">=</span> <span class="n">df_perc</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">df_perc</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2009</span><span class="p">])</span>

<span class="c1"># MultiIndex table: Class ‚Üí (Count, Percent, ŒîCount, Œî%)</span>
<span class="n">wide_metric_first</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;Count&quot;</span><span class="p">:</span> <span class="n">df_counts</span><span class="p">,</span> <span class="s2">&quot;Percent&quot;</span><span class="p">:</span> <span class="n">df_perc</span><span class="p">,</span> <span class="s2">&quot;ŒîCount&quot;</span><span class="p">:</span> <span class="n">df_dcount</span><span class="p">,</span> <span class="s2">&quot;Œî%&quot;</span><span class="p">:</span> <span class="n">df_dperc</span><span class="p">},</span>
    <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Reorder: Class first, Metric second</span>
<span class="n">wide_by_class</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">wide_metric_first</span>
    <span class="o">.</span><span class="n">swaplevel</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># Drop &quot;No Data&quot;</span>
<span class="n">display_classes</span> <span class="o">=</span> <span class="p">[</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">ipcc_groups</span> <span class="k">if</span> <span class="n">g</span> <span class="o">!=</span> <span class="s2">&quot;No Data&quot;</span><span class="p">]</span>
<span class="n">metric_order</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span><span class="s2">&quot;ŒîCount&quot;</span><span class="p">,</span><span class="s2">&quot;Œî%&quot;</span><span class="p">]</span>

<span class="n">wide_no_nodata</span> <span class="o">=</span> <span class="n">wide_by_class</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">wide_by_class</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">get_level_values</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">display_classes</span><span class="p">)]</span>
<span class="n">wide_no_nodata</span> <span class="o">=</span> <span class="n">wide_no_nodata</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span>
    <span class="n">columns</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">MultiIndex</span><span class="o">.</span><span class="n">from_product</span><span class="p">([</span><span class="n">display_classes</span><span class="p">,</span> <span class="n">metric_order</span><span class="p">])</span>
<span class="p">)</span>

<span class="c1"># Pretty formatting</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_fmt</span><span class="p">(</span><span class="n">st</span><span class="p">):</span>
    <span class="n">fmtd</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="bp">cls</span> <span class="ow">in</span> <span class="n">display_classes</span><span class="p">:</span>
        <span class="n">fmtd</span><span class="p">[(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;Count&quot;</span><span class="p">)]</span>   <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:,}</span><span class="s2">&quot;</span>
        <span class="n">fmtd</span><span class="p">[(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;Percent&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:.2f}</span><span class="s2">&quot;</span>
        <span class="n">fmtd</span><span class="p">[(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;ŒîCount&quot;</span><span class="p">)]</span>  <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:+,}</span><span class="s2">&quot;</span>
        <span class="n">fmtd</span><span class="p">[(</span><span class="bp">cls</span><span class="p">,</span> <span class="s2">&quot;Œî%&quot;</span><span class="p">)]</span>      <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:+.2f}</span><span class="s2">&quot;</span>
    <span class="k">return</span> <span class="n">st</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fmtd</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">_fmt</span><span class="p">(</span><span class="n">wide_no_nodata</span><span class="o">.</span><span class="n">style</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_e0410">
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e0410_level0_col0" class="col_heading level0 col0" colspan="4">Agriculture</th>
      <th id="T_e0410_level0_col4" class="col_heading level0 col4" colspan="4">Forest</th>
      <th id="T_e0410_level0_col8" class="col_heading level0 col8" colspan="4">Grassland</th>
      <th id="T_e0410_level0_col12" class="col_heading level0 col12" colspan="4">Settlement</th>
      <th id="T_e0410_level0_col16" class="col_heading level0 col16" colspan="4">Wetland</th>
      <th id="T_e0410_level0_col20" class="col_heading level0 col20" colspan="4">Other</th>
    </tr>
    <tr>
      <th class="blank level1" >&nbsp;</th>
      <th id="T_e0410_level1_col0" class="col_heading level1 col0" >Count</th>
      <th id="T_e0410_level1_col1" class="col_heading level1 col1" >Percent</th>
      <th id="T_e0410_level1_col2" class="col_heading level1 col2" >ŒîCount</th>
      <th id="T_e0410_level1_col3" class="col_heading level1 col3" >Œî%</th>
      <th id="T_e0410_level1_col4" class="col_heading level1 col4" >Count</th>
      <th id="T_e0410_level1_col5" class="col_heading level1 col5" >Percent</th>
      <th id="T_e0410_level1_col6" class="col_heading level1 col6" >ŒîCount</th>
      <th id="T_e0410_level1_col7" class="col_heading level1 col7" >Œî%</th>
      <th id="T_e0410_level1_col8" class="col_heading level1 col8" >Count</th>
      <th id="T_e0410_level1_col9" class="col_heading level1 col9" >Percent</th>
      <th id="T_e0410_level1_col10" class="col_heading level1 col10" >ŒîCount</th>
      <th id="T_e0410_level1_col11" class="col_heading level1 col11" >Œî%</th>
      <th id="T_e0410_level1_col12" class="col_heading level1 col12" >Count</th>
      <th id="T_e0410_level1_col13" class="col_heading level1 col13" >Percent</th>
      <th id="T_e0410_level1_col14" class="col_heading level1 col14" >ŒîCount</th>
      <th id="T_e0410_level1_col15" class="col_heading level1 col15" >Œî%</th>
      <th id="T_e0410_level1_col16" class="col_heading level1 col16" >Count</th>
      <th id="T_e0410_level1_col17" class="col_heading level1 col17" >Percent</th>
      <th id="T_e0410_level1_col18" class="col_heading level1 col18" >ŒîCount</th>
      <th id="T_e0410_level1_col19" class="col_heading level1 col19" >Œî%</th>
      <th id="T_e0410_level1_col20" class="col_heading level1 col20" >Count</th>
      <th id="T_e0410_level1_col21" class="col_heading level1 col21" >Percent</th>
      <th id="T_e0410_level1_col22" class="col_heading level1 col22" >ŒîCount</th>
      <th id="T_e0410_level1_col23" class="col_heading level1 col23" >Œî%</th>
    </tr>
    <tr>
      <th class="index_name level0" >Year</th>
      <th class="blank col0" >&nbsp;</th>
      <th class="blank col1" >&nbsp;</th>
      <th class="blank col2" >&nbsp;</th>
      <th class="blank col3" >&nbsp;</th>
      <th class="blank col4" >&nbsp;</th>
      <th class="blank col5" >&nbsp;</th>
      <th class="blank col6" >&nbsp;</th>
      <th class="blank col7" >&nbsp;</th>
      <th class="blank col8" >&nbsp;</th>
      <th class="blank col9" >&nbsp;</th>
      <th class="blank col10" >&nbsp;</th>
      <th class="blank col11" >&nbsp;</th>
      <th class="blank col12" >&nbsp;</th>
      <th class="blank col13" >&nbsp;</th>
      <th class="blank col14" >&nbsp;</th>
      <th class="blank col15" >&nbsp;</th>
      <th class="blank col16" >&nbsp;</th>
      <th class="blank col17" >&nbsp;</th>
      <th class="blank col18" >&nbsp;</th>
      <th class="blank col19" >&nbsp;</th>
      <th class="blank col20" >&nbsp;</th>
      <th class="blank col21" >&nbsp;</th>
      <th class="blank col22" >&nbsp;</th>
      <th class="blank col23" >&nbsp;</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e0410_level0_row0" class="row_heading level0 row0" >2009</th>
      <td id="T_e0410_row0_col0" class="data row0 col0" >7,135,728</td>
      <td id="T_e0410_row0_col1" class="data row0 col1" >8.02</td>
      <td id="T_e0410_row0_col2" class="data row0 col2" >+0</td>
      <td id="T_e0410_row0_col3" class="data row0 col3" >+0.00</td>
      <td id="T_e0410_row0_col4" class="data row0 col4" >75,081,201</td>
      <td id="T_e0410_row0_col5" class="data row0 col5" >84.41</td>
      <td id="T_e0410_row0_col6" class="data row0 col6" >+0</td>
      <td id="T_e0410_row0_col7" class="data row0 col7" >+0.00</td>
      <td id="T_e0410_row0_col8" class="data row0 col8" >0</td>
      <td id="T_e0410_row0_col9" class="data row0 col9" >0.00</td>
      <td id="T_e0410_row0_col10" class="data row0 col10" >+0</td>
      <td id="T_e0410_row0_col11" class="data row0 col11" >+0.00</td>
      <td id="T_e0410_row0_col12" class="data row0 col12" >50,752</td>
      <td id="T_e0410_row0_col13" class="data row0 col13" >0.06</td>
      <td id="T_e0410_row0_col14" class="data row0 col14" >+0</td>
      <td id="T_e0410_row0_col15" class="data row0 col15" >+0.00</td>
      <td id="T_e0410_row0_col16" class="data row0 col16" >0</td>
      <td id="T_e0410_row0_col17" class="data row0 col17" >0.00</td>
      <td id="T_e0410_row0_col18" class="data row0 col18" >+0</td>
      <td id="T_e0410_row0_col19" class="data row0 col19" >+0.00</td>
      <td id="T_e0410_row0_col20" class="data row0 col20" >6,680,967</td>
      <td id="T_e0410_row0_col21" class="data row0 col21" >7.51</td>
      <td id="T_e0410_row0_col22" class="data row0 col22" >+0</td>
      <td id="T_e0410_row0_col23" class="data row0 col23" >+0.00</td>
    </tr>
    <tr>
      <th id="T_e0410_level0_row1" class="row_heading level0 row1" >2010</th>
      <td id="T_e0410_row1_col0" class="data row1 col0" >7,136,847</td>
      <td id="T_e0410_row1_col1" class="data row1 col1" >8.02</td>
      <td id="T_e0410_row1_col2" class="data row1 col2" >+1,119</td>
      <td id="T_e0410_row1_col3" class="data row1 col3" >+0.00</td>
      <td id="T_e0410_row1_col4" class="data row1 col4" >75,076,028</td>
      <td id="T_e0410_row1_col5" class="data row1 col5" >84.40</td>
      <td id="T_e0410_row1_col6" class="data row1 col6" >-5,173</td>
      <td id="T_e0410_row1_col7" class="data row1 col7" >-0.01</td>
      <td id="T_e0410_row1_col8" class="data row1 col8" >0</td>
      <td id="T_e0410_row1_col9" class="data row1 col9" >0.00</td>
      <td id="T_e0410_row1_col10" class="data row1 col10" >+0</td>
      <td id="T_e0410_row1_col11" class="data row1 col11" >+0.00</td>
      <td id="T_e0410_row1_col12" class="data row1 col12" >51,228</td>
      <td id="T_e0410_row1_col13" class="data row1 col13" >0.06</td>
      <td id="T_e0410_row1_col14" class="data row1 col14" >+476</td>
      <td id="T_e0410_row1_col15" class="data row1 col15" >+0.00</td>
      <td id="T_e0410_row1_col16" class="data row1 col16" >0</td>
      <td id="T_e0410_row1_col17" class="data row1 col17" >0.00</td>
      <td id="T_e0410_row1_col18" class="data row1 col18" >+0</td>
      <td id="T_e0410_row1_col19" class="data row1 col19" >+0.00</td>
      <td id="T_e0410_row1_col20" class="data row1 col20" >6,684,545</td>
      <td id="T_e0410_row1_col21" class="data row1 col21" >7.52</td>
      <td id="T_e0410_row1_col22" class="data row1 col22" >+3,578</td>
      <td id="T_e0410_row1_col23" class="data row1 col23" >+0.00</td>
    </tr>
    <tr>
      <th id="T_e0410_level0_row2" class="row_heading level0 row2" >2011</th>
      <td id="T_e0410_row2_col0" class="data row2 col0" >7,158,468</td>
      <td id="T_e0410_row2_col1" class="data row2 col1" >8.05</td>
      <td id="T_e0410_row2_col2" class="data row2 col2" >+22,740</td>
      <td id="T_e0410_row2_col3" class="data row2 col3" >+0.03</td>
      <td id="T_e0410_row2_col4" class="data row2 col4" >75,045,161</td>
      <td id="T_e0410_row2_col5" class="data row2 col5" >84.37</td>
      <td id="T_e0410_row2_col6" class="data row2 col6" >-36,040</td>
      <td id="T_e0410_row2_col7" class="data row2 col7" >-0.04</td>
      <td id="T_e0410_row2_col8" class="data row2 col8" >0</td>
      <td id="T_e0410_row2_col9" class="data row2 col9" >0.00</td>
      <td id="T_e0410_row2_col10" class="data row2 col10" >+0</td>
      <td id="T_e0410_row2_col11" class="data row2 col11" >+0.00</td>
      <td id="T_e0410_row2_col12" class="data row2 col12" >51,808</td>
      <td id="T_e0410_row2_col13" class="data row2 col13" >0.06</td>
      <td id="T_e0410_row2_col14" class="data row2 col14" >+1,056</td>
      <td id="T_e0410_row2_col15" class="data row2 col15" >+0.00</td>
      <td id="T_e0410_row2_col16" class="data row2 col16" >0</td>
      <td id="T_e0410_row2_col17" class="data row2 col17" >0.00</td>
      <td id="T_e0410_row2_col18" class="data row2 col18" >+0</td>
      <td id="T_e0410_row2_col19" class="data row2 col19" >+0.00</td>
      <td id="T_e0410_row2_col20" class="data row2 col20" >6,693,211</td>
      <td id="T_e0410_row2_col21" class="data row2 col21" >7.52</td>
      <td id="T_e0410_row2_col22" class="data row2 col22" >+12,244</td>
      <td id="T_e0410_row2_col23" class="data row2 col23" >+0.01</td>
    </tr>
    <tr>
      <th id="T_e0410_level0_row3" class="row_heading level0 row3" >2012</th>
      <td id="T_e0410_row3_col0" class="data row3 col0" >7,177,086</td>
      <td id="T_e0410_row3_col1" class="data row3 col1" >8.07</td>
      <td id="T_e0410_row3_col2" class="data row3 col2" >+41,358</td>
      <td id="T_e0410_row3_col3" class="data row3 col3" >+0.05</td>
      <td id="T_e0410_row3_col4" class="data row3 col4" >75,022,440</td>
      <td id="T_e0410_row3_col5" class="data row3 col5" >84.34</td>
      <td id="T_e0410_row3_col6" class="data row3 col6" >-58,761</td>
      <td id="T_e0410_row3_col7" class="data row3 col7" >-0.07</td>
      <td id="T_e0410_row3_col8" class="data row3 col8" >0</td>
      <td id="T_e0410_row3_col9" class="data row3 col9" >0.00</td>
      <td id="T_e0410_row3_col10" class="data row3 col10" >+0</td>
      <td id="T_e0410_row3_col11" class="data row3 col11" >+0.00</td>
      <td id="T_e0410_row3_col12" class="data row3 col12" >52,398</td>
      <td id="T_e0410_row3_col13" class="data row3 col13" >0.06</td>
      <td id="T_e0410_row3_col14" class="data row3 col14" >+1,646</td>
      <td id="T_e0410_row3_col15" class="data row3 col15" >+0.00</td>
      <td id="T_e0410_row3_col16" class="data row3 col16" >0</td>
      <td id="T_e0410_row3_col17" class="data row3 col17" >0.00</td>
      <td id="T_e0410_row3_col18" class="data row3 col18" >+0</td>
      <td id="T_e0410_row3_col19" class="data row3 col19" >+0.00</td>
      <td id="T_e0410_row3_col20" class="data row3 col20" >6,696,724</td>
      <td id="T_e0410_row3_col21" class="data row3 col21" >7.53</td>
      <td id="T_e0410_row3_col22" class="data row3 col22" >+15,757</td>
      <td id="T_e0410_row3_col23" class="data row3 col23" >+0.02</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">from_year</span> <span class="o">=</span> <span class="mi">2009</span>      <span class="c1"># LC before</span>
<span class="n">to_year</span>   <span class="o">=</span> <span class="mi">2012</span>      <span class="c1"># LC after</span>


<span class="c1"># Land cover before/after (entire domain, no burned filter)</span>
<span class="n">lc_before</span> <span class="o">=</span> <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">from_year</span><span class="p">)</span>
<span class="n">lc_after</span>  <span class="o">=</span> <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">to_year</span><span class="p">)</span>

<span class="c1"># Flatten &amp; drop NaNs (lazy with Dask)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">lc_before</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">lc_after</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">da</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">da</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="c1">#  Map ESA-CCI classes to IPCC groups</span>
<span class="n">ipcc_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ipcc_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="n">lut</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">_color</span><span class="p">,</span> <span class="n">codes</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ipcc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
        <span class="n">lut</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">map_to_ipcc</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="n">lut</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">lut</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">out</span><span class="p">[</span><span class="n">arr</span> <span class="o">==</span> <span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">grp</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">b_ipcc</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">map_to_ipcc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">a_ipcc</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">map_to_ipcc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="c1"># Histogram at group level (use weights to ignore invalid pixels)</span>
<span class="n">valid_mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">b_ipcc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">a_ipcc</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">n_groups</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ipcc_labels</span><span class="p">)</span>
<span class="n">H_da</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
    <span class="n">b_ipcc</span><span class="p">,</span> <span class="n">a_ipcc</span><span class="p">,</span>
    <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="n">n_groups</span><span class="p">,</span> <span class="n">n_groups</span><span class="p">],</span>
    <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">-</span><span class="mf">0.5</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">n_groups</span><span class="o">-</span><span class="mf">0.5</span><span class="p">]],</span>
    <span class="n">weights</span><span class="o">=</span><span class="n">valid_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H_da</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Drop zero-only rows/cols</span>
<span class="n">row_sums</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">col_sums</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">keep_rows</span> <span class="o">=</span> <span class="n">row_sums</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">keep_cols</span> <span class="o">=</span> <span class="n">col_sums</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="n">H</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">keep_rows</span><span class="p">,</span> <span class="n">keep_cols</span><span class="p">)]</span>

<span class="n">row_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">ipcc_labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">)</span> <span class="k">if</span> <span class="n">keep_rows</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
<span class="n">col_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">ipcc_labels</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_groups</span><span class="p">)</span> <span class="k">if</span> <span class="n">keep_cols</span><span class="p">[</span><span class="n">j</span><span class="p">]]</span>

<span class="c1"># Annotate counts (only non-zero)</span>
<span class="n">annot_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">H</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="c1"># Plot heatmap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">row_labels</span><span class="p">)</span><span class="o">*</span><span class="mf">1.5</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">col_labels</span><span class="p">)</span><span class="o">*</span><span class="mf">1.2</span><span class="p">)))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
    <span class="n">H</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlOrRd&quot;</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">H</span><span class="p">[</span><span class="n">H</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="k">if</span> <span class="n">H</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">1</span><span class="p">),</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="n">col_labels</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="n">row_labels</span><span class="p">,</span>
    <span class="n">annot</span><span class="o">=</span><span class="n">annot_vals</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Pixel count&quot;</span><span class="p">},</span>
    <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">7</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LC </span><span class="si">{</span><span class="n">from_year</span><span class="si">}</span><span class="s2">‚Üí</span><span class="si">{</span><span class="n">to_year</span><span class="si">}</span><span class="s2"> (raw counts; IPCC groups)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LC </span><span class="si">{</span><span class="n">to_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LC </span><span class="si">{</span><span class="n">from_year</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/5acb911f454d965445a023fdcd0eb2d3dbf0169164ef180c8de774fdd55e7ec8.png" src="../../_images/5acb911f454d965445a023fdcd0eb2d3dbf0169164ef180c8de774fdd55e7ec8.png" />
</div>
</div>
<p>The results show that land cover in the Amazon remained highly stable between 2009 and 2012. Forest consistently accounted for more than 85% of the area, followed by agriculture (~8%) and smaller fractions of grassland, wetlands, settlements, and other classes. Year-to-year differences are minimal, with only very small gains or losses across categories.</p>
<p>The transition matrix confirms this stability, with the vast majority of pixels persisting within their original class. Among the limited transitions observed, the most common are forest to agriculture, forest to grassland, and smaller exchanges involving wetlands and ‚Äúother‚Äù categories. These represent only a small fraction compared to the dominant within-class stability.</p>
</section>
<section id="cross-comparison-of-fire-and-land-cover-change">
<span id="satellite-satellite-land-cover-consistency-q04-code-section-4"></span><h3>4. Cross-comparison of fire and land cover change<a class="headerlink" href="#cross-comparison-of-fire-and-land-cover-change" title="Link to this heading">#</a></h3>
<p>After describing the overall land cover distribution and transitions, the next step is to directly compare <strong>burned areas detected in 2009</strong> with subsequent land cover changes. This cross-comparison serves two purposes:</p>
<ul class="simple">
<li><p>To explore the types of transitions that occur within burned pixels, using transition matrices to visualise class-to-class changes.</p></li>
<li><p>To quantify whether burned areas are more likely to undergo major transitions (e.g. <strong>forest ‚Üí non-forest</strong>) than unburned areas, providing a relative measure of fire impact.</p></li>
</ul>
<p>By combining both perspectives, we can assess not only the nature of changes observed in fire-affected regions but also the extent to which these changes are distinguishable from background land cover dynamics.</p>
<p>In this step we focus on <strong>pixels affected by fire in 2009</strong> and analyse how their land cover evolves in subsequent years. By restricting the analysis to burned pixels, we can directly assess whether fire events are followed by land cover changes.</p>
<p>The code below computes and visualises <strong>transition matrices</strong> comparing land cover in the baseline year (2009) with a later year (by default 2012). Two versions are provided:</p>
<ul class="simple">
<li><p>one using the <strong>original ESA land cover classes</strong>,</p></li>
<li><p>and another using the broader <strong>IPCC groups</strong>.</p></li>
</ul>
<p>This setup allows users to explore fire-related changes at different levels of thematic detail.
The years can be adjusted in the code (<code class="docutils literal notranslate"><span class="pre">from_year</span></code> and <code class="docutils literal notranslate"><span class="pre">to_year</span></code>) to verify that the largest differences in burned pixels emerge when comparing the baseline (2009) with later years, particularly 2012.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">burned_year</span> <span class="o">=</span> <span class="mi">2009</span>
<span class="c1"># Burned mask for 2009</span>
<span class="c1"># ensure small-ish time chunks so reduction streams nicely</span>
<span class="n">JD</span> <span class="o">=</span> <span class="n">ds_fire_amazon</span><span class="p">[</span><span class="s2">&quot;JD&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">burned_year</span><span class="p">))</span><span class="o">.</span><span class="n">chunk</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">12</span><span class="p">})</span>
<span class="n">burned</span> <span class="o">=</span> <span class="p">(</span><span class="n">JD</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span>   <span class="c1"># boolean 2D (lat, lon), still lazy</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">from_year</span>   <span class="o">=</span> <span class="mi">2009</span>
<span class="n">to_year</span>     <span class="o">=</span> <span class="mi">2012</span>   <span class="c1"># fixed target year</span>

<span class="c1"># LC before/after restricted to burned pixels</span>
<span class="n">lc_before</span> <span class="o">=</span> <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">from_year</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">burned</span><span class="p">)</span>
<span class="n">lc_after</span>  <span class="o">=</span> <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">to_year</span><span class="p">)</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">burned</span><span class="p">)</span>

<span class="c1"># Flatten lazily</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">lc_before</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">lc_after</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="o">~</span><span class="n">da</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">da</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">compress</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="c1"># ---- Helper: build histogram + plot ----</span>
<span class="k">def</span><span class="w"> </span><span class="nf">plot_transition_matrix</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">classes</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
    <span class="n">H_da</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">histogram2d</span><span class="p">(</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
        <span class="n">bins</span><span class="o">=</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">classes</span><span class="p">)],</span>
        <span class="nb">range</span><span class="o">=</span><span class="p">[[</span><span class="nb">min</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">],</span>
               <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">classes</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="p">]]</span>
    <span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">H_da</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Drop empty rows/cols</span>
    <span class="n">row_sums</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">col_sums</span> <span class="o">=</span> <span class="n">H</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">keep</span> <span class="o">=</span> <span class="p">(</span><span class="n">row_sums</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">col_sums</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">H</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ix_</span><span class="p">(</span><span class="n">keep</span><span class="p">,</span> <span class="n">keep</span><span class="p">)]</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">labels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span> <span class="k">if</span> <span class="n">keep</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>

    <span class="n">annot_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">H</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span><span class="o">*</span><span class="mf">1.0</span><span class="p">)))</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span>
        <span class="n">H</span><span class="p">,</span>
        <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;YlOrRd&quot;</span><span class="p">,</span>
        <span class="n">norm</span><span class="o">=</span><span class="n">mcolors</span><span class="o">.</span><span class="n">LogNorm</span><span class="p">(</span><span class="n">vmin</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">H</span><span class="p">[</span><span class="n">H</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">H</span><span class="o">.</span><span class="n">max</span><span class="p">()),</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">labels</span><span class="p">,</span>
        <span class="n">annot</span><span class="o">=</span><span class="n">annot_vals</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.0f&quot;</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="n">cbar_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="s2">&quot;Pixel count&quot;</span><span class="p">},</span>
        <span class="n">annot_kws</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="mi">6</span><span class="p">}</span>
    <span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LC </span><span class="si">{</span><span class="n">to_year</span><span class="si">}</span><span class="s2"> (TO)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;LC </span><span class="si">{</span><span class="n">from_year</span><span class="si">}</span><span class="s2"> (FROM)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># --- IPCC groups ---</span>
<span class="n">lut</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">ipcc_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ipcc_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="p">(</span><span class="n">_color</span><span class="p">,</span> <span class="n">codes</span><span class="p">))</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ipcc_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">:</span>
        <span class="n">lut</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">idx</span>

<span class="k">def</span><span class="w"> </span><span class="nf">map_to_ipcc</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">lut</span><span class="o">=</span><span class="n">lut</span><span class="p">):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">code</span><span class="p">,</span> <span class="n">grp</span> <span class="ow">in</span> <span class="n">lut</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">out</span><span class="p">[</span><span class="n">arr</span> <span class="o">==</span> <span class="n">code</span><span class="p">]</span> <span class="o">=</span> <span class="n">grp</span>
    <span class="k">return</span> <span class="n">out</span>

<span class="n">b_ipcc</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">map_to_ipcc</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
<span class="n">a_ipcc</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">map_blocks</span><span class="p">(</span><span class="n">map_to_ipcc</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>

<span class="n">plot_transition_matrix</span><span class="p">(</span><span class="n">b_ipcc</span><span class="p">,</span> <span class="n">a_ipcc</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ipcc_labels</span><span class="p">)),</span> <span class="n">ipcc_labels</span><span class="p">,</span>
    <span class="sa">f</span><span class="s2">&quot;[Burned Pixels </span><span class="si">{</span><span class="n">burned_year</span><span class="si">}</span><span class="s2">]  LC </span><span class="si">{</span><span class="n">from_year</span><span class="si">}</span><span class="s2">‚Üí</span><span class="si">{</span><span class="n">to_year</span><span class="si">}</span><span class="s2"> (IPCC groups)&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/cf2884bc3c65930262f7c71673e02f8b514c7434aaa5891aa95652cb8fea3e1d.png" src="../../_images/cf2884bc3c65930262f7c71673e02f8b514c7434aaa5891aa95652cb8fea3e1d.png" />
</div>
</div>
<p>The IPCC-group matrices show that most burned pixels remain in the <strong>same land cover category</strong> over the period, but a number of cross-class transitions are visible.</p>
<ul class="simple">
<li><p>At the group level, <strong>Agriculture ‚Üí Agriculture</strong> (~13,300 pixels) and <strong>Forest ‚Üí Forest</strong> (~21,500 pixels) dominate, showing stability within major categories.</p></li>
<li><p>The most frequent transitions are <strong>Forest ‚Üí Agriculture</strong> (~300 pixels) and <strong>Forest ‚Üí Grassland</strong> (~9 pixels), alongside <strong>Grassland ‚Üí Agriculture</strong> (~7 pixels) and <strong>Wetland ‚Üí Other</strong> (~1,200 pixels).</p></li>
<li><p>Although these numbers are small relative to the stable areas, they highlight the directions in which burned pixels tend to shift: primarily from forested land into agricultural or open vegetation classes.</p></li>
</ul>
<p><strong>Overall interpretation:</strong></p>
<ul class="simple">
<li><p>Burned areas in 2009 mostly retained their original land cover status by 2012, particularly in agriculture and forest categories.</p></li>
<li><p>However, the detected transitions align with expected <strong>fire-driven pathways</strong>: forest pixels converting to agriculture or grassland, and vegetation mosaics shifting towards cropland.</p></li>
<li><p>These patterns, though limited in scale, provide evidence that the Land Cover dataset does capture some post-fire dynamics, even if the majority of pixels remain unchanged.</p></li>
</ul>
<p>Building on the transition matrices, which highlight both persistence and selected post-fire shifts, we now turn to a more <strong>quantitative assessment</strong>. Specifically, we compare the likelihood of land cover change in <strong>burned versus unburned forest pixels</strong>.</p>
<p>We focus on forest pixels because they represent the dominant land cover in the Amazon and are ecologically the most critical for assessing fire impacts. Even small proportions of forest ‚Üí non-forest change can have significant implications for carbon storage, biodiversity, and ecosystem services. Restricting the analysis to forest provides a clear, policy-relevant indicator of post-fire degradation.</p>
<p>By calculating the probability of <strong>forest ‚Üí non-forest transitions</strong> in both burned and unburned pixels, and expressing their ratio as a <strong>relative risk (RR)</strong>, we can evaluate whether burned areas are systematically more likely to undergo change than unburned areas. This approach complements the qualitative insights from the transition matrices and provides a stronger test of the added value of merging the fire and land cover datasets.</p>
<p>The code below implements this analysis step by step. It first identifies all pixels classified as <strong>forest in 2009</strong>, then tracks whether they remain forest or convert to another class in subsequent years (2010‚Äì2012). Using a mask corresponding to the burned pixels from FireCCI gridded product, these pixels are divided into two groups:</p>
<ul class="simple">
<li><p><strong>Burned forest pixels</strong> ‚Äì forest in 2009 and affected by fire in that year.</p></li>
<li><p><strong>Unburned forest pixels</strong> ‚Äì forest in 2009 but not affected by fire.</p></li>
</ul>
<p>For each group, the code counts:</p>
<ul class="simple">
<li><p><strong>Changed pixels</strong>: number of forest pixels in 2009 that became non-forest by the target year.</p></li>
<li><p><strong>Total pixels</strong>: total number of forest pixels in the group.</p></li>
<li><p><strong>Probability of change</strong>:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
P(\text{change}) = \frac{\text{changed pixels}}{\text{total pixels}}
\]</div>
<p>Finally, the <strong>relative change (RC)</strong> is calculated as the ratio:</p>
<div class="math notranslate nohighlight">
\[
RC = \frac{P(\text{change} \mid \text{burned})}{P(\text{change} \mid \text{unburned})}
\]</div>
<p>Hence, RC depicts the amount of time that the LC of a burned pixel is more/less likely to change, compared to a non-burned one. For example, a RC = 2 means that forest pixels exposed to fire are twice as likely to transition to non-forest than unburned forest pixels. This metric translates the raw counts into a per-pixel likelihood, ensuring that the comparison is fair even though the number of unburned forest pixels is much larger than the number of burned pixels.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># ==== RAM-ONLY CLEANER (keeps your variables intact) ====</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gc</span><span class="o">,</span><span class="w"> </span><span class="nn">ctypes</span>

<span class="c1"># 1) Collect unreachable Python objects (won&#39;t touch referenced datasets)</span>
<span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>

<span class="c1"># 2) Clear small Dask token cache (doesn&#39;t drop your arrays/graphs)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">dask</span>
    <span class="n">dask</span><span class="o">.</span><span class="n">array</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">tokenize</span><span class="o">.</span><span class="n">_CACHE</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># 3) Close any open Matplotlib figures (these often hold MBs)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c1"># 4) Ask glibc to return free heap pages to the OS (Linux only; safe no-op elsewhere)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">ctypes</span><span class="o">.</span><span class="n">CDLL</span><span class="p">(</span><span class="s2">&quot;libc.so.6&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">malloc_trim</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;üßπ RAM cleaned &quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>üßπ RAM cleaned 
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span><span class="o">,</span><span class="w"> </span><span class="nn">dask</span><span class="o">,</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span><span class="o">,</span><span class="w"> </span><span class="nn">dask.array</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">da</span><span class="o">,</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dask.diagnostics</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProgressBar</span>

<span class="c1"># --- Safety: cap threads to avoid CPU spikes ---</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OMP_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;OPENBLAS_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;MKL_NUM_THREADS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
<span class="n">dask</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">scheduler</span><span class="o">=</span><span class="s2">&quot;threads&quot;</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">forest_codes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">61</span><span class="p">,</span> <span class="mi">62</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">81</span><span class="p">,</span> <span class="mi">82</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">170</span><span class="p">]</span>
<span class="n">baseline_year</span> <span class="o">=</span> <span class="mi">2009</span>
<span class="n">lags</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>

<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c1"># --- Burned mask for baseline year (lazy, chunked) ---</span>
<span class="n">JD</span> <span class="o">=</span> <span class="n">ds_fire_amazon</span><span class="p">[</span><span class="s2">&quot;JD&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">baseline_year</span><span class="p">))</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span>
    <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">16</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="mi">1024</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">burned_mask_fire</span> <span class="o">=</span> <span class="p">(</span><span class="n">JD</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s2">&quot;time&quot;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># --- Base LC interpolated to same grid + rechunked ---</span>
<span class="n">lc_base_fire</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">baseline_year</span><span class="p">)</span>
    <span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">burned_mask_fire</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">burned_mask_fire</span><span class="o">.</span><span class="n">chunksizes</span><span class="p">)</span>  <span class="c1"># align chunking</span>
<span class="p">)</span>

<span class="k">for</span> <span class="n">lag</span> <span class="ow">in</span> <span class="n">lags</span><span class="p">:</span>
    <span class="n">year_after</span> <span class="o">=</span> <span class="n">baseline_year</span> <span class="o">+</span> <span class="n">lag</span>
    <span class="k">if</span> <span class="n">year_after</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
        <span class="k">continue</span>

    <span class="n">lc_after_fire</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">ds_lc_amazon</span><span class="p">[</span><span class="s2">&quot;lccs_class&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">year</span><span class="o">=</span><span class="n">year_after</span><span class="p">)</span>
        <span class="o">.</span><span class="n">interp_like</span><span class="p">(</span><span class="n">burned_mask_fire</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span>
        <span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">burned_mask_fire</span><span class="o">.</span><span class="n">chunksizes</span><span class="p">)</span>  <span class="c1"># align chunking</span>
    <span class="p">)</span>

    <span class="c1"># --- Boolean masks ---</span>
    <span class="n">base_is_forest</span>  <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">lc_base_fire</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>  <span class="n">forest_codes</span><span class="p">)</span>
    <span class="n">after_is_forest</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">lc_after_fire</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">forest_codes</span><span class="p">)</span>
    <span class="n">major_change</span>    <span class="o">=</span> <span class="n">base_is_forest</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">after_is_forest</span><span class="p">)</span>
    <span class="n">burned_b</span>        <span class="o">=</span> <span class="n">burned_mask_fire</span><span class="o">.</span><span class="n">data</span>

    <span class="c1"># --- Fused reductions (one compute) ---</span>
    <span class="n">ds_counts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">({</span>
        <span class="s2">&quot;burned_changed&quot;</span><span class="p">:</span>   <span class="p">(</span><span class="n">major_change</span> <span class="o">&amp;</span> <span class="n">burned_b</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="s2">&quot;burned_total&quot;</span><span class="p">:</span>     <span class="n">burned_b</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="s2">&quot;unburned_changed&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">major_change</span> <span class="o">&amp;</span> <span class="p">(</span><span class="o">~</span><span class="n">burned_b</span><span class="p">))</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
        <span class="s2">&quot;unburned_total&quot;</span><span class="p">:</span>   <span class="p">((</span><span class="o">~</span><span class="n">burned_b</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">base_is_forest</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span>
    <span class="p">})</span>

    <span class="c1"># Progress bar while computing</span>
    <span class="k">with</span> <span class="n">ProgressBar</span><span class="p">():</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">ds_counts</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>

    <span class="n">bc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;burned_changed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
    <span class="n">bt</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;burned_total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
    <span class="n">uc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;unburned_changed&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>
    <span class="n">ut</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="s2">&quot;unburned_total&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">())</span>

    <span class="n">p_burned</span>   <span class="o">=</span> <span class="n">bc</span> <span class="o">/</span> <span class="n">bt</span> <span class="k">if</span> <span class="n">bt</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">p_unburned</span> <span class="o">=</span> <span class="n">uc</span> <span class="o">/</span> <span class="n">ut</span> <span class="k">if</span> <span class="n">ut</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">rr</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_burned</span> <span class="o">/</span> <span class="n">p_unburned</span><span class="p">)</span> <span class="k">if</span> <span class="n">p_unburned</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;inf&quot;</span><span class="p">)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
        <span class="s2">&quot;lag&quot;</span><span class="p">:</span> <span class="n">lag</span><span class="p">,</span>
        <span class="s2">&quot;year_after&quot;</span><span class="p">:</span> <span class="n">year_after</span><span class="p">,</span>
        <span class="s2">&quot;burned_changed&quot;</span><span class="p">:</span> <span class="n">bc</span><span class="p">,</span>
        <span class="s2">&quot;burned_total&quot;</span><span class="p">:</span> <span class="n">bt</span><span class="p">,</span>
        <span class="s2">&quot;p_burned&quot;</span><span class="p">:</span> <span class="n">p_burned</span><span class="p">,</span>
        <span class="s2">&quot;unburned_changed&quot;</span><span class="p">:</span> <span class="n">uc</span><span class="p">,</span>
        <span class="s2">&quot;unburned_total&quot;</span><span class="p">:</span> <span class="n">ut</span><span class="p">,</span>
        <span class="s2">&quot;p_unburned&quot;</span><span class="p">:</span> <span class="n">p_unburned</span><span class="p">,</span>
        <span class="s2">&quot;relative_risk&quot;</span><span class="p">:</span> <span class="n">rr</span>
    <span class="p">})</span>

<span class="n">df_rr</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[########################################] | 100% Completed | 149.37 s
[########################################] | 100% Completed | 127.90 s
[########################################] | 100% Completed | 121.54 s
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_rr</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>lag</th>
      <th>year_after</th>
      <th>burned_changed</th>
      <th>burned_total</th>
      <th>p_burned</th>
      <th>unburned_changed</th>
      <th>unburned_total</th>
      <th>p_unburned</th>
      <th>relative_risk</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2010</td>
      <td>89</td>
      <td>52125</td>
      <td>0.001707</td>
      <td>21887</td>
      <td>75905873</td>
      <td>0.000288</td>
      <td>5.921518</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2011</td>
      <td>248</td>
      <td>52125</td>
      <td>0.004758</td>
      <td>60220</td>
      <td>75905873</td>
      <td>0.000793</td>
      <td>5.997086</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2012</td>
      <td>335</td>
      <td>52125</td>
      <td>0.006427</td>
      <td>91332</td>
      <td>75905873</td>
      <td>0.001203</td>
      <td>5.341351</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">years</span> <span class="o">=</span> <span class="n">df_rr</span><span class="p">[</span><span class="s2">&quot;year_after&quot;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># --- Probabilities ---</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">df_rr</span><span class="p">[</span><span class="s2">&quot;p_burned&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;firebrick&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Burned forest&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">df_rr</span><span class="p">[</span><span class="s2">&quot;p_unburned&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;steelblue&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unburned forest&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of Forest ‚Üí Non-forest change (%)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Fire impact on Forest ‚Üí Non-forest transitions&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>

<span class="c1"># --- Relative risk ---</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">df_rr</span><span class="p">[</span><span class="s2">&quot;relative_risk&quot;</span><span class="p">],</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkgreen&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Relative Risk (RR)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Relative Risk (burned vs. unburned)&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Year after fire&quot;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">)</span>

<span class="c1"># --- Force integer ticks on x-axis ---</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">MaxNLocator</span><span class="p">(</span><span class="n">integer</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/0834fc4baa07fc6f9b6fe455b5c2be0adc51a15a88e2ec6f090fa5350595794d.png" src="../../_images/0834fc4baa07fc6f9b6fe455b5c2be0adc51a15a88e2ec6f090fa5350595794d.png" />
</div>
</div>
<p>The plot indicates that burned forest areas consistently have a higher probability of transitioning to non-forest compared to unburned areas over the three-year period.</p>
<p>The probability of conversion in <strong>burned forest</strong> increases from approximately <strong>0.17% in the first year</strong> to about <strong>0.48% in the second year</strong>, reaching around <strong>0.65% by the third year</strong>. In contrast, <strong>unburned forest</strong> shows much lower and more gradual change, rising from roughly <strong>0.03%</strong> in year one to <strong>0.08%</strong> in year two and <strong>0.12%</strong> in year three.</p>
<p>The corresponding <strong>relative risk (RR)</strong> indicates that burned areas are about <strong>5.5‚Äì6 times more likely</strong> to convert to non-forest than unburned areas, with risk peaking in the second year and declining slightly by the third year.</p>
<p>Although the absolute probabilities remain small, the persistent gap between burned and unburned forests demonstrates that fire substantially elevates the short- to medium-term risk of forest loss. This supports the importance of incorporating fire occurrence data when analyzing land-cover change, while also showing that the magnitude of the effect is moderate rather than extreme.</p>
</section>
<section id="main-takeaways">
<span id="satellite-satellite-land-cover-consistency-q04-code-section-5"></span><h3>5. Main-takeaways<a class="headerlink" href="#main-takeaways" title="Link to this heading">#</a></h3>
<ul class="simple">
<li><p>Burned pixels show a statistically higher likelihood of land cover transitions than unburned pixels, but the LC dataset does not allow direct attribution of fire as the sole driver.</p></li>
<li><p>Observed transitions (notably Forest ‚Üí Agriculture and Forest ‚Üí Grassland) are ecologically plausible in post-fire contexts but may also result from other land-use processes such as logging or agricultural expansion.</p></li>
<li><p>Relative risk values (higher probability of change in burned pixels) demonstrate an association between fire occurrence and subsequent land cover change.</p></li>
<li><p>Most burned pixels remain mapped as forest, reflecting both persistence of forest cover and the conservative classification approach of the LC dataset.</p></li>
<li><p>The integration of Fire and LC datasets provides valuable insights into susceptibility of burned areas to change, but cannot isolate fire as the definitive cause.</p></li>
</ul>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Some key resources and further reading were linked throughout this assessment.</p>
<p>The CDS catalogue entry for the data used were:</p>
<ul class="simple">
<li><p>Land cover classification gridded maps from 1992 to present derived from satellite observations:
(<a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-land-cover?tab=overview" rel="noreferrer" target="_blank">https://cds.climate.copernicus.eu/datasets/satellite-land-cover?tab=overview</a>)</p></li>
<li><p>Product User Guide and Specification of the dataset <a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-land-cover/D5.3.1_PUGS_ICDR_LC_v2.1.x_PRODUCTS_v1.1.pdf" rel="noreferrer" target="_blank">version 2.1</a> and <a class="reference external" href="https://dast.copernicus-climate.eu/documents/satellite-land-cover/D3.3.11-v1.0_PUGS_CDR_LC-CCI_v2.0.7cds_Products_v1.0.1_APPROVED_Ver1.pdf" rel="noreferrer" target="_blank">version 2.0</a></p></li>
</ul>
<p>Additional resources:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://ec.europa.eu/eurostat/web/nuts" rel="noreferrer" target="_blank">Eurostat NUTS</a> (Nomenclature of territorial units for statistics)</p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
</ul>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Land_Biosphere"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Land_Biosphere.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.4. </span>Land Biosphere</p>
      </div>
    </a>
    <a class="right-next"
       href="../Land_Hydrology/Land_Hydrology.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.5. </span>Land Hydrology</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-using-land-cover-and-fire-products-to-monitor-post-fire-land-cover-changes">üåç Use case: Using land cover and fire products to monitor post-fire land cover changes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-data-harmonisation">1. Download and Data Harmonisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-all-the-libraries-packages">Import all the libraries/packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#data-overview">Data Overview</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#land-cover-dataset"><strong>Land Cover Dataset</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-request-for-land-cover-dataset">Download request for land cover dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-function-for-land-cover-dataset">Download function for land cover dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#label-color-definition-and-class-correspondence-for-land-cover-dataset">Label Color Definition and Class Correspondence for Land Cover dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#fire-dataset"><strong>Fire Dataset</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-request-for-fire-dataset">Download request for Fire dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-function-for-fire-dataset">Download function for Fire dataset</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#harmonise-the-datasets-to-enable-correct-comparison"><strong>Harmonise the datasets to enable correct comparison</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#study-area"><strong>Study Area</strong></a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#clip-land-cover-and-fire-burned-area-datasets-to-amazon-boundaries">Clip land cover and fire burned area datasets to Amazon boundaries</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#satellite-satellite-land-cover-consistency-q04-code-section-2">2. Identification of Burned Areas</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#land-cover-changes-between-20092012">3. Land Cover changes between 2009‚Äì2012</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cross-comparison-of-fire-and-land-cover-change">4. Cross-comparison of fire and land cover change</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#main-takeaways">5. Main-takeaways</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>