
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1.1.1. Surface Radiation Budget‚Äôs Surface Downwelling Shortwave Flux intercomparison for solar energy applications &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Satellite_ECVs/Atmosphere_Physics/satellite_satellite-surface-radiation-budget_consistency_q03';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="1.2. Atmospheric Composition" href="../Atmospheric_Composition/Atmospheric_Composition.html" />
    <link rel="prev" title="1.1. Atmosphere Physics" href="Atmosphere_Physics.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../satellite.html">1. Quality assessments for Satellite Observations</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3 current active"><a class="current reference internal" href="#">1.1.1. Surface Radiation Budget‚Äôs Surface Downwelling Shortwave Flux intercomparison for solar energy applications</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FSatellite_ECVs/Atmosphere_Physics/satellite_satellite-surface-radiation-budget_consistency_q03.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Satellite_ECVs/Atmosphere_Physics/satellite_satellite-surface-radiation-budget_consistency_q03.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Surface Radiation Budget‚Äôs Surface Downwelling Shortwave Flux intercomparison for solar energy applications</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-use-of-satellite-radiation-data-in-the-solar-energy-sector">üåç Use case: Use of satellite radiation data in the solar energy sector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-definition-and-setup">1. Data Definition and Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-and-transformation">2. Data download and transformation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-weighted-time-series">3. Spatial weighted time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-weighted-mean-maps">4. Time-weighted mean maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weighted-zonal-mean-profiles">5. Spatially weighted zonal mean profiles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-applications">Discussion and applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<div class="alert alert-block alert-warning">
Please note that this repository is used for development and review, so quality assessments should be considered work in progress until they are merged into the main branch
</div><section class="tex2jax_ignore mathjax_ignore" id="surface-radiation-budget-s-surface-downwelling-shortwave-flux-intercomparison-for-solar-energy-applications">
<h1><span class="section-number">1.1.1. </span>Surface Radiation Budget‚Äôs Surface Downwelling Shortwave Flux intercomparison for solar energy applications<a class="headerlink" href="#surface-radiation-budget-s-surface-downwelling-shortwave-flux-intercomparison-for-solar-energy-applications" title="Link to this heading">#</a></h1>
<p>Production date: 11-06-2025</p>
<p>Produced by: CNR-ISMAR, Claudia Allegrini, Andrea Storto, Vincenzo de Toma</p>
<section id="use-case-use-of-satellite-radiation-data-in-the-solar-energy-sector">
<h2>üåç Use case: Use of satellite radiation data in the solar energy sector<a class="headerlink" href="#use-case-use-of-satellite-radiation-data-in-the-solar-energy-sector" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question-s">
<h2>‚ùì Quality assessment question(s)<a class="headerlink" href="#quality-assessment-question-s" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>How consistent are the satellite-based Surface Downwelling Shortwave Flux from CLARA-A3 with the ERA5 Reanalysis?</strong></p></li>
</ul>
<p>This notebook provides a quantitative consistency assessment of two key shortwave radiation products essential for solar energy resource planning. The approach involves a direct spatio-temporal comparison between the satellite-derived CLARA-A3 Surface Downwelling Shortwave Flux and the ERA5 reanalysis analogue, the mean surface downward shortwave radiation flux. The goal is to evaluate the agreement, quantify potential systematic biases, and assess the overall quality and uncertainty of the CLARA-A3 data when inter-compared with ERA5 Reanalysis. This intercomparison could provide insights for users interested in using these datasets for solar energy applications.</p>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>There is strong spatial and temporal agreement between the satellite-derived CLARA-A3 Surface Downwelling Shortwave Flux and the ERA5 reanalysis product, with both datasets capturing key global radiation patterns and seasonal cycles effectively.</p></li>
<li><p>CLARA-A3 is well-suited for solar energy applications, providing accurate estimates of surface shortwave radiation during sunlit periods and avoiding some of the structural overestimations found in ERA5; however, users must consider limitations such as lower data availability in polar night and early satellite sensor periods.</p></li>
<li><p>Combining CLARA-A3 and ERA5 leverages their complementary strengths: satellite observations for validation and high-fidelity local cloud effects, and ERA5 for continuous, spatially complete data, enhancing solar resource assessment and energy yield modeling, when appropriate multi-source bias corrections techniques are applied.</p></li>
</ul>
</div>
<figure class="align-default" id="id1">
<img alt="../../_images/8d29d45c-5d47-466c-a42f-0652c5263b73.png" src="../../_images/8d29d45c-5d47-466c-a42f-0652c5263b73.png" />
<figcaption>
<p><span class="caption-number">Fig. 1.1.1.1 </span><span class="caption-text">Mean Bias between CLARA-A3 and ERA5 Surface Solar Radiation for the period 1979-2020</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>This quality assessment utilises a direct, cell-by-cell spatio-temporal comparison between two distinct sources of Surface Shortwave Radiation (SSR) products within the Copernicus Climate Change (C3S) Climate Data Store (CDS). Respectively, the catalogue entries are:</p>
<ol class="arabic simple">
<li><p>CLARA-A3 Surface Downwelling Shortwave Flux (SIS) (Satellite-Derived): This product is derived from satellite observations as part of the third generation of the CM SAF cLoud, Albedo, and Radiation dataset from AVHRR (CLARA-A3). It provides global coverage of monthly mean of surface downwelling shortwave flux, calculated through radiative transfer models applied to cloud and surface properties retrieved from satellite instruments. This dataset represents observational estimates of the amount of shortwave radiation energy reaching the lower boundary of the atmosphere per unit of time and area from above. (for further information see <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/satellite-surface-radiation-budget?tab=overview" rel="noreferrer" target="_blank">CLARA-A3 Overview Page</a>).</p></li>
<li><p>ERA5 Mean Downward Short Wave Radiation Flux (avg_sdswrf) (Reanalysis Model): The ERA5 product is the fifth-generation ECMWF atmospheric reanalysis, providing hourly estimates of atmospheric, land, and oceanic variables. avg_sdswrf is not a direct observation but is the result of numerical weather prediction and climate models assimilating vast amounts of global data, and provided as a monthly averaged flux. It is considered a highly consistent and frequently used reference dataset for energy and climate studies due to its stability and high resolution. (for further detail see <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=overview" rel="noreferrer" target="_blank">ERA5 Overview Page</a>).</p></li>
</ol>
<p>The comparison involves co-locating the CLARA-A3 and ERA5 datasets in both space and time to ensure a fair comparison of corresponding grid cells and timestamps. The analysis focuses on showing the percentage of valid data points in time and space, selected fixing a given threshold on the number of daily measurements used to derive the monthly average in CLARA-A3, applying the same mask to ERA5, and showing diagnostics such as annual cycles globally and regionally, and mean maps on the common coverage period between the satellite-derived and reanalysis products.
The analysis and results are organised in the following steps, which are detailed in the sections below:</p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-consistency-q03-choose-the-data-to-use-and-setup-code"><span class="std std-ref">1. Data Definition and Setup</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-consistency-q03-download-and-transform"><span class="std std-ref">2. Data download and transformation</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-consistency-q03-plot-spatial-weighted-time-series"><span class="std std-ref">3. Spatial weighted time series</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-consistency-q03-plot-time-weighted-means"><span class="std std-ref">4. Time-weighted mean maps</span></a></strong></p>
<p><strong><a class="reference internal" href="#satellite-satellite-surface-radiation-budget-consistency-q03-plot-spatial-weighted-zonal-means"><span class="std std-ref">5. Spatially weighted zonal mean profiles</span></a></strong></p>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="data-definition-and-setup">
<span id="satellite-satellite-surface-radiation-budget-consistency-q03-choose-the-data-to-use-and-setup-code"></span><h3>1. Data Definition and Setup<a class="headerlink" href="#data-definition-and-setup" title="Link to this heading">#</a></h3>
<p>This section sets the stage for the analysis by defining all necessary parameters and utility functions. The study is established to cover the extended period from January 1979 to December 2020, and the core variable is the downwelling shortwave flux (SIS for CLARA-A3, avg_sdswrf for ERA5). Three distinct regions ‚Äî global, northern hemisphere, and southern hemisphere ‚Äî are defined for focused temporal analysis. Furthermore, this step specifies the exact metadata required to retrieve both the CLARA-A3 satellite data and the ERA5 reanalysis data from their respective Copernicus Climate Data Store collections.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;CDSAPI_RC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~/detoma_vincenzo/.cdsapirc&quot;</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">cartopy</span><span class="w"> </span><span class="kn">import</span> <span class="n">crs</span> <span class="k">as</span> <span class="n">ccrs</span><span class="p">,</span> <span class="n">feature</span> <span class="k">as</span> <span class="n">cfeature</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.mpl.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cticker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span><span class="p">,</span> <span class="n">diagnostics</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Variable to analyse</span>
<span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;downwelling_shortwave&quot;</span>

<span class="c1"># Region for timeseries</span>
<span class="n">region_slices</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;global&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
    <span class="s2">&quot;northern hemisphere&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
    <span class="s2">&quot;southern hemisphere&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">)},</span>
<span class="p">}</span>

<span class="n">collection_ids</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;satellite-surface-radiation-budget&quot;</span><span class="p">,</span> <span class="s2">&quot;reanalysis-era5-single-levels-monthly-means&quot;</span><span class="p">]</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>

<span class="c1"># Define request_dict</span>
<span class="n">request_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;CLARA_A3&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="s2">&quot;1979-01&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="s2">&quot;2020-12&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;product_family&quot;</span><span class="p">:</span> <span class="s2">&quot;clara_a3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;eumetsat&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;surface_</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">_flux&quot;</span><span class="p">,</span>
        <span class="s2">&quot;climate_data_record_type&quot;</span><span class="p">:</span> <span class="s2">&quot;thematic_climate_data_record&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_mean&quot;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s2">&quot;ERA5&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;start&quot;</span><span class="p">:</span><span class="s2">&quot;1979-01&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;stop&quot;</span> <span class="p">:</span><span class="s2">&quot;2020-12&quot;</span><span class="p">,</span> 
        <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_averaged_reanalysis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;grib&quot;</span><span class="p">,</span>
        <span class="s2">&quot;download_format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;mean_surface_downward_short_wave_radiation_flux&quot;</span><span class="p">,</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1"># Create the list with the dictionary</span>
<span class="n">request_dicts</span> <span class="o">=</span> <span class="p">[</span><span class="n">request_dict</span><span class="p">]</span>

<span class="k">def</span><span class="w"> </span><span class="nf">preprocess_time</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">in</span> <span class="n">ds</span> <span class="ow">and</span> <span class="s2">&quot;units&quot;</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
        <span class="c1"># Could not decode</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ds</span><span class="p">:</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;time_coverage_start&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="p">[</span><span class="n">time</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ds</span>

<span class="k">def</span><span class="w"> </span><span class="nf">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="p">,</span> <span class="n">regrid</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">SKIP</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regrid</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">regrid</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">ds_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">lon_slice</span><span class="o">=</span><span class="n">lon_slice</span><span class="p">,</span> <span class="n">lat_slice</span><span class="o">=</span><span class="n">lat_slice</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">mask</span><span class="p">)),</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">SKIP</span><span class="p">)</span>

<span class="n">xarray_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;drop_variables&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;time_bounds&quot;</span><span class="p">],</span>
    <span class="s2">&quot;preprocess&quot;</span><span class="p">:</span> <span class="n">preprocess_time</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="data-download-and-transformation">
<span id="satellite-satellite-surface-radiation-budget-consistency-q03-download-and-transform"></span><h3>2. Data download and transformation<a class="headerlink" href="#data-download-and-transformation" title="Link to this heading">#</a></h3>
<p>In this section the two datasets are homogenised to ensure they are directly comparable. First, a quality mask is created using the CLARA-A3 SIS_dms variable, which identifies and excludes months where the number of daily measurements used to get the monthly mean is incomplete. This step is necessary in order to consider only high-quality, representative monthly means in the subsequent statistics. Next, because the datasets have different native resolutions, the ERA5 data is regridded to the CLARA-A3 grid. The mask created using the above-mentioned procedure is then visualised to demonstrate the reliability of the CLARA-A3 product over the period, showing the spatial percentage of valid measurements and the product‚Äôs robustness over time, latitude and longitude.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span><span class="o">=</span><span class="kc">True</span>
<span class="n">skipna</span><span class="o">=</span><span class="kc">True</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">DS</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">request_dict</span> <span class="ow">in</span> <span class="n">request_dicts</span><span class="p">:</span>
    <span class="n">Ds</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">collection_id</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">collection_ids</span><span class="p">,</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>
    
        <span class="n">start</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
        <span class="n">stop</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;stop&quot;</span><span class="p">)</span>
        
        <span class="n">requests</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">update_request_date</span><span class="p">(</span>
            <span class="n">request</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="o">=</span><span class="n">stop</span><span class="p">,</span> <span class="n">stringify_dates</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
    
        <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
            <span class="n">collection_id</span><span class="p">,</span>
            <span class="n">requests</span><span class="p">,</span>
            <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
            <span class="n">transform_chunks</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">xarray_kwargs</span><span class="p">,</span>
            <span class="n">quiet</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">Ds</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>
    <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ds</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">navg_obs_month</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="s1">&#39;CLARA_A3&#39;</span><span class="p">][</span><span class="s1">&#39;SIS_dms&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">avgdays_in_month</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="s1">&#39;CLARA_A3&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">daysinmonth</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">navg_obs_month</span><span class="o">==</span><span class="n">avgdays_in_month</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> 
<span class="c1"># mask where the number of daily averages in that month is not equal to the number of days in that given month.</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_over_time</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">valid_over_time</span> <span class="o">=</span> <span class="n">valid_over_time</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;Percentage of Valid Measurements&#39;</span><span class="p">)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span><span class="n">valid_over_time</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">})</span>
<span class="n">p</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Percentage from 1979 to 2020&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/92ee973340953f5458b10043ee03e84ff6c0bd7d224935bd0f55073aff64106b.png" src="../../_images/92ee973340953f5458b10043ee03e84ff6c0bd7d224935bd0f55073aff64106b.png" />
</div>
</div>
<p>The percentage of valid CLARA-A3 measurements over time shows high spatial coverage and robustness, with minor gaps in regions prone to persistent cloud cover: Southern Ocean and Antarctic Area. Indeed, these regions are characterized by persistent cloudiness and the presence of snow/ice surfaces, which complicate the cloud detection, especially during polar night or low sun angle periods. This results in under-detection of clouds or misclassifications, reducing valid retrievals for surface shortwave flux (see <a class="reference external" href="https://doi.org/10.5194/essd-15-4901-2023" rel="noreferrer" target="_blank">[1]</a>, or the <a class="reference external" href="https://www.cmsaf.eu/SharedDocs/Literatur/document/2023/saf_cm_rmib_pum_gac_toa_1_2_pdf.pdf?__blob=publicationFile#page=24.04" rel="noreferrer" target="_blank">CLARA-A3 PUM</a>)</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">valid_lat_time</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;longitude&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
<span class="n">valid_lon_time</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s1">&#39;latitude&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="o">.</span><span class="n">latitude</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="n">valid_lat_time</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">valid_lon_time</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Lat-Lon Yearly-Averaged Percentage of Valid Measurements&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;Lat-Lon Yearly-Averaged Percentage of Valid Measurements&#39;)
</pre></div>
</div>
<img alt="../../_images/80093259e11e9d73fcbe80be4cb789d065988019e9a335cefcc33ca03933d924.png" src="../../_images/80093259e11e9d73fcbe80be4cb789d065988019e9a335cefcc33ca03933d924.png" />
</div>
</div>
<p>The low availability of valid CLARA-A3 surface downwelling shortwave radiation data from 1979 to 1985 is primarily due to the technical and calibration limitations of the early AVHRR sensors on the first NOAA polar orbiting satellites. These issues affected data quality, leading to filtering of scenes and lower overall valid data coverage until improved sensors and additional satellites became operational from the mid-1980s onward (see again the <a class="reference external" href="https://www.cmsaf.eu/SharedDocs/Literatur/document/2023/saf_cm_rmib_pum_gac_toa_1_2_pdf.pdf?__blob=publicationFile#page=24.04" rel="noreferrer" target="_blank">CLARA-A3 PUM</a>)</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">mean_map_period</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">S</span><span class="p">):</span>
    <span class="n">selection</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">))</span>
    <span class="n">time_coord</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">selection</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;time&#39;</span><span class="p">:(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">time_coord</span><span class="p">,</span> <span class="n">selection</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">attrs</span><span class="p">)})</span>
    <span class="n">ds_map</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">W</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="n">S</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_map</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">variable</span><span class="o">==</span><span class="s2">&quot;downwelling_shortwave&quot;</span><span class="p">:</span>
        <span class="n">varnames</span> <span class="o">=</span> <span class="p">(</span>
            <span class="p">{</span><span class="s2">&quot;SIS&quot;</span><span class="p">,</span> <span class="s2">&quot;avg_sdswrf&quot;</span><span class="p">,</span> <span class="s2">&quot;SW_flux&quot;</span><span class="p">}</span>
        <span class="p">)</span>
        
    <span class="p">(</span><span class="n">varname</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">varnames</span>
    <span class="k">return</span> <span class="n">varname</span>

<span class="n">ds_maps</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">request_dict</span> <span class="ow">in</span> <span class="n">request_dicts</span><span class="p">:</span>
    <span class="n">da_maps</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">collection_id</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">collection_ids</span><span class="p">,</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
        
        <span class="n">varname</span><span class="o">=</span><span class="n">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
        
        <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s2">&quot;CLARA_A3&quot;</span><span class="p">:</span>
            <span class="n">regrid</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">da_obj</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regrid</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;forecast_reference_time&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">da_obj</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>
        <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">*</span><span class="n">mask</span>
        <span class="n">da_maps</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">time_weighted_mean</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">skipna</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        
    <span class="n">ds_maps</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_maps</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ds_timeseries</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">request_dict</span> <span class="ow">in</span> <span class="n">request_dicts</span><span class="p">:</span>
    <span class="n">da_timeseries</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">collection_id</span><span class="p">,</span> <span class="p">(</span><span class="n">product</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">collection_ids</span><span class="p">,</span> <span class="n">request_dict</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="n">p</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product</span><span class="p">)</span>

        <span class="n">ds</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="n">product</span><span class="p">]</span>
        
        <span class="n">varname</span><span class="o">=</span><span class="n">get_varname</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">variable</span><span class="p">)</span>
        
        <span class="n">da</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">product</span><span class="o">==</span><span class="s2">&quot;CLARA_A3&quot;</span><span class="p">:</span>
            <span class="n">regrid</span><span class="o">=</span><span class="kc">False</span>
            <span class="n">da_obj</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="n">varname</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">regrid</span><span class="o">=</span><span class="kc">True</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;forecast_reference_time&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">da_obj</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
            <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>
        
        <span class="n">regrid_dict</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;regrid&#39;</span><span class="p">:</span><span class="n">regrid</span><span class="p">,</span> <span class="s1">&#39;ds_obj&#39;</span><span class="p">:</span><span class="n">da_obj</span><span class="p">}</span>

        <span class="n">SkipNa</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;SKIP&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>

        <span class="n">Mask</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;mask&#39;</span><span class="p">:</span> <span class="n">mask</span><span class="p">}</span>
        
        <span class="n">dataarrays</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">region</span><span class="p">,</span> <span class="n">slices</span> <span class="ow">in</span> <span class="n">region_slices</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">dall</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">slices</span><span class="p">)</span>
            <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">regrid_dict</span><span class="p">)</span>
            <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">SkipNa</span><span class="p">)</span>
            <span class="n">dall</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">Mask</span><span class="p">)</span>
            <span class="n">da_ts</span> <span class="o">=</span> <span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">da</span><span class="p">,</span>
                                          <span class="n">lon_slice</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lon_slice&#39;</span><span class="p">],</span>
                                          <span class="n">lat_slice</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;lat_slice&#39;</span><span class="p">],</span>
                                          <span class="n">regrid</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;regrid&#39;</span><span class="p">],</span>
                                          <span class="n">ds_obj</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;ds_obj&#39;</span><span class="p">],</span>
                                          <span class="n">SKIP</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;SKIP&#39;</span><span class="p">],</span>
                                          <span class="n">mask</span><span class="o">=</span><span class="n">dall</span><span class="p">[</span><span class="s1">&#39;mask&#39;</span><span class="p">])</span>
            <span class="n">dataarrays</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">da_ts</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">region</span><span class="o">=</span><span class="p">[</span><span class="n">region</span><span class="p">]))</span>
        
        <span class="n">da</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">dataarrays</span><span class="p">,</span> <span class="s2">&quot;region&quot;</span><span class="p">)</span>
        <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;start&quot;</span><span class="p">:</span> <span class="n">start</span><span class="p">,</span> <span class="s2">&quot;stop&quot;</span><span class="p">:</span> <span class="n">stop</span><span class="p">})</span>
        <span class="n">da_timeseries</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">ds_timeseries</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span> <span class="o">=</span> <span class="n">da_timeseries</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="spatial-weighted-time-series">
<span id="satellite-satellite-surface-radiation-budget-consistency-q03-plot-spatial-weighted-time-series"></span><h3>3. Spatial weighted time series<a class="headerlink" href="#spatial-weighted-time-series" title="Link to this heading">#</a></h3>
<p>The analysis shifts to temporal consistency by aggregating the data over the three defined global regions. For each domain (Global, Northern Hemisphere, and Southern Hemisphere), three key plots are generated. The monthly mean climatology plot averages the time series by month to reveal the characteristic annual cycle and effectively quantify any seasonal differences or systematic offsets between CLARA-A3 and ERA5, which are further investigated through the calculation of the climatological bias and Root Mean Square Error (RMSE).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lw_ts</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;downwelling_shortwave&#39;</span><span class="p">][</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;downwelling_shortwave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()],</span> 
                  <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> 
                  <span class="n">coords</span><span class="o">=</span><span class="s1">&#39;minimal&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds_timeseries</span><span class="p">[</span><span class="s1">&#39;downwelling_shortwave&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()]})</span>
<span class="n">monthly_clim</span> <span class="o">=</span> <span class="n">lw_ts</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t1</span> <span class="o">=</span> <span class="n">monthly_clim</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">t1</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/196239c4a1a3d11bedd988b4f5508dc52cade732089b6c89ca8c5f3883dd6ac7.png" src="../../_images/196239c4a1a3d11bedd988b4f5508dc52cade732089b6c89ca8c5f3883dd6ac7.png" />
</div>
</div>
<p>The global and hemispheric time series indicate strong coherence between CLARA-A3 and ERA5 across the 1979‚Äì2020 period. Differences are generally small, with some seasonal variations: discrepancies appear mainly from September to February in the Southern Hemisphere, which also influences the global curve. Both hemispheric time series exhibit clear seasonality consistent with boreal and austral cycles. By visual extrapolation, global time series suggest a globally-averaged downward solar radiation of about <span class="math notranslate nohighlight">\(190\, W m^{-2}\)</span>, slightly higher than the widely accepted value of about <span class="math notranslate nohighlight">\(160-170\, W m^{-2}\)</span> (<a class="reference external" href="https://doi.org/10.1017/9781009157896" rel="noreferrer" target="_blank">[2]</a>), likely due to the masking carried out (see discussion below).</p>
<p>The monthly climatological bias between the CLARA A3 and ERA5 shortwave flux datasets is computed by subtracting the ERA5 shortwave flux time series from the CLARA A3 time series.
Next, the code plots the resulting monthly climatological bias. A multi panel figure is generated, with a separate plot for each geographic region. The three panels show the monthly bias (CLARA-A3 minus ERA5) for global, Northern Hemisphere, and Southern Hemisphere averages over the period 1979‚Äì2020.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bias_clara_era</span> <span class="o">=</span> <span class="n">lw_ts</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;CLARA_A3&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="n">lw_ts</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">product</span><span class="o">=</span><span class="s1">&#39;ERA5&#39;</span><span class="p">)</span>
<span class="n">monthly_clim_bias</span> <span class="o">=</span> <span class="n">bias_clara_era</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clim_bias</span> <span class="o">=</span> <span class="n">monthly_clim_bias</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias (CLARA-A3 - ERA5)&#39;</span><span class="p">)</span> <span class="c1">#.resample(time=&#39;1M&#39;).mean()</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">clim_bias</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Bias [W m-2]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/f9b2a69bee1ed732522d4e47fb281807058ebbb3792728fd114fbf9c12f2c637.png" src="../../_images/f9b2a69bee1ed732522d4e47fb281807058ebbb3792728fd114fbf9c12f2c637.png" />
</div>
</div>
<p>The global bias oscillates seasonally, ranging from about <span class="math notranslate nohighlight">\(‚Äì9 W\, m^{-2}\)</span> in January to <span class="math notranslate nohighlight">\(\sim +3 W\, m^{-2}\)</span> in July. Negative values dominate most of the year, indicating that CLARA-A3 generally reports lower shortwave flux than ERA5, except during boreal summer (June‚ÄìAugust), when CLARA-A3 is slightly higher.
In the Northern Hemisphere, the pattern is similar to the global curve but more pronounced: i) in winter (Jan‚ÄìFeb) CLARA-A3 is <span class="math notranslate nohighlight">\(\sim W\, m^{-2}\)</span> lower than ERA5; ii) in summer (Jun‚ÄìJul), CLARA-A3 exceeds ERA5 by up to <span class="math notranslate nohighlight">\(\sim +4 W\, m^{-2}\)</span>.
In the Southern Hemisphere, i) in the Austral summer (Dec‚ÄìJan), CLARA-A3 is <span class="math notranslate nohighlight">\(\sim 12‚Äì15 W\, m^{-2}\)</span> lower than ERA5; ii) in Austral winter (Jun‚ÄìJul), the bias is slightly positive.
Overall, the bias is seasonally dependent and hemisphere-specific, not constant throughout the year.</p>
<p>The code below calculates the monthly climatological Root Mean Square Error (RMSE) between the CLARA A3 and ERA5 shortwave flux datasets and then visualizes the result. Next, the code plots the resulting monthly RMSE. A multi panel figure is generated, with a separate plot for each geographic region. The three panels display the monthly Root Mean Square Error (RMSE) between CLARA-A3 and ERA5 for global, Northern Hemisphere, and Southern Hemisphere averages over 1979‚Äì2020.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">monthly_clim_rmse</span> <span class="o">=</span> <span class="n">bias_clara_era</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;time.month&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clim_rmse</span> <span class="o">=</span> <span class="n">monthly_clim_rmse</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="s1">&#39;region&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Bias (CLARA-A3 - ERA5)&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">clim_rmse</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">():</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">11</span><span class="p">,</span><span class="mi">12</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;RMSE [W m-2]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/1444591c602b2f36e87531d81cb13a8efe7d25bc0fe667cb0e0363653f89b9a6.png" src="../../_images/1444591c602b2f36e87531d81cb13a8efe7d25bc0fe667cb0e0363653f89b9a6.png" />
</div>
</div>
<p>The most evident feature is the pronounced ‚ÄúU-shape‚Äù in the Southern Hemisphere plot. The error does not remain constant but scales drastically with the solar cycle, peaking at <span class="math notranslate nohighlight">\(\sim 8.5 W\, m^{-2}\)</span> during the austral summer (December‚ÄìJanuary) and dropping to <span class="math notranslate nohighlight">\(\sim 2.2 W\, m^{-2}\)</span> in the austral winter (June).
The Global plot (left) mirrors the Southern Hemisphere‚Äôs pattern, with high errors in December‚ÄìJanuary (<span class="math notranslate nohighlight">\(\sim 6.8 W\, m^{-2}\)</span>) and lower errors in June‚ÄìJuly (<span class="math notranslate nohighlight">\(\sim 2.8 W\, m^{-2}\)</span>).
The Northern Hemisphere shows a much flatter and lower error profile, fluctuating between <span class="math notranslate nohighlight">\(2.3\)</span> and <span class="math notranslate nohighlight">\(4.4 W\, m^{-2}\)</span>.</p>
</section>
<section id="time-weighted-mean-maps">
<span id="satellite-satellite-surface-radiation-budget-consistency-q03-plot-time-weighted-means"></span><h3>4. Time-weighted mean maps<a class="headerlink" href="#time-weighted-mean-maps" title="Link to this heading">#</a></h3>
<p>This section provides the long-term visual assessment of spatial consistency. The code generates two global mean maps, one for the CLARA-A3 data and one for the ERA5 data, averaging the monthly fluxes over the 1979‚Äì2020 period. This visualisation allows for a direct qualitative comparison of the spatial distribution of the shortwave flux. Both products are displayed side by side using the same colour scale and geographic projection, which helps visually identify regions of good agreement or regions where systematic biases (such as those found in the time series analysis) are most pronounced geographically.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_to_show</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;CLARA_A3&#39;</span><span class="p">,</span> <span class="s1">&#39;ERA5&#39;</span><span class="p">]</span>
<span class="n">lw_maps</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_maps</span><span class="p">[</span><span class="s1">&#39;downwelling_shortwave&#39;</span><span class="p">][</span><span class="n">p</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">p_to_show</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s1">&#39;product&#39;</span><span class="p">:</span> <span class="n">p_to_show</span><span class="p">})</span>
<span class="n">lw_maps_masked</span> <span class="o">=</span> <span class="n">lw_maps</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">lw_ts</span><span class="o">.</span><span class="n">time</span>
<span class="n">p1</span> <span class="o">=</span> <span class="n">lw_maps_masked</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">),</span>
                         <span class="n">col</span><span class="o">=</span><span class="s1">&#39;product&#39;</span><span class="p">,</span> 
                         <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                         <span class="n">subplot_kws</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
                         <span class="n">levels</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
                         <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
                         <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;nipy_spectral&quot;</span><span class="p">,</span>
                         <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                         <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">p1</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">:</span>  <span class="c1"># loop through the map axes</span>
    <span class="n">subplotspec</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_subplotspec</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">subplotspec</span><span class="o">.</span><span class="n">is_last_row</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subplotspec</span><span class="o">.</span><span class="n">is_first_col</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">coastlines</span><span class="p">(</span><span class="s1">&#39;50m&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">()</span>
<span class="n">p1</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">set_layout_engine</span><span class="p">(</span><span class="s2">&quot;compressed&quot;</span><span class="p">)</span>
<span class="n">cax</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">1.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
<span class="n">p1</span><span class="o">.</span><span class="n">add_colorbar</span><span class="p">(</span><span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;showrtwave [W m-2]&#39;</span><span class="p">)</span>
<span class="n">p1</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean map on the period </span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0.98, &#39;Mean map on the period 1979-2020&#39;)
</pre></div>
</div>
<img alt="../../_images/4254d15b78e6037901a71b829e3e7084189a6d7ba66275f669624dcb4875b84a.png" src="../../_images/4254d15b78e6037901a71b829e3e7084189a6d7ba66275f669624dcb4875b84a.png" />
</div>
</div>
<p>Both datasets exhibit similar spatial patterns, with maximum values over the subtropical oceans and continental low-latitude regions, and minima near the poles. The Intertropical Convergence Zone (ITCZ) appears as a pronounced high-radiation band across the equator in both products. Differences are subtle but visible: ERA5 tends to show slightly higher fluxes over tropical land areas and in the Southern Hemisphere (Antarctica), compared to CLARA-A3. Overall, the spatial agreement is strong, confirming that both datasets capture the global radiation climatology well, with minor systematic differences likely linked to clouds, which are probably too few in ERA5 (<a class="reference external" href="https://doi.org/10.1007/s00382-024-07182-6" rel="noreferrer" target="_blank">[3]</a>).</p>
<p>This code performs a multi-step analysis comparing the CLARA-A3 Surface Incoming Shortwave product with the ERA5 Shortwave Radiation Flux data, over the period 1979‚Äì2020, ultimately generating two geographical maps: one for the Mean Bias and one for the Root Mean Square Error (RMSE).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">navg_obs_month</span><span class="o">==</span><span class="n">avgdays_in_month</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">da_obj</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="s1">&#39;CLARA_A3&#39;</span><span class="p">][</span><span class="s1">&#39;SIS&#39;</span><span class="p">]</span>
<span class="n">da_era5</span> <span class="o">=</span> <span class="n">DS</span><span class="p">[</span><span class="n">variable</span><span class="p">][</span><span class="s1">&#39;ERA5&#39;</span><span class="p">][</span><span class="s1">&#39;avg_sdswrf&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s1">&#39;forecast_reference_time&#39;</span><span class="p">:</span><span class="s1">&#39;time&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">da_obj</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>
<span class="n">bias</span> <span class="o">=</span> <span class="p">(</span><span class="n">da_obj</span> <span class="o">-</span> 
        <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">da_era5</span><span class="p">,</span>
                           <span class="n">da_obj</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;bilinear&#39;</span><span class="p">))</span><span class="o">*</span><span class="n">mask</span>
<span class="n">timeavg_bias</span> <span class="o">=</span> <span class="n">bias</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;mean_bias&#39;</span><span class="p">)</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">lw_ts</span><span class="o">.</span><span class="n">time</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p2</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span><span class="n">timeavg_bias</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdBu_r&#39;</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;Mean Bias [W m-2]&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=-</span><span class="mi">50</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Mean Bias (CLARA-A3 - ERA5) </span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/5eb035cba46f19fee7394cb5ab7bb6823a0524b7e78b75531bed36b3314d8e61.png" src="../../_images/5eb035cba46f19fee7394cb5ab7bb6823a0524b7e78b75531bed36b3314d8e61.png" />
</div>
</div>
<p>A strong, consistent negative bias (blue) dominates the entire Southern Ocean and Antarctica. This means the CLARA-A3 product is consistently lower than the ERA5 product. Particularly, ERA5 has higher insolation over China and the Tibetan Plateau area, which can be addressed to the underestimation of the cloud cover (see <a class="reference external" href="https://doi.org/10.1155/adme/5002403" rel="noreferrer" target="_blank">[4]</a>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">time_rmse</span> <span class="o">=</span> <span class="n">bias</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;time_rmse&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p3</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span><span class="n">time_rmse</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;BuGn&#39;</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;shrink&#39;</span><span class="p">:</span><span class="mf">0.6</span><span class="p">,</span> <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;RMSE [W m-2]&#39;</span><span class="p">},</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">p3</span><span class="o">.</span><span class="n">axes</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time RMSE (CLARA-A3 - ERA5) </span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">p3</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/6950a9d1e3b92f052e8f84eaeb5a4d2348f33e36b8c0c279973dc7e4d671bcc0.png" src="../../_images/6950a9d1e3b92f052e8f84eaeb5a4d2348f33e36b8c0c279973dc7e4d671bcc0.png" />
</div>
</div>
<p>RMSE measures the magnitude of the typical difference or variability over time, with higher values indicating greater time-varying differences between the two products.
The most apparent pattern is the RMSE significantly higher in the polar and high latitude regions, especially over the Southern Ocean and Antarctica, compared to the generally lower values seen over the tropics and mid-latitudes. This indicates the two datasets have the greatest temporal disagreement and variability in their differences near the poles.</p>
</section>
<section id="spatially-weighted-zonal-mean-profiles">
<span id="satellite-satellite-surface-radiation-budget-consistency-q03-plot-spatial-weighted-zonal-means"></span><h3>5. Spatially weighted zonal mean profiles<a class="headerlink" href="#spatially-weighted-zonal-mean-profiles" title="Link to this heading">#</a></h3>
<p>This final section shifts the focus from global maps to a quantitative comparison of the latitudinal distribution of the shortwave flux. The code calculates the Zonal Mean profile for both CLARA-A3 and ERA5 by spatially weighting the data at each latitude line (using the cosine of latitude to account for grid cell area) and averaging over all longitudes and the entire time period (1979‚Äì2020). Plotting these two profiles on a single axis allows for immediate and precise identification of any systematic latitudinal biases, revealing how the differences between the satellite product and the reanalysis vary across distinct climate zones, from the poles to the equator.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Zonal Mean on the period </span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">-</span><span class="si">{</span><span class="n">times</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">da_maps</span> <span class="o">=</span> <span class="n">ds_maps</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span>
<span class="n">ax</span><span class="o">=</span><span class="n">ax1</span>
<span class="k">for</span> <span class="n">product</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">da_maps</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">da</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
    <span class="n">da</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">product</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2"> [W m-2]&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 0, &#39;downwelling_shortwave [W m-2]&#39;)
</pre></div>
</div>
<img alt="../../_images/1949edd74514cc9332a5f71ece79679a606bebb7612eeaa55b71e25cadf35691.png" src="../../_images/1949edd74514cc9332a5f71ece79679a606bebb7612eeaa55b71e25cadf35691.png" />
</div>
</div>
<p>Both datasets exhibit very similar profiles, with maximum values near the equator (<span class="math notranslate nohighlight">\(\sim 240‚ÄØW\, m^{-2}\)</span>) and a gradual decrease toward the poles, reaching <span class="math notranslate nohighlight">\(\sim 100‚Äì140‚ÄØW\, m^{-2}\)</span> at high latitudes. The agreement between the two datasets is strong across all latitudes, and no systematic bias is evident‚Äîdifferences are small and vary locally, with occasional minor deviations in the Southern Hemisphere high latitudes. Overall, the figure confirms that CLARA-A3 and ERA5 provide consistent estimates of the global radiation climatology when averaged zonally.</p>
<section id="discussion-and-applications">
<h4>Discussion and applications<a class="headerlink" href="#discussion-and-applications" title="Link to this heading">#</a></h4>
<p>The comparison between the satellite-derived Surface Downwelling Shortwave Flux from CLARA-A3 and the ERA5 reanalysis reveals a high degree of spatial and temporal consistency, making both datasets valuable for solar energy applications <a class="reference external" href="https://doi.org/10.1016/j.solener.2019.02.058" rel="noreferrer" target="_blank">[5]</a>.</p>
<p>CLARA-A3 provides robust global coverage, with minor data gaps primarily in regions characterised by persistent cloudiness and reflective ice/snow surfaces, such as the Southern Ocean and Antarctica. These gaps arise from challenges in cloud detection under low solar angles or during polar night, as well as the complex reflectance of ice and snow, which complicate retrievals (<a class="reference external" href="https://doi.org/10.5194/essd-15-4901-2023" rel="noreferrer" target="_blank">[1]</a>, <a class="reference external" href="https://www.cmsaf.eu/SharedDocs/Literatur/document/2023/saf_cm_rmib_pum_gac_toa_1_2_pdf.pdf?__blob=publicationFile#page=24.04" rel="noreferrer" target="_blank">CLARA-A3 PUM</a>). Additionally, data availability in the early period (1979‚Äì1985) is limited due to technical issues with early AVHRR sensors, with improvements seen in later satellite generations (<a class="reference external" href="https://www.cmsaf.eu/SharedDocs/Literatur/document/2023/saf_cm_rmib_pum_gac_toa_1_2_pdf.pdf?__blob=publicationFile#page=24.04" rel="noreferrer" target="_blank">CLARA-A3 PUM</a>).</p>
<p>Over the 1979-2020 period, global and hemispheric time series show strong coherence and seasonal agreement between CLARA-A3 and ERA5. Differences are generally small but seasonally dependent and region-specific, with the Southern Hemisphere exhibiting the largest biases during austral summer. Both datasets capture key spatial patterns well, including maxima along the ITCZ and minima near the poles. ERA5 tends to report slightly higher fluxes over tropical land and Antarctic regions, likely influenced by differences in cloud representation <a class="reference external" href="https://doi.org/10.5194/essd-15-4901-2023" rel="noreferrer" target="_blank">[1]</a>.</p>
<p>Monthly bias analysis reveals a systematic oscillation where CLARA-A3 generally underestimates shortwave flux in winter and overestimates in summer relative to ERA5, with RMSE values peaking at high latitudes, particularly over the Southern Ocean.</p>
<p>For solar energy applications, where accurate representation of irradiance during sunlit hours is crucial, CLARA-A3 is often preferred. Being satellite-based, it better captures the actual optical cloud properties and avoids the structural overestimation found in ERA5, thus providing a more conservative resource estimate. However, users should consider CLARA-A3‚Äôs ‚Äúmissing data‚Äù during polar night and low solar angles, which inflates global mean radiation estimates by excluding zero-flux periods <a class="reference external" href="https://doi.org/10.5194/essd-15-4901-2023" rel="noreferrer" target="_blank">[1]</a>.</p>
<p>The complementarity of CLARA-A3 and ERA5 underpins their combined use for solar energy resource assessment. CLARA-A3 provides observational validation, while ERA5 offers continuous spatial interpolation and coverage, which is particularly beneficial where satellite data are sparse or unavailable. Recognizing regional and seasonal biases‚Äîincluding polar and early satellite era limitations‚Äîmay require multi-source bias correction (<a class="reference external" href="https://doi.org/10.1016/j.rse.2024.114472" rel="noreferrer" target="_blank">[6]</a>, <a class="reference external" href="https://doi.org/10.1109/JSTARS.2023.3346032" rel="noreferrer" target="_blank">[7]</a>).</p>
<p>Overall, CLARA-A3 and ERA5 together provide a high-quality, coherent surface downwelling shortwave radiation climatology suitable for solar energy applications worldwide, supporting reliable energy yield modeling and planning while accounting for known dataset limitations.</p>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.5194/essd-15-4901-2023" rel="noreferrer" target="_blank">[1]</a> Karlsson, K. G., Stengel, M., Meirink, J. F., Riihel√§, A., Trentmann, J., Akkermans, T., ‚Ä¶ &amp; Hollmann, R. (2023). CLARA-A3: The third edition of the AVHRR-based CM SAF climate data record on clouds, radiation and surface albedo covering the period 1979 to 2023. Earth System Science Data, 15(11), 4901-4926. <a class="reference external" href="https://doi.org/10.5194/essd-15-4901-2023" rel="noreferrer" target="_blank">https://doi.org/10.5194/essd-15-4901-2023</a></p>
<p><a class="reference external" href="https://doi.org/10.1017/9781009157896" rel="noreferrer" target="_blank">[2]</a> Masson-Delmotte, V., Zhai, P., Pirani, A., Connors, S. L., P√©an, C., Berger, S., ‚Ä¶ &amp; Zhou, B. (2021). Climate change 2021: the physical science basis. Contribution of working group I to the sixth assessment report of the intergovernmental panel on climate change, 2(1), 2391. <a class="reference external" href="https://doi.org/10.1017/9781009157896" rel="noreferrer" target="_blank">https://doi.org/10.1017/9781009157896</a></p>
<p><a class="reference external" href="https://doi.org/10.1007/s00382-024-07182-6" rel="noreferrer" target="_blank">[3]</a> Dai, A. (2024). The diurnal cycle from observations and ERA5 in precipitation, clouds, boundary layer height, buoyancy, and surface fluxes. Climate Dynamics, 62(7), 5879-5908. <a class="reference external" href="https://doi.org/10.1007/s00382-024-07182-6" rel="noreferrer" target="_blank">https://doi.org/10.1007/s00382-024-07182-6</a></p>
<p><a class="reference external" href="https://doi.org/10.1155/adme/5002403" rel="noreferrer" target="_blank">[4]</a> Zeng, Y., Yang, L., Tong, Z., Jiang, Y., Abulikemu, A., Zhou, Y., ‚Ä¶ &amp; Li, X. (2025). Total Cloud Cover in Xinjiang Uygur Autonomous Region, Northwest China: A Comparison of ERA5 and ISCCP With FY4A. Advances in Meteorology, 2025(1), 5002403. <a class="reference external" href="https://doi.org/10.1155/adme/5002403" rel="noreferrer" target="_blank">https://doi.org/10.1155/adme/5002403</a></p>
<p><a class="reference external" href="https://doi.org/10.1016/j.solener.2019.02.058" rel="noreferrer" target="_blank">[5]</a> Babar, B., Graversen, R., &amp; Bostr√∂m, T. (2019). Solar radiation estimation at high latitudes: Assessment of the CMSAF databases, ASR and ERA5. Solar Energy, 182, 397-411. <a class="reference external" href="https://doi.org/10.1016/j.solener.2019.02.058" rel="noreferrer" target="_blank">https://doi.org/10.1016/j.solener.2019.02.058</a></p>
<p><a class="reference external" href="https://doi.org/10.1016/j.rse.2024.114472" rel="noreferrer" target="_blank">[6]</a> Urraca, R., Trentmann, J., Pfeifroth, U., &amp; Gobron, N. (2024). Can satellite products monitor solar brightening in Europe?. Remote Sensing of Environment, 315, 114472. <a class="reference external" href="https://doi.org/10.1016/j.rse.2024.114472" rel="noreferrer" target="_blank">https://doi.org/10.1016/j.rse.2024.114472</a></p>
<p><a class="reference external" href="https://doi.org/10.1109/JSTARS.2023.3346032" rel="noreferrer" target="_blank">[7]</a> Tian, Q., Zhang, S., Duan, W., &amp; Ming, G. (2023). Evaluation of downward shortwave radiation products over the Loess Plateau. IEEE Journal of Selected Topics in Applied Earth Observations and Remote Sensing, 17, 3167-3180. <a class="reference external" href="https://doi.org/10.1109/JSTARS.2023.3346032" rel="noreferrer" target="_blank">https://doi.org/10.1109/JSTARS.2023.3346032</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Satellite_ECVs/Atmosphere_Physics"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="Atmosphere_Physics.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1.1. </span>Atmosphere Physics</p>
      </div>
    </a>
    <a class="right-next"
       href="../Atmospheric_Composition/Atmospheric_Composition.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">1.2. </span>Atmospheric Composition</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-use-of-satellite-radiation-data-in-the-solar-energy-sector">üåç Use case: Use of satellite radiation data in the solar energy sector</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question-s">‚ùì Quality assessment question(s)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-definition-and-setup">1. Data Definition and Setup</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#data-download-and-transformation">2. Data download and transformation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatial-weighted-time-series">3. Spatial weighted time series</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-weighted-mean-maps">4. Time-weighted mean maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spatially-weighted-zonal-mean-profiles">5. Spatially weighted zonal mean profiles</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion-and-applications">Discussion and applications</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>