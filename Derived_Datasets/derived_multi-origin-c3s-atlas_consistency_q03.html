
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>7.3. Consistency between the C3S Atlas dataset and its origins: Multiple origin datasets &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Derived_Datasets/derived_multi-origin-c3s-atlas_consistency_q03';</script>
    <link rel="icon" href="../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="8. Applications" href="../Applications/application.html" />
    <link rel="prev" title="7.2. Consistency between the C3S Atlas dataset and its origins: Multiple indicators" href="derived_multi-origin-c3s-atlas_consistency_q02.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">‚ö†Ô∏èThis is under development!‚ö†Ô∏è</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../_static/C3S‚ÄìPOS‚ÄìLINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Satellite Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Satellite_ECVs/satellite.html">1. Quality assessments for Satellite Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-aerosol-properties_consistency_q01.html">1.2.1. Assessment of Seasonal Variability and Completeness of Aerosol Optical Depth from SLSTR Satellite Data (2017-2023)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-carbon-dioxide_trend-assessment_q01.html">1.2.2. Carbon dioxide satellite observations completeness assessment for greenhouse gas monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-carbon-dioxide_uncertainty-quality-flags_q02.html">1.2.3. Spatial and temporal completeness and uncertainties of carbon dioxide satellite observations for quantifying atmospheric greenhouse gas variability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-methane_completeness_q03.html">1.2.4. Methane satellite observations completeness assessment for greenhouse gas monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-methane_uncertainty_q01.html">1.2.5. Methane satellite observations uncertainty and completeness assessment for carbon cycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-ozone-v1_climate-monitoring_q01.html">1.2.6. Temporal and spatial completeness of the satellite-derived Ozone for policy making and variability studies</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_derived-gridded-glacier-mass-change_data-completeness_q01.html">1.3.1. Glacier mass change data from satellite and in-situ observations: uncertainty analysis for glaciological and climate change monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_derived-gridded-glacier-mass-change_trend-assessment_q02.html">1.3.2. Glacier mass change data from satellite and in-situ observations: resolution and coverage for trend analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_satellite-greenland-ice-sheet-velocity_trend-assessment_q01.html">1.3.3. Ice sheet velocity data from satellite observations: temporal and spatial coverage and data completeness for trend analysis in glaciological applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_satellite-ice-sheet-elevation-change_consistency-assessment_q02.html">1.3.4. Spatio-temporal data completeness and consistency of remote sensing-derived ice sheet surface elevation changes over Antarctica</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_satellite-ice-sheet-elevation-change_trend-assessment_q01.html">1.3.5. Uncertainty of ice sheet surface elevation change¬†data over Greenland for volume and mass change trend assessments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_satellite-ice-sheet-mass-balance_trend-assessment_q02.html">1.3.6. Gravimetric mass balance data from satellite observations: utility analysis for mass change monitoring of the ice sheets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Cryosphere/satellite_satellite-ice-sheet-mass-balance_uncertainty_q01.html">1.3.7. Gravimetric mass changes from satellite data: assessment of resolution and uncertainty of Greenland ice sheet mass changes for glaciological applications</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Land_Biosphere/satellite_satellite-fire-burned-area_climate-and-weather-extremes_q01.html">1.4.1. Satellite fire burned area completeness for seasonal climatology maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Land_Biosphere/satellite_satellite-fire-burned-area_trend-assessment_q02.html">1.4.2. Satellite fire burned area trends assessment for climate monitoring</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Land_Hydrology/satellite_satellite-lake-water-level_climate-and-weather-extremes_q01.html">1.5.1. Lake Victoria‚Äôs 2020 Flood Event Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Land_Hydrology/satellite_satellite-lake-water-level_completeness_q02.html">1.5.2. Assessing Lake Titicaca‚Äôs water levels in support of water management</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Satellite_ECVs/Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-ocean-colour_completeness_q01.html">1.6.1. Completeness of ocean colour observations for biogeochemical models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-ocean-colour_consistency-assessment_q01.html">1.6.2. Impact of using successive satellites on Ocean Colour time series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-sea-ice-edge-type_intercomparison_q01.html">1.6.3. Intercomparison of satellite multi-year sea ice extent estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-sea-ice-thickness_trend-assessment_q01.html">1.6.4. Suitability of satellite sea ice thickness data for studying climate change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-sea-level-global_trend-assessment_q01.html">1.6.5. Regional sea level trend assessment in the Mediterranean Sea from Satellite (observations) at basin and sub-basin scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-sea-surface-temperature_consistency_q01.html">1.6.6. Consistency Assessment of Satellite Sea Surface Temperature for Climate Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Satellite_ECVs/Ocean/satellite_satellite-sea-surface-temperature_consistency_q02.html">1.6.7. Satellite Sea Surface Temperature Consistency in representing Ocean Warming Trends</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_forecast-skill_q02.html">4.1. Seasonal forecasts bias assessment for impact models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_forecast-skill_q04.html">4.2. Evaluation of the hit-rate of seasonal forecasts for tercile categories of monthly anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_resolution_q06.html">4.3. Assessing the impact of spatial scale and temporal trends on seasonal forecast quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_uncertainty-quality-flags_q01.html">4.4. Assessing possible outcomes of seasonal temperature forecast</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Projections</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Climate_Projections/climate.html">5. Quality assessments for Climate Projections</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Climate_Projections/CMIP6/CMIP6.html">5.1. CMIP6</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q01.html">5.1.1. Bias in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q02.html">5.1.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q03.html">5.1.3. Uncertainty in projected changes in extreme temperature indices at a 2¬∞C Global Warming Level for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-impact-indicators_q01.html">5.1.4. Biases in energy-consumption-related indices in Europe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-impact-indicators_q02.html">5.1.5. Uncertainty in projected changes of energy consumption in Europe</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-impact-indicators_q03.html">5.1.6. Uncertainty in projected changes of energy consumption in Europe at a 2¬∞C Global Warming Level</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_climate-impact-indicators_q04.html">5.1.7. Projections of future ice-free periods for the Arctic and Antarctic</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_model-performance_q02.html">5.1.8. Historical accuracy of sea ice extent in the CMIP6 projections</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_model-performance_q03.html">5.1.9. Evaluation of the Arctic sea ice thickness in the CMIP6 historical experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_validation_q10.html">5.1.10. Testing the capability of CMIP6 GCMs to represent precipitation inter-annual variability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_validation_q11.html">5.1.11. Testing the capability of CMIP6 GCMs to represent precipitation intra-seasonal variability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_validation_q12.html">5.1.12. Biases in temperature trends at different pressure levels using CMIP6 across latitudinal bands</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CMIP6/climate_projections-cmip6_validation_q13.html">5.1.13. CMIP6 biases in the SPEI6 drought index over the Mediterranean region</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../Climate_Projections/CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q01.html">5.2.1. Bias in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q02.html">5.2.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q03.html">5.2.3. Bias in precipitation-based indices for impact models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q04.html">5.2.4. Projected changes in precipitation-based indices for impact models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_validation_q05.html">5.2.5. CORDEX temperature biases over the Alpine region for the ski and hydrological sectors.</a></li>
<li class="toctree-l3"><a class="reference internal" href="../Climate_Projections/CORDEX/climate_projections-cordex-domains-single-levels_validation_q06.html">5.2.6. CORDEX temperature biases over the Alpine region ‚Äî assessment using E-OBS and CERRA</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Derived Datasets</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="derived.html">7. Quality assessments for Derived Datasets</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q01.html">7.1. Consistency between the C3S Atlas dataset and its origins: Case study</a></li>
<li class="toctree-l2"><a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q02.html">7.2. Consistency between the C3S Atlas dataset and its origins: Multiple indicators</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">7.3. Consistency between the C3S Atlas dataset and its origins: Multiple origin datasets</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">‚û°Ô∏è Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../Applications/application_gttm_uncertainty_q01.html">8.1. Assessing global warming with the C3S Global Temperature Trend Monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Applications/application_pulse_extreme-events_q01.html">8.2. Visualisation of temperature during extreme weather events with Climate Pulse</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FDerived_Datasets/derived_multi-origin-c3s-atlas_consistency_q03.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/Derived_Datasets/derived_multi-origin-c3s-atlas_consistency_q03.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Consistency between the C3S Atlas dataset and its origins: Multiple origin datasets</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-retrieving-climate-indicators-from-the-copernicus-interactive-climate-atlas">üåç Use case: Retrieving climate indicators from the Copernicus Interactive Climate Atlas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-setup">1. Code setup</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-user-tools-for-the-c3s-atlas">Install the User-tools for the C3S Atlas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-required-libraries">Import required libraries</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-indicators">Define indicators</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#helper-functions">Helper functions</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#data-downloading-pre-processing">Data downloading &amp; (pre-)processing</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics">Statistics</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisation">Visualisation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-and-retrieve-indicators">2. Calculate and retrieve indicators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-setup">General setup</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip6">CMIP6</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip5">CMIP5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cordex-eur-11">CORDEX-EUR-11</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#era5">ERA5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-land">ERA5-Land</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#e-obs">E-OBS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#berkearth">BERKEARTH</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#oras5">ORAS5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sst-cci">SST-CCI</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cpc">CPC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">3. Results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#consistency-comparison-on-native-grids">Consistency: Comparison on native grids</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducibility-comparison-on-c3s-atlas-grid">Reproducibility: Comparison on C3S Atlas grid</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../_images/LogoLine_horizon_C3S1.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="consistency-between-the-c3s-atlas-dataset-and-its-origins-multiple-origin-datasets">
<h1><span class="section-number">7.3. </span>Consistency between the C3S Atlas dataset and its origins: Multiple origin datasets<a class="headerlink" href="#consistency-between-the-c3s-atlas-dataset-and-its-origins-multiple-origin-datasets" title="Link to this heading">#</a></h1>
<p>Production date: 2025-10-14.</p>
<p>Dataset version: 2.0.</p>
<p>Produced by: Olivier Burggraaff, Nicole Reynolds (National Physical Laboratory).</p>
<section id="use-case-retrieving-climate-indicators-from-the-copernicus-interactive-climate-atlas">
<h2>üåç Use case: Retrieving climate indicators from the Copernicus Interactive Climate Atlas<a class="headerlink" href="#use-case-retrieving-climate-indicators-from-the-copernicus-interactive-climate-atlas" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>‚ùì Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>Are the climate indicators in the dataset underpinning the Copernicus Interactive Climate Atlas consistent with their origin datasets?</strong></p></li>
<li><p><strong>Can the dataset underpinning the Copernicus Interactive Climate Atlas be reproduced from its origin datasets?</strong></p></li>
</ul>
<p>The <a class="reference external" href="https://atlas.climate.copernicus.eu/atlas" rel="noreferrer" target="_blank"><em>Copernicus Interactive Climate Atlas</em></a>, or <em>C3S Atlas</em> for short, is a C3S web application providing an easy-to-access tool for exploring climate projections, reanalyses, and observational data [<a class="reference external" href="https://doi.org/10.21957/ah52ufc369" rel="noreferrer" target="_blank">Guti√©rrez+24</a>].
Version 2.0 of the application allows the user to interact with 12 datasets:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Dataset</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Climate Projection</p></td>
<td><p>CMIP6</p></td>
</tr>
<tr class="row-odd"><td><p>Climate Projection</p></td>
<td><p>CMIP5</p></td>
</tr>
<tr class="row-even"><td><p>Climate Projection</p></td>
<td><p>CORDEX-CORE</p></td>
</tr>
<tr class="row-odd"><td><p>Climate Projection</p></td>
<td><p>CORDEX-EUR-11</p></td>
</tr>
<tr class="row-even"><td><p>Reanalysis</p></td>
<td><p>ERA5</p></td>
</tr>
<tr class="row-odd"><td><p>Reanalysis</p></td>
<td><p>ERA5-Land</p></td>
</tr>
<tr class="row-even"><td><p>Reanalysis</p></td>
<td><p>ORAS5</p></td>
</tr>
<tr class="row-odd"><td><p>Reanalysis</p></td>
<td><p>CERRA</p></td>
</tr>
<tr class="row-even"><td><p>Observations</p></td>
<td><p>E-OBS</p></td>
</tr>
<tr class="row-odd"><td><p>Observations</p></td>
<td><p>BERKEARTH</p></td>
</tr>
<tr class="row-even"><td><p>Observations</p></td>
<td><p>CPC</p></td>
</tr>
<tr class="row-odd"><td><p>Observations</p></td>
<td><p>SST-CCI</p></td>
</tr>
</tbody>
</table>
</div>
<p>These datasets are provided through an intermediary dataset, the <a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank"><em>Gridded dataset underpinning the Copernicus Interactive Climate Atlas</em></a> or <em>C3S Atlas dataset</em> for short [<a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank">C3S Atlas dataset</a>].
Compared to their origins, the versions of the climate datasets within the C3S Atlas dataset have been processed following the workflow in Figure <a class="reference internal" href="#multi-origin-c3s-atlas-consistency-q03-workflow-fig"><span class="std std-numref">7.3.1</span></a>.</p>
<figure class="align-default" id="multi-origin-c3s-atlas-consistency-q03-workflow-fig">
<a class="reference internal image-reference" href="../_images/c3s_atlas_dataset_workflow.png"><img alt="../_images/c3s_atlas_dataset_workflow.png" src="../_images/c3s_atlas_dataset_workflow.png" style="height: 360px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 7.3.1 </span><span class="caption-text">Schematic representation of the workflow for the production of the C3S Atlas dataset from its origin datasets, from the <a class="reference external" href="https://ecmwf-projects.github.io/c3s-atlas/chapter01.html" rel="noreferrer" target="_blank">User-tools for the C3S Atlas</a>.</span><a class="headerlink" href="#multi-origin-c3s-atlas-consistency-q03-workflow-fig" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Because a wide range of users interact with climate data through the C3S Atlas application, it is crucial that the underpinning dataset represent its origins correctly.
In other words, the C3S Atlas dataset must be consistent with and reproducible from its origins.
Here, we assess this consistency and reproducibility by comparing climate indicators retrieved from the C3S Atlas dataset with their equivalents calculated from the origin dataset, mirroring the workflow from Figure <a class="reference internal" href="#multi-origin-c3s-atlas-consistency-q03-workflow-fig"><span class="std std-numref">7.3.1</span></a>.
While a full analysis and reproduction of every record within the C3S Atlas dataset is outside the scope of quality assessment
(and would require high-performance computing infrastructure),
a case study with a narrower scope probes these quality attributes of the dataset
and can be a jumping-off point for further analysis by the reader.</p>
<p>This notebook is part of a series:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Notebook</p></th>
<th class="head"><p>Contents</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q01.html"><span class="doc std std-doc">Consistency between the C3S Atlas dataset and its origins: Case study</span></a></p></td>
<td><p>Comparison between C3S Atlas dataset and one origin dataset (CMIP6) for one indicator (<code class="docutils literal notranslate"><span class="pre">tx35</span></code>), including detailed setup.</p></td>
</tr>
<tr class="row-odd"><td><p><a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q02.html"><span class="doc std std-doc">Consistency between the C3S Atlas dataset and its origins: Multiple indicators</span></a></p></td>
<td><p>Comparison between C3S Atlas dataset and one origin dataset (CMIP6) for multiple indicators.</p></td>
</tr>
<tr class="row-even"><td><p><strong>Consistency between the C3S Atlas dataset and its origins: Multiple origin datasets</strong></p></td>
<td><p>Comparison between C3S Atlas dataset and multiple origin datasets for one indicator.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="quality-assessment-statement">
<h2>üì¢ Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>Climate indicators (here 3 monthly indicators) provided by the C3S Atlas dataset are highly consistent with values calculated from its origin datasets (here 10 climate projection, observation, and reanalysis datasets).</p></li>
<li><p>There are some differences in coverage between the C3S Atlas dataset and its origins due to differences in the version used, e.g. E-OBS temperature indicators at the edges of Europe, but these do not affect the vast majority use cases for the C3S Atlas.</p></li>
<li><p>Differences between the C3S Atlas dataset and a manual reproduction are rare and generally negligible (median absolute difference of 0 for <code class="docutils literal notranslate"><span class="pre">tx35</span></code> and <code class="docutils literal notranslate"><span class="pre">r01</span></code>, ‚â§0.0003 ¬∞C for SST). Where differences occur, they can be explained by dataset versions or details of the workflow implementation.</p></li>
<li><p>The C3S Atlas is traceable and reproducible, and can be confidently used to view, analyse, and download climate data.</p></li>
<li><p>For specific use cases, like scientific papers, it is recommended to manually process the origin dataset instead of using the C3S Atlas. This is not necessary for other use cases, such as climate risk assessments and climate reports, in which case the C3S Atlas can be used as is.</p></li>
</ul>
</div>
</section>
<section id="methodology">
<h2>üìã Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>This quality assessment tests the consistency between climate indicators retrieved from the <a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank"><em>Gridded dataset underpinning the Copernicus Interactive Climate Atlas</em></a> [<a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank">C3S Atlas dataset</a>] and their equivalents calculated from the origin datasets,
as well as the reproducibility of said dataset.</p>
<p>This notebook probes the consistency between the C3S Atlas dataset and multiple origin datasets at the same time.
Due to differences in scope (e.g. atmosphere / land / sea), not every indicator is available in every origin dataset or its C3S Atlas derivative.
Furthermore, some origin datasets are historical while others are future projections.
For this reason, we will examine the following indicators in the following origin datasets:</p>
<p><strong>Monthly count of days with maximum near-surface (2-metre) air temperature above 35 ¬∞C (<code class="docutils literal notranslate"><span class="pre">tx35</span></code>)</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Dataset</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Climate Projection</p></td>
<td><p>CMIP6</p></td>
</tr>
<tr class="row-odd"><td><p>Climate Projection</p></td>
<td><p>CMIP5</p></td>
</tr>
<tr class="row-even"><td><p>Climate Projection</p></td>
<td><p>CORDEX-EUR-11</p></td>
</tr>
<tr class="row-odd"><td><p>Reanalysis</p></td>
<td><p>ERA5</p></td>
</tr>
<tr class="row-even"><td><p>Reanalysis</p></td>
<td><p>ERA5-Land</p></td>
</tr>
<tr class="row-odd"><td><p>Observations</p></td>
<td><p>E-OBS</p></td>
</tr>
<tr class="row-even"><td><p>Observations</p></td>
<td><p>BERKEARTH</p></td>
</tr>
</tbody>
</table>
</div>
<p>Note that CORDEX-CORE has been left out of this assessment because its mosaicking workflow is out of scope.
CERRA has been left out because the C3S User-tools package is currently not fully compatible with this dataset.</p>
<p><strong>Monthly mean temperature of sea water near the surface (<code class="docutils literal notranslate"><span class="pre">sst</span></code>)</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Dataset</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Reanalysis</p></td>
<td><p>ORAS5</p></td>
</tr>
<tr class="row-odd"><td><p>Observations</p></td>
<td><p>SST-CCI</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Monthly count of days with daily accumulated precipitation of liquid water equivalent from all phases above 1 mm (<code class="docutils literal notranslate"><span class="pre">r01</span></code>)</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Type</p></th>
<th class="head"><p>Dataset</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Observations</p></td>
<td><p>CPC</p></td>
</tr>
</tbody>
</table>
</div>
<p>The analysis and results are organised in the following steps, which are detailed in the sections below:</p>
<p><strong><a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-section-codesetup"><span class="std std-ref">1. Code setup</span></a></strong></p>
<ul class="simple">
<li><p>Install User-tools for the C3S Atlas.</p></li>
<li><p>Import all required libraries.</p></li>
<li><p>Define indicators.</p></li>
<li><p>Define helper functions.</p></li>
</ul>
<p><strong><a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-section-indicators"><span class="std std-ref">2. Calculate and retrieve indicators</span></a></strong></p>
<ul class="simple">
<li><p>Download data from the origin datasets.</p></li>
<li><p>Homogenise data.</p></li>
<li><p>Calculate indicators.</p></li>
<li><p>Regrid the origin data to the C3S Atlas grid.</p></li>
<li><p>Download corresponding data from the C3S Atlas dataset.</p></li>
</ul>
<p><strong><a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-section-results"><span class="std std-ref">3. Results</span></a></strong></p>
<ul class="simple">
<li><p>Consistency: Compare the C3S Atlas and reproduced datasets on native grids.</p></li>
<li><p>Reproducibility: Compare the C3S Atlas and reproduced datasets on the C3S Atlas grid.</p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>üìà Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="code-setup">
<span id="derived-multi-origin-c3s-atlas-consistency-q03-section-codesetup"></span><h3>1. Code setup<a class="headerlink" href="#code-setup" title="Link to this heading">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This notebook uses <a class="reference external" href="https://github.com/ecmwf/earthkit" rel="noreferrer" target="_blank">earthkit</a> for
downloading (<a class="reference external" href="https://github.com/ecmwf/earthkit-data" rel="noreferrer" target="_blank">earthkit-data</a>)
and visualising (<a class="reference external" href="https://github.com/ecmwf/earthkit-plots" rel="noreferrer" target="_blank">earthkit-plots</a>) data.
Because earthkit is in active development, some functionality may change after this notebook is published.
If any part of the code stops functioning, please raise an issue on our GitHub repository so it can be fixed.</p>
</div>
<section id="install-the-user-tools-for-the-c3s-atlas">
<h4>Install the User-tools for the C3S Atlas<a class="headerlink" href="#install-the-user-tools-for-the-c3s-atlas" title="Link to this heading">#</a></h4>
<p>This notebook uses the <a class="reference external" href="https://github.com/ecmwf-projects/c3s-atlas" rel="noreferrer" target="_blank">User-tools for the C3S Atlas</a>, which can be installed from GitHub using <code class="docutils literal notranslate"><span class="pre">pip</span></code>.
For convenience, the following cell can do this from within the notebook.
Further details and alternative options for installing this library are available in its <a class="reference external" href="https://github.com/ecmwf-projects/c3s-atlas?tab=readme-ov-file#requirements" rel="noreferrer" target="_blank">documentation</a>.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>git+https://github.com/ecmwf-projects/c3s-atlas.git
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="import-required-libraries">
<h4>Import required libraries<a class="headerlink" href="#import-required-libraries" title="Link to this heading">#</a></h4>
<p>In this section, we import all the relevant packages needed for running the notebook.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Input / Output</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">earthkit.data</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ekd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>

<span class="c1"># General data handling</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>  <span class="c1"># Ignore divide-by-zero warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span><span class="p">,</span> <span class="n">wraps</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dask.array</span><span class="w"> </span><span class="kn">import</span> <span class="n">nanmedian</span><span class="p">,</span> <span class="n">ravel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dask.array.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">PerformanceWarning</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="n">action</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="n">PerformanceWarning</span><span class="p">)</span>

<span class="c1"># Data pre-processing</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_atlas.fixers</span><span class="w"> </span><span class="kn">import</span> <span class="n">apply_fixers</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">c3s_atlas.interpolation</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xesmfCICA</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">itertools</span><span class="w"> </span><span class="kn">import</span> <span class="n">batched</span>

<span class="c1"># Climate indicators</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xclim</span>
<span class="n">xclim</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">cf_compliance</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>  <span class="c1"># Mute warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">c3s_atlas.indexes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_atlas.units</span><span class="w"> </span><span class="kn">import</span> <span class="n">VALID_UNITS</span>

<span class="c1"># Visualisation</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">earthkit.plots</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ekp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">earthkit.plots.styles</span><span class="w"> </span><span class="kn">import</span> <span class="n">Style</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;grid.linestyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>  <span class="c1"># Progress bars</span>

<span class="c1"># Visualisation in Jupyter book -- automatically ignored otherwise</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">myst_nb</span><span class="w"> </span><span class="kn">import</span> <span class="n">glue</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">glue</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Type hints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Generator</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">earthkit.plots.geo.domains</span><span class="w"> </span><span class="kn">import</span> <span class="n">Domain</span>
<span class="n">AnyDomain</span> <span class="o">=</span> <span class="p">(</span><span class="n">Domain</span> <span class="o">|</span> <span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-indicators">
<h4>Define indicators<a class="headerlink" href="#define-indicators" title="Link to this heading">#</a></h4>
<p>This section defines functions and variables for calculating and using the climate indicators.</p>
<p>The following cell includes a helper function (in the form of a decorator) to correctly propagate NaNs, which is important for datasets using land/sea masks:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">propagate_nan</span><span class="p">(</span><span class="n">func</span><span class="p">:</span> <span class="n">Callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Decorator that ensures propagation of NaNs: find them in the original data, create a mask, and apply it to the result. &quot;&quot;&quot;</span>
    <span class="nd">@wraps</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">func_with_nan</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">propagate_nan</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
        <span class="c1"># Calculate indicator as normal</span>
        <span class="n">indicator</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># If propagation is not desired (e.g. you know there are no NaNs), simply return the result</span>
        <span class="c1"># This preserves integer data types</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">propagate_nan</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">indicator</span>

        <span class="c1"># Infer input (var-iable), output (ind-icator) keys</span>
        <span class="n">var</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ind</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">indicator</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Resample data to frequency of indicator, generate mask</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">indicator</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span>                  \
                 <span class="o">.</span><span class="n">resample</span><span class="p">({</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">freq</span><span class="p">})</span>   \
                 <span class="o">.</span><span class="n">sum</span><span class="p">()</span>                      \
                 <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>               \
                 <span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">var</span><span class="p">:</span> <span class="n">ind</span><span class="p">})</span>

        <span class="c1"># Apply mask and return result</span>
        <span class="n">indicator_masked</span> <span class="o">=</span> <span class="n">indicator</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indicator_masked</span>

    <span class="k">return</span> <span class="n">func_with_nan</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following cell contains functions for calculating the indicators described in the introduction:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">cal_tasmax</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Daily maximum of hourly temperature &quot;&quot;&quot;</span>
    <span class="n">ds_tx</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">valid_time</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">key</span><span class="p">:</span>
        <span class="n">ds_tx</span> <span class="o">=</span> <span class="n">ds_tx</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">key</span><span class="p">:</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">})</span>
    <span class="k">return</span> <span class="n">ds_tx</span>

<span class="nd">@propagate_nan</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cal_tx35</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Monthly count of days with maximum near-surface (2-metre) temperature above 35 ¬∞C &quot;&quot;&quot;</span>
    <span class="n">ds_tx35</span> <span class="o">=</span> <span class="n">xclim</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">tx_days_above</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s1">&#39;tasmax&#39;</span><span class="p">],</span> <span class="n">thresh</span><span class="o">=</span><span class="s1">&#39;35.0 degC&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;tx35&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_tx35</span>

<span class="k">def</span><span class="w"> </span><span class="nf">cal_sst</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Monthly mean temperature of sea water near the surface &quot;&quot;&quot;</span>
    <span class="n">ds_sst</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;sst&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;sst&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_sst</span>

<span class="nd">@propagate_nan</span>
<span class="k">def</span><span class="w"> </span><span class="nf">cal_r01</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Monthly count of days with daily accumulated precipitation of liquid water equivalent from all phases above 1 mm &quot;&quot;&quot;</span>
    <span class="n">pr_flux</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;mm/day&#39;</span><span class="p">)</span>
    <span class="n">per0</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">pr_flux</span><span class="p">)</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">(</span><span class="n">units</span><span class="o">=</span><span class="s1">&#39;mm/day&#39;</span><span class="p">)</span>
    <span class="n">ds_r01</span> <span class="o">=</span> <span class="n">xclim</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">days_over_precip_thresh</span><span class="p">(</span><span class="n">pr_flux</span><span class="p">,</span> <span class="n">per0</span><span class="p">,</span> <span class="n">thresh</span><span class="o">=</span><span class="s1">&#39;1 mm/day&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;MS&#39;</span><span class="p">,</span> <span class="n">bootstrap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataset</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;r01&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_r01</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following cell defines <a class="reference external" href="https://earthkit-plots.readthedocs.io/en/latest/_api/plots/styles/index.html" rel="noreferrer" target="_blank">earthkit-plots styles</a> for the indicators.
These styles define the colour maps and colour bar ranges for each quantity.
Earthkit-plots styles are explained further in the <a class="reference external" href="https://earthkit-plots.readthedocs.io/en/latest/examples/examples/examples.html#Styles" rel="noreferrer" target="_blank">corresponding documentation</a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Styles for indicators</span>
<span class="n">n_diff</span> <span class="o">=</span> <span class="mi">5</span>  <span class="c1"># Levels in difference charts</span>

<span class="n">_style_monthly_days</span>      <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>     <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>    <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;neither&quot;</span><span class="p">}</span>
<span class="n">_style_monthly_days_diff</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span>  <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="mf">2.5</span><span class="p">,</span>   <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>

<span class="c1"># tx35 indicator</span>
<span class="n">_style_tx35</span>      <span class="o">=</span> <span class="n">_style_monthly_days</span>      <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Oranges</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="mi">10</span><span class="p">)}</span>
<span class="n">_style_tx35_diff</span> <span class="o">=</span> <span class="n">_style_monthly_days_diff</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu_r</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="n">n_diff</span><span class="p">)}</span>

<span class="c1"># sst indicator</span>
<span class="n">_style_sst</span>        <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">YlOrBr</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="mi">14</span><span class="p">),</span>   <span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>
<span class="n">_style_sst_diff</span>   <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="n">n_diff</span><span class="p">),</span> <span class="s2">&quot;vmin&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;vmax&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>

<span class="c1"># r01 indicator</span>
<span class="n">_style_r01</span>         <span class="o">=</span> <span class="n">_style_monthly_days</span>      <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">Blues</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="mi">10</span><span class="p">)}</span>
<span class="n">_style_r01_diff</span>    <span class="o">=</span> <span class="n">_style_monthly_days_diff</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">RdBu</span><span class="o">.</span><span class="n">resampled</span><span class="p">(</span><span class="n">n_diff</span><span class="p">)}</span>

<span class="c1"># Individual styles</span>
<span class="c1"># Set up like this so they can still be edited individually</span>
<span class="n">styles</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;tx35&quot;</span><span class="p">:</span> <span class="n">Style</span><span class="p">(</span><span class="o">**</span><span class="n">_style_tx35</span><span class="p">),</span>       <span class="s2">&quot;tx35_diff&quot;</span><span class="p">:</span> <span class="n">Style</span><span class="p">(</span><span class="o">**</span><span class="n">_style_tx35_diff</span><span class="p">),</span>
    <span class="s2">&quot;sst&quot;</span> <span class="p">:</span> <span class="n">Style</span><span class="p">(</span><span class="o">**</span><span class="n">_style_sst</span><span class="p">),</span>        <span class="s2">&quot;sst_diff&quot;</span><span class="p">:</span> <span class="n">Style</span><span class="p">(</span><span class="o">**</span><span class="n">_style_sst_diff</span><span class="p">),</span>
    <span class="s2">&quot;r01&quot;</span><span class="p">:</span> <span class="n">Style</span><span class="p">(</span><span class="o">**</span><span class="n">_style_r01</span><span class="p">),</span>         <span class="s2">&quot;r01_diff&quot;</span><span class="p">:</span> <span class="n">Style</span><span class="p">(</span><span class="o">**</span><span class="n">_style_r01_diff</span><span class="p">),</span>
<span class="p">}</span>

<span class="c1"># Apply general settings</span>
<span class="k">for</span> <span class="n">style</span> <span class="ow">in</span> <span class="n">styles</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
    <span class="n">style</span><span class="o">.</span><span class="n">normalize</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="helper-functions">
<h4>Helper functions<a class="headerlink" href="#helper-functions" title="Link to this heading">#</a></h4>
<p>This section defines some functions and variables used in the following analysis, allowing code cells in later sections to be shorter and ensuring consistency.</p>
<section id="data-downloading-pre-processing">
<h5>Data downloading &amp; (pre-)processing<a class="headerlink" href="#data-downloading-pre-processing" title="Link to this heading">#</a></h5>
<p>The following functions help with downloading data from datasets with limits, by generating multiple CDS requests with similar parameters:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Split requests into smaller parts</span>
<span class="k">def</span><span class="w"> </span><span class="nf">split_request_along_key</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a dict `request` with iterable entries, for the given `key`, generate a list of dicts instead. &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">request</span> <span class="o">|</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="p">[</span><span class="n">item</span><span class="p">,]}</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">request</span><span class="p">[</span><span class="n">key</span><span class="p">]]</span>


<span class="c1"># SST-CCI: Generate monthly batches of requests</span>
<span class="k">def</span><span class="w"> </span><span class="nf">generate_dates_in_month</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Generator</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; For a given year + month, generate all valid dates (checked with datetime). &quot;&quot;&quot;</span>
    <span class="n">year</span><span class="p">,</span> <span class="n">month</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">month</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Validate the date</span>
            <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>  <span class="c1"># Invalid date</span>
            <span class="k">continue</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># Valid date</span>
            <span class="k">yield</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>  <span class="c1"># 2-digit string format for CDS</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_monthly_batches</span><span class="p">(</span><span class="n">year</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">11</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Generate batches of n days in the given year + month. &quot;&quot;&quot;</span>
    <span class="k">yield from</span> <span class="n">batched</span><span class="p">(</span><span class="n">generate_dates_in_month</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">),</span> <span class="n">n</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_submonthly_request</span><span class="p">(</span><span class="n">main_request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">month</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">day_batch</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add a month and day (or batch of days) to a `main_request`.</span>
<span class="sd">    Note that month and day_batch must be in 2-digit string format for the CDS to accept them.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">request</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">month</span><span class="p">,</span>
        <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">day_batch</span><span class="p">,</span>
    <span class="p">}</span> <span class="o">|</span> <span class="n">main_request</span>
    <span class="k">return</span> <span class="n">request</span>

<span class="k">def</span><span class="w"> </span><span class="nf">generate_submonthly_requests</span><span class="p">(</span><span class="n">main_request</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">year</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; For a given `year`, generate batched requests of ‚â§n days per month for every month. &quot;&quot;&quot;</span>
    <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>

    <span class="c1"># Generate requests</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">create_submonthly_request</span><span class="p">(</span><span class="n">main_request</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">day_batch</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">MONTHS</span>  <span class="c1"># Requires MONTHS to be defined in the &quot;general setup&quot; section</span>
            <span class="k">for</span> <span class="n">day_batch</span> <span class="ow">in</span> <span class="n">generate_monthly_batches</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following functions aid in sub-selecting data, e.g. selecting one model from the ensemble included in the C3S Atlas dataset or selecting data for a specific time frame:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select (multiple) years in a dataset</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_years_in_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span> <span class="o">|</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Select only data for the given year(s). &quot;&quot;&quot;</span>
    <span class="n">years</span> <span class="o">=</span> <span class="p">[</span><span class="n">years</span><span class="p">,]</span> <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">years</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">))</span> <span class="k">else</span> <span class="n">years</span>  <span class="c1"># Deal with single year</span>
    <span class="n">years_int</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">years</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">years_int</span><span class="p">))</span>

<span class="c1"># C3S Atlas dataset: Individual model selection</span>
<span class="k">def</span><span class="w"> </span><span class="nf">select_model_from_c3s_atlas_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Select only data for the given model. &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the model ID is provided in the right format</span>
    <span class="n">model_id</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>

    <span class="c1"># Find the corresponding model ID in the list of models</span>
    <span class="c1"># This cannot use .sel because the coordinate is not indexed</span>
    <span class="n">select_member</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">mem</span><span class="p">)</span> <span class="k">for</span> <span class="n">mem</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">member_id</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">model_id</span> <span class="ow">in</span> <span class="n">mem</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()][</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Find the corresponding data and return those</span>
    <span class="n">member_ind</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">member_id</span> <span class="o">==</span> <span class="n">select_member</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">data_member</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">member</span><span class="o">=</span><span class="n">member_ind</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="s2">&quot;member&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data_member</span>

<span class="c1"># C3S Atlas dataset: Common pre-processing</span>
<span class="k">def</span><span class="w"> </span><span class="nf">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">years</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Pre-process C3S Atlas data by selecting only the desired years and model (if relevant). &quot;&quot;&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">select_years_in_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">years</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">select_model_from_c3s_atlas_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following functions handle <a class="reference external" href="https://docs.xarray.dev/en/latest/user-guide/dask.html" rel="noreferrer" target="_blank">data chunking in dask</a> for computational efficiency:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Rechunking of data to speed up dask calculations</span>
<span class="k">def</span><span class="w"> </span><span class="nf">rechunk</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Rechunk a dataset `ds` based on pre-set memory requirements. &quot;&quot;&quot;</span>
    <span class="c1"># Find coordinates (usually lat/lon, sometimes x/y)</span>
    <span class="n">index_keys</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
    <span class="n">coord_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">index_keys</span> <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s2">&quot;time&quot;</span><span class="p">]</span>

    <span class="c1"># Assign new chunk sizes</span>
    <span class="k">if</span> <span class="n">ds</span><span class="o">.</span><span class="n">nbytes</span> <span class="o">&lt;=</span> <span class="mf">1e8</span><span class="p">:</span>  <span class="c1"># 100 MB</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">}</span> <span class="o">|</span> <span class="p">{</span><span class="n">coord</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_keys</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>  <span class="o">|</span> <span class="p">{</span><span class="n">coord</span><span class="p">:</span> <span class="mi">4000</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coord_keys</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following functions handle the homogenisation of origin data to a consistent format using the <a class="reference external" href="https://ecmwf-projects.github.io/c3s-atlas/intro.html" rel="noreferrer" target="_blank">User-tools for the C3S Atlas</a>:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Homogenisation of origin dataset</span>
<span class="k">def</span><span class="w"> </span><span class="nf">homogenise</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">project_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Homogenise a dataset `ds` for one variable `var_name` &quot;&quot;&quot;</span>
    <span class="n">var_mapping</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;dataset_variable&quot;</span><span class="p">:</span> <span class="p">{</span><span class="n">var_name</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">},</span>
                <span class="s2">&quot;aggregation&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="s2">&quot;mean&quot;</span><span class="p">},</span>
        <span class="p">}</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">apply_fixers</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">var_name</span><span class="p">,</span> <span class="n">project_id</span><span class="p">,</span> <span class="n">var_mapping</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">data</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following functions handle regridding data based on ESMF as implemented in the <a class="reference external" href="https://ecmwf-projects.github.io/c3s-atlas/intro.html" rel="noreferrer" target="_blank">User-tools for the C3S Atlas</a>.
This step is explained in more detail in the relevant section below.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">padded_range</span><span class="p">(</span><span class="n">start</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">stop</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">step</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given a range, e.g. (-89.5, 89.5, 1.), create a padded np.arange that includes the stop. &quot;&quot;&quot;</span>
    <span class="n">stop</span> <span class="o">=</span> <span class="n">stop</span> <span class="o">+</span> <span class="n">step</span><span class="o">/</span><span class="mf">100.</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">stop</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>

<span class="c1"># Regridding from native grid to C3S Atlas grid</span>
<span class="k">def</span><span class="w"> </span><span class="nf">regrid</span><span class="p">(</span><span class="n">ds</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                <span class="n">lat_range</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">89.5</span><span class="p">,</span> <span class="mf">89.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span> <span class="n">lon_range</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">179.5</span><span class="p">,</span> <span class="mf">179.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">))</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Regrid a dataset `ds` for one variable `var_name`. &quot;&quot;&quot;</span>
    <span class="n">int_attr</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;interpolation_method&quot;</span><span class="p">:</span> <span class="s2">&quot;conservative_normed&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lats&quot;</span><span class="p">:</span> <span class="n">padded_range</span><span class="p">(</span><span class="o">*</span><span class="n">lat_range</span><span class="p">),</span>
                <span class="s2">&quot;lons&quot;</span><span class="p">:</span> <span class="n">padded_range</span><span class="p">(</span><span class="o">*</span><span class="n">lon_range</span><span class="p">),</span>
                <span class="s2">&quot;var_name&quot;</span><span class="p">:</span> <span class="n">var_name</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">INTER</span> <span class="o">=</span> <span class="n">xesmfCICA</span><span class="o">.</span><span class="n">Interpolator</span><span class="p">(</span><span class="n">int_attr</span><span class="p">)</span>
    <span class="n">ds_interp</span> <span class="o">=</span> <span class="n">INTER</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds_interp</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="statistics">
<h5>Statistics<a class="headerlink" href="#statistics" title="Link to this heading">#</a></h5>
<p>The following functions calculate the difference (absolute / relative) between datasets, handling metadata etc.:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Constants</span>
<span class="n">NONZERO_THRESHOLD</span> <span class="o">=</span> <span class="mf">1e-5</span>
<span class="n">NONZERO_THRESHOLD_PCT</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Difference between datasets</span>
<span class="k">def</span><span class="w"> </span><span class="nf">difference_between_datasets</span><span class="p">(</span><span class="n">data1</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">data2</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">diff_variables</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the difference between two datasets, preserving CRS and metadata. &quot;&quot;&quot;</span>
    <span class="c1"># Align</span>
    <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">align</span><span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s2">&quot;inner&quot;</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Subtract</span>
    <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="s2">&quot;lat_bnds&quot;</span><span class="p">,</span> <span class="s2">&quot;lon_bnds&quot;</span><span class="p">,</span> <span class="s2">&quot;time_bnds&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)]</span>
    <span class="n">difference</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">data1</span><span class="p">[</span><span class="n">diff_variables</span><span class="p">],</span> <span class="n">data2</span><span class="p">[</span><span class="n">diff_variables</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">difference</span>

<span class="k">def</span><span class="w"> </span><span class="nf">relative_difference_between_datasets</span><span class="p">(</span><span class="n">data1</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">data2</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">reldiff_variables</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the relative [%] difference between two datasets, preserving CRS and updating metadata.</span>
<span class="sd">    Relative difference is calculated relative to the first dataset.</span>
<span class="sd">    Where data1 == 0 and data2 == 0, the relative difference is set to 0 too.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Select and calculate</span>
    <span class="n">data1</span><span class="p">,</span> <span class="n">data2</span> <span class="o">=</span> <span class="p">[</span><span class="n">dataset</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">dataset</span><span class="o">.</span><span class="n">data_vars</span> <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">reldiff_variables</span><span class="p">,</span> <span class="s2">&quot;crs&quot;</span><span class="p">]])</span> \
                        <span class="k">for</span> <span class="n">dataset</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)]</span>

    <span class="n">relative_difference</span> <span class="o">=</span> <span class="p">(</span><span class="n">data1</span> <span class="o">-</span> <span class="n">data2</span><span class="p">)</span> <span class="o">/</span> <span class="n">data1</span> <span class="o">*</span> <span class="mf">100.</span>

    <span class="c1"># Replace 0/0 with 0</span>
    <span class="n">data1_zero</span> <span class="o">=</span> <span class="p">(</span><span class="n">data1</span> <span class="o">&lt;=</span> <span class="n">NONZERO_THRESHOLD</span><span class="p">)</span>  <span class="c1"># Threshold slightly &gt; 0 because of floating-point errors</span>
    <span class="n">relative_difference</span> <span class="o">=</span> <span class="n">relative_difference</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">data1_zero</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)</span>

    <span class="c1"># Add name</span>
    <span class="n">relative_difference</span> <span class="o">=</span> <span class="n">relative_difference</span><span class="o">.</span><span class="n">assign_attrs</span><span class="p">({</span><span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;C3S Atlas ‚Äì Reproduced [%]&quot;</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">relative_difference</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fraction_over_threshold</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="o">=</span><span class="n">NONZERO_THRESHOLD</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Calculate the % of non-NaN cells in a dataframe greater than a given threshold. &quot;&quot;&quot;</span>
    <span class="n">data_over</span> <span class="o">=</span> <span class="p">(</span><span class="n">data</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span>
    <span class="n">frac_over</span> <span class="o">=</span> <span class="n">data_over</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">data_over</span><span class="o">.</span><span class="n">count</span><span class="p">()</span> <span class="o">*</span> <span class="mf">100.</span>
    <span class="k">return</span> <span class="n">frac_over</span>

<span class="n">fraction_over_threshold_relative</span> <span class="o">=</span> <span class="n">partial</span><span class="p">(</span><span class="n">fraction_over_threshold</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">NONZERO_THRESHOLD_PCT</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following functions calculate and display metrics for the difference between two datasets, e.g. mean and median deviation:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_comparison_statistics_single</span><span class="p">(</span><span class="n">dataset1</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">indicator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                  <span class="n">do_relative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given two datasets, calculate a number of statistics for one variable and return the result in a table.</span>
<span class="sd">    This version is hardcoded for one indicator in one year.</span>
<span class="sd">    Run this multiple times in a loop to do multiple origins.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Calculate differences</span>
    <span class="n">differences</span> <span class="o">=</span> <span class="n">difference_between_datasets</span><span class="p">(</span><span class="n">dataset1</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="n">diff_variables</span><span class="o">=</span><span class="p">[</span><span class="n">indicator</span><span class="p">,])</span>
    <span class="n">differences_abs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">differences</span><span class="p">)</span>

    <span class="c1"># Calculate relative difference if desired</span>
    <span class="k">if</span> <span class="n">do_relative</span><span class="p">:</span>
        <span class="n">differences_rel</span> <span class="o">=</span> <span class="n">relative_difference_between_datasets</span><span class="p">(</span><span class="n">dataset1</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="n">reldiff_variables</span><span class="o">=</span><span class="p">[</span><span class="n">indicator</span><span class="p">,])</span>
        <span class="n">differences_rel_abs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">ufuncs</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">differences_rel</span><span class="p">)</span>

    <span class="c1"># Calculate aggregate statistics</span>
    <span class="c1"># (n.b. in dask, this only queues them up, doesn&#39;t actually compute)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span><span class="sa">r</span><span class="s2">&quot;Mean Œî&quot;</span><span class="p">:</span> <span class="n">differences</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span>
             <span class="sa">r</span><span class="s2">&quot;Median Œî&quot;</span><span class="p">:</span> <span class="n">nanmedian</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">differences</span><span class="p">[</span><span class="n">indicator</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
             <span class="sa">r</span><span class="s2">&quot;Median |Œî|&quot;</span><span class="p">:</span> <span class="n">nanmedian</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">differences_abs</span><span class="p">[</span><span class="n">indicator</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
             <span class="sa">r</span><span class="s2">&quot;% where |Œî| ‚â• Œµ&quot;</span><span class="p">:</span> <span class="n">fraction_over_threshold</span><span class="p">(</span><span class="n">differences_abs</span><span class="p">[</span><span class="n">indicator</span><span class="p">]),</span>
            <span class="p">}</span>

    <span class="k">if</span> <span class="n">do_relative</span><span class="p">:</span>
        <span class="n">stats_rel</span> <span class="o">=</span> <span class="p">{</span><span class="sa">r</span><span class="s2">&quot;Median |Œî| [%]&quot;</span><span class="p">:</span> <span class="n">nanmedian</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">differences_rel_abs</span><span class="p">[</span><span class="n">indicator</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                     <span class="sa">rf</span><span class="s2">&quot;% where |Œî| ‚â• </span><span class="si">{</span><span class="n">NONZERO_THRESHOLD_PCT</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">:</span> <span class="n">fraction_over_threshold_relative</span><span class="p">(</span><span class="n">differences_rel_abs</span><span class="p">[</span><span class="n">indicator</span><span class="p">]),</span>
                    <span class="p">}</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span> <span class="o">|</span> <span class="n">stats_rel</span>

    <span class="c1"># Calculate correlation coefficients</span>
    <span class="n">corrs</span> <span class="o">=</span> <span class="p">{</span><span class="sa">r</span><span class="s2">&quot;Pearson r&quot;</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">dataset1</span><span class="p">[</span><span class="n">indicator</span><span class="p">],</span> <span class="n">dataset2</span><span class="p">[</span><span class="n">indicator</span><span class="p">])}</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">stats</span> <span class="o">|</span> <span class="n">corrs</span>

    <span class="c1"># Perform the queued-up calculations</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="nb">float</span><span class="p">(</span><span class="n">stat</span><span class="p">)</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">stat</span> <span class="ow">in</span> <span class="n">stats</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>

    <span class="c1"># Combine statistics into one dataframe</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">({</span><span class="n">indicator</span><span class="p">:</span> <span class="n">stats</span><span class="p">},</span> <span class="n">orient</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stats</span>

<span class="k">def</span><span class="w"> </span><span class="nf">comparison_statistics</span><span class="p">(</span><span class="n">dataset1</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">indicator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                          <span class="n">do_relative</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Given two dicts of datasets, calculate a number of statistics for one variable and return the result in a table.</span>
<span class="sd">    This version is hardcoded for one indicator, one year, multiple datasets.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup: origins</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dataset1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">dataset2</span><span class="p">]</span>
    <span class="n">loop_origins</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">common_keys</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Calculating for datasets&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Calculate statistics per dataset, combine result, return</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">[</span><span class="n">_comparison_statistics_single</span><span class="p">(</span><span class="n">dataset1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">dataset2</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">indicator</span><span class="p">,</span> <span class="n">do_relative</span><span class="o">=</span><span class="n">do_relative</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">{</span><span class="n">indicator</span><span class="p">:</span> <span class="n">key</span><span class="p">})</span>
             <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loop_origins</span><span class="p">]</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">stats</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">stats</span>

<span class="k">def</span><span class="w"> </span><span class="nf">display_difference_stats</span><span class="p">(</span><span class="n">dataset1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span>
                             <span class="n">glue_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Given two dicts of datasets, calculate a number of statistics for each pair and display the result in a table. &quot;&quot;&quot;</span>
    <span class="n">comparison_stats</span> <span class="o">=</span> <span class="n">comparison_statistics</span><span class="p">(</span><span class="n">dataset1</span><span class="p">,</span> <span class="n">dataset2</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">formatted</span> <span class="o">=</span> <span class="n">comparison_stats</span><span class="o">.</span><span class="n">style</span> \
                                <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">precision</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>  \
                                <span class="o">.</span><span class="n">set_caption</span><span class="p">(</span><span class="s2">&quot;C3S Atlas ‚Äì Reproduced&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">formatted</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="visualisation">
<h5>Visualisation<a class="headerlink" href="#visualisation" title="Link to this heading">#</a></h5>
<p>The following cells contain functions for plotting results, starting with some base helper functions (e.g. displaying in Jupyter Notebook or Jupyter Book style, adding textboxes with consistent formatting, etc.):</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualisation: Helper functions, general</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_glue_or_show</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="n">glue_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    If `glue` is available, glue the figure using the provided label.</span>
<span class="sd">    If not, display the figure in the notebook.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">glue</span><span class="p">(</span><span class="n">glue_label</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_add_textbox_to_subplots</span><span class="p">(</span><span class="n">text</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="n">axs</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="n">ekp</span><span class="o">.</span><span class="n">Subplot</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Add a text box to each of the specified subplots. &quot;&quot;&quot;</span>
    <span class="c1"># Get the plt.Axes for each ekp.Subplot</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="p">[</span><span class="n">subplot</span><span class="o">.</span><span class="n">ax</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">subplot</span><span class="p">,</span> <span class="n">ekp</span><span class="o">.</span><span class="n">Subplot</span><span class="p">)</span> <span class="k">else</span> <span class="n">subplot</span> <span class="k">for</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">]</span>

    <span class="c1"># Set up location</span>
    <span class="n">x</span> <span class="o">=</span> <span class="mf">0.95</span> <span class="k">if</span> <span class="n">right</span> <span class="k">else</span> <span class="mf">0.05</span>
    <span class="n">horizontalalignment</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span> <span class="k">if</span> <span class="n">right</span> <span class="k">else</span> <span class="s2">&quot;left&quot;</span>

    <span class="c1"># Add the text</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">horizontalalignment</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
        <span class="n">bbox</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;facecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="s2">&quot;edgecolor&quot;</span><span class="p">:</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;boxstyle&quot;</span><span class="p">:</span> <span class="s2">&quot;round&quot;</span><span class="p">,</span>
              <span class="s2">&quot;alpha&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">})</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_sharexy</span><span class="p">(</span><span class="n">axs</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Force all of the axes in axs to share x and y with the first element. &quot;&quot;&quot;</span>
    <span class="n">main_ax</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">sharex</span><span class="p">(</span><span class="n">main_ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">sharey</span><span class="p">(</span><span class="n">main_ax</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">_symmetric_xlim</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Adjust the xlims for one Axes to be symmetric, based on existing values. &quot;&quot;&quot;</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">current</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
    <span class="n">maxlim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
    <span class="n">newlim</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">maxlim</span><span class="p">,</span> <span class="n">maxlim</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">newlim</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following functions are also base helper functions, but specific to geospatial plots:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualisation: Helper functions for geospatial plots</span>
<span class="k">def</span><span class="w"> </span><span class="nf">_spatial_plot_append_subplots</span><span class="p">(</span><span class="n">fig</span><span class="p">:</span> <span class="n">ekp</span><span class="o">.</span><span class="n">Figure</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span><span class="p">:</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyDomain</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ekp</span><span class="o">.</span><span class="n">Subplot</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot; Plot any number of datasets into new subplots in an existing earthkit figure. &quot;&quot;&quot;</span>
    <span class="c1"># Create subplots</span>
    <span class="n">subplots</span> <span class="o">=</span> <span class="p">[</span><span class="n">fig</span><span class="o">.</span><span class="n">add_map</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>

    <span class="c1"># Plot</span>
    <span class="k">for</span> <span class="n">subplot</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">subplots</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">subplot</span><span class="o">.</span><span class="n">grid_cells</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot;lon&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">subplots</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following cell contains functions for geospatial comparisons between datasets on their native grids or on a common grid (the latter also showing the per-pixel difference):</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">geospatial_comparison_multiple_origins</span><span class="p">(</span><span class="n">data1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span> <span class="n">data2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">xr</span><span class="o">.</span><span class="n">Dataset</span><span class="p">],</span> <span class="n">indicator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                           <span class="n">label1</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;C3S Atlas dataset&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Reproduced from origin&quot;</span><span class="p">,</span>
                                           <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyDomain</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                           <span class="n">glue_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot one indicator in multiple dicts of datasets.</span>
<span class="sd">    A specific date (e.g. year+month as &quot;2010-06&quot;) has to be specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup: origins</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data2</span><span class="p">]</span>
    <span class="n">n_datasets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_keys</span><span class="p">)</span>
    <span class="n">loop_origins</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">common_keys</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Plotting datasets&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Create figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">ekp</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_datasets</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="o">*</span><span class="n">n_datasets</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loop_origins</span><span class="p">:</span>
        <span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)]</span>

        <span class="c1"># Plot individual datasets</span>
        <span class="n">subplots_data</span> <span class="o">=</span> <span class="n">_spatial_plot_append_subplots</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                                      <span class="n">z</span><span class="o">=</span><span class="n">indicator</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">indicator</span><span class="p">])</span>

        <span class="c1"># Decorate: Text</span>
        <span class="n">_add_textbox_to_subplots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">subplots_data</span><span class="p">)</span>

    <span class="c1"># Colour bar at the bottom</span>
    <span class="k">for</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]:</span>
        <span class="n">subplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">indicator</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>

    <span class="c1"># Titles on top</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">):</span>
        <span class="n">subplot</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Decorate figure</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">land</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;grid.linestyle&quot;</span><span class="p">])</span>

    <span class="c1"># Show result</span>
    <span class="n">_glue_or_show</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">glue_label</span><span class="p">)</span>


<span class="c1"># Visualisation: Plot indicators geospatially</span>
<span class="k">def</span><span class="w"> </span><span class="nf">geospatial_comparison_multiple_origin_with_difference</span><span class="p">(</span><span class="n">data1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">data2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">indicator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">date</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                                          <span class="n">label1</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;C3S Atlas dataset&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Reproduced from origin&quot;</span><span class="p">,</span>
                                                          <span class="n">domain</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">AnyDomain</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                                          <span class="n">glue_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot one indicator in multiple dicts of datasets.</span>
<span class="sd">    A specific date (e.g. year+month as &quot;2010-06&quot;) has to be specified.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup: origins</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data2</span><span class="p">]</span>
    <span class="n">n_datasets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_keys</span><span class="p">)</span>
    <span class="n">loop_origins</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">common_keys</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Plotting datasets&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Create figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">ekp</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="n">n_datasets</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="mf">7.5</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_datasets</span><span class="p">)))</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">loop_origins</span><span class="p">:</span>
        <span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;nearest&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="p">(</span><span class="n">data1</span><span class="p">,</span> <span class="n">data2</span><span class="p">)]</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">difference_between_datasets</span><span class="p">(</span><span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span><span class="p">,</span> <span class="n">diff_variables</span><span class="o">=</span><span class="p">[</span><span class="n">indicator</span><span class="p">,])</span>

        <span class="c1"># Plot individual datasets</span>
        <span class="n">subplots_data</span> <span class="o">=</span> <span class="n">_spatial_plot_append_subplots</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                                      <span class="n">z</span><span class="o">=</span><span class="n">indicator</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="n">indicator</span><span class="p">])</span>

        <span class="c1"># Plot difference</span>
        <span class="n">subplot_diff</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_map</span><span class="p">(</span><span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">)</span>
        <span class="n">subplot_diff</span><span class="o">.</span><span class="n">grid_cells</span><span class="p">(</span><span class="n">difference</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">indicator</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">styles</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">_diff&quot;</span><span class="p">])</span>

        <span class="c1"># Decorate: Text</span>
        <span class="n">_add_textbox_to_subplots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">subplots_data</span><span class="p">,</span> <span class="n">subplot_diff</span><span class="p">)</span>

    <span class="c1"># Colour bar at the bottom</span>
    <span class="k">for</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="n">subplots_data</span><span class="p">:</span>
        <span class="n">subplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">indicator</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>
    <span class="n">subplot_diff</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Difference&quot;</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span>


    <span class="c1"># Titles on top</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">,</span> <span class="s2">&quot;Difference&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">subplot</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">fig</span><span class="o">.</span><span class="n">subplots</span><span class="p">):</span>
        <span class="n">subplot</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Decorate figure</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">land</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">coastlines</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">linestyle</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;grid.linestyle&quot;</span><span class="p">])</span>

    <span class="c1"># Show result</span>
    <span class="n">_glue_or_show</span><span class="p">(</span><span class="n">fig</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span> <span class="n">glue_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>The following cell contains functions for histogram comparisons between datasets on their native grids or on a common grid (the latter also showing the per-pixel difference):</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Visualisation: Plot data in histograms</span>
<span class="k">def</span><span class="w"> </span><span class="nf">histogram_comparison_by_origin</span><span class="p">(</span><span class="n">data1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">data2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">indicator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                   <span class="n">label1</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;C3S Atlas dataset&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Reproduced from origin&quot;</span><span class="p">,</span>
                                   <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                   <span class="n">glue_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a histogram for one indicator in multiple dicts of datasets.</span>
<span class="sd">    Flattens all data in the datasets, including spatial and temporal dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup: origins</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data2</span><span class="p">]</span>
    <span class="n">n_datasets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_keys</span><span class="p">)</span>
    <span class="n">loop_origins</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">common_keys</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Plotting datasets&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">n_datasets</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s2">&quot;row&quot;</span><span class="p">,</span>
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_datasets</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Plot histograms of data</span>
    <span class="c1"># Loop over rows / origins</span>
    <span class="k">for</span> <span class="n">ax_row</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">loop_origins</span><span class="p">):</span>
        <span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">data2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax_row</span><span class="p">,</span> <span class="p">(</span><span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span><span class="p">)):</span>
            <span class="c1"># Flatten data</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="c1"># Create histogram</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

            <span class="c1"># Labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>

        <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>

        <span class="c1"># Identify panel</span>
        <span class="n">date_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">_add_textbox_to_subplots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}{</span><span class="n">date_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">ax_row</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Titles on top</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Show result</span>
    <span class="n">_glue_or_show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">glue_label</span><span class="p">)</span>


<span class="c1"># Visualisation: Plot data + difference in histograms</span>
<span class="k">def</span><span class="w"> </span><span class="nf">histogram_comparison_by_origin_with_difference</span><span class="p">(</span><span class="n">data1</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">data2</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">indicator</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
                                                   <span class="n">label1</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;C3S Atlas dataset&quot;</span><span class="p">,</span> <span class="n">label2</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s2">&quot;Reproduced from origin&quot;</span><span class="p">,</span>
                                                   <span class="n">year</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                                   <span class="n">glue_label</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot a histogram for one indicator in multiple dicts of datasets, including the point-by-point difference.</span>
<span class="sd">    Flattens all data in the datasets, including spatial and temporal dimensions.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Setup: origins</span>
    <span class="n">common_keys</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data1</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">data2</span><span class="p">]</span>
    <span class="n">n_datasets</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">common_keys</span><span class="p">)</span>
    <span class="n">loop_origins</span> <span class="o">=</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">common_keys</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s2">&quot;Plotting datasets&quot;</span><span class="p">,</span> <span class="n">leave</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Create figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">n_datasets</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">n_datasets</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="n">squeeze</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Setup x/y share -- cannot be done in plt.subplots because of difference panel not sharing these</span>
    <span class="n">_sharexy</span><span class="p">(</span><span class="n">axs</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="c1"># _sharexy(axs[:, -1])  # Leave out for now -- ALlow differences between origin datasets</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">labelbottom</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">labelleft</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelright</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Plot histograms of data</span>
    <span class="c1"># Loop over rows / origins</span>
    <span class="k">for</span> <span class="n">ax_row</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axs</span><span class="p">,</span> <span class="n">loop_origins</span><span class="p">):</span>
        <span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span> <span class="o">=</span> <span class="n">data1</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">data2</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">difference</span> <span class="o">=</span> <span class="n">difference_between_datasets</span><span class="p">(</span><span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span><span class="p">,</span> <span class="n">diff_variables</span><span class="o">=</span><span class="p">[</span><span class="n">indicator</span><span class="p">,])</span>

        <span class="c1"># Loop over columns / data</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">ax_row</span><span class="p">,</span> <span class="p">(</span><span class="n">data1_here</span><span class="p">,</span> <span class="n">data2_here</span><span class="p">)):</span>
            <span class="c1"># Flatten data</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

            <span class="c1"># Create histogram</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

            <span class="c1"># Labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">indicator</span><span class="p">)</span>

            <span class="c1"># Plot difference</span>
            <span class="n">difference_here</span> <span class="o">=</span> <span class="n">difference</span><span class="p">[</span><span class="n">indicator</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
            <span class="n">ax_row</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">difference_here</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="n">log</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>

        <span class="n">ax_row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>

        <span class="c1"># Identify panel</span>
        <span class="n">date_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">)&quot;</span> <span class="k">if</span> <span class="n">year</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
        <span class="n">_add_textbox_to_subplots</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key</span><span class="si">}{</span><span class="n">date_label</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">ax_row</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]:</span>  <span class="c1"># Symmetric xlims for difference</span>
        <span class="n">_symmetric_xlim</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># Titles on top</span>
    <span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="n">label1</span><span class="p">,</span> <span class="n">label2</span><span class="p">,</span> <span class="s2">&quot;Difference&quot;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Show result</span>
    <span class="n">_glue_or_show</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">glue_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
</section>
<section id="calculate-and-retrieve-indicators">
<span id="derived-multi-origin-c3s-atlas-consistency-q03-section-indicators"></span><h3>2. Calculate and retrieve indicators<a class="headerlink" href="#calculate-and-retrieve-indicators" title="Link to this heading">#</a></h3>
<p>In the previous two notebooks in this assessment,
the origin data were downloaded,
pre-processed,
used to calculate the relevant indicator(s),
and regridded;
after which the <a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank">Atlas dataset</a> was downloaded.
This notebook follows the same structure but for each origin in turn,
for clarity and to preserve memory when loading multiple datasets at the same time.
As such,
the individual steps are described in less detail,
because this information is available in the previous notebooks.</p>
<p>If you are only interested in specific origin datasets,
or want to limit your bandwidth or memory usage,
you can choose to only run specific subsections below.</p>
<p>This assessment examines the dataset in one year (2080),
for one ensemble member
and
for one climate scenario
‚Äì which is not how climate projection data are normally used.
Good practice in climate science is to look at multi-year statistics and trends,
across multiple ensemble members.
However, since the purpose of this assessment is to assess the consistency and reproducibility of the post-processing performed to produce the C3S Atlas dataset,
it is valid to use a subset of the data here.
The specific subset used can be easily tweaked by changing the <code class="docutils literal notranslate"><span class="pre">EXPERIMENT</span></code>, <code class="docutils literal notranslate"><span class="pre">MODEL</span></code>, and <code class="docutils literal notranslate"><span class="pre">YEARS</span></code> variables in the relevant sections.</p>
<p>This notebook uses <a class="reference external" href="https://github.com/ecmwf/earthkit-data" rel="noreferrer" target="_blank">earthkit-data</a> to download files from the CDS.
If you intend to run this notebook multiple times, it is highly recommended that you <a class="reference external" href="https://earthkit-data.readthedocs.io/en/latest/guide/caching.html" rel="noreferrer" target="_blank">enable caching</a> to prevent having to download the same files multiple times.
If you prefer not to use earthkit, the following requests can also be used with the <a class="reference external" href="https://cds.climate.copernicus.eu/how-to-api#linux-use-client-step" rel="noreferrer" target="_blank">cdsapi module</a>.
In either case (earthkit-data or cdsapi), it is required to set up a CDS account and API key as explained <a class="reference external" href="https://cds.climate.copernicus.eu/how-to-api" rel="noreferrer" target="_blank">on the CDS website</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This notebook uses <a class="reference external" href="https://github.com/pangeo-data/xESMF" rel="noreferrer" target="_blank">xESMF</a> for regridding data.
xESMF is most easily installed using mamba/conda as explained in its documentation.
Users who cannot or do not wish to use mamba/conda can manually compile and install <a class="reference external" href="https://earthsystemmodeling.org/docs/release/latest/ESMF_usrdoc/node10.html" rel="noreferrer" target="_blank">ESMF</a> on their machines.
In future, this notebook will use <a class="reference external" href="https://github.com/ecmwf/earthkit-regrid" rel="noreferrer" target="_blank">earthkit-regrid</a> instead, once it reaches suitable maturity.</p>
</div>
<p>Note that the C3S Atlas workflow calculates indicators first, then regrids.
For operations that involve averaging, like smoothing and regridding, the order of operations can affect the result, especially in areas with steep gradients [<a class="reference external" href="https://doi.org/10.1364/OE.391470" rel="noreferrer" target="_blank">Burggraaff+20</a>].
Examples of such areas for a temperature index are coastlines and mountain ranges.
In the case of C3S Atlas, this order of operations was a conscious choice to preserve the ‚Äúraw‚Äù signals,
e.g. preventing extreme temperatures from being smoothed out.
However, it can affect the indicator values and therefore must be considered when using the C3S Atlas application or dataset.</p>
<section id="general-setup">
<h4>General setup<a class="headerlink" href="#general-setup" title="Link to this heading">#</a></h4>
<p>Throughout this section,
we combine the downloaded datasets into dictionaries for easy access.
They cannot be combined into a single xarray object because of differing grids.
Each dataset is added in its own subsection,
meaning any datasets not downloaded will automatically be skipped in the analysis.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Constants to ensure consistency between origins</span>
<span class="c1"># Change these to customise the analysis</span>
<span class="n">YEAR_HISTORICAL</span> <span class="o">=</span> <span class="s2">&quot;2010&quot;</span>
<span class="n">YEAR_FUTURE</span>     <span class="o">=</span> <span class="s2">&quot;2080&quot;</span>

<span class="c1"># All days and months</span>
<span class="n">MONTHS</span>  <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)]</span>
<span class="n">DAYS</span>    <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span>   <span class="k">for</span> <span class="n">day</span>   <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)]</span>
<span class="n">HOURS24</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">h</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">:00&quot;</span>   <span class="k">for</span> <span class="n">h</span>     <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">24</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">C3S_ATLAS_ID</span> <span class="o">=</span> <span class="s2">&quot;multi-origin-c3s-atlas&quot;</span>
<span class="n">BIAS_ADJUSTMENT</span> <span class="o">=</span> <span class="s2">&quot;no_bias_adjustment&quot;</span>

<span class="c1"># Templates for C3S Atlas requests</span>
<span class="n">request_c3s_atlas_tx35</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_extreme_hot_days&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bias_adjustment&quot;</span><span class="p">:</span> <span class="n">BIAS_ADJUSTMENT</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">request_c3s_atlas_sst</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_sea_surface_temperature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bias_adjustment&quot;</span><span class="p">:</span> <span class="n">BIAS_ADJUSTMENT</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">request_c3s_atlas_r01</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;monthly_wet_days&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bias_adjustment&quot;</span><span class="p">:</span> <span class="n">BIAS_ADJUSTMENT</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c3s_atlas_tx35_future</span>                <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_tx35_future</span>                   <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_c3s_atlasgrid_tx35_future</span>     <span class="o">=</span> <span class="p">{}</span>

<span class="n">c3s_atlas_tx35_historical</span>            <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_tx35_historical</span>               <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_c3s_atlasgrid_tx35_historical</span> <span class="o">=</span> <span class="p">{}</span>

<span class="n">c3s_atlas_sst</span>                        <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_sst</span>                           <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_c3s_atlasgrid_sst</span>             <span class="o">=</span> <span class="p">{}</span>

<span class="n">c3s_atlas_r01</span>                        <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_r01</span>                           <span class="o">=</span> <span class="p">{}</span>
<span class="n">origin_c3s_atlasgrid_r01</span>             <span class="o">=</span> <span class="p">{}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="cmip6">
<h4>CMIP6<a class="headerlink" href="#cmip6" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Customisable options for this dataset</span>
<span class="n">CMIP6_MODEL</span> <span class="o">=</span> <span class="s2">&quot;cmcc_esm2&quot;</span>
<span class="n">CMIP6_EXPERIMENT</span> <span class="o">=</span> <span class="s2">&quot;ssp5_8_5&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">CMIP6_ID</span> <span class="o">=</span> <span class="s2">&quot;projections-cmip6&quot;</span>
<span class="n">request_CMIP6</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">CMIP6_EXPERIMENT</span><span class="p">,</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">CMIP6_MODEL</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;daily_maximum_near_surface_air_temperature&quot;</span><span class="p">],</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_FUTURE</span><span class="p">,],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">MONTHS</span><span class="p">,</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">DAYS</span><span class="p">,</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator, regrid</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">CMIP6_ID</span><span class="p">,</span> <span class="n">request_CMIP6</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">CMIP6_ID</span><span class="p">)</span>
<span class="n">indicator_CMIP6</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">propagate_nan</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">regridded_CMIP6</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">indicator_CMIP6</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span>
                                 <span class="n">lat_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">89.5</span><span class="p">,</span> <span class="mf">89.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">lon_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">179.5</span><span class="p">,</span> <span class="mf">179.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unknown file type, no reader available. path=/home/ob2/cds_data/cds-67885792c67c919c6adef8f9452ca11327458aa2fc79e661bd6835af4bbb1791.d/provenance.png magic=b&#39;\x89PNG\r\n\x1a\n\x00\x00\x00\rIHDR\x00\x00\n\xd3\x00\x00\x03&quot;\x08\x02\x00\x00\x00\x99\xec9+\x00\x00\x00\x06bKGD\x00\xff\x00\xff\x00\xff\xa0\xbd\xa7\x93\x00\x00 \x00IDATx\x9c\xec\xddw&#39; content_type=None
2025-10-13 16:44:59,142 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Dataset has already the correct names for its coordinates
2025-10-13 16:44:59,155 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 81MB
Dimensions:    (time: 365, bnds: 2, lat: 192, lon: 288)
Coordinates:
  * time       (time) object 3kB 2080-01-01 12:00:00 ... 2080-12-31 12:00:00
  * lat        (lat) float64 2kB -90.0 -89.06 -88.12 -87.17 ... 88.12 89.06 90.0
  * lon        (lon) float64 2kB 0.0 1.25 2.5 3.75 ... 355.0 356.2 357.5 358.8
    height     float64 8B ...
Dimensions without coordinates: bnds
Data variables:
    time_bnds  (time, bnds) object 6kB dask.array&lt;chunksize=(1, 2), meta=np.ndarray&gt;
    lat_bnds   (lat, bnds) float64 3kB dask.array&lt;chunksize=(192, 2), meta=np.ndarray&gt;
    lon_bnds   (lon, bnds) float64 5kB dask.array&lt;chunksize=(288, 2), meta=np.ndarray&gt;
    tasmax     (time, lat, lon) float32 81MB dask.array&lt;chunksize=(1, 192, 288), meta=np.ndarray&gt;
Attributes: (12/48)
    Conventions:            CF-1.7 CMIP-6.2
    activity_id:            ScenarioMIP
    branch_method:          standard
    branch_time_in_child:   60225.0
    branch_time_in_parent:  60225.0
    comment:                none
    ...                     ...
    title:                  CMCC-ESM2 output prepared for CMIP6
    variable_id:            tasmax
    variant_label:          r1i1p1f1
    license:                CMIP6 model data produced by CMCC is licensed und...
    cmor_version:           3.6.0
    tracking_id:            hdl:21.14100/ba2e335b-8bac-45ec-abbe-f1f16299d2d4
2025-10-13 16:44:59,332 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are not in the correct magnitude. A conversion from K to Celsius will be performed.
2025-10-13 16:44:59,405 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_cmip6</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;cmip6&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">CMIP6_EXPERIMENT</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_FUTURE</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_cmip6</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_FUTURE</span><span class="p">,</span> <span class="n">CMIP6_MODEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_future</span><span class="p">[</span><span class="s2">&quot;CMIP6&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_future</span><span class="p">[</span><span class="s2">&quot;CMIP6&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_CMIP6</span>
<span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">[</span><span class="s2">&quot;CMIP6&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridded_CMIP6</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="cmip5">
<h4>CMIP5<a class="headerlink" href="#cmip5" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Customisable options for this dataset</span>
<span class="n">CMIP5_MODEL</span> <span class="o">=</span> <span class="s2">&quot;access1_0&quot;</span>
<span class="n">CMIP5_MEMBER</span> <span class="o">=</span> <span class="s2">&quot;r1i1p1&quot;</span>
<span class="n">CMIP5_EXPERIMENT</span> <span class="o">=</span> <span class="s2">&quot;rcp_8_5&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">CMIP5_ID</span> <span class="o">=</span> <span class="s2">&quot;projections-cmip5-daily-single-levels&quot;</span>
<span class="n">request_CMIP5</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">CMIP5_EXPERIMENT</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;maximum_2m_temperature_in_the_last_24_hours&quot;</span><span class="p">],</span>
    <span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">CMIP5_MODEL</span><span class="p">,</span>
    <span class="s2">&quot;ensemble_member&quot;</span><span class="p">:</span> <span class="n">CMIP5_MEMBER</span><span class="p">,</span>
    <span class="c1"># Note: CMIP5 &quot;period&quot; cannot be [YEAR_FUTURE,]</span>
    <span class="c1"># You may have to change the following line if you want to change</span>
    <span class="c1"># YEAR_FUTURE, CMIP5_MODEL, or CMIP5_EXPERIMENT</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;20560101-20801231&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator, regrid</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">CMIP5_ID</span><span class="p">,</span> <span class="n">request_CMIP5</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">select_years_in_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="n">YEAR_FUTURE</span><span class="p">,])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">CMIP5_ID</span><span class="p">)</span>
<span class="n">indicator_CMIP5</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">regridded_CMIP5</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">indicator_CMIP5</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span>
                                 <span class="n">lat_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">89.</span><span class="p">,</span> <span class="mf">89.</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">lon_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">179.</span><span class="p">,</span> <span class="mf">179.</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-13 16:45:09,478 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Dataset has already the correct names for its coordinates
2025-10-13 16:45:09,481 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 41MB
Dimensions:    (time: 366, bnds: 2, lat: 145, lon: 192)
Coordinates:
  * time       (time) datetime64[ns] 3kB 2080-01-01T12:00:00 ... 2080-12-31T1...
  * lat        (lat) float64 1kB -90.0 -88.75 -87.5 -86.25 ... 87.5 88.75 90.0
  * lon        (lon) float64 2kB 0.0 1.875 3.75 5.625 ... 354.4 356.2 358.1
    height     float64 8B ...
Dimensions without coordinates: bnds
Data variables:
    time_bnds  (time, bnds) datetime64[ns] 6kB dask.array&lt;chunksize=(366, 2), meta=np.ndarray&gt;
    lat_bnds   (lat, bnds) float64 2kB dask.array&lt;chunksize=(145, 2), meta=np.ndarray&gt;
    lon_bnds   (lon, bnds) float64 3kB dask.array&lt;chunksize=(192, 2), meta=np.ndarray&gt;
    tasmax     (time, lat, lon) float32 41MB dask.array&lt;chunksize=(366, 145, 192), meta=np.ndarray&gt;
Attributes: (12/28)
    institution:            CSIRO (Commonwealth Scientific and Industrial Res...
    institute_id:           CSIRO-BOM
    experiment_id:          rcp85
    source:                 ACCESS1-0 2011. Atmosphere: AGCM v1.0 (N96 grid-p...
    model_id:               ACCESS1-0
    forcing:                GHG, Oz, SA, Sl, Vl, BC, OC, (GHG = CO2, N2O, CH4...
    ...                     ...
    table_id:               Table day (01 February 2012) b6353e9919862612c81d...
    title:                  ACCESS1-0 model output prepared for CMIP5 RCP8.5
    parent_experiment:      historical
    modeling_realm:         atmos
    realization:            1
    cmor_version:           2.8.0
2025-10-13 16:45:09,492 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are not in the correct magnitude. A conversion from K to Celsius will be performed.
2025-10-13 16:45:09,543 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_cmip5</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;cmip5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">CMIP5_EXPERIMENT</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_FUTURE</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_cmip5</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_FUTURE</span><span class="p">,</span> <span class="n">CMIP5_MODEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_future</span><span class="p">[</span><span class="s2">&quot;CMIP5&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_future</span><span class="p">[</span><span class="s2">&quot;CMIP5&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_CMIP5</span>
<span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">[</span><span class="s2">&quot;CMIP5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridded_CMIP5</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="cordex-eur-11">
<h4>CORDEX-EUR-11<a class="headerlink" href="#cordex-eur-11" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Customisable options for this dataset</span>
<span class="c1"># Note that the model nomenclature is different for the origin dataset (GCM, RCM separate) vs C3S Atlas (combined)</span>
<span class="c1"># If you want to change the model, be sure to edit all of the relevant lines below</span>
<span class="n">CORDEX_EUR_11_GCM</span> <span class="o">=</span> <span class="s2">&quot;ncc_noresm1_m&quot;</span>
<span class="n">CORDEX_EUR_11_RCM</span> <span class="o">=</span> <span class="s2">&quot;gerics_remo2015&quot;</span>
<span class="n">CORDEX_EUR_11_MODEL</span> <span class="o">=</span> <span class="s2">&quot;NCC_NorESM1-M_r1i1p1_GERICS_REMO2015_v1&quot;</span>
<span class="n">CORDEX_EUR_11_MEMBER</span> <span class="o">=</span> <span class="s2">&quot;r1i1p1&quot;</span>
<span class="n">CORDEX_EUR_11_EXPERIMENT</span> <span class="o">=</span> <span class="s2">&quot;rcp_8_5&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">CORDEX_EUR_11_ID</span> <span class="o">=</span> <span class="s2">&quot;projections-cordex-domains-single-levels&quot;</span>
<span class="n">request_CORDEX_EUR_11</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;europe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">CORDEX_EUR_11_EXPERIMENT</span><span class="p">,</span>
    <span class="s2">&quot;horizontal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;0_11_degree_x_0_11_degree&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;daily_mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;maximum_2m_temperature_in_the_last_24_hours&quot;</span><span class="p">],</span>
    <span class="s2">&quot;gcm_model&quot;</span><span class="p">:</span> <span class="n">CORDEX_EUR_11_GCM</span><span class="p">,</span>
    <span class="s2">&quot;rcm_model&quot;</span><span class="p">:</span> <span class="n">CORDEX_EUR_11_RCM</span><span class="p">,</span>
    <span class="s2">&quot;ensemble_member&quot;</span><span class="p">:</span> <span class="n">CORDEX_EUR_11_MEMBER</span><span class="p">,</span>
    <span class="c1"># Note: CORDEX &quot;start_year&quot; and &quot;end_year&quot; cannot be YEAR_FUTURE</span>
    <span class="c1"># and cannot be determined generically for the various model members</span>
    <span class="c1"># You may have to change the following line if you want to change</span>
    <span class="c1"># YEAR_FUTURE, CORDEX_EUR_11_MODEL, or CORDEX_EUR_11_EXPERIMENT</span>
    <span class="s2">&quot;start_year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2076&quot;</span><span class="p">],</span>
    <span class="s2">&quot;end_year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2080&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator, regrid</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">CORDEX_EUR_11_ID</span><span class="p">,</span> <span class="n">request_CORDEX_EUR_11</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">select_years_in_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="n">YEAR_FUTURE</span><span class="p">,])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">CORDEX_EUR_11_ID</span><span class="p">)</span>
<span class="n">indicator_CORDEX_EUR_11</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">regridded_CORDEX_EUR_11</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">indicator_CORDEX_EUR_11</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span>
                                         <span class="n">lat_range</span><span class="o">=</span><span class="p">(</span><span class="mf">21.8125</span><span class="p">,</span> <span class="mf">72.6875</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">),</span> <span class="n">lon_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">44.8125</span><span class="p">,</span> <span class="mf">65.1875</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-13 16:45:13,404 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing coordinates names: {&#39;rlon&#39;: &#39;x&#39;, &#39;rlat&#39;: &#39;y&#39;}
2025-10-13 16:45:13,407 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 263MB
Dimensions:                     (time: 366, bnds: 2, y: 412, x: 424, vertices: 4)
Coordinates:
  * time                        (time) datetime64[ns] 3kB 2080-01-01T12:00:00...
  * y                           (y) float64 3kB -23.38 -23.27 ... 21.72 21.84
  * x                           (x) float64 3kB -28.38 -28.27 ... 18.04 18.16
    lat                         (y, x) float32 699kB dask.array&lt;chunksize=(412, 424), meta=np.ndarray&gt;
    lon                         (y, x) float32 699kB dask.array&lt;chunksize=(412, 424), meta=np.ndarray&gt;
    height                      float64 8B ...
Dimensions without coordinates: bnds, vertices
Data variables:
    time_bnds                   (time, bnds) datetime64[ns] 6kB dask.array&lt;chunksize=(1, 2), meta=np.ndarray&gt;
    rotated_latitude_longitude  int32 4B ...
    lat_vertices                (y, x, vertices) float32 3MB dask.array&lt;chunksize=(412, 424, 4), meta=np.ndarray&gt;
    lon_vertices                (y, x, vertices) float32 3MB dask.array&lt;chunksize=(412, 424, 4), meta=np.ndarray&gt;
    tasmax                      (time, y, x) float32 256MB dask.array&lt;chunksize=(1, 412, 424), meta=np.ndarray&gt;
Attributes: (12/35)
    institution:                    Helmholtz-Zentrum Geesthacht, Climate Ser...
    institute_id:                   GERICS
    experiment_id:                  rcp85
    source:                         GERICS-REMO2015
    model_id:                       GERICS-REMO2015
    forcing:                        N/A
    ...                             ...
    parent_experiment:              N/A
    modeling_realm:                 atmos
    realization:                    1
    cmor_version:                   2.9.1
    tracking_id:                    hdl:21.14103/c3a4e035-9dcd-429f-a86d-8d53...
    c3s_disclaimer:                 This data has been produced in the contex...
2025-10-13 16:45:13,425 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are not in the correct magnitude. A conversion from K to Celsius will be performed.
2025-10-13 16:45:13,436 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_cordex_eur_11</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;cordex_eur_11&quot;</span><span class="p">,</span>
    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="n">CORDEX_EUR_11_EXPERIMENT</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;euro_cordex&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_FUTURE</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_cordex_eur_11</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_FUTURE</span><span class="p">,</span> <span class="n">CORDEX_EUR_11_MODEL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_future</span><span class="p">[</span><span class="s2">&quot;CORDEX-EUR-11&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_future</span><span class="p">[</span><span class="s2">&quot;CORDEX-EUR-11&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_CORDEX_EUR_11</span>
<span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">[</span><span class="s2">&quot;CORDEX-EUR-11&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridded_CORDEX_EUR_11</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="era5">
<h4>ERA5<a class="headerlink" href="#era5" title="Link to this heading">#</a></h4>
<p>Note that ERA5 data for a year are &gt;30 GB in size.
These data may take up to several hours to download
and
require sufficient storage to download and cache.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">ERA5_ID</span> <span class="o">=</span> <span class="s2">&quot;reanalysis-era5-single-levels&quot;</span>
<span class="n">request_ERA5</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;reanalysis&quot;</span><span class="p">],</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2m_temperature&quot;</span><span class="p">],</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">MONTHS</span><span class="p">,</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">DAYS</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">HOURS24</span><span class="p">,</span>
    <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;download_format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">ERA5_ID</span><span class="p">,</span> <span class="n">request_ERA5</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>  <span class="c1"># Hourly temperature</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cal_tasmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;t2m&quot;</span><span class="p">)</span>  <span class="c1"># Hourly temperature -&gt; Daily max temperature</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;valid_time&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">ERA5_ID</span><span class="p">)</span>
<span class="n">indicator_ERA5</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-13 16:45:32,294 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing coordinates names: {&#39;longitude&#39;: &#39;lon&#39;, &#39;latitude&#39;: &#39;lat&#39;}
2025-10-13 16:45:32,298 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 2GB
Dimensions:  (time: 365, lat: 721, lon: 1440)
Coordinates:
    number   int64 8B ...
  * lat      (lat) float64 6kB 90.0 89.75 89.5 89.25 ... -89.5 -89.75 -90.0
  * lon      (lon) float64 12kB 0.0 0.25 0.5 0.75 ... 359.0 359.2 359.5 359.8
  * time     (time) datetime64[ns] 3kB 2010-01-01 2010-01-02 ... 2010-12-31
Data variables:
    tasmax   (time, lat, lon) float32 2GB dask.array&lt;chunksize=(1, 52, 103), meta=np.ndarray&gt;
Attributes:
    GRIB_centre:             ecmf
    GRIB_centreDescription:  European Centre for Medium-Range Weather Forecasts
    GRIB_subCentre:          0
    Conventions:             CF-1.7
    institution:             European Centre for Medium-Range Weather Forecasts
    history:                 2025-10-07T20:34 GRIB to CDM+CF via cfgrib-0.9.1...
2025-10-13 16:45:32,381 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are not in the correct magnitude. A conversion from K to Celsius will be performed.
2025-10-13 16:45:34,651 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_era5</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;era5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_era5</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_historical</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_historical</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_ERA5</span>
<span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">[</span><span class="s2">&quot;ERA5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indicator_ERA5</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="era5-land">
<h4>ERA5-Land<a class="headerlink" href="#era5-land" title="Link to this heading">#</a></h4>
<p>Note that ERA5-Land data for a year are &gt;200 GB in size.
These data may take up to several hours to download
and
require sufficient storage to download and cache.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">ERA5_Land_ID</span> <span class="o">=</span> <span class="s2">&quot;reanalysis-era5-land&quot;</span>
<span class="n">request_ERA5_Land</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;2m_temperature&quot;</span><span class="p">],</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">MONTHS</span><span class="p">,</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="n">DAYS</span><span class="p">,</span>
    <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="n">HOURS24</span><span class="p">,</span>
    <span class="s2">&quot;data_format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
    <span class="s2">&quot;download_format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># ERA5-Land doesn&#39;t allow us to download a single year in one go, it has to be split into multiple requests</span>
<span class="n">multi_request_ERA5_Land</span> <span class="o">=</span> <span class="n">split_request_along_key</span><span class="p">(</span><span class="n">request_ERA5_Land</span><span class="p">,</span> <span class="s2">&quot;month&quot;</span><span class="p">)</span>

<span class="c1"># Download data, pre-process, calculate indicator</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">ERA5_Land_ID</span><span class="p">,</span> <span class="o">*</span><span class="n">multi_request_ERA5_Land</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">cal_tasmax</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;t2m&quot;</span><span class="p">)</span>  <span class="c1"># Hourly temperature -&gt; Daily max temperature</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;valid_time&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">ERA5_Land_ID</span><span class="p">)</span>
<span class="n">indicator_ERA5_Land</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 12/12 [00:00&lt;00:00, 247.68it/s]
2025-10-13 16:45:38,419 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing coordinates names: {&#39;longitude&#39;: &#39;lon&#39;, &#39;latitude&#39;: &#39;lat&#39;}
2025-10-13 16:45:38,422 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 9GB
Dimensions:  (time: 365, lat: 1801, lon: 3600)
Coordinates:
    number   int64 8B 0
  * lat      (lat) float64 14kB 90.0 89.9 89.8 89.7 ... -89.7 -89.8 -89.9 -90.0
  * lon      (lon) float64 29kB 0.0 0.1 0.2 0.3 0.4 ... 359.6 359.7 359.8 359.9
  * time     (time) datetime64[ns] 3kB 2010-01-01 2010-01-02 ... 2010-12-31
Data variables:
    tasmax   (time, lat, lon) float32 9GB dask.array&lt;chunksize=(1, 164, 328), meta=np.ndarray&gt;
Attributes:
    GRIB_centre:             ecmf
    GRIB_centreDescription:  European Centre for Medium-Range Weather Forecasts
    GRIB_subCentre:          0
    Conventions:             CF-1.7
    institution:             European Centre for Medium-Range Weather Forecasts
    history:                 2025-10-08T09:44 GRIB to CDM+CF via cfgrib-0.9.1...
2025-10-13 16:45:38,476 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are not in the correct magnitude. A conversion from K to Celsius will be performed.
2025-10-13 16:45:40,453 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_era5land</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;era5_land&quot;</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_era5land</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Regridding for ERA5-Land</span>
<span class="c1"># The coordinates for C3S Atlas/ERA5-Land are irregular, likely due to floating-point errors.</span>
<span class="c1"># To mitigate this, we round the coords to one digit.</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">data_c3s_atlas</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="n">coord</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">[</span><span class="n">coord</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">)})</span>
<span class="n">indicator_ERA5_Land</span> <span class="o">=</span> <span class="n">indicator_ERA5_Land</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="n">coord</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">indicator_ERA5_Land</span><span class="p">[</span><span class="n">coord</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;lat&quot;</span><span class="p">,</span> <span class="s2">&quot;lon&quot;</span><span class="p">)})</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_historical</span><span class="p">[</span><span class="s2">&quot;ERA5-Land&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_historical</span><span class="p">[</span><span class="s2">&quot;ERA5-Land&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_ERA5_Land</span>
<span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">[</span><span class="s2">&quot;ERA5-Land&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indicator_ERA5_Land</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="e-obs">
<h4>E-OBS<a class="headerlink" href="#e-obs" title="Link to this heading">#</a></h4>
<p>Note that E-OBS data for the full period are &gt;30 GB in size.
These data may take up to several hours to download
and
require sufficient storage to download and cache.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">E_OBS_ID</span> <span class="o">=</span> <span class="s2">&quot;insitu-gridded-observations-europe&quot;</span>
<span class="n">request_E_OBS</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="s2">&quot;ensemble_mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;maximum_temperature&quot;</span><span class="p">],</span>
    <span class="s2">&quot;grid_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;0_1deg&quot;</span><span class="p">,</span>
    <span class="c1"># It is not possible to provide specific years to &quot;period&quot;,</span>
    <span class="c1"># but a function that picks the shortest period covering all</span>
    <span class="c1"># YEAR_HISTORICAL would be useful to reduce download size</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="s2">&quot;full_period&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;30_0e&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator, regrid</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">E_OBS_ID</span><span class="p">,</span> <span class="n">request_E_OBS</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">select_years_in_dataset</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,])</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;tx&quot;</span><span class="p">:</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">})</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">E_OBS_ID</span><span class="p">)</span>
<span class="n">indicator_E_OBS</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">regridded_E_OBS</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">indicator_E_OBS</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span>
                                 <span class="n">lat_range</span><span class="o">=</span><span class="p">(</span><span class="mf">25.0625</span><span class="p">,</span> <span class="mf">71.4375</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">),</span> <span class="n">lon_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">24.9375</span><span class="p">,</span> <span class="mf">45.4375</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-13 16:45:43,266 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing coordinates names: {&#39;longitude&#39;: &#39;lon&#39;, &#39;latitude&#39;: &#39;lat&#39;}
2025-10-13 16:45:43,269 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 479MB
Dimensions:  (time: 365, lat: 465, lon: 705)
Coordinates:
  * lat      (lat) float64 4kB 25.05 25.15 25.25 25.35 ... 71.25 71.35 71.45
  * lon      (lon) float64 6kB -24.95 -24.85 -24.75 -24.65 ... 45.25 45.35 45.45
  * time     (time) datetime64[ns] 3kB 2010-01-01 2010-01-02 ... 2010-12-31
Data variables:
    tasmax   (time, lat, lon) float32 479MB dask.array&lt;chunksize=(1, 465, 705), meta=np.ndarray&gt;
Attributes:
    E-OBS_version:  30.0e
    Conventions:    CF-1.4
    References:     http://surfobs.climate.copernicus.eu/dataaccess/access_eo...
    history:        Fri Aug 30 11:43:24 2024: ncks --no-abc -d time,0,27209 /...
    NCO:            netCDF Operators version 5.1.8 (Homepage = http://nco.sf....
2025-10-13 16:45:43,279 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are already in the correct magnitude
2025-10-13 16:45:43,422 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_e_obs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;e_obs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;europe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_e_obs</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_historical</span><span class="p">[</span><span class="s2">&quot;E-OBS&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_historical</span><span class="p">[</span><span class="s2">&quot;E-OBS&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_E_OBS</span>
<span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">[</span><span class="s2">&quot;E-OBS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridded_E_OBS</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="berkearth">
<h4>BERKEARTH<a class="headerlink" href="#berkearth" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">BERKEARTH_ID</span> <span class="o">=</span> <span class="s2">&quot;insitu-gridded-observations-global-and-regional&quot;</span>
<span class="n">request_BERKEARTH</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;berkearth&quot;</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;temperature_anomaly&quot;</span><span class="p">],</span>
    <span class="s2">&quot;statistic&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;maximum&quot;</span><span class="p">],</span>
    <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="s2">&quot;horizontal_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;1_x_1&quot;</span><span class="p">],</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v1_0&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">BERKEARTH_ID</span><span class="p">,</span> <span class="n">request_BERKEARTH</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;tasmax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Celsius&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tasmax&quot;</span><span class="p">,</span> <span class="n">BERKEARTH_ID</span><span class="p">)</span>
<span class="n">indicator_BERKEARTH</span> <span class="o">=</span> <span class="n">cal_tx35</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-13 16:45:55,010 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing coordinates names: {&#39;longitude&#39;: &#39;lon&#39;, &#39;latitude&#39;: &#39;lat&#39;}
2025-10-13 16:45:55,015 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 95MB
Dimensions:  (time: 365, lat: 180, lon: 360)
Coordinates:
  * time     (time) datetime64[ns] 3kB 2010-01-01 2010-01-02 ... 2010-12-31
  * lon      (lon) float32 1kB -179.5 -178.5 -177.5 -176.5 ... 177.5 178.5 179.5
  * lat      (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 86.5 87.5 88.5 89.5
Data variables:
    tasmax   (time, lat, lon) float32 95MB dask.array&lt;chunksize=(1, 180, 360), meta=np.ndarray&gt;
Attributes: (12/21)
    CDI:                        Climate Data Interface version 1.9.10 (https:...
    institution:                Berkeley Earth Surface Temperature Project
    Conventions:                Berkeley Earth Internal Convention (based on ...
    title:                      Gridded Berkeley Earth Surface Temperature An...
    source_history:             14-Sep-2020 16:15:39
    comment:                    This file contains surface temperature anomal...
    ...                         ...
    geospatial_lon_resolution:  1.0
    climexp_url:                https://climexp.knmi.nl/select.cgi?berkeley_t...
    history:                    Fri Jun 18 07:44:32 2021: cdo -O -splityear /...
    time_coverage_start:        1880-01-01 00:00:00
    time_coverage_end:          2019-12-31 00:00:00
    CDO:                        Climate Data Operators version 1.9.10 (https:...
2025-10-13 16:45:55,027 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset tasmax units are already in the correct magnitude
2025-10-13 16:45:55,109 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_berkearth</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;in_situ_temperature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_tx35</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_berkearth</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_tx35_historical</span><span class="p">[</span><span class="s2">&quot;BERKEARTH&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_tx35_historical</span><span class="p">[</span><span class="s2">&quot;BERKEARTH&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_BERKEARTH</span>
<span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">[</span><span class="s2">&quot;BERKEARTH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indicator_BERKEARTH</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="oras5">
<h4>ORAS5<a class="headerlink" href="#oras5" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">ORAS5_ID</span> <span class="o">=</span> <span class="s2">&quot;reanalysis-oras5&quot;</span>
<span class="n">request_ORAS5</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;consolidated&quot;</span><span class="p">],</span>
    <span class="s2">&quot;vertical_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;single_level&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;sea_surface_temperature&quot;</span><span class="p">],</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="n">MONTHS</span><span class="p">,</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator, regrid</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">ORAS5_ID</span><span class="p">,</span> <span class="n">request_ORAS5</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;sosstsst&quot;</span><span class="p">:</span> <span class="s2">&quot;sst&quot;</span><span class="p">})</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;sst&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Celsius&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="n">ORAS5_ID</span><span class="p">)</span>
<span class="n">indicator_ORAS5</span> <span class="o">=</span> <span class="n">cal_sst</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">regridded_ORAS5</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">indicator_ORAS5</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span>
                                 <span class="n">lat_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">89.875</span><span class="p">,</span> <span class="mf">89.875</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">),</span> <span class="n">lon_range</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">179.875</span><span class="p">,</span> <span class="mf">179.875</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-14 00:08:31,387 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing coordinates names: {&#39;nav_lon&#39;: &#39;lon&#39;, &#39;nav_lat&#39;: &#39;lat&#39;}
2025-10-14 00:08:31,416 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset sst units are already in the correct magnitude
2025-10-14 00:08:31,451 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_oras5</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;oras5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_sst</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_oras5</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_sst</span><span class="p">[</span><span class="s2">&quot;ORAS5&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_sst</span><span class="p">[</span><span class="s2">&quot;ORAS5&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_ORAS5</span>
<span class="n">origin_c3s_atlasgrid_sst</span><span class="p">[</span><span class="s2">&quot;ORAS5&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">regridded_ORAS5</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="sst-cci">
<h4>SST-CCI<a class="headerlink" href="#sst-cci" title="Link to this heading">#</a></h4>
<p>Note that SST-CCI data for a year are &gt;150 GB in size.
These data may take up to several hours to download
and
require sufficient storage to download and cache.</p>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">SST_CCI_ID</span> <span class="o">=</span> <span class="s2">&quot;satellite-sea-surface-temperature&quot;</span>
<span class="n">request_main_SST_CCI</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;all&quot;</span><span class="p">,</span>
    <span class="s2">&quot;processinglevel&quot;</span><span class="p">:</span> <span class="s2">&quot;level_4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sensor_on_satellite&quot;</span><span class="p">:</span> <span class="s2">&quot;combined_product&quot;</span><span class="p">,</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="s2">&quot;2_1&quot;</span><span class="p">,</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span>

<span class="c1"># SST-CCI doesn&#39;t allow us to download a single year in one go, it has to be split into multiple requests</span>
<span class="n">multi_request_SST_CCI</span> <span class="o">=</span> <span class="n">generate_submonthly_requests</span><span class="p">(</span><span class="n">request_main_SST_CCI</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>

<span class="c1"># Download data, pre-process, calculate indicator</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">SST_CCI_ID</span><span class="p">,</span> <span class="o">*</span><span class="n">multi_request_SST_CCI</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="s2">&quot;analysed_sst&quot;</span><span class="p">:</span> <span class="s2">&quot;sst&quot;</span><span class="p">})</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;sst&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Kelvin&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="n">SST_CCI_ID</span><span class="p">)</span>
<span class="n">indicator_SST_CCI</span> <span class="o">=</span> <span class="n">cal_sst</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà| 36/36 [00:00&lt;00:00, 165.43it/s]
2025-11-03 16:20:40,236 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Dataset has already the correct names for its coordinates
2025-11-03 16:20:40,240 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 151GB
Dimensions:                   (time: 365, lat: 3600, lon: 7200, bnds: 2)
Coordinates:
  * lat                       (lat) float32 14kB -89.97 -89.93 ... 89.93 89.97
  * lon                       (lon) float32 29kB -180.0 -179.9 ... 179.9 180.0
  * time                      (time) datetime64[ns] 3kB 2010-01-01T12:00:00 ....
Dimensions without coordinates: bnds
Data variables:
    sst                       (time, lat, lon) float32 38GB dask.array&lt;chunksize=(1, 1200, 2400), meta=np.ndarray&gt;
    mask                      (time, lat, lon) float32 38GB dask.array&lt;chunksize=(1, 1800, 3600), meta=np.ndarray&gt;
    sea_ice_fraction          (time, lat, lon) float32 38GB dask.array&lt;chunksize=(1, 1800, 3600), meta=np.ndarray&gt;
    analysed_sst_uncertainty  (time, lat, lon) float32 38GB dask.array&lt;chunksize=(1, 1200, 2400), meta=np.ndarray&gt;
    time_bnds                 (time, bnds) datetime64[ns] 6kB dask.array&lt;chunksize=(1, 2), meta=np.ndarray&gt;
    lat_bnds                  (time, lat, bnds) float32 11MB dask.array&lt;chunksize=(1, 3600, 2), meta=np.ndarray&gt;
    lon_bnds                  (time, lon, bnds) float32 21MB dask.array&lt;chunksize=(1, 7200, 2), meta=np.ndarray&gt;
Attributes: (12/58)
    Conventions:                     CF-1.5, Unidata Observation Dataset v1.0
    title:                           ESA SST CCI OSTIA L4 product
    summary:                         OSTIA L4 product from the ESA SST CCI pr...
    references:                      http://www.esa-sst-cci.org
    institution:                     ESACCI
    history:                         Created using OSTIA reanalysis system v3.0
    ...                              ...
    source:                          ATSR&lt;1,2&gt;-ESACCI-L3U-v2.0, AATSR-ESACCI-...
    platform:                        ERS-&lt;1,2&gt;, Envisat, NOAA-&lt;07,09,11,12,14...
    creator_name:                    ESA SST CCI
    product_specification_version:   SST_CCI-PSD-UKMO-201-Issue-2
    id:                              OSTIA-ESACCI-L4-GLOB-v2.1
    product_version:                 2.1
2025-11-03 16:20:40,294 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset sst units are not in the correct magnitude. A conversion from Kelvin to Celsius will be performed.
2025-11-03 16:20:41,695 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_sst_cci</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;satellite_sea_surface_temperature&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_sst</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_sst_cci</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>

<span class="c1"># The coordinates for C3S Atlas/SST-CCI are irregular, likely due to floating-point errors.</span>
<span class="c1"># To mitigate this, we force it to use the same coordinates as the SST-CCI origin.</span>
<span class="c1"># Please note that this is NOT generally good practice, and is only done here for the sake of the assessment.</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">data_c3s_atlas</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="s2">&quot;lat&quot;</span><span class="p">:</span> <span class="n">indicator_SST_CCI</span><span class="p">[</span><span class="s2">&quot;lat&quot;</span><span class="p">],</span>
                                               <span class="s2">&quot;lon&quot;</span><span class="p">:</span> <span class="n">indicator_SST_CCI</span><span class="p">[</span><span class="s2">&quot;lon&quot;</span><span class="p">]})</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_sst</span><span class="p">[</span><span class="s2">&quot;SST-CCI&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_sst</span><span class="p">[</span><span class="s2">&quot;SST-CCI&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_SST_CCI</span>
<span class="n">origin_c3s_atlasgrid_sst</span><span class="p">[</span><span class="s2">&quot;SST-CCI&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indicator_SST_CCI</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="cpc">
<h4>CPC<a class="headerlink" href="#cpc" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input tag_hide-output docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Origin request</span>
<span class="n">CPC_ID</span> <span class="o">=</span> <span class="s2">&quot;insitu-gridded-observations-global-and-regional&quot;</span>
<span class="n">request_CPC</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;cpc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span> <span class="s2">&quot;global&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;precipitation&quot;</span><span class="p">],</span>
    <span class="s2">&quot;time_aggregation&quot;</span><span class="p">:</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="s2">&quot;horizontal_aggregation&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;0_5_x_0_5&quot;</span><span class="p">],</span>
    <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
    <span class="s2">&quot;version&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;v1_0&quot;</span><span class="p">],</span>
<span class="p">}</span>

<span class="c1"># Download data, pre-process, calculate indicator</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">CPC_ID</span><span class="p">,</span> <span class="n">request_CPC</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;pr&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mm day**-1&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">homogenise</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;pr&quot;</span><span class="p">,</span> <span class="n">CPC_ID</span><span class="p">)</span>
<span class="n">indicator_CPC</span> <span class="o">=</span> <span class="n">cal_r01</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<details class="admonition hide below-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell output</p>
<p class="expanded admonition-title">Hide code cell output</p>
</summary>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-10-13 16:23:32,652 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Dataset has already the correct names for its coordinates
2025-10-13 16:23:32,661 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî Fixing calendar for &lt;xarray.Dataset&gt; Size: 757MB
Dimensions:  (time: 365, lat: 360, lon: 720)
Coordinates:
  * time     (time) datetime64[ns] 3kB 2010-01-01T12:00:00 ... 2010-12-31T12:...
  * lon      (lon) float64 6kB 0.25 0.75 1.25 1.75 ... 358.2 358.8 359.2 359.8
  * lat      (lat) float64 3kB -89.75 -89.25 -88.75 -88.25 ... 88.75 89.25 89.75
Data variables:
    pr       (time, lat, lon) float64 757MB dask.array&lt;chunksize=(1, 360, 720), meta=np.ndarray&gt;
Attributes: (12/19)
    CDI:                        Climate Data Interface version 1.9.10 (https:...
    institution:                NOAA/NCEP/CPC (converted to netcdf at KNMI)
    Conventions:                CF-1.4
    NCO:                        netCDF Operators version 4.9.0 (Homepage = ht...
    title:                      CPC unified (gauge-based) precipitation
    source_url:                 ftp://ftp.cpc.ncep.noaa.gov/precip/CPC_UNI_PR...
    ...                         ...
    geospatial_lon_resolution:  0.5
    climexp_url:                https://climexp.knmi.nl/select.cgi?prcp_cpc_d...
    history:                    Fri Jun 18 07:52:31 2021: cdo -O -splityear /...
    time_coverage_start:        1979-01-01 12:00:00
    time_coverage_end:          2021-12-31 12:00:00
    CDO:                        Climate Data Operators version 1.9.10 (https:...
2025-10-13 16:23:32,818 ‚Äî UNITS_TRANSFORM ‚Äî INFO ‚Äî The dataset pr units are not in the correct magnitude. A conversion from mm day**-1 to mm will be performed.
2025-10-13 16:23:32,972 ‚Äî Homogenization-fixers ‚Äî INFO ‚Äî The dataset is in daily or monthly resolution, we don&#39;t need to resample it from hourly frequency
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: C3S Atlas request</span>
<span class="n">request_c3s_atlas_cpc</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;origin&quot;</span><span class="p">:</span> <span class="s2">&quot;in_situ_precipitation&quot;</span><span class="p">,</span>
    <span class="s2">&quot;period&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">YEAR_HISTORICAL</span><span class="p">,],</span>
<span class="p">}</span> <span class="o">|</span> <span class="n">request_c3s_atlas_r01</span>

<span class="c1"># Download data, pre-process</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">ekd</span><span class="o">.</span><span class="n">from_source</span><span class="p">(</span><span class="s2">&quot;cds&quot;</span><span class="p">,</span> <span class="n">C3S_ATLAS_ID</span><span class="p">,</span> <span class="n">request_c3s_atlas_cpc</span><span class="p">)</span><span class="o">.</span><span class="n">to_xarray</span><span class="p">()</span>
<span class="n">data_c3s_atlas</span> <span class="o">=</span> <span class="n">preprocess_c3s_atlas_data</span><span class="p">(</span><span class="n">data_c3s_atlas</span><span class="p">,</span> <span class="n">YEAR_HISTORICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Add to collection</span>
<span class="n">c3s_atlas_r01</span><span class="p">[</span><span class="s2">&quot;CPC&quot;</span><span class="p">]</span>            <span class="o">=</span> <span class="n">data_c3s_atlas</span>
<span class="n">origin_r01</span><span class="p">[</span><span class="s2">&quot;CPC&quot;</span><span class="p">]</span>               <span class="o">=</span> <span class="n">indicator_CPC</span>
<span class="n">origin_c3s_atlasgrid_r01</span><span class="p">[</span><span class="s2">&quot;CPC&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">indicator_CPC</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="cleanup">
<h4>Cleanup<a class="headerlink" href="#cleanup" title="Link to this heading">#</a></h4>
<p>Lastly,
we manually clear out some memory-intensive objects that are no longer necessary.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">del</span> <span class="n">data</span>
<span class="k">del</span> <span class="n">data_c3s_atlas</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>We also <a class="reference external" href="https://docs.xarray.dev/en/latest/user-guide/dask.html" rel="noreferrer" target="_blank">re-chunk</a> the datasets to be more computationally efficient:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">dataset_dict</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c3s_atlas_tx35_future</span><span class="p">,</span> <span class="n">origin_tx35_future</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">,</span>
                     <span class="n">c3s_atlas_tx35_historical</span><span class="p">,</span> <span class="n">origin_tx35_historical</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">,</span>
                     <span class="n">c3s_atlas_sst</span><span class="p">,</span> <span class="n">origin_sst</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_sst</span><span class="p">,</span>
                     <span class="n">c3s_atlas_r01</span><span class="p">,</span> <span class="n">origin_r01</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_r01</span><span class="p">,</span>
                    <span class="p">]:</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dataset_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">dataset_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">rechunk</span><span class="p">(</span><span class="n">dataset_dict</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="results">
<span id="derived-multi-origin-c3s-atlas-consistency-q03-section-results"></span><h3>3. Results<a class="headerlink" href="#results" title="Link to this heading">#</a></h3>
<p>This section contains the comparison between the indicator values retrieved from the C3S Atlas dataset vs those reproduced from the origin datasets.</p>
<p>The datasets are first compared on their native grids.
This means a point-by-point comparison is not possible
(because the points are not equivalent),
but the distributions can be compared geospatially and overall.
This qualitative comparison probes the consistency quality attribute:
Are the climate indicators in the dataset underpinning the Copernicus Interactive Climate Atlas consistent with their origin datasets?</p>
<p>Second, the C3S Atlas dataset is compared to the indicators derived from the origin dataset and regridded to the C3S Atlas grid.
This makes a quantitative point-by-point comparison possible.
This second comparison probes how well the dataset underpinning the Copernicus Interactive Climate Atlas can be reproduced from its origin datasets,
based on the workflow (Figure <a class="reference internal" href="#multi-origin-c3s-atlas-consistency-q03-workflow-fig"><span class="std std-numref">7.3.1</span></a>).</p>
<p>For the geospatial comparison,
we display the values of the indicators for one month,
across one region and globally.
As an example, we display the results across
Europe
in
June,
which should provide significant spatial variation.
This region can easily be modified in the following code cell using the <a class="reference external" href="https://earthkit-plots.readthedocs.io/en/latest/examples/guide/05-domains.html" rel="noreferrer" target="_blank">domains provided by earthkit-plots</a>.
Some examples are provided in the cell (commented out using <code class="docutils literal notranslate"><span class="pre">#</span></code>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Setup: Choose a month to display</span>
<span class="n">month</span> <span class="o">=</span> <span class="mi">6</span>

<span class="c1"># Setup: Pick domain using earthkit-plots</span>
<span class="n">domain</span> <span class="o">=</span> <span class="s2">&quot;Europe&quot;</span>
<span class="c1"># domain = &quot;Mediterranean&quot;</span>

<span class="c1"># Other examples -- uncomment where desired</span>
<span class="c1"># domain = ekp.geo.domains.union([&quot;Portugal&quot;, &quot;Spain&quot;], name=&quot;Iberia&quot;)</span>
<span class="c1"># domain = &quot;Italy&quot;</span>
<span class="c1"># domain = &quot;South America&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<section id="consistency-comparison-on-native-grids">
<h4>Consistency: Comparison on native grids<a class="headerlink" href="#consistency-comparison-on-native-grids" title="Link to this heading">#</a></h4>
<p>As in the
<a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q01.html"><span class="doc std std-doc">previous</span></a>
<a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q02.html"><span class="doc std std-doc">notebooks</span></a>,
it is clear from the geospatial comparisons
(Figures <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35future"><span class="std std-numref">7.3.2</span></a>‚Äì<a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-r01"><span class="std std-numref">7.3.5</span></a>)
that the C3S Atlas dataset closely resembles a manual reproduction from its origin datasets.
The general distribution of indicator values is the same for
all comparisons.
The
E-OBS <code class="docutils literal notranslate"><span class="pre">tx35</span></code> (Figure <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35historical"><span class="std std-numref">7.3.3</span></a>)
comparison shows clear differences in terms of coverage,
which is explained by differences in versions used
(26.0e in the production of the C3S Atlas dataset, 30.0e here).
Additionally,
the CMIP5 comparison
(Figure <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35future"><span class="std std-numref">7.3.2</span></a>)
shows clear differences here due to the fact that the C3S Atlas version of CMIP5 is regridded to a coarser resolution
to ensure consistency between the different model members of the ensemble.</p>
<p>This pattern is also visible in the overall distributions
(Figures <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35future-native"><span class="std std-numref">7.3.6</span></a>‚Äì<a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-r01-native"><span class="std std-numref">7.3.9</span></a>),
which are again very similar for almost all comparisons.</p>
<p>The overall conclusion from this comparison is the same as in the
previous
notebooks.
The C3S Atlas dataset and its origins are highly consistent,
but small differences exist due to the difference in grid
and differences in the origin dataset version used and workflow.
Large differences were observed
only
in the availability or masking of data in specific areas,
such as
on the edges of the E-OBS dataset.
Users of the C3S Atlas dataset
‚Äì and thus users of the C3S Atlas application ‚Äì
should be aware that the indicator values retrieved for a specific location may differ slightly from a manual analysis of the origin dataset.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the plotting dates based on user inputs</span>
<span class="n">date_historical</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">YEAR_HISTORICAL</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="n">date_future</span>     <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">YEAR_FUTURE</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origins</span><span class="p">(</span><span class="n">c3s_atlas_tx35_future</span><span class="p">,</span> <span class="n">origin_tx35_future</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">date_future</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                       <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geo-tx35future&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origins</span><span class="p">(</span><span class="n">c3s_atlas_tx35_historical</span><span class="p">,</span> <span class="n">origin_tx35_historical</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">date_historical</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                       <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geo-tx35historical&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origins</span><span class="p">(</span><span class="n">c3s_atlas_sst</span><span class="p">,</span> <span class="n">origin_sst</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="n">date_historical</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                       <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geo-sst&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origins</span><span class="p">(</span><span class="n">c3s_atlas_r01</span><span class="p">,</span> <span class="n">origin_r01</span><span class="p">,</span> <span class="s2">&quot;r01&quot;</span><span class="p">,</span> <span class="n">date_historical</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                       <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geo-r01&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-0" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35future" for="sd-tab-item-0">
Projected <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35future" style="width: 700px">
<img alt="../_images/73e2682c44403358ead14e9dd8e6f4360f7da506318e13efb1079b22cdaba741.png" src="../_images/73e2682c44403358ead14e9dd8e6f4360f7da506318e13efb1079b22cdaba741.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.2 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
projected
<code class="docutils literal notranslate"><span class="pre">tx35</span></code> in one month,
across Europe,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35future" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-1" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35historical" for="sd-tab-item-1">
Historical <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35historical" style="width: 700px">
<img alt="../_images/39856847b76aa41c8b1a4891fb70c892d7dfa652ed0e3da120569ce78e263b07.png" src="../_images/39856847b76aa41c8b1a4891fb70c892d7dfa652ed0e3da120569ce78e263b07.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.3 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
historical
<code class="docutils literal notranslate"><span class="pre">tx35</span></code> in one month,
across Europe,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-tx35historical" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-2" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="sst" for="sd-tab-item-2">
<code class="docutils literal notranslate"><span class="pre">sst</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-sst" style="width: 700px">
<img alt="../_images/1ac5341f4ad2543f104790368dc1e175e8d552b79b7f2a00f4289aa214ba8d61.png" src="../_images/1ac5341f4ad2543f104790368dc1e175e8d552b79b7f2a00f4289aa214ba8d61.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.4 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
historical
<code class="docutils literal notranslate"><span class="pre">sst</span></code> in one month,
across Europe,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-sst" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-3" name="sd-tab-set-0" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="r01" for="sd-tab-item-3">
<code class="docutils literal notranslate"><span class="pre">r01</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-r01" style="width: 700px">
<img alt="../_images/ac09ad983a92b1101cc47c84d9cbef32f55d1fb7b431f9a1e46de8f8038062e3.png" src="../_images/ac09ad983a92b1101cc47c84d9cbef32f55d1fb7b431f9a1e46de8f8038062e3.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.5 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
historical
<code class="docutils literal notranslate"><span class="pre">r01</span></code> in one month,
across Europe,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geo-r01" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin</span><span class="p">(</span><span class="n">c3s_atlas_tx35_future</span><span class="p">,</span> <span class="n">origin_tx35_future</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_FUTURE</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-tx35future-native&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin</span><span class="p">(</span><span class="n">c3s_atlas_tx35_historical</span><span class="p">,</span> <span class="n">origin_tx35_historical</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_HISTORICAL</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-tx35historical-native&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin</span><span class="p">(</span><span class="n">c3s_atlas_sst</span><span class="p">,</span> <span class="n">origin_sst</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_HISTORICAL</span><span class="p">,</span>
                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-sst-native&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin</span><span class="p">(</span><span class="n">c3s_atlas_r01</span><span class="p">,</span> <span class="n">origin_r01</span><span class="p">,</span> <span class="s2">&quot;r01&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_HISTORICAL</span><span class="p">,</span>
                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-r01-native&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-4" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35future" for="sd-tab-item-4">
Projected <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35future-native" style="width: 700px">
<img alt="../_images/4e36157275795d346231c255ae11018e41ee498c0681220fee709cdb6e6694d9.png" src="../_images/4e36157275795d346231c255ae11018e41ee498c0681220fee709cdb6e6694d9.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.6 </span><span class="caption-text">Comparison between overall distributions of
projected
<code class="docutils literal notranslate"><span class="pre">tx35</span></code>
values in the C3S Atlas dataset and its reproduction,
across all spatial and temporal dimensions,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35future-native" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-5" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35historical" for="sd-tab-item-5">
Historical <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35historical-native" style="width: 700px">
<img alt="../_images/400307558fb10441813a70206f84e524ccdc525f0503ab90d2c6dc5659cf5c52.png" src="../_images/400307558fb10441813a70206f84e524ccdc525f0503ab90d2c6dc5659cf5c52.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.7 </span><span class="caption-text">Comparison between overall distributions of
historical
<code class="docutils literal notranslate"><span class="pre">tx35</span></code>
values in the C3S Atlas dataset and its reproduction,
across all spatial and temporal dimensions,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35historical-native" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-6" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="sst" for="sd-tab-item-6">
<code class="docutils literal notranslate"><span class="pre">sst</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-sst-native" style="width: 700px">
<img alt="../_images/1db22d16f5bbdb17fc88a9c6c3cf2fae8f0aed875f5a59877247993f4e996f49.png" src="../_images/1db22d16f5bbdb17fc88a9c6c3cf2fae8f0aed875f5a59877247993f4e996f49.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.8 </span><span class="caption-text">Comparison between overall distributions of
historical
<code class="docutils literal notranslate"><span class="pre">sst</span></code>
values in the C3S Atlas dataset and its reproduction,
across all spatial and temporal dimensions,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-sst-native" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-7" name="sd-tab-set-1" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="r01" for="sd-tab-item-7">
<code class="docutils literal notranslate"><span class="pre">r01</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-r01-native" style="width: 700px">
<img alt="../_images/c41aff8f1bd2e6dca89892ad1789ecf708087141ebaa096daeee281f616bcaaa.png" src="../_images/c41aff8f1bd2e6dca89892ad1789ecf708087141ebaa096daeee281f616bcaaa.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.9 </span><span class="caption-text">Comparison between overall distributions of
historical
<code class="docutils literal notranslate"><span class="pre">r01</span></code>
values in the C3S Atlas dataset and its reproduction,
across all spatial and temporal dimensions,
on the native grid of each dataset.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-r01-native" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
</section>
<section id="reproducibility-comparison-on-c3s-atlas-grid">
<h4>Reproducibility: Comparison on C3S Atlas grid<a class="headerlink" href="#reproducibility-comparison-on-c3s-atlas-grid" title="Link to this heading">#</a></h4>
<p>After regridding to the C3S Atlas grid,
the indicator values reproduced from the origin dataset
can be compared point-by-point to the values retrieved from the C3S Atlas dataset.
We first examine some metrics that describe the difference Œî between corresponding pixels:</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_difference_stats</span><span class="p">(</span><span class="n">c3s_atlas_tx35_future</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_e8fcc">
  <caption>C3S Atlas ‚Äì Reproduced</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_e8fcc_level0_col0" class="col_heading level0 col0" >Mean Œî</th>
      <th id="T_e8fcc_level0_col1" class="col_heading level0 col1" >Median Œî</th>
      <th id="T_e8fcc_level0_col2" class="col_heading level0 col2" >Median |Œî|</th>
      <th id="T_e8fcc_level0_col3" class="col_heading level0 col3" >% where |Œî| ‚â• Œµ</th>
      <th id="T_e8fcc_level0_col4" class="col_heading level0 col4" >Pearson r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_e8fcc_level0_row0" class="row_heading level0 row0" >CMIP6</th>
      <td id="T_e8fcc_row0_col0" class="data row0 col0" >-0.00095</td>
      <td id="T_e8fcc_row0_col1" class="data row0 col1" >0.00000</td>
      <td id="T_e8fcc_row0_col2" class="data row0 col2" >0.00000</td>
      <td id="T_e8fcc_row0_col3" class="data row0 col3" >0.09388</td>
      <td id="T_e8fcc_row0_col4" class="data row0 col4" >0.99998</td>
    </tr>
    <tr>
      <th id="T_e8fcc_level0_row1" class="row_heading level0 row1" >CMIP5</th>
      <td id="T_e8fcc_row1_col0" class="data row1 col0" >0.00000</td>
      <td id="T_e8fcc_row1_col1" class="data row1 col1" >0.00000</td>
      <td id="T_e8fcc_row1_col2" class="data row1 col2" >0.00000</td>
      <td id="T_e8fcc_row1_col3" class="data row1 col3" >10.20628</td>
      <td id="T_e8fcc_row1_col4" class="data row1 col4" >1.00000</td>
    </tr>
    <tr>
      <th id="T_e8fcc_level0_row2" class="row_heading level0 row2" >CORDEX-EUR-11</th>
      <td id="T_e8fcc_row2_col0" class="data row2 col0" >-0.00065</td>
      <td id="T_e8fcc_row2_col1" class="data row2 col1" >0.00000</td>
      <td id="T_e8fcc_row2_col2" class="data row2 col2" >0.00000</td>
      <td id="T_e8fcc_row2_col3" class="data row2 col3" >4.20466</td>
      <td id="T_e8fcc_row2_col4" class="data row2 col4" >1.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_difference_stats</span><span class="p">(</span><span class="n">c3s_atlas_tx35_historical</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_d10f9">
  <caption>C3S Atlas ‚Äì Reproduced</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_d10f9_level0_col0" class="col_heading level0 col0" >Mean Œî</th>
      <th id="T_d10f9_level0_col1" class="col_heading level0 col1" >Median Œî</th>
      <th id="T_d10f9_level0_col2" class="col_heading level0 col2" >Median |Œî|</th>
      <th id="T_d10f9_level0_col3" class="col_heading level0 col3" >% where |Œî| ‚â• Œµ</th>
      <th id="T_d10f9_level0_col4" class="col_heading level0 col4" >Pearson r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_d10f9_level0_row0" class="row_heading level0 row0" >ERA5</th>
      <td id="T_d10f9_row0_col0" class="data row0 col0" >0.00003</td>
      <td id="T_d10f9_row0_col1" class="data row0 col1" >0.00000</td>
      <td id="T_d10f9_row0_col2" class="data row0 col2" >0.00000</td>
      <td id="T_d10f9_row0_col3" class="data row0 col3" >0.00311</td>
      <td id="T_d10f9_row0_col4" class="data row0 col4" >1.00000</td>
    </tr>
    <tr>
      <th id="T_d10f9_level0_row1" class="row_heading level0 row1" >ERA5-Land</th>
      <td id="T_d10f9_row1_col0" class="data row1 col0" >-0.00002</td>
      <td id="T_d10f9_row1_col1" class="data row1 col1" >0.00000</td>
      <td id="T_d10f9_row1_col2" class="data row1 col2" >0.00000</td>
      <td id="T_d10f9_row1_col3" class="data row1 col3" >0.00597</td>
      <td id="T_d10f9_row1_col4" class="data row1 col4" >1.00000</td>
    </tr>
    <tr>
      <th id="T_d10f9_level0_row2" class="row_heading level0 row2" >E-OBS</th>
      <td id="T_d10f9_row2_col0" class="data row2 col0" >-0.11389</td>
      <td id="T_d10f9_row2_col1" class="data row2 col1" >0.00000</td>
      <td id="T_d10f9_row2_col2" class="data row2 col2" >0.00000</td>
      <td id="T_d10f9_row2_col3" class="data row2 col3" >3.63519</td>
      <td id="T_d10f9_row2_col4" class="data row2 col4" >0.91907</td>
    </tr>
    <tr>
      <th id="T_d10f9_level0_row3" class="row_heading level0 row3" >BERKEARTH</th>
      <td id="T_d10f9_row3_col0" class="data row3 col0" >0.00000</td>
      <td id="T_d10f9_row3_col1" class="data row3 col1" >0.00000</td>
      <td id="T_d10f9_row3_col2" class="data row3 col2" >0.00000</td>
      <td id="T_d10f9_row3_col3" class="data row3 col3" >0.00000</td>
      <td id="T_d10f9_row3_col4" class="data row3 col4" >1.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_difference_stats</span><span class="p">(</span><span class="n">c3s_atlas_sst</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_sst</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_a8fea">
  <caption>C3S Atlas ‚Äì Reproduced</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_a8fea_level0_col0" class="col_heading level0 col0" >Mean Œî</th>
      <th id="T_a8fea_level0_col1" class="col_heading level0 col1" >Median Œî</th>
      <th id="T_a8fea_level0_col2" class="col_heading level0 col2" >Median |Œî|</th>
      <th id="T_a8fea_level0_col3" class="col_heading level0 col3" >% where |Œî| ‚â• Œµ</th>
      <th id="T_a8fea_level0_col4" class="col_heading level0 col4" >Pearson r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_a8fea_level0_row0" class="row_heading level0 row0" >ORAS5</th>
      <td id="T_a8fea_row0_col0" class="data row0 col0" >0.00000</td>
      <td id="T_a8fea_row0_col1" class="data row0 col1" >0.00000</td>
      <td id="T_a8fea_row0_col2" class="data row0 col2" >0.00024</td>
      <td id="T_a8fea_row0_col3" class="data row0 col3" >65.47403</td>
      <td id="T_a8fea_row0_col4" class="data row0 col4" >1.00000</td>
    </tr>
    <tr>
      <th id="T_a8fea_level0_row1" class="row_heading level0 row1" >SST-CCI</th>
      <td id="T_a8fea_row1_col0" class="data row1 col0" >0.00003</td>
      <td id="T_a8fea_row1_col1" class="data row1 col1" >0.00009</td>
      <td id="T_a8fea_row1_col2" class="data row1 col2" >0.00020</td>
      <td id="T_a8fea_row1_col3" class="data row1 col3" >65.15363</td>
      <td id="T_a8fea_row1_col4" class="data row1 col4" >1.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">display_difference_stats</span><span class="p">(</span><span class="n">c3s_atlas_r01</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_r01</span><span class="p">,</span> <span class="s2">&quot;r01&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_html"><style type="text/css">
</style>
<table id="T_ec1de">
  <caption>C3S Atlas ‚Äì Reproduced</caption>
  <thead>
    <tr>
      <th class="blank level0" >&nbsp;</th>
      <th id="T_ec1de_level0_col0" class="col_heading level0 col0" >Mean Œî</th>
      <th id="T_ec1de_level0_col1" class="col_heading level0 col1" >Median Œî</th>
      <th id="T_ec1de_level0_col2" class="col_heading level0 col2" >Median |Œî|</th>
      <th id="T_ec1de_level0_col3" class="col_heading level0 col3" >% where |Œî| ‚â• Œµ</th>
      <th id="T_ec1de_level0_col4" class="col_heading level0 col4" >Pearson r</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th id="T_ec1de_level0_row0" class="row_heading level0 row0" >CPC</th>
      <td id="T_ec1de_row0_col0" class="data row0 col0" >0.00000</td>
      <td id="T_ec1de_row0_col1" class="data row0 col1" >0.00000</td>
      <td id="T_ec1de_row0_col2" class="data row0 col2" >0.00000</td>
      <td id="T_ec1de_row0_col3" class="data row0 col3" >0.00000</td>
      <td id="T_ec1de_row0_col4" class="data row0 col4" >1.00000</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>As in the
<a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q01.html"><span class="doc std std-doc">previous</span></a>
<a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q02.html"><span class="doc std std-doc">notebooks</span></a>,
it is clear that
the C3S Atlas dataset and its manual reproduction
are very similar.
The median difference, median absolute difference, and median absolute percentage difference
are all close to 0
and the vast majority of pixels show a near-zero difference
(defined here as |Œî| ‚â• Œµ with Œµ = 10<sup>‚Äì5</sup> to avoid floating-point errors)
in all comparisons.
E-OBS shows the most significant differences,
likely explained by differences in the version used
as in the previous section.</p>
<p>These observations are confirmed by
the overall distributions
(Figures <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35future-c3s-atlas"><span class="std std-numref">7.3.10</span></a>‚Äì<a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-r01-c3s-atlas"><span class="std std-numref">7.3.13</span></a>)
and
the geospatial distributions
(Figures <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-tx35future"><span class="std std-numref">7.3.14</span></a>‚Äì<a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-r01"><span class="std std-numref">7.3.17</span></a>).
Notably,
while the difference between <code class="docutils literal notranslate"><span class="pre">tx35</span></code> in the C3S Atlas dataset and E-OBS is typically small,
with a median of 0 and with ‚â§4% of pixels showing non-zero differences,
it has a long tail of large differences
(Figure <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35historical-c3s-atlas"><span class="std std-numref">7.3.11</span></a>).
These pixels are concentrated at the periphery of the domain
(Figures <a class="reference internal" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-tx35historical"><span class="std std-numref">7.3.15</span></a>).
This is likely the result of a difference in
the underlying dataset version
(as before).</p>
<p>We can extend the conclusion from the
<a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q01.html"><span class="doc std std-doc">previous</span></a>
<a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q02.html"><span class="doc std std-doc">notebooks</span></a>,
namely that the C3S Atlas dataset can be considered practically reproducible.
Some indicators in the C3S Atlas dataset
are completely identical to
their origin datasets,
e.g. <code class="docutils literal notranslate"><span class="pre">r01</span></code> in the CPC comparison;
others
show non-zero differences,
e.g. some of the pixels in the CMIP6 and E-OBS <code class="docutils literal notranslate"><span class="pre">tx35</span></code> comparisons.
The causes of these differences are unclear,
but they are generally small and rare enough to be negligible for most users using the C3S Atlas dataset,
especially since they will typically use it through the application.
For further analysis,
it is generally best to manually process the origin dataset,
if only to remove the amount of steps that may affect the result.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_tx35_future</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_FUTURE</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-tx35future-c3s-atlas&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_tx35_historical</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_HISTORICAL</span><span class="p">,</span> <span class="n">log</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-tx35historical-c3s-atlas&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_sst</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_sst</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_HISTORICAL</span><span class="p">,</span>
                                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-sst-c3s-atlas&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">histogram_comparison_by_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_r01</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_r01</span><span class="p">,</span> <span class="s2">&quot;r01&quot;</span><span class="p">,</span> <span class="n">year</span><span class="o">=</span><span class="n">YEAR_HISTORICAL</span><span class="p">,</span>
                                               <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-hist-r01-c3s-atlas&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-8" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35future" for="sd-tab-item-8">
Projected <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35future-c3s-atlas" style="width: 700px">
<img alt="../_images/3243bc603152607be2d654e0e77b4b72535cba8fc2370d203480ef29f57bd7b4.png" src="../_images/3243bc603152607be2d654e0e77b4b72535cba8fc2370d203480ef29f57bd7b4.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.10 </span><span class="caption-text">Comparison between overall distributions of
projected
<code class="docutils literal notranslate"><span class="pre">tx35</span></code>
values in the C3S Atlas dataset and its reproduction
on the C3S Atlas grid,
across all spatial and temporal dimensions,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35future-c3s-atlas" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-9" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35historical" for="sd-tab-item-9">
Historical <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35historical-c3s-atlas" style="width: 700px">
<img alt="../_images/f7749ca374f3531ba4cf3e791891eab5ce63c4eedb432f1f5a089bbe3a51a49f.png" src="../_images/f7749ca374f3531ba4cf3e791891eab5ce63c4eedb432f1f5a089bbe3a51a49f.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.11 </span><span class="caption-text">Comparison between overall distributions of
historical
<code class="docutils literal notranslate"><span class="pre">tx35</span></code>
values in the C3S Atlas dataset and its reproduction
on the C3S Atlas grid,
across all spatial and temporal dimensions,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-tx35historical-c3s-atlas" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-10" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="sst" for="sd-tab-item-10">
<code class="docutils literal notranslate"><span class="pre">sst</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-sst-c3s-atlas" style="width: 700px">
<img alt="../_images/2bf3bbfc79c4e3bef360d0ec84935d4a695046c3a7c1afa6715b0f1cc2340cdd.png" src="../_images/2bf3bbfc79c4e3bef360d0ec84935d4a695046c3a7c1afa6715b0f1cc2340cdd.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.12 </span><span class="caption-text">Comparison between overall distributions of
historical
<code class="docutils literal notranslate"><span class="pre">sst</span></code>
values in the C3S Atlas dataset and its reproduction
on the C3S Atlas grid,
across all spatial and temporal dimensions,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-sst-c3s-atlas" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-11" name="sd-tab-set-2" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="r01" for="sd-tab-item-11">
<code class="docutils literal notranslate"><span class="pre">r01</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-r01-c3s-atlas" style="width: 700px">
<img alt="../_images/7ee5244c2af4db7b20a4410350189fba48aee08c2534da1dd0d9e9c60e212984.png" src="../_images/7ee5244c2af4db7b20a4410350189fba48aee08c2534da1dd0d9e9c60e212984.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.13 </span><span class="caption-text">Comparison between overall distributions of
historical
<code class="docutils literal notranslate"><span class="pre">r01</span></code>
values in the C3S Atlas dataset and its reproduction
on the C3S Atlas grid,
across all spatial and temporal dimensions,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-hist-r01-c3s-atlas" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_tx35_future</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_future</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">date_future</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                                      <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geocomp-tx35future&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_tx35_historical</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_tx35_historical</span><span class="p">,</span> <span class="s2">&quot;tx35&quot;</span><span class="p">,</span> <span class="n">date_historical</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                                      <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geocomp-tx35historical&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_sst</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_sst</span><span class="p">,</span> <span class="s2">&quot;sst&quot;</span><span class="p">,</span> <span class="n">date_historical</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                                      <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geocomp-sst&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geospatial_comparison_multiple_origin_with_difference</span><span class="p">(</span><span class="n">c3s_atlas_r01</span><span class="p">,</span> <span class="n">origin_c3s_atlasgrid_r01</span><span class="p">,</span> <span class="s2">&quot;r01&quot;</span><span class="p">,</span> <span class="n">date_historical</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">domain</span><span class="p">,</span>
                                                      <span class="n">glue_label</span><span class="o">=</span><span class="s2">&quot;derived_multi-origin-c3s-atlas_consistency_q03_fig-geocomp-r01&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="sd-tab-set docutils">
<input checked="checked" id="sd-tab-item-12" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35future" for="sd-tab-item-12">
Projected <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-tx35future" style="width: 700px">
<img alt="../_images/edc9df803afc1bd69a25dc06d345f31f939a7cd5392e5b68ff715c08604d7b46.png" src="../_images/edc9df803afc1bd69a25dc06d345f31f939a7cd5392e5b68ff715c08604d7b46.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.14 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
projected
<code class="docutils literal notranslate"><span class="pre">tx35</span></code> in one month,
across Europe,
on the C3S Atlas dataset grid,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-tx35future" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-13" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="tx35historical" for="sd-tab-item-13">
Historical <code class="docutils literal notranslate"><span class="pre">tx35</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-tx35historical" style="width: 700px">
<img alt="../_images/9d96192e46d9635ad57876b18f5335cc63a451b40f092dde2c0fd7b00bf4b0f5.png" src="../_images/9d96192e46d9635ad57876b18f5335cc63a451b40f092dde2c0fd7b00bf4b0f5.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.15 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
historical
<code class="docutils literal notranslate"><span class="pre">tx35</span></code> in one month,
across Europe,
on the C3S Atlas dataset grid,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-tx35historical" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-14" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="sst" for="sd-tab-item-14">
<code class="docutils literal notranslate"><span class="pre">sst</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-sst" style="width: 700px">
<img alt="../_images/462c80cf58b6e459539f4f9ddaf5f620d33a600ec1d1ca5a80195c543bc929e1.png" src="../_images/462c80cf58b6e459539f4f9ddaf5f620d33a600ec1d1ca5a80195c543bc929e1.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.16 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
historical
<code class="docutils literal notranslate"><span class="pre">sst</span></code> in one month,
across Europe,
on the C3S Atlas dataset grid,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-sst" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
<input id="sd-tab-item-15" name="sd-tab-set-3" type="radio">
<label class="sd-tab-label" data-sync-group="tab" data-sync-id="r01" for="sd-tab-item-15">
<code class="docutils literal notranslate"><span class="pre">r01</span></code></label><div class="sd-tab-content docutils">
<figure class="align-default" id="derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-r01" style="width: 700px">
<img alt="../_images/6537d9c4ac9ffee5cc6ef0b7ae8d2ebf894b1a5def563b4f469137023c8af15a.png" src="../_images/6537d9c4ac9ffee5cc6ef0b7ae8d2ebf894b1a5def563b4f469137023c8af15a.png" />
<figcaption>
<p><span class="caption-number">Fig. 7.3.17 </span><span class="caption-text">Comparison between C3S Atlas dataset and reproduction for
historical
<code class="docutils literal notranslate"><span class="pre">r01</span></code> in one month,
across Europe,
on the C3S Atlas dataset grid,
including the per-pixel difference.</span><a class="headerlink" href="#derived-multi-origin-c3s-atlas-consistency-q03-fig-geocomp-r01" title="Link to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>‚ÑπÔ∏è If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>The CDS catalogue entries for the data used were:</p>
<ul class="simple">
<li><p>Gridded dataset underpinning the Copernicus Interactive Climate Atlas: <a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank">multi-origin-c3s-atlas</a></p>
<ul>
<li><p><a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q01.html"><span class="doc std std-doc">Consistency between the C3S Atlas dataset and its origins: Case study</span></a></p></li>
<li><p><a class="reference internal" href="derived_multi-origin-c3s-atlas_consistency_q02.html"><span class="doc std std-doc">Consistency between the C3S Atlas dataset and its origins: Multiple indicators</span></a></p></li>
<li><p><strong>Consistency between the C3S Atlas dataset and its origins: Multiple origin datasets</strong></p></li>
</ul>
</li>
<li><p>CMIP6 climate projections: <a class="reference external" href="https://doi.org/10.24381/cds.c866074c" rel="noreferrer" target="_blank">projections-cmip6</a></p>
<ul>
<li><p><a class="reference internal" href="../Climate_Projections/CMIP6/CMIP6.html"><span class="std std-doc">Quality assessments for CMIP6</span></a></p></li>
</ul>
</li>
<li><p>CMIP5 daily data on single levels: <a class="reference external" href="https://doi.org/10.24381/cds.d3513dbf" rel="noreferrer" target="_blank">projections-cmip5-daily-single-levels</a></p></li>
<li><p>CORDEX regional climate model data on single levels: <a class="reference external" href="https://doi.org/10.24381/cds.bc91edc3" rel="noreferrer" target="_blank">projections-cordex-domains-single-levels</a></p>
<ul>
<li><p><a class="reference internal" href="../Climate_Projections/CORDEX/CORDEX.html"><span class="std std-doc">Quality assessments for CORDEX</span></a></p></li>
</ul>
</li>
<li><p>ERA5 hourly data on single levels from 1940 to present: <a class="reference external" href="https://doi.org/10.24381/cds.adbb2d47" rel="noreferrer" target="_blank">reanalysis-era5-single-levels</a></p>
<ul>
<li><p><a class="reference internal" href="../Reanalyses/reanalysis.html"><span class="std std-doc">Quality assessments for Reanalyses</span></a></p></li>
</ul>
</li>
<li><p>ERA5-Land hourly data from 1950 to present: <a class="reference external" href="https://doi.org/10.24381/cds.e2161bac" rel="noreferrer" target="_blank">reanalysis-era5-land</a></p>
<ul>
<li><p><a class="reference internal" href="../Reanalyses/reanalysis.html"><span class="std std-doc">Quality assessments for Reanalyses</span></a></p></li>
</ul>
</li>
<li><p>E-OBS daily gridded meteorological data for Europe from 1950 to present derived from in-situ observations: <a class="reference external" href="https://doi.org/10.24381/cds.151d3ec6" rel="noreferrer" target="_blank">insitu-gridded-observations-europe</a></p>
<ul>
<li><p><a class="reference internal" href="../In_Situ/insitu.html"><span class="std std-doc">Quality assessments for Insitu Observations</span></a></p></li>
</ul>
</li>
<li><p>Temperature and precipitation gridded data for global and regional domains derived from in-situ and satellite observations (BERKEARTH, CPC) <a class="reference external" href="https://doi.org/10.24381/cds.11dedf0c" rel="noreferrer" target="_blank">insitu-gridded-observations-global-and-regional</a></p>
<ul>
<li><p><a class="reference internal" href="../In_Situ/insitu.html"><span class="std std-doc">Quality assessments for Insitu Observations</span></a></p></li>
</ul>
</li>
<li><p>ORAS5 global ocean reanalysis monthly data from 1958 to present: <a class="reference external" href="https://doi.org/10.24381/cds.67e8eeb7" rel="noreferrer" target="_blank">reanalysis-oras5</a></p>
<ul>
<li><p><a class="reference internal" href="../Reanalyses/reanalysis.html"><span class="std std-doc">Quality assessments for Reanalyses</span></a></p></li>
</ul>
</li>
<li><p>Sea surface temperature daily data from 1981 to present derived from satellite observations (SST-CCI): <a class="reference external" href="https://doi.org/10.24381/cds.cf608234" rel="noreferrer" target="_blank">satellite-sea-surface-temperature</a></p>
<ul>
<li><p><a class="reference internal" href="../Satellite_ECVs/Ocean/Ocean.html"><span class="std std-doc">Quality assessments for Satellite Observations: Ocean</span></a></p></li>
</ul>
</li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/ecmwf/earthkit" rel="noreferrer" target="_blank">earthkit</a></p>
<ul>
<li><p><a class="reference external" href="https://github.com/ecmwf/earthkit-data" rel="noreferrer" target="_blank">earthkit-data</a></p></li>
<li><p><a class="reference external" href="https://github.com/ecmwf/earthkit-plots" rel="noreferrer" target="_blank">earthkit-plots</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://github.com/ecmwf-projects/c3s-atlas" rel="noreferrer" target="_blank">User-tools for the C3S Atlas</a></p></li>
<li><p><a class="reference external" href="https://xclim.readthedocs.io/en/stable/" rel="noreferrer" target="_blank">xclim</a> climate indicator tools</p></li>
</ul>
<p>More about the Copernicus Interactive Climate Atlas and its IPCC predecessor:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://atlas.climate.copernicus.eu/" rel="noreferrer" target="_blank">Copernicus Interactive Climate Atlas application</a></p></li>
<li><p><a class="reference external" href="https://confluence.ecmwf.int/display/CKB/Gridded+data+underpinning+the+Copernicus+Interactive+Climate+Atlas%3A+Description+of+the+datasets+and+variables" rel="noreferrer" target="_blank">Gridded data underpinning the Copernicus Interactive Climate Atlas: Description of the datasets and variables</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.21957/ah52ufc369" rel="noreferrer" target="_blank">The Copernicus Interactive Climate Atlas: a tool to explore regional climate change</a></p></li>
<li><p><a class="reference external" href="https://www.ecmwf.int/en/newsletter/179/news/copernicus-interactive-climate-atlas-new-tool-visualise-climate-variability" rel="noreferrer" target="_blank">Copernicus Interactive Climate Atlas: a new tool to visualise climate variability and change</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1038/s41597-022-01739-y" rel="noreferrer" target="_blank">Implementation of FAIR principles in the IPCC: the WGI AR6 Atlas repository</a></p></li>
<li><p><a class="reference external" href="https://doi.org/10.1017/9781009157896.021" rel="noreferrer" target="_blank">Climate Change 2021 ‚Äì The Physical Science Basis: Atlas</a></p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p>[<a class="reference external" href="https://doi.org/10.21957/ah52ufc369" rel="noreferrer" target="_blank">Guti√©rrez+24</a>] J. M. Guti√©rrez et al., ‚ÄòThe Copernicus Interactive Climate Atlas: a tool to explore regional climate change‚Äô, ECMWF Newsletter, vol. 181, pp. 38‚Äì45, Oct. 2024, doi: 10.21957/ah52ufc369.</p>
<p>[<a class="reference external" href="https://doi.org/10.24381/cds.h35hb680" rel="noreferrer" target="_blank">C3S Atlas dataset</a>] Copernicus Climate Change Service, ‚ÄòGridded dataset underpinning the Copernicus Interactive Climate Atlas‚Äô. Copernicus Climate Change Service (C3S) Climate Data Store (CDS), Jun. 17, 2024. doi: 10.24381/cds.h35hb680.</p>
<p>[<a class="reference external" href="https://doi.org/10.24381/cds.c866074c" rel="noreferrer" target="_blank">CMIP6 dataset</a>] Copernicus Climate Change Service, ‚ÄòCMIP6 climate projections‚Äô. Copernicus Climate Change Service (C3S) Climate Data Store (CDS), Mar. 23, 2021. doi: 10.24381/cds.c866074c.</p>
<p>[<a class="reference external" href="https://doi.org/10.1364/OE.391470" rel="noreferrer" target="_blank">Burggraaff+20</a>] O. Burggraaff, ‚ÄòBiases from incorrect reflectance convolution‚Äô, Optics Express, vol. 28, no. 9, pp. 13801‚Äì13816, Apr. 2020, doi: 10.1364/OE.391470.</p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Derived_Datasets"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="derived_multi-origin-c3s-atlas_consistency_q02.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">7.2. </span>Consistency between the C3S Atlas dataset and its origins: Multiple indicators</p>
      </div>
    </a>
    <a class="right-next"
       href="../Applications/application.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">8. </span>Applications</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-retrieving-climate-indicators-from-the-copernicus-interactive-climate-atlas">üåç Use case: Retrieving climate indicators from the Copernicus Interactive Climate Atlas</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">‚ùì Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">üì¢ Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">üìã Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">üìà Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#code-setup">1. Code setup</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#install-the-user-tools-for-the-c3s-atlas">Install the User-tools for the C3S Atlas</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-required-libraries">Import required libraries</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-indicators">Define indicators</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#helper-functions">Helper functions</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#data-downloading-pre-processing">Data downloading &amp; (pre-)processing</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#statistics">Statistics</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#visualisation">Visualisation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-and-retrieve-indicators">2. Calculate and retrieve indicators</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#general-setup">General setup</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip6">CMIP6</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cmip5">CMIP5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cordex-eur-11">CORDEX-EUR-11</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#era5">ERA5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#era5-land">ERA5-Land</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#e-obs">E-OBS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#berkearth">BERKEARTH</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#oras5">ORAS5</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#sst-cci">SST-CCI</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cpc">CPC</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cleanup">Cleanup</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#results">3. Results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#consistency-comparison-on-native-grids">Consistency: Comparison on native grids</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#reproducibility-comparison-on-c3s-atlas-grid">Reproducibility: Comparison on C3S Atlas grid</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">‚ÑπÔ∏è If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>