
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>5.1.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector &#8212; eqcbook</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Climate_Projections/CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q02';</script>
    <link rel="icon" href="../../_static/C3S_favicon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="5.1.3. Uncertainty in projected changes in extreme temperature indices at a 2°C Global Warming Level for the reinsurance sector" href="climate_projections-cmip6_climate-and-weather-extremes_q03.html" />
    <link rel="prev" title="5.1.1. Bias in extreme temperature indices for the reinsurance sector" href="climate_projections-cmip6_climate-and-weather-extremes_q01.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">⚠️This is under development!⚠️</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/C3S–POS–LINE.png" class="logo__image only-light" alt="eqcbook - Home"/>
    <script>document.write(`<img src="../../_static/C3S–POS–LINE.png" class="logo__image only-dark" alt="eqcbook - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    C3S EQC quality assessments
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Satellite Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Satellite_ECVs/satellite.html">1. Quality assessments for Satellite Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Atmosphere_Physics/Atmosphere_Physics.html">1.1. Atmosphere Physics</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Atmospheric_Composition/Atmospheric_Composition.html">1.2. Atmospheric Composition</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-carbon-dioxide_trend-assessment_q01.html">1.2.1. Carbon dioxide satellite observations completeness assessment for greenhouse gas monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-methane_uncertainty_q01.html">1.2.2. Methane satellite observations uncertainty and completeness assessment for carbon cycle</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Atmospheric_Composition/satellite_satellite-ozone-v1_climate-monitoring_q01.html">1.2.3. Temporal and spatial completeness of the satellite-derived Ozone for policy making and variability studies</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Cryosphere/Cryosphere.html">1.3. Cryosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Cryosphere/satellite_derived-gridded-glacier-mass-change_data-completeness_q01.html">1.3.1. Glacier mass change data from satellite and in-situ observations: uncertainty analysis for glaciological and climate change monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Cryosphere/satellite_satellite-ice-sheet-elevation-change_trend-assessment_q01.html">1.3.2. Uncertainty of ice sheet surface elevation change data over Greenland for volume and mass change trend assessments</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/Land_Biosphere.html">1.4. Land Biosphere</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/satellite_satellite-fire-burned-area_climate-and-weather-extremes_q01.html">1.4.1. Satellite fire burned area completeness for seasonal climatology maps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Land_Biosphere/satellite_satellite-fire-burned-area_trend-assessment_q02.html">1.4.2. Satellite fire burned area trends assessment for climate monitoring</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Land_Hydrology/Land_Hydrology.html">1.5. Land Hydrology</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../Satellite_ECVs/Ocean/Ocean.html">1.6. Ocean</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Ocean/satellite_satellite-ocean-colour_consistency-assessment_q01.html">1.6.1. Impact of using successive satellites on Ocean Colour time series</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Ocean/satellite_satellite-sea-ice-edge-type_intercomparison_q01.html">1.6.2. Intercomparison of satellite multi-year sea ice extent estimates</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Ocean/satellite_satellite-sea-ice-thickness_trend-assessment_q01.html">1.6.3. Suitability of satellite sea ice thickness data for studying climate change</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Ocean/satellite_satellite-sea-level-global_trend-assessment_q01.html">1.6.4. Regional sea level trend assessment in the Mediterranean Sea from Satellite (observations) at basin and sub-basin scale</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Ocean/satellite_satellite-sea-surface-temperature_consistency_q01.html">1.6.5. Consistency Assessment of Satellite Sea Surface Temperature for Climate Monitoring</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../Satellite_ECVs/Ocean/satellite_satellite-sea-surface-temperature_consistency_q02.html">1.6.6. Satellite Sea Surface Temperature Consistency in representing Ocean Warming Trends</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Insitu Observations</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../In_Situ/insitu.html">2. Quality assessments for Insitu Observations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Reanalysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Reanalyses/reanalysis.html">3. Quality assessments for Reanalysis</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Seasonal Forecasts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal.html">4. Quality assessments for Seasonal Forecasts</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_forecast-skill_q02.html">4.1. Seasonal forecasts bias assessment for impact models</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_forecast-skill_q04.html">4.2. Evaluation of the hit-rate of seasonal forecasts for tercile categories of monthly anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../Seasonal_Forecasts/seasonal_seasonal-monthly-single-levels_uncertainty-quality-flags_q01.html">4.3. Assessing possible outcomes of seasonal temperature forecast</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Climate Projections</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../climate.html">5. Quality assessments for Climate Projections</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2 current active has-children"><a class="reference internal" href="CMIP6.html">5.1. CMIP6</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_climate-and-weather-extremes_q01.html">5.1.1. Bias in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3 current active"><a class="current reference internal" href="#">5.1.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_climate-and-weather-extremes_q03.html">5.1.3. Uncertainty in projected changes in extreme temperature indices at a 2°C Global Warming Level for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_climate-impact-indicators_q01.html">5.1.4. Biases in energy-consumption-related indices in Europe</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_climate-impact-indicators_q02.html">5.1.5. Uncertainty in projected changes of energy consumption in Europe</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_climate-impact-indicators_q03.html">5.1.6. Uncertainty in projected changes of energy consumption in Europe at a 2°C Global Warming Level</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_climate-impact-indicators_q04.html">5.1.7. Projections of future ice-free periods for the Arctic and Antarctic</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_model-performance_q02.html">5.1.8. Historical accuracy of sea ice extent in the CMIP6 projections</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_model-performance_q03.html">5.1.9. Evaluation of the Arctic sea ice thickness in the CMIP6 historical experiments</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_validation_q10.html">5.1.10. Testing the capability of CMIP6 GCMs to represent precipitation inter-annual variability</a></li>
<li class="toctree-l3"><a class="reference internal" href="climate_projections-cmip6_validation_q11.html">5.1.11. Testing the capability of CMIP6 GCMs to represent precipitation intra-seasonal variability</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../CORDEX/CORDEX.html">5.2. CORDEX</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q01.html">5.2.1. Bias in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q02.html">5.2.2. Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q03.html">5.2.3. Bias in precipitation-based indices for impact models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CORDEX/climate_projections-cordex-domains-single-levels_climate-and-weather-extremes_q04.html">5.2.4. Projected changes in precipitation-based indices for impact models</a></li>
<li class="toctree-l3"><a class="reference internal" href="../CORDEX/climate_projections-cordex-domains-single-levels_validation_q05.html">5.2.5. CORDEX temperature biases over the Alpine region for the ski and hydrological sectors.</a></li>
</ul>
</details></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Climate Indicators</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Indicators/indicator.html">6. Quality assessments for Climate Indicators</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Derived Datasets</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Derived_Datasets/derived.html">7. Quality assessments for Derived Datasets</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">➡️ Applications</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../Applications/application.html">8. Quality assessments for C3S Applications</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="simple">
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Quality assessment template</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../templates/template_instructions.html">Template instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../templates/template.html">Template</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ecmwf-projects/c3s2-eqc-quality-assessment/issues/new?title=Issue%20on%20page%20%2FClimate_Projections/CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q02.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/Climate_Projections/CMIP6/climate_projections-cmip6_climate-and-weather-extremes_q02.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Uncertainty in projected changes in extreme temperature indices for the reinsurance sector</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-defining-a-strategy-to-optimise-reinsurance-protections">🌍 Use case: Defining a strategy to optimise reinsurance protections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">❓ Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-requests-and-functions-definition">1. Parameters, requests and functions definition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1.1. Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-parameters">1.2. Define Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-models">1.3. Define models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-land-sea-mask-request">1.4. Define land-sea mask request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-model-requests">1.5. Define model requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">1.6. Functions to cache</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-and-processing">2. Downloading and processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-the-regridding-model">2.1. Download and transform the regridding model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-models">2.2. Download and transform models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-land-sea-mask-change-attributes-and-cut-the-region-to-show">2.3. Apply land-sea mask, change attributes and cut the region to show</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">3. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-plotting-functions">3.1. Define plotting functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-ensemble-maps">3.2. Plot ensemble maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-model-maps">3.3. Plot model maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots-of-the-future-trend">3.4. Boxplots of the future trend</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion">3.5. Results summary and discussion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <p><img alt="logo" src="../../_images/LogoLine_horizon_C3S1.png" /></p>
<section class="tex2jax_ignore mathjax_ignore" id="uncertainty-in-projected-changes-in-extreme-temperature-indices-for-the-reinsurance-sector">
<h1><span class="section-number">5.1.2. </span>Uncertainty in projected changes in extreme temperature indices for the reinsurance sector<a class="headerlink" href="#uncertainty-in-projected-changes-in-extreme-temperature-indices-for-the-reinsurance-sector" title="Link to this heading">#</a></h1>
<p>Production date: 24-05-2024</p>
<p>Produced by: CMCC foundation - Euro-Mediterranean Center on Climate Change. Albert Martinez Boti.</p>
<section id="use-case-defining-a-strategy-to-optimise-reinsurance-protections">
<h2>🌍 Use case: Defining a strategy to optimise reinsurance protections<a class="headerlink" href="#use-case-defining-a-strategy-to-optimise-reinsurance-protections" title="Link to this heading">#</a></h2>
</section>
<section id="quality-assessment-question">
<h2>❓ Quality assessment question<a class="headerlink" href="#quality-assessment-question" title="Link to this heading">#</a></h2>
<ul class="simple">
<li><p><strong>What are the projected future changes and associated uncertainties in air temperature extremes in Europe?</strong></p></li>
</ul>
<p>Climate change has a major impact on the reinsurance market <a class="reference external" href="https://doi.org/10.3390/atmos11020146" rel="noreferrer" target="_blank">[1]</a><a class="reference external" href="https://doi.org/10.5194/nhess-22-659-2022" rel="noreferrer" target="_blank">[2]</a>. In the third assessment report of the IPCC, hot temperature extremes were already presented as relevant to insurance and related services <a class="reference external" href="https://www.ipcc.ch/site/assets/uploads/2018/03/wg2TARchap8.pdf" rel="noreferrer" target="_blank">[3]</a>. Consequently, the need for reliable regional and global climate projections has become paramount, offering valuable insights for optimising reinsurance strategies in the face of a changing climate landscape. Nonetheless, despite their pivotal role, uncertainties inherent in these projections can potentially lead to misuse <a class="reference external" href="https://doi.org/10.1002/wcc.71" rel="noreferrer" target="_blank">[4]</a><a class="reference external" href="https://doi.org/10.1002/wcc.579" rel="noreferrer" target="_blank">[5]</a>. This underscores the importance of accurately calculating and accounting for uncertainties to ensure their appropriate consideration. This notebook utilises data from a subset of models from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview" rel="noreferrer" target="_blank">CMIP6</a> Global Climate Models (GCMs) and explores the uncertainty in future projections of maximum temperature-based extreme indices by considering the ensemble inter-model spread of projected changes. Two maximum temperature-based indices from <a class="reference external" href="https://www.ecad.eu/indicesextremes/" rel="noreferrer" target="_blank">ECA&amp;D</a> indices (one of physical nature and the other of statistical nature) are computed using the <a class="reference external" href="https://icclim.readthedocs.io/en/stable/" rel="noreferrer" target="_blank">icclim</a> Python package. The first index, identified by the ETCCDI short name ‘SU’, quantifies the occurrence of summer days (i.e., with daily maximum temperatures exceeding 25°C) within a year or a season (JJA in this notebook). The second index, labeled ‘TX90p’, describes the number of days with daily maximum temperatures exceeding the daily 90th percentile of maximum temperature for a 5-day moving window. For this notebook, the daily 90th percentile threshold is calculated for the historical period spanning from 1971 to 2000. The index calculations, though, are performed over the future period from 2015 to 2099, following the Shared Socioeconomic Pathways SSP5-8.5. It is important to mention that the results presented here pertain to a specific subset of the CMIP6 ensemble and may not be generalisable to the entire dataset. Also note that a separate assessment examines the representation of climatology and trends of these indices for the same models during the historical period (1971-2000), while another assessment looks at the projected climate signal of these indices for the same models at a 2°C Global Warming Level.</p>
</section>
<section id="quality-assessment-statement">
<h2>📢 Quality assessment statement<a class="headerlink" href="#quality-assessment-statement" title="Link to this heading">#</a></h2>
<div class="note admonition">
<p class="admonition-title">These are the key outcomes of this assessment</p>
<ul class="simple">
<li><p>Looking ahead to future projections (2015-2099), all models within the subset agree on projecting general positive trends for both indices across Europe during the temporal aggregation of JJA, with a particularly notable positive projected trend in the Mediterranean Basin for ‘TX90p’. This finding is consistent with the results of Josep Cos et al. (2022) <a class="reference external" href="https://doi.org/10.5194/esd-13-321-2022" rel="noreferrer" target="_blank">[6]</a>, who evaluated the Mediterranean climate change hotspot using CMIP6 projections.</p></li>
<li><p>While certain regions exhibit near-zero trends for the ‘SU’ index, possibly due to threshold temperature constraints, others show higher values, highlighting the importance of considering both statistically and physically based extreme indices for comprehensive assessments.</p></li>
<li><p>Utilising CMIP6 projections presents a valuable opportunity to anticipate future trends in air temperature extremes across Europe, enabling the insurance industry to refine risk management strategies. While all considered models show a positive trend for these indices, the magnitude of these trends and their uncertainty (quantified by the inter-model spread) vary spatially and need to be considered.</p></li>
<li><p>A separate assessment evaluates the biases in climatology and trends of these indices for the historical period from 1971 to 2000 (“CMIP6 Climate Projections: evaluating bias in extreme temperature indices for the reinsurance sector”). The results of that assessment show an overall underestimation of the trends for both indices and the climatology of ‘SU’, as well as difficulty in correctly representing the spatial distribution, particularly over regions with complex orography. These biases may affect future projections and should be taken into account before using them.</p></li>
</ul>
</div>
<figure class="align-default" id="id1">
<a class="reference internal image-reference" href="../../_images/00e7ccee-ce24-4448-a32d-d37b6cce9162.png"><img alt="trend_future_TX90p" src="../../_images/00e7ccee-ce24-4448-a32d-d37b6cce9162.png" style="width: 850px;" />
</a>
<figcaption>
<p><span class="caption-number">Fig. 5.1.2.1 </span><span class="caption-text">Number of days with daily maximum temperatures exceeding the daily 90th percentile of maximum temperature for a 5-day moving window (‘TX90p’) for the temporal aggregation of ‘JJA’. Trend for the future period (2015-2099). For this index, the reference daily 90th percentile threshold is calculated based on the historical period (1971-2000). The layout includes data corresponding to: (a) the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell) and (b) the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</span><a class="headerlink" href="#id1" title="Link to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="methodology">
<h2>📋 Methodology<a class="headerlink" href="#methodology" title="Link to this heading">#</a></h2>
<p>This notebook offers an assessment of the projected changes and their associated uncertainties using a subset of 16 models from <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview" rel="noreferrer" target="_blank">CMIP6</a>. The uncertainty is examined by analysing the ensemble inter-model spread of projected changes for the maximum-temperature-based indices ‘SU’ and ‘TX90p,’ calculated over the temporal aggregation of JJA for the future period spanning from 2015 to 2099. In particular, spatial patterns of climate projected trends are examined and displayed for each model individually and for the ensemble median (calculated for each grid cell), alongside the ensemble inter-model spread to account for projected uncertainty. Additionally, spatially-averaged trend values are analysed and presented using box plots to provide an overview of trend behavior across the distribution of the chosen subset of models when averaged across Europe.</p>
<p>The analysis and results follow the next outline:</p>
<p><strong><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1"><span class="std std-ref">1. Parameters, requests and functions definition</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-1"><span class="std std-ref">1.1. Import packages</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-2"><span class="std std-ref">1.2. Define Parameters</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-3"><span class="std std-ref">1.3. Define models</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-4"><span class="std std-ref">1.4. Define land-sea mask request</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-5"><span class="std std-ref">1.5. Define model requests</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-6"><span class="std std-ref">1.6. Functions to cache</span></a></p></li>
</ul>
<p><strong><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-2"><span class="std std-ref">2. Downloading and processing</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-2-1"><span class="std std-ref">2.1. Download and transform the regridding model</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-2-2"><span class="std std-ref">2.2. Download and transform models</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-2-3"><span class="std std-ref">2.3. Apply land-sea mask, change attributes and cut the region to show</span></a></p></li>
</ul>
<p><strong><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-3"><span class="std std-ref">3. Plot and describe results</span></a></strong></p>
<ul class="simple">
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-1"><span class="std std-ref">3.1. Define plotting functions</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-2"><span class="std std-ref">3.2. Plot ensemble maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-3"><span class="std std-ref">3.3. Plot model maps</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-4"><span class="std std-ref">3.4. Boxplots of the future trend</span></a></p></li>
<li><p><a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-5"><span class="std std-ref">3.5. Results summary and discussion</span></a></p></li>
</ul>
</section>
<section id="analysis-and-results">
<h2>📈 Analysis and results<a class="headerlink" href="#analysis-and-results" title="Link to this heading">#</a></h2>
<section id="parameters-requests-and-functions-definition">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1"></span><h3>1. Parameters, requests and functions definition<a class="headerlink" href="#parameters-requests-and-functions-definition" title="Link to this heading">#</a></h3>
<section id="import-packages">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-1"></span><h4>1.1. Import packages<a class="headerlink" href="#import-packages" title="Link to this heading">#</a></h4>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tempfile</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">textwrap</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cartopy.crs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ccrs</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">icclim</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">xarray</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">xr</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">c3s_eqc_automatic_quality_control</span><span class="w"> </span><span class="kn">import</span> <span class="n">diagnostics</span><span class="p">,</span> <span class="n">download</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">utils</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">xarrayMannKendall</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mann_Kendall_test</span>

<span class="n">plt</span><span class="o">.</span><span class="n">style</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;seaborn-v0_8-notebook&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;hatch.linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-parameters">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-2"></span><h4>1.2. Define Parameters<a class="headerlink" href="#define-parameters" title="Link to this heading">#</a></h4>
<p>In the “Define Parameters” section, various customisable options for the notebook are specified. Most of the parameters chosen are the same as those used in other assessments (“CMIP6 Climate Projections: evaluating bias in extreme temperature indices for the reinsurance sector”), being them:</p>
<ul class="simple">
<li><p>The initial and ending year used for the future projections period can be specified by changing the parametes <code class="docutils literal notranslate"><span class="pre">future_slice</span></code> (2015-2099 is chosen for consistency between CMIP6 and CORDEX).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">historical_slice</span></code> determines the historical period used (1971 to 2000 is choosen to allow comparison to CORDEX models in other assessments).</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">timeseries</span></code> set the temporal aggregation. For instance, selecting “JJA” implies considering only the JJA season.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">collection_id</span></code> provides the choice between Global Climate Models CMIP6 or Regional Climate Models CORDEX. Although the code allows choosing between CMIP6 or CORDEX, the example provided in this notebook deals with CMIP6.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">area</span></code> allows specifying the geographical domain of interest.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">interpolation_method</span></code> parameter allows selecting the interpolation method when regridding is performed over the indices.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">chunk</span></code> selection allows the user to define if dividing into chunks when downloading the data on their local machine. Although it does not significantly affect the analysis, it is recommended to keep the default value for optimal performance.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Time period</span>
<span class="n">historical_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">1971</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">future_slice</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">2015</span><span class="p">,</span> <span class="mi">2099</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">future_slice</span><span class="o">.</span><span class="n">start</span> <span class="o">&gt;</span> <span class="n">historical_slice</span><span class="o">.</span><span class="n">stop</span>

<span class="c1"># Choose annual or seasonal timeseries</span>
<span class="n">timeseries</span> <span class="o">=</span> <span class="s2">&quot;JJA&quot;</span>
<span class="k">assert</span> <span class="n">timeseries</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;annual&quot;</span><span class="p">,</span> <span class="s2">&quot;DJF&quot;</span><span class="p">,</span> <span class="s2">&quot;MAM&quot;</span><span class="p">,</span> <span class="s2">&quot;JJA&quot;</span><span class="p">,</span> <span class="s2">&quot;SON&quot;</span><span class="p">)</span>

<span class="c1"># Variable</span>
<span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;temperature&quot;</span>
<span class="k">assert</span> <span class="n">variable</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">)</span>

<span class="c1"># Choose CORDEX or CMIP6</span>
<span class="n">collection_id</span> <span class="o">=</span> <span class="s2">&quot;CMIP6&quot;</span>
<span class="k">assert</span> <span class="n">collection_id</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;CORDEX&quot;</span><span class="p">,</span> <span class="s2">&quot;CMIP6&quot;</span><span class="p">)</span>

<span class="c1"># Interpolation method</span>
<span class="n">interpolation_method</span> <span class="o">=</span> <span class="s2">&quot;bilinear&quot;</span>

<span class="c1"># Area to show</span>
<span class="n">area</span> <span class="o">=</span> <span class="p">[</span><span class="mi">72</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>

<span class="c1"># Chunks for download</span>
<span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-models">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-3"></span><h4>1.3. Define models<a class="headerlink" href="#define-models" title="Link to this heading">#</a></h4>
<p>The following climate analyses are performed considering a subset of GCMs from CMIP6. Models names are listed in the parameters below. Some variable-dependent parameters are also selected, as the <code class="docutils literal notranslate"><span class="pre">index_names</span></code> parameter, which specifies the maximum-temperature-based indices (‘SU’ and ‘TX90p’ in our case) from the <a class="reference external" href="https://icclim.readthedocs.io/en/stable/" rel="noreferrer" target="_blank">icclim</a> Python package.</p>
<p>The selected CMIP6 models have available both the historical and SSP8.5 experiments, and they are the same as those used in other assessments (“CMIP6 Climate Projections: evaluating bias in extreme temperature indices for the reinsurance sector”).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">match</span> <span class="n">variable</span><span class="p">:</span>
    <span class="k">case</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span>
        <span class="n">resample_reduction</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span>
        <span class="n">index_names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;SU&quot;</span><span class="p">,</span> <span class="s2">&quot;TX90p&quot;</span><span class="p">)</span>
        <span class="n">era5_variable</span> <span class="o">=</span> <span class="s2">&quot;2m_temperature&quot;</span>
        <span class="n">cmip6_variable</span> <span class="o">=</span> <span class="s2">&quot;daily_maximum_near_surface_air_temperature&quot;</span>
        <span class="n">cordex_variable</span> <span class="o">=</span> <span class="s2">&quot;maximum_2m_temperature_in_the_last_24_hours&quot;</span>
        <span class="n">models_cmip6</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;access_cm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;awi_cm_1_1_mr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmcc_esm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cnrm_cm6_1_hr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cnrm_esm2_1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec_earth3_cc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gfdl_esm4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inm_cm4_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inm_cm5_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;kiost_esm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mpi_esm1_2_lr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;miroc6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;miroc_es2l&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;mri_esm2_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;noresm2_mm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nesm3&quot;</span><span class="p">,</span>    
        <span class="p">)</span>   
        <span class="n">cbars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cmap_divergent&quot;</span><span class="p">:</span> <span class="s2">&quot;RdBu_r&quot;</span><span class="p">,</span> <span class="s2">&quot;cmap_sequential&quot;</span><span class="p">:</span> <span class="s2">&quot;viridis&quot;</span><span class="p">}</span>
        <span class="c1">#Define dictionaries to use in titles and caption</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;SU&quot;</span><span class="p">:</span><span class="s2">&quot;Number of summer days&quot;</span><span class="p">,</span>
            <span class="s2">&quot;TX90p&quot;</span><span class="p">:</span><span class="s2">&quot;Number of days with daily maximum temperatures exceeding the daily 90th percentile of maximum temperature for a 5-day moving window&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">case</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">:</span>
        <span class="n">resample_reduction</span> <span class="o">=</span> <span class="s2">&quot;sum&quot;</span>
        <span class="n">index_names</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;CWD&quot;</span><span class="p">,</span> <span class="s2">&quot;R20mm&quot;</span><span class="p">,</span> <span class="s2">&quot;RR1&quot;</span><span class="p">,</span> <span class="s2">&quot;RX1day&quot;</span><span class="p">,</span> <span class="s2">&quot;RX5day&quot;</span><span class="p">)</span>
        <span class="n">era5_variable</span> <span class="o">=</span> <span class="s2">&quot;total_precipitation&quot;</span>
        <span class="n">cmip6_variable</span> <span class="o">=</span> <span class="s2">&quot;precipitation&quot;</span>
        <span class="n">cordex_variable</span> <span class="o">=</span> <span class="s2">&quot;mean_precipitation_flux&quot;</span>
        <span class="n">models_cmip6</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;access_cm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;bcc_csm2_mr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cmcc_esm2&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cnrm_cm6_1_hr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;cnrm_esm2_1&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ec_earth3_cc&quot;</span><span class="p">,</span>
            <span class="s2">&quot;gfdl_esm4&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inm_cm4_8&quot;</span><span class="p">,</span>
            <span class="s2">&quot;inm_cm5_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;mpi_esm1_2_lr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;miroc6&quot;</span><span class="p">,</span>
            <span class="s2">&quot;miroc_es2l&quot;</span><span class="p">,</span> 
            <span class="s2">&quot;mri_esm2_0&quot;</span><span class="p">,</span>
            <span class="s2">&quot;noresm2_mm&quot;</span><span class="p">,</span>
            <span class="s2">&quot;nesm3&quot;</span><span class="p">,</span>
            <span class="s2">&quot;ukesm1_0_ll&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">cbars</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;cmap_divergent&quot;</span><span class="p">:</span> <span class="s2">&quot;RdBu&quot;</span><span class="p">,</span> <span class="s2">&quot;cmap_sequential&quot;</span><span class="p">:</span> <span class="s2">&quot;viridis_r&quot;</span><span class="p">}</span>
        <span class="c1">#Define dictionaries to use in titles and caption</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;RX1day&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum 1-day total precipitation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RX5day&quot;</span><span class="p">:</span> <span class="s2">&quot;Maximum 5-day total precipitation&quot;</span><span class="p">,</span>
            <span class="s2">&quot;RR1&quot;</span><span class="p">:</span><span class="s2">&quot;Number of wet days (Precip &gt;= 1mm)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;R20mm&quot;</span><span class="p">:</span><span class="s2">&quot;Number of heavy precipitation days (Precip &gt;= 20mm)&quot;</span><span class="p">,</span>
            <span class="s2">&quot;CWD&quot;</span><span class="p">:</span><span class="s2">&quot;Maximum consecutive wet days&quot;</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">variable</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">models_cordex</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;clmcom_clm_cclm4_8_17&quot;</span><span class="p">,</span>
    <span class="s2">&quot;clmcom_eth_cosmo_crclim&quot;</span><span class="p">,</span>
    <span class="s2">&quot;cnrm_aladin63&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dmi_hirham5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;knmi_racmo22e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mohc_hadrem3_ga7_05&quot;</span><span class="p">,</span>
    <span class="s2">&quot;mpi_csc_remo2009&quot;</span><span class="p">,</span>
    <span class="s2">&quot;smhi_rca4&quot;</span><span class="p">,</span>
    <span class="s2">&quot;uhoh_wrf361h&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">model_regrid</span> <span class="o">=</span> <span class="s2">&quot;gfdl_esm4&quot;</span> <span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span> <span class="k">else</span> <span class="s2">&quot;clmcom_eth_cosmo_crclim&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-land-sea-mask-request">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-4"></span><h4>1.4. Define land-sea mask request<a class="headerlink" href="#define-land-sea-mask-request" title="Link to this heading">#</a></h4>
<p>Within this notebook, ERA5 will be used to download the land-sea mask when plotting. In this section, we set the required parameters for the cds-api data-request of ERA5 land-sea mask.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_lsm</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;reanalysis-era5-single-levels&quot;</span><span class="p">,</span>
    <span class="p">{</span>
        <span class="s2">&quot;product_type&quot;</span><span class="p">:</span> <span class="s2">&quot;reanalysis&quot;</span><span class="p">,</span>
        <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;netcdf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;00:00&quot;</span><span class="p">,</span>
        <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="s2">&quot;land_sea_mask&quot;</span><span class="p">,</span>
        <span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="s2">&quot;1940&quot;</span><span class="p">,</span>
        <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="s2">&quot;01&quot;</span><span class="p">,</span>
        <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">area</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="define-model-requests">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-5"></span><h4>1.5. Define model requests<a class="headerlink" href="#define-model-requests" title="Link to this heading">#</a></h4>
<p>In this section we set the required parameters for the cds-api data-request.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">Weights</span> <span class="pre">=</span> <span class="pre">True</span></code>, spatial weighting is applied for calculations requiring spatial data aggregation. This is particularly relevant for CMIP6 GCMs with regular lon-lat grids that do not consider varying surface extensions at different latitudes. In contrast, CORDEX RCMs, using rotated grids, inherently account for different cell surfaces based on latitude, eliminating the need for a latitude cosine multiplicative factor (<code class="docutils literal notranslate"><span class="pre">Weights</span> <span class="pre">=</span> <span class="pre">False</span></code>).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">request_cmip6</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;daily&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">cmip6_variable</span><span class="p">,</span>
    <span class="s2">&quot;month&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">month</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)],</span>
    <span class="s2">&quot;day&quot;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">day</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">day</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">32</span><span class="p">)],</span>
    <span class="s2">&quot;area&quot;</span><span class="p">:</span> <span class="n">area</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">request_cordex</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;zip&quot;</span><span class="p">,</span>
    <span class="s2">&quot;domain&quot;</span><span class="p">:</span> <span class="s2">&quot;europe&quot;</span><span class="p">,</span>
    <span class="s2">&quot;horizontal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;0_11_degree_x_0_11_degree&quot;</span><span class="p">,</span>
    <span class="s2">&quot;temporal_resolution&quot;</span><span class="p">:</span> <span class="s2">&quot;daily_mean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;variable&quot;</span><span class="p">:</span> <span class="n">cordex_variable</span><span class="p">,</span>
    <span class="s2">&quot;gcm_model&quot;</span><span class="p">:</span> <span class="s2">&quot;mpi_m_mpi_esm_lr&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ensemble_member&quot;</span><span class="p">:</span> <span class="s2">&quot;r1i1p1&quot;</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">def</span><span class="w"> </span><span class="nf">get_cordex_years</span><span class="p">(</span>
    <span class="n">year_slice</span><span class="p">,</span>
    <span class="n">timeseries</span><span class="p">,</span>
    <span class="n">start_years</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1951</span><span class="p">,</span> <span class="mi">2097</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
    <span class="n">end_years</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1955</span><span class="p">,</span> <span class="mi">2101</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
<span class="p">):</span>
    <span class="n">start_year</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">end_year</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">years</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span>
        <span class="nb">range</span><span class="p">(</span><span class="n">year_slice</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;DJF&quot;</span><span class="p">),</span> <span class="n">year_slice</span><span class="o">.</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1"># Include D(year-1)</span>
    <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">start_years</span><span class="p">,</span> <span class="n">end_years</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">years</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)):</span>
            <span class="n">start_year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">end_year</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">end</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_cmip6_years</span><span class="p">(</span><span class="n">year_slice</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span>
            <span class="n">year_slice</span><span class="o">.</span><span class="n">start</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;DJF&quot;</span><span class="p">),</span>  <span class="c1"># Include D(year-1)</span>
            <span class="n">year_slice</span><span class="o">.</span><span class="n">stop</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">]</span>


<span class="n">model_requests</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CORDEX&quot;</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_cordex</span><span class="p">:</span>
        <span class="n">start_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1970</span> <span class="k">if</span> <span class="n">model</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;smhi_rca4&quot;</span><span class="p">,</span> <span class="s2">&quot;uhoh_wrf361h&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">1966</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span>
            <span class="nb">range</span><span class="p">(</span><span class="mi">1971</span><span class="p">,</span> <span class="mi">2097</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">end_years</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1970</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1975</span><span class="p">,</span> <span class="mi">2101</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
        <span class="c1"># Historical</span>
        <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">:</span>
            <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">requests</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="o">**</span><span class="n">request_cordex</span><span class="p">,</span>
                    <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;historical&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;start_year&quot;</span><span class="p">:</span> <span class="n">start_year</span><span class="p">,</span>
                    <span class="s2">&quot;end_year&quot;</span><span class="p">:</span> <span class="n">end_year</span><span class="p">,</span>
                    <span class="s2">&quot;rcm_model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                    <span class="o">*</span><span class="n">get_cordex_years</span><span class="p">(</span>
                        <span class="n">historical_slice</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">start_years</span><span class="p">,</span> <span class="n">end_years</span>
                    <span class="p">)</span>
                <span class="p">)</span>
            <span class="p">]</span>
        <span class="c1"># Future</span>
        <span class="n">requests</span> <span class="o">+=</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="o">**</span><span class="n">request_cordex</span><span class="p">,</span>
                <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;rcp_8_5&quot;</span><span class="p">,</span>
                <span class="s2">&quot;start_year&quot;</span><span class="p">:</span> <span class="n">start_year</span><span class="p">,</span>
                <span class="s2">&quot;end_year&quot;</span><span class="p">:</span> <span class="n">end_year</span><span class="p">,</span>
                <span class="s2">&quot;rcm_model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">for</span> <span class="n">start_year</span><span class="p">,</span> <span class="n">end_year</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
                <span class="o">*</span><span class="n">get_cordex_years</span><span class="p">(</span><span class="n">future_slice</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">start_years</span><span class="p">,</span> <span class="n">end_years</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">]</span>
        <span class="n">model_requests</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;projections-cordex-domains-single-levels&quot;</span><span class="p">,</span> <span class="n">requests</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span><span class="p">:</span>
    <span class="c1"># Historical</span>
    <span class="k">if</span> <span class="n">variable</span> <span class="o">==</span> <span class="s2">&quot;precipitation&quot;</span><span class="p">:</span>
        <span class="n">requests</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">requests</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">split_request</span><span class="p">(</span>
            <span class="n">request_cmip6</span>
            <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">get_cmip6_years</span><span class="p">(</span><span class="n">historical_slice</span><span class="p">),</span> <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;historical&quot;</span><span class="p">},</span>
            <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Future</span>
    <span class="n">requests</span> <span class="o">+=</span> <span class="n">download</span><span class="o">.</span><span class="n">split_request</span><span class="p">(</span>
        <span class="n">request_cmip6</span>
        <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;year&quot;</span><span class="p">:</span> <span class="n">get_cmip6_years</span><span class="p">(</span><span class="n">future_slice</span><span class="p">),</span> <span class="s2">&quot;experiment&quot;</span><span class="p">:</span> <span class="s2">&quot;ssp5_8_5&quot;</span><span class="p">},</span>
        <span class="n">chunks</span><span class="o">=</span><span class="n">chunks</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models_cmip6</span><span class="p">:</span>
        <span class="n">model_requests</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;projections-cmip6&quot;</span><span class="p">,</span>
            <span class="p">[</span><span class="n">request</span> <span class="o">|</span> <span class="p">{</span><span class="s2">&quot;model&quot;</span><span class="p">:</span> <span class="n">model</span><span class="p">}</span> <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="n">requests</span><span class="p">],</span>
        <span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">request_grid_out</span> <span class="o">=</span> <span class="n">model_requests</span><span class="p">[</span><span class="n">model_regrid</span><span class="p">]</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="functions-to-cache">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-6"></span><h4>1.6. Functions to cache<a class="headerlink" href="#functions-to-cache" title="Link to this heading">#</a></h4>
<p>In this section, functions that will be executed in the caching phase are defined. Caching is the process of storing copies of files in a temporary storage location, so that they can be accessed more quickly. This process also checks if the user has already downloaded a file, avoiding redundant downloads.</p>
<p>Functions description:</p>
<ul class="simple">
<li><p>The <code class="docutils literal notranslate"><span class="pre">select_timeseries</span></code> function subsets the dataset based on the chosen <code class="docutils literal notranslate"><span class="pre">timeseries</span></code> parameter.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">compute_indices</span></code> function utilises the icclim package to calculate the maximum-temperature-based indices.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">compute_trends</span></code> function employs the Mann-Kendall test for trend calculation.</p></li>
<li><p>Finally, the <code class="docutils literal notranslate"><span class="pre">compute_indices_and_trends</span></code> function calculates the maximum-temperature-based indices for the corresponding temporal aggregation using the <code class="docutils literal notranslate"><span class="pre">compute_indices</span></code> function, determines the indices mean for the future period (2015-2099), obtain the trends using the <code class="docutils literal notranslate"><span class="pre">compute_trends</span></code> function, and offers an option for regridding to <code class="docutils literal notranslate"><span class="pre">model_regrid</span></code>.</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">select_timeseries</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">year_slice</span><span class="p">,</span> <span class="n">index_names</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;annual&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year_slice</span><span class="o">.</span><span class="n">start</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">year_slice</span><span class="o">.</span><span class="n">stop</span><span class="p">)))</span>
    <span class="n">ds</span><span class="o">=</span><span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year_slice</span><span class="o">.</span><span class="n">start</span><span class="o">-</span><span class="mi">1</span><span class="si">}</span><span class="s2">-12&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">-11&quot;</span><span class="p">))</span>
    <span class="k">if</span> <span class="s2">&quot;RX5day&quot;</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ds</span>
    <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ds</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">season</span> <span class="o">==</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  


<span class="k">def</span><span class="w"> </span><span class="nf">compute_indices</span><span class="p">(</span>
    <span class="n">ds</span><span class="p">,</span>
    <span class="n">index_names</span><span class="p">,</span>
    <span class="n">timeseries</span><span class="p">,</span>
    <span class="n">tmpdir</span><span class="p">,</span>
    <span class="n">future_slice</span><span class="p">,</span>
    <span class="n">historical_slice</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">labels</span><span class="p">,</span> <span class="n">datasets</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">ds</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;time.year&quot;</span><span class="p">))</span>
    <span class="n">paths</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2">.nc&quot;</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">]</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span><span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">datasets</span><span class="p">]</span>
    <span class="n">xr</span><span class="o">.</span><span class="n">save_mfdataset</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="n">paths</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_mfdataset</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>
    <span class="n">in_files</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">/rechunked.zarr&quot;</span>
    <span class="n">chunks</span> <span class="o">=</span> <span class="p">{</span><span class="n">dim</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span> <span class="k">else</span> <span class="s2">&quot;auto&quot;</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">}</span>
    <span class="n">ds</span><span class="o">.</span><span class="n">chunk</span><span class="p">(</span><span class="n">chunks</span><span class="p">)</span><span class="o">.</span><span class="n">to_zarr</span><span class="p">(</span><span class="n">in_files</span><span class="p">)</span>

    <span class="n">time_range</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-01-01&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">-12-31&quot;</span>
    <span class="n">base_range</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">historical_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-01-01&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">historical_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">-12-31&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">historical_slice</span>
        <span class="k">else</span> <span class="kc">None</span>
    <span class="p">)</span>

    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">icclim</span><span class="o">.</span><span class="n">index</span><span class="p">(</span>
            <span class="n">index_name</span><span class="o">=</span><span class="n">index_name</span><span class="p">,</span>
            <span class="n">in_files</span><span class="o">=</span><span class="n">in_files</span><span class="p">,</span>
            <span class="n">out_file</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">tmpdir</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">index_name</span><span class="si">}</span><span class="s2">.nc&quot;</span><span class="p">,</span>
            <span class="n">slice_mode</span><span class="o">=</span><span class="s2">&quot;year&quot;</span> <span class="k">if</span> <span class="n">timeseries</span> <span class="o">==</span> <span class="s2">&quot;annual&quot;</span> <span class="k">else</span> <span class="n">timeseries</span><span class="p">,</span>
            <span class="n">time_range</span><span class="o">=</span><span class="n">time_range</span><span class="p">,</span>
            <span class="n">base_period_time_range</span><span class="o">=</span><span class="n">base_range</span> <span class="k">if</span> <span class="n">index_name</span> <span class="o">==</span> <span class="s2">&quot;TX90p&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">index_name</span> <span class="ow">in</span> <span class="n">index_names</span>
    <span class="p">]</span>

    <span class="k">return</span> <span class="n">xr</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">datasets</span><span class="p">)</span><span class="o">.</span><span class="n">drop_dims</span><span class="p">(</span><span class="s2">&quot;bounds&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_trends</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="n">datasets</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="p">(</span><span class="n">lat</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;Y&quot;</span><span class="p">])</span>
    <span class="p">(</span><span class="n">lon</span><span class="p">,)</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">&amp;</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">axes</span><span class="p">[</span><span class="s2">&quot;X&quot;</span><span class="p">])</span>
    <span class="n">coords_name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="s2">&quot;time&quot;</span><span class="p">,</span>
        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span>
        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">Mann_Kendall_test</span><span class="p">(</span>
            <span class="n">da</span> <span class="o">-</span> <span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">),</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;theilslopes&quot;</span><span class="p">,</span>
            <span class="n">coords_name</span><span class="o">=</span><span class="n">coords_name</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">rename</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">coords_name</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">})</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">assign_coords</span><span class="p">({</span><span class="n">dim</span><span class="p">:</span> <span class="n">da</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">dims</span><span class="p">})</span>
        <span class="n">datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">datasets</span><span class="p">,</span> <span class="s2">&quot;index&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">add_bounds</span><span class="p">(</span><span class="n">ds</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="p">{</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">}</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">bounds</span><span class="p">):</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">add_bounds</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ds</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_grid_out</span><span class="p">(</span><span class="n">request_grid_out</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="n">ds_regrid</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span><span class="o">*</span><span class="n">request_grid_out</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
        <span class="n">ds_regrid</span> <span class="o">=</span> <span class="n">add_bounds</span><span class="p">(</span><span class="n">ds_regrid</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">coords</span><span class="p">):</span>
            <span class="n">coords</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">ds_regrid</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">bounds</span><span class="p">[</span><span class="n">coord</span><span class="p">])</span>
    <span class="n">grid_out</span> <span class="o">=</span> <span class="n">ds_regrid</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span>
    <span class="n">coords_to_drop</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_out</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">grid_out</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span>
    <span class="n">grid_out</span> <span class="o">=</span> <span class="n">ds_regrid</span><span class="p">[</span><span class="n">coords</span><span class="p">]</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">coords_to_drop</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">grid_out</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="n">grid_out</span>


<span class="k">def</span><span class="w"> </span><span class="nf">compute_indices_and_trends_future</span><span class="p">(</span>
    <span class="n">ds</span><span class="p">,</span>
    <span class="n">index_names</span><span class="p">,</span>
    <span class="n">timeseries</span><span class="p">,</span>
    <span class="n">resample</span><span class="p">,</span>
    <span class="n">future_slice</span><span class="p">,</span>
    <span class="n">historical_slice</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">resample_reduction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">request_grid_out</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="o">**</span><span class="n">regrid_kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">assert</span> <span class="p">(</span><span class="n">request_grid_out</span> <span class="ow">and</span> <span class="n">regrid_kwargs</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span>
        <span class="n">request_grid_out</span> <span class="ow">or</span> <span class="n">regrid_kwargs</span>
    <span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">drop_vars</span><span class="p">([</span><span class="n">var</span> <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">da</span><span class="o">.</span><span class="n">dims</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">])</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="p">)]</span>

    <span class="c1"># Original bounds for conservative interpolation</span>
    <span class="k">if</span> <span class="n">regrid_kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;method&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;conservative&quot;</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">add_bounds</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ds</span><span class="o">.</span><span class="n">cf</span><span class="o">.</span><span class="n">get_bounds</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">.</span><span class="n">reset_coords</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bounds</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">ds_future</span> <span class="o">=</span> <span class="n">select_timeseries</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">future_slice</span><span class="p">,</span><span class="n">index_names</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">historical_slice</span><span class="p">:</span>
        <span class="n">ds_historical</span> <span class="o">=</span> <span class="n">select_timeseries</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">timeseries</span><span class="p">,</span> <span class="n">historical_slice</span><span class="p">,</span><span class="n">index_names</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">ds_historical</span><span class="p">,</span> <span class="n">ds_future</span><span class="p">],</span> <span class="s2">&quot;time&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_future</span>

    <span class="k">if</span> <span class="n">resample_reduction</span><span class="p">:</span>
        <span class="n">resampled</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s2">&quot;1D&quot;</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">resampled</span><span class="p">,</span> <span class="n">resample_reduction</span><span class="p">)(</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resample_reduction</span> <span class="o">==</span> <span class="s2">&quot;sum&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_vars</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / day&quot;</span>
    <span class="k">with</span> <span class="n">tempfile</span><span class="o">.</span><span class="n">TemporaryDirectory</span><span class="p">()</span> <span class="k">as</span> <span class="n">tmpdir</span><span class="p">:</span>
        <span class="n">ds_indices</span> <span class="o">=</span> <span class="n">compute_indices</span><span class="p">(</span>
            <span class="n">ds</span><span class="p">,</span>
            <span class="n">index_names</span><span class="p">,</span>
            <span class="n">timeseries</span><span class="p">,</span>
            <span class="n">tmpdir</span><span class="p">,</span>
            <span class="n">future_slice</span><span class="o">=</span><span class="n">future_slice</span><span class="p">,</span>
            <span class="n">historical_slice</span><span class="o">=</span><span class="n">historical_slice</span><span class="p">,</span>
        <span class="p">)</span><span class="o">.</span><span class="n">compute</span><span class="p">()</span>
        <span class="n">ds_trends</span> <span class="o">=</span> <span class="n">compute_trends</span><span class="p">(</span><span class="n">ds_indices</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_indices</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;time&quot;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">ds_trends</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">request_grid_out</span><span class="p">:</span>
            <span class="n">ds</span> <span class="o">=</span> <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">merge</span><span class="p">({</span><span class="n">da</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">da</span> <span class="k">for</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">bounds</span><span class="p">}),</span>
                <span class="n">grid_out</span><span class="o">=</span><span class="n">get_grid_out</span><span class="p">(</span><span class="n">request_grid_out</span><span class="p">,</span> <span class="n">regrid_kwargs</span><span class="p">[</span><span class="s2">&quot;method&quot;</span><span class="p">]),</span>
                <span class="o">**</span><span class="n">regrid_kwargs</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">ds</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="downloading-and-processing">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-2"></span><h3>2. Downloading and processing<a class="headerlink" href="#downloading-and-processing" title="Link to this heading">#</a></h3>
<section id="download-and-transform-the-regridding-model">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-2-1"></span><h4>2.1. Download and transform the regridding model<a class="headerlink" href="#download-and-transform-the-regridding-model" title="Link to this heading">#</a></h4>
<p>In this section, the <code class="docutils literal notranslate"><span class="pre">download.download_and_transform</span></code> function from the ‘c3s_eqc_automatic_quality_control’ package is employed to download daily data from the selected CMIP6 regridding model, compute the maximum-temperature-based indices for the selected temporal aggregation, calculate the mean and trend over the future projections period (2015-2099), and cache the result (to avoid redundant downloads and processing).</p>
<p>The regridding model is intended here as the model whose grid will be used to interpolate the others. This ensures all models share a common grid, facilitating the calculation of median values for each cell point. The regridding model within this notebook is “gfdl_esm4” but a different one can be selected by just modifying the <code class="docutils literal notranslate"><span class="pre">model_regrid</span></code> parameter at <a class="reference internal" href="#climate-projections-cmip6-climate-and-weather-extremes-q02-section-1-3"><span class="std std-ref">1.3. Define models</span></a>. It is key to highlight the importance of the chosen target grid depending on the specific application.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;chunks&quot;</span><span class="p">:</span> <span class="n">chunks</span> <span class="k">if</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;transform_chunks&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
    <span class="s2">&quot;transform_func&quot;</span><span class="p">:</span> <span class="n">compute_indices_and_trends_future</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">transform_func_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;index_names&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">index_names</span><span class="p">),</span>
    <span class="s2">&quot;timeseries&quot;</span><span class="p">:</span> <span class="n">timeseries</span><span class="p">,</span>
    <span class="s2">&quot;future_slice&quot;</span><span class="p">:</span> <span class="n">future_slice</span><span class="p">,</span>
    <span class="s2">&quot;historical_slice&quot;</span><span class="p">:</span> <span class="n">historical_slice</span> <span class="k">if</span> <span class="s2">&quot;TX90p&quot;</span> <span class="ow">in</span> <span class="n">index_names</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;resample&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ds_regrid</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
    <span class="o">*</span><span class="n">request_grid_out</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="download-and-transform-models">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-2-2"></span><h4>2.2. Download and transform models<a class="headerlink" href="#download-and-transform-models" title="Link to this heading">#</a></h4>
<p>In this section, the <code class="docutils literal notranslate"><span class="pre">download.download_and_transform</span></code> function from the ‘c3s_eqc_automatic_quality_control’ package is employed to download daily data from the CMIP6 models, compute the maximum-temperature-based indices for the selected temporal aggregation, calculate the mean and trend over the future period (2015-2099), interpolate to the regridding model’s grid (only for the cases in which it is specified, in the other cases, the original model’s grid is mantained), and cache the result (to avoid redundant downloads and processing).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">interpolated_datasets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">model_datasets</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">requests</span> <span class="ow">in</span> <span class="n">model_requests</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model</span><span class="si">=}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Original model</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
        <span class="o">*</span><span class="n">requests</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">model_datasets</span><span class="p">[</span><span class="n">model</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span>

    <span class="k">if</span> <span class="n">model</span> <span class="o">!=</span> <span class="n">model_regrid</span><span class="p">:</span>
        <span class="c1"># Interpolated model</span>
        <span class="n">ds</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span>
            <span class="o">*</span><span class="n">requests</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
            <span class="n">transform_func_kwargs</span><span class="o">=</span><span class="n">transform_func_kwargs</span>
            <span class="o">|</span> <span class="p">{</span>
                <span class="s2">&quot;request_grid_out&quot;</span><span class="p">:</span> <span class="n">request_grid_out</span><span class="p">,</span>
                <span class="s2">&quot;method&quot;</span><span class="p">:</span> <span class="n">interpolation_method</span><span class="p">,</span>
                <span class="s2">&quot;skipna&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">)</span>
    <span class="n">interpolated_datasets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]))</span>

<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">interpolated_datasets</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;minimal&#39;</span><span class="p">,</span> <span class="n">compat</span><span class="o">=</span><span class="s1">&#39;override&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>model=&#39;access_cm2&#39;
model=&#39;awi_cm_1_1_mr&#39;
model=&#39;cmcc_esm2&#39;
model=&#39;cnrm_cm6_1_hr&#39;
model=&#39;cnrm_esm2_1&#39;
model=&#39;ec_earth3_cc&#39;
model=&#39;gfdl_esm4&#39;
model=&#39;inm_cm4_8&#39;
model=&#39;inm_cm5_0&#39;
model=&#39;kiost_esm&#39;
model=&#39;mpi_esm1_2_lr&#39;
model=&#39;miroc6&#39;
model=&#39;miroc_es2l&#39;
model=&#39;mri_esm2_0&#39;
model=&#39;noresm2_mm&#39;
model=&#39;nesm3&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="apply-land-sea-mask-change-attributes-and-cut-the-region-to-show">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-2-3"></span><h4>2.3. Apply land-sea mask, change attributes and cut the region to show<a class="headerlink" href="#apply-land-sea-mask-change-attributes-and-cut-the-region-to-show" title="Link to this heading">#</a></h4>
<p>This section performs the following tasks:</p>
<ol class="arabic simple">
<li><p>Cut the region of interest.</p></li>
<li><p>Downloads the sea mask for ERA5.</p></li>
<li><p>Regrids ERA5’s mask to the <code class="docutils literal notranslate"><span class="pre">model_regrid</span></code> grid and applies it to the regridded data</p></li>
<li><p>Regrids the ERA5 land-sea mask to the model’s original grid and applies it to them.</p></li>
<li><p>Change some variable attributes for plotting purposes.</p></li>
</ol>
<p><strong>Note:</strong> <code class="docutils literal notranslate"><span class="pre">ds_interpolated</span></code> contains data from the models regridded to the regridding model’s grid. <code class="docutils literal notranslate"><span class="pre">model_datasets</span></code> contain the same data but in the original grid of each model.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lsm</span> <span class="o">=</span> <span class="n">download</span><span class="o">.</span><span class="n">download_and_transform</span><span class="p">(</span><span class="o">*</span><span class="n">request_lsm</span><span class="p">)[</span><span class="s2">&quot;lsm&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Cutout</span>
<span class="n">regionalise_kwargs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;lon_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
    <span class="s2">&quot;lat_slice&quot;</span><span class="p">:</span> <span class="nb">slice</span><span class="p">(</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">area</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
<span class="p">}</span>
<span class="n">lsm</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">lsm</span><span class="p">,</span> <span class="o">**</span><span class="n">regionalise_kwargs</span><span class="p">)</span>
<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds_interpolated</span><span class="p">,</span> <span class="o">**</span><span class="n">regionalise_kwargs</span><span class="p">)</span>
<span class="n">model_datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">utils</span><span class="o">.</span><span class="n">regionalise</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="o">**</span><span class="n">regionalise_kwargs</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Mask</span>
<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">ds_interpolated</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
    <span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">lsm</span><span class="p">,</span> <span class="n">ds_interpolated</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">model_datasets</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diagnostics</span><span class="o">.</span><span class="n">regrid</span><span class="p">(</span><span class="n">lsm</span><span class="p">,</span> <span class="n">ds</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1"># Edit attributes</span>
<span class="k">for</span> <span class="n">ds</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ds_interpolated</span><span class="p">,</span> <span class="o">*</span><span class="n">model_datasets</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">10</span>
    <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;trend&quot;</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
        <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;long_name&quot;</span><span class="p">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;units&quot;</span><span class="p">:</span> <span class="s2">&quot;days&quot;</span> <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;d&quot;</span> 
                           <span class="k">else</span> <span class="p">(</span><span class="s2">&quot;mm&quot;</span> <span class="k">if</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;mm d-1&quot;</span> 
                                 <span class="k">else</span> <span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">])}</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 1/1 [00:00&lt;00:00, 16.00it/s]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plot-and-describe-results">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-3"></span><h3>3. Plot and describe results<a class="headerlink" href="#plot-and-describe-results" title="Link to this heading">#</a></h3>
<p>This section will display the following results:</p>
<ul class="simple">
<li><p>Maps representing the spatial distribution of the <strong>future trends</strong> (2015-2099) of the indices ‘SU’ and ‘TX90p’ for each model individually, the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell), and the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</p></li>
<li><p><strong>Boxplots</strong> which represent statistical distributions (PDF) built on the the spatially-averaged future trend from each considered model.</p></li>
</ul>
<section id="define-plotting-functions">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-1"></span><h4>3.1. Define plotting functions<a class="headerlink" href="#define-plotting-functions" title="Link to this heading">#</a></h4>
<p>The functions presented here are used to plot the trends calculated over the future period (2015-2099) for each of the indices (‘SU’ and ‘TX90p’).</p>
<p>For a selected index, two layout types will be displayed, depending on the chosen function:</p>
<ol class="arabic simple">
<li><p>Layout including the ensemble median and the ensemble spread for the trend: <code class="docutils literal notranslate"><span class="pre">plot_ensemble()</span></code> is used.</p></li>
<li><p>Layout including every model trend: <code class="docutils literal notranslate"><span class="pre">plot_models()</span></code> is employed.</p></li>
</ol>
<p><code class="docutils literal notranslate"><span class="pre">trend==True</span></code> allows displaying trend values over the future period, while <code class="docutils literal notranslate"><span class="pre">trend==False</span></code> show mean values. In this notebook, which focuses on the future period, only trend values will be shown, and, consequently, <code class="docutils literal notranslate"><span class="pre">trend==True</span></code>. When the <code class="docutils literal notranslate"><span class="pre">trend</span></code> argument is set to True, regions with no significance are hatched. For individual models, a grid point is considered to have a statistically significant trend when the p-value is lower than 0.05 (in such cases, no hatching is shown). However, for determining trend significance for the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell), reliance is placed on agreement categories, following the advanced approach proposed in AR6 <a class="reference external" href="https://www.ipcc.ch/report/ar6/wg1/downloads/report/IPCC_AR6_WGI_Atlas.pdf" rel="noreferrer" target="_blank">IPCC</a> on pages 1945-1950. The <code class="docutils literal notranslate"><span class="pre">hatch_p_value_ensemble()</span></code> function is used to distinguish, for each grid point, between three possible cases:</p>
<ol class="arabic simple">
<li><p>If more than 66% of the models are statistically significant (p-value &lt; 0.05) and more than 80% of the models share the same sign, we consider the ensemble median trend to be statistically significant, and there is agreement on the sign. To represent this, no hatching is used.</p></li>
<li><p>If less than 66% of the models are statistically significant, regardless of agreement on the sign of the trend, hatching is applied (indicating that the ensemble median trend is not statistically significant).</p></li>
<li><p>If more than 66% of the models are statistically significant but less than 80% of the models share the same sign, we consider the ensemble median trend to be statistically significant, but there is no agreement on the sign of the trend. This is represented using crosses.</p></li>
</ol>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Define function to plot the caption of the figures (for the ensmble case)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_caption_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span><span class="n">exp</span><span class="p">):</span>
    <span class="n">ref_period_str</span><span class="o">=</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;For this index, the reference daily 90th percentile threshold &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;is calculated based on the historical period (1971-2000). &quot;</span>
    <span class="p">)</span>
    <span class="c1">#Add caption to the figure</span>
    <span class="k">match</span> <span class="n">trend</span><span class="p">:</span>
        <span class="k">case</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the temporal aggregation of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> period (</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">). &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_period_str</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;TX90p&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The layout includes data corresponding to: (a) the ensemble median &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(understood as the median of the trend values of the chosen subset of models &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;calculated for each grid cell) and (b) the ensemble spread &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(derived as the standard deviation of the distribution of the chosen &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;subset of models).&quot;</span>
            <span class="p">)</span>
        <span class="k">case</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the temporal aggregation of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> period (</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">). &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_period_str</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;TX90p&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;The layout includes data corresponding to: (a) the ensemble median &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(understood as the median of the mean values of the chosen subset of models &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;calculated for each grid cell) and (b) the ensemble spread &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;(derived as the standard deviation of the distribution of the chosen &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;subset of models).&quot;</span>
            <span class="p">)</span>
          
            
    <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">caption_text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">105</span><span class="p">)</span>
    <span class="c1"># Add each line to the figure</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="c1">#end captioning</span>


<span class="c1">#Define function to plot the caption of the figures (for the individual models case)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span><span class="n">exp</span><span class="p">):</span>
    <span class="n">ref_period_str</span><span class="o">=</span><span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;For this index, the reference daily 90th percentile threshold &quot;</span>
    <span class="sa">f</span><span class="s2">&quot;is calculated based on the historical period (1971-2000). &quot;</span>
    <span class="p">)</span>
    <span class="c1">#Add caption to the figure</span>
    <span class="k">match</span> <span class="n">trend</span><span class="p">:</span>
        <span class="k">case</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the temporal aggregation of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend for the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;period (</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">) of each individual &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> model. &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_period_str</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;TX90p&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">case</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">caption_text</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Fig </span><span class="si">{</span><span class="n">fig_number</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">long_name</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="si">}</span><span class="s2"> (&#39;</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&#39;) for &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;the temporal aggregation of &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;. Trend for the </span><span class="si">{</span><span class="n">exp</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;period (</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">) of each individual &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> model. &quot;</span> 
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ref_period_str</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;TX90p&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
    <span class="n">wrapped_lines</span> <span class="o">=</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="n">caption_text</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">120</span><span class="p">)</span>
    <span class="c1"># Add each line to the figure</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrapped_lines</span><span class="p">):</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span>  <span class="o">-</span> <span class="n">i</span> <span class="o">*</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>






<span class="k">def</span><span class="w"> </span><span class="nf">hatch_p_value</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;plot_func&quot;</span><span class="p">:</span> <span class="s2">&quot;contourf&quot;</span><span class="p">,</span>
        <span class="s2">&quot;show_stats&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;cmap&quot;</span><span class="p">:</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="s2">&quot;add_colorbar&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
        <span class="s2">&quot;levels&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
        <span class="s2">&quot;hatches&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;/&quot;</span> <span class="o">*</span> <span class="mi">3</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">default_kwargs</span> <span class="o">|</span> <span class="n">kwargs</span>

    <span class="n">title</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_title</span><span class="p">()</span>
    <span class="n">plot_obj</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">plot_obj</span>



<span class="k">def</span><span class="w"> </span><span class="nf">hatch_p_value_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">ax</span><span class="p">):</span>
    <span class="n">n_models</span> <span class="o">=</span> <span class="n">trend</span><span class="o">.</span><span class="n">sizes</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span>
    <span class="n">robust_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">p_value</span> <span class="o">&lt;=</span> <span class="mf">0.05</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_models</span>
    <span class="n">robust_ratio</span> <span class="o">=</span> <span class="n">robust_ratio</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">p_value</span><span class="o">.</span><span class="n">notnull</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">))</span>
    <span class="n">signs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">([(</span><span class="n">trend</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">),</span> <span class="p">(</span><span class="n">trend</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">)],</span> <span class="s2">&quot;sign&quot;</span><span class="p">)</span>
    <span class="n">sign_ratio</span> <span class="o">=</span> <span class="n">signs</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="s2">&quot;sign&quot;</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_models</span>
    <span class="n">robust_threshold</span> <span class="o">=</span> <span class="mf">0.66</span>
    <span class="n">sign_ratio</span> <span class="o">=</span> <span class="n">sign_ratio</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">robust_ratio</span> <span class="o">&gt;</span> <span class="n">robust_threshold</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">da</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="n">character</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span>
        <span class="p">[</span><span class="n">robust_ratio</span><span class="p">,</span> <span class="n">sign_ratio</span><span class="p">],</span> <span class="p">[</span><span class="n">robust_threshold</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">]</span>
    <span class="p">):</span>
        <span class="n">hatch_p_value</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">hatches</span><span class="o">=</span><span class="p">[</span><span class="n">character</span> <span class="o">*</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>


<span class="k">def</span><span class="w"> </span><span class="nf">set_extent</span><span class="p">(</span><span class="n">da</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">area</span><span class="p">):</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="n">area</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coord</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">extent</span><span class="p">):</span>
        <span class="n">extent</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="k">else</span> <span class="o">+</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span><span class="n">extent</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">plot_models</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">da_for_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">p_values</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">col_wrap</span><span class="o">=</span><span class="mi">4</span> <span class="k">if</span> <span class="n">collection_id</span><span class="o">==</span><span class="s2">&quot;CMIP6&quot;</span> <span class="k">else</span> <span class="mi">3</span><span class="p">,</span>
    <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
    <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span>
    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">da_for_kwargs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">model_dataarrays</span> <span class="o">=</span> <span class="n">data</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">da_for_kwargs</span> <span class="o">=</span> <span class="n">da_for_kwargs</span> <span class="ow">or</span> <span class="n">data</span>
        <span class="n">model_dataarrays</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">p_values</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model_p_dataarrays</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">p_values</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">p_values</span><span class="p">,</span> <span class="nb">dict</span><span class="p">)</span> <span class="k">else</span> <span class="nb">dict</span><span class="p">(</span><span class="n">p_values</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">model_p_dataarrays</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Get kwargs</span>
    <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;robust&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">default_kwargs</span> <span class="o">|</span> <span class="n">kwargs</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">_determine_cmap_params</span><span class="p">(</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="n">col_wrap</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">model_dataarrays</span><span class="p">)</span> <span class="o">/</span> <span class="n">col_wrap</span><span class="p">)),</span>
        <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">da</span><span class="p">),</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">model_dataarrays</span><span class="o">.</span><span class="n">items</span><span class="p">(),</span> <span class="n">axs</span><span class="p">):</span>
        <span class="n">pcm</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
            <span class="n">da</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">add_colorbar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_p_dataarrays</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hatch_p_value</span><span class="p">(</span><span class="n">model_p_dataarrays</span><span class="p">[</span><span class="n">model</span><span class="p">],</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">set_extent</span><span class="p">(</span><span class="n">da_for_kwargs</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
        <span class="n">pcm</span><span class="p">,</span>
        <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
        <span class="n">extend</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;extend&quot;</span><span class="p">],</span>
        <span class="n">location</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;long_name&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">da_for_kwargs</span><span class="o">.</span><span class="n">attrs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;units&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_ensemble</span><span class="p">(</span>
    <span class="n">da_models</span><span class="p">,</span>
    <span class="n">da_era5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">p_value_era5</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">p_value_models</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()},</span>
    <span class="n">figsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span>
    <span class="n">cbar_kwargs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">area</span><span class="o">=</span><span class="n">area</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># Get kwargs</span>
    <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;robust&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;extend&quot;</span><span class="p">:</span> <span class="s2">&quot;both&quot;</span><span class="p">}</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">default_kwargs</span> <span class="o">|</span> <span class="n">kwargs</span>
    <span class="n">kwargs</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">_determine_cmap_params</span><span class="p">(</span>
        <span class="n">da_models</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">da_era5</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">cbar_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar_kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;orientation&quot;</span><span class="p">:</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">}</span>

    <span class="c1"># Figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
        <span class="n">subplot_kw</span><span class="o">=</span><span class="n">subplot_kw</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">,</span>
        <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">axs</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">axs_iter</span> <span class="o">=</span> <span class="nb">iter</span><span class="p">(</span><span class="n">axs</span><span class="p">)</span>

    <span class="c1"># ERA5</span>
    <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
            <span class="n">da_era5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">p_value_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">hatch_p_value</span><span class="p">(</span><span class="n">p_value_era5</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(a) ERA5&quot;</span><span class="p">)</span>

    <span class="c1"># Median</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">da_models</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
        <span class="n">median</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">p_value_models</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hatch_p_value_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="n">da_models</span><span class="p">,</span> <span class="n">p_value</span><span class="o">=</span><span class="n">p_value_models</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(b) Ensemble Median&quot;</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;(a) Ensemble Median&quot;</span><span class="p">)</span>

    <span class="c1"># Bias</span>
    <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
            <span class="n">bias</span> <span class="o">=</span> <span class="n">median</span> <span class="o">-</span> <span class="n">da_era5</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
            <span class="n">bias</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span>
            <span class="o">**</span><span class="n">default_kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(c) Ensemble Median Bias&quot;</span><span class="p">)</span>

    <span class="c1"># Std</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">axs_iter</span><span class="p">)</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">da_models</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="n">keep_attrs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">plot</span><span class="o">.</span><span class="n">projected_map</span><span class="p">(</span>
        <span class="n">std</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">show_stats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">cbar_kwargs</span><span class="o">=</span><span class="n">cbar_kwargs</span><span class="p">,</span> <span class="o">**</span><span class="n">default_kwargs</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;(d) Ensemble Standard Deviation&quot;</span> <span class="k">if</span> <span class="n">da_era5</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="s2">&quot;(b) Ensemble Standard Deviation&quot;</span><span class="p">)</span>

    <span class="n">set_extent</span><span class="p">(</span><span class="n">da_models</span><span class="p">,</span> <span class="n">axs</span><span class="p">,</span> <span class="n">area</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-ensemble-maps">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-2"></span><h4>3.2. Plot ensemble maps<a class="headerlink" href="#plot-ensemble-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_ensemble()</span></code> function to visualise the trend calculated over the future period (2015-2099) for the model ensemble across Europe. Note that the model data used in this section has previously been interpolated to the “regridding model” grid (<code class="docutils literal notranslate"><span class="pre">&quot;gfdl_esm4&quot;</span></code> for this notebook).</p>
<p>Specifically, for each of the indices (‘SU’ and ‘TX90p’), this section presents a single layout including trend values of the future period (2015-2099) for: (a) the ensemble median (understood as the median of the trend values of the chosen subset of models calculated for each grid cell) and (b) the ensemble spread (derived as the standard deviation of the distribution of the chosen subset of models).</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#Change default colorbars</span>
<span class="n">xr</span><span class="o">.</span><span class="n">set_options</span><span class="p">(</span><span class="o">**</span><span class="n">cbars</span><span class="p">)</span>

<span class="c1">#Fig number counter</span>
<span class="n">fig_number</span><span class="o">=</span><span class="mi">1</span>

<span class="c1">#Common title</span>
<span class="n">common_title</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;&#39;SSP5-8.5&#39;. Future period: </span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">. Temporal aggregation: &#39;</span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2">&#39;&quot;</span>

<span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
    <span class="c1"># Trend</span>
    <span class="n">da_trend</span> <span class="o">=</span> <span class="n">ds_interpolated</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da_trend</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ds_interpolated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_ensemble</span><span class="p">(</span>
        <span class="n">da_models</span><span class="o">=</span><span class="n">da_trend</span><span class="p">,</span>
        <span class="n">p_value_models</span><span class="o">=</span><span class="n">ds_interpolated</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">),</span>
        <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trend of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> ensemble)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    <span class="n">add_caption_ensemble</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;future&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/1d9ae3634fba034f64dca3988e6ddb8d4dd544e0b792b057c8c9fe128c1460fb.png" src="../../_images/1d9ae3634fba034f64dca3988e6ddb8d4dd544e0b792b057c8c9fe128c1460fb.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/f4c81127e22a4c27207e8f929f77f6016fff47caba6a40fa0c741ec6e2947cec.png" src="../../_images/f4c81127e22a4c27207e8f929f77f6016fff47caba6a40fa0c741ec6e2947cec.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-model-maps">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-3"></span><h4>3.3. Plot model maps<a class="headerlink" href="#plot-model-maps" title="Link to this heading">#</a></h4>
<p>In this section, we invoke the <code class="docutils literal notranslate"><span class="pre">plot_models()</span></code> function to visualise the trend over the future period (2015-2099) for every model individually. Note that the model data used in this section maintains its original grid.</p>
<p>Specifically, for each of the indices (‘SU’ and ‘TX90p’), this section presents a single layout including the trend for the future period (2015-2099) of every model.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">index_names</span><span class="p">:</span>
   <span class="c1"># Trend</span>
    <span class="n">da_for_kwargs_trends</span> <span class="o">=</span> <span class="n">ds_interpolated</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">da_for_kwargs_trends</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;units&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ds_interpolated</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plot_models</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">{</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="n">da_for_kwargs</span><span class="o">=</span><span class="n">da_for_kwargs_trends</span><span class="p">,</span>
        <span class="n">p_values</span><span class="o">=</span><span class="p">{</span>
            <span class="n">model</span><span class="p">:</span> <span class="n">ds</span><span class="p">[</span><span class="s2">&quot;p&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">},</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span><span class="mf">6.5</span><span class="p">],</span>
        <span class="n">center</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trend of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> individual models)</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">common_title</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">add_caption_models</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">exp</span><span class="o">=</span><span class="s2">&quot;future&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">fig_number</span><span class="o">=</span><span class="n">fig_number</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/be4bdd1d99f62d93e7fdb865ecea740ee292086228254f7d6ede9c35180dc91c.png" src="../../_images/be4bdd1d99f62d93e7fdb865ecea740ee292086228254f7d6ede9c35180dc91c.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<img alt="../../_images/3ce46b0b5368c60bb229ba8a9984f62bf24a7d913a90b03927838df6a8c686a0.png" src="../../_images/3ce46b0b5368c60bb229ba8a9984f62bf24a7d913a90b03927838df6a8c686a0.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="boxplots-of-the-future-trend">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-4"></span><h4>3.4. Boxplots of the future trend<a class="headerlink" href="#boxplots-of-the-future-trend" title="Link to this heading">#</a></h4>
<p>Finally, we present boxplots representing the ensemble distribution of each climate model trend calculated over the future period (2015-2099) across Europe.</p>
<p>Dots represent the spatially-averaged future trend over the selected region (change of the number of days per decade) for each model (grey) and the ensemble mean (blue). The ensemble median is shown as a green line. Note that the spatially averaged values are calculated for each model from its original grid (i.e., no interpolated data has been used here).</p>
<p>The boxplot visually illustrates the distribution of trends among the climate models, with the box covering the first quartile (Q1 = 25th percentile) to the third quartile (Q3 = 75th percentile), and a green line indicating the ensemble median (Q2 = 50th percentile). Whiskers extend from the edges of the box to show the full data range.</p>
<div class="cell tag_hide-input docutils container">
<details class="admonition hide above-input">
<summary aria-label="Toggle hidden content">
<p class="collapsed admonition-title">Show code cell source</p>
<p class="expanded admonition-title">Hide code cell source</p>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weights</span> <span class="o">=</span> <span class="n">collection_id</span> <span class="o">==</span> <span class="s2">&quot;CMIP6&quot;</span>
<span class="n">mean_datasets</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">diagnostics</span><span class="o">.</span><span class="n">spatial_weighted_mean</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="p">[</span><span class="n">model</span><span class="p">]),</span> <span class="n">weights</span><span class="o">=</span><span class="n">weights</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">model</span><span class="p">,</span> <span class="n">ds</span> <span class="ow">in</span> <span class="n">model_datasets</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="p">]</span>
<span class="n">mean_ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">mean_datasets</span><span class="p">,</span> <span class="s2">&quot;model&quot;</span><span class="p">,</span><span class="n">coords</span><span class="o">=</span><span class="s1">&#39;minimal&#39;</span><span class="p">,</span> <span class="n">compat</span><span class="o">=</span><span class="s1">&#39;override&#39;</span><span class="p">)</span>
<span class="n">index_str</span><span class="o">=</span><span class="mi">1</span>

<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="n">mean_ds</span><span class="p">[</span><span class="s2">&quot;trend&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">):</span>
    <span class="n">df_slope</span> <span class="o">=</span> <span class="n">da</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()[[</span><span class="s2">&quot;trend&quot;</span><span class="p">]]</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">df_slope</span><span class="o">.</span><span class="n">boxplot</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_slope</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">df_slope</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s2">&quot;models&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Ensemble mean</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="n">da</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">),</span>
        <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> Ensemble Mean&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">collection_id</span><span class="si">}</span><span class="s2"> Ensemble&quot;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">labels</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">ds</span><span class="p">[</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> / decade&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="s1">&#39;`&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">index_str</span><span class="p">)</span><span class="si">}</span><span class="s2">) Trend of </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">. Temporal aggregation: </span><span class="si">{</span><span class="n">timeseries</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;region: lon [</span><span class="si">{</span><span class="o">-</span><span class="n">area</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">W, </span><span class="si">{</span><span class="n">area</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">E] x lat [</span><span class="si">{</span><span class="n">area</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">N, </span><span class="si">{</span><span class="n">area</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">N] </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;&#39;SSP5-8.5&#39;. Period: </span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">start</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">future_slice</span><span class="o">.</span><span class="n">stop</span><span class="si">}</span><span class="s2">. &quot;</span>
        <span class="p">)</span>  
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">index_str</span><span class="o">=</span><span class="n">index_str</span><span class="o">+</span><span class="mi">1</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../../_images/f05cf01b44884dec5c350b4bf82c0c038619c8ed24b19ecd8b27bd2c32064d17.png" src="../../_images/f05cf01b44884dec5c350b4bf82c0c038619c8ed24b19ecd8b27bd2c32064d17.png" />
<img alt="../../_images/2253b5a8de0dd267ccec8704fafae9fed3fb96a11503b1d6c2c8a0092fcd3e3d.png" src="../../_images/2253b5a8de0dd267ccec8704fafae9fed3fb96a11503b1d6c2c8a0092fcd3e3d.png" />
</div>
</div>
<div>
    <div style="max-width: 800px;">
    <p><strong>Fig 5.</strong> Boxplots illustrating the future trends of the distribution of the chosen subset of models for: (a) the 'SU' index and (b) the 'TX90p' index. The distribution is created by considering spatially averaged trends across Europe. The ensemble mean and the ensemble median trends are both included. Outliers in the distribution are denoted by a grey circle with a black contour.</p>
</div></section>
<section id="results-summary-and-discussion">
<span id="climate-projections-cmip6-climate-and-weather-extremes-q02-section-3-5"></span><h4>3.5. Results summary and discussion<a class="headerlink" href="#results-summary-and-discussion" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p>What do the results mean for users?  Are the biases from the historical assessment (“CMIP6 Climate Projections: evaluating bias in extreme temperature indices for the reinsurance sector”) relevant?</p>
<ul>
<li><p>The projected increase in summer days and days above the 90th percentile offers valuable insights for some applications like developing strategies to optimise reinsurance protections from 2015-2099. While all considered models show a positive trend for these indices, the magnitude of these trends and their uncertainty (quantified by the inter-model spread) vary spatially, emphasising the need for careful interpretation.</p></li>
<li><p>Additionally, biases identified in these models during the historical period (1971-2000), as reviewed in “CMIP6 Climate Projections: evaluating bias in extreme temperature indices for the reinsurance sector”, should be accounted for before using these results. This evaluation highlighted an overall underestimation of trends and climatology for ‘SU’, along with challenges in accurately representing spatial distribution, particularly over regions with complex orography.</p></li>
</ul>
</li>
<li><p>For the selected subset of models, the ‘SU’ index indicates near-zero trends in the southern Mediterranean Basin and northernmost Europe. This disparity may stem from northern Europe rarely reaching the 25°C threshold required for summer days, while the southern Mediterranean consistently exceeds this threshold throughout the JJA season. This underscores the need for a comprehensive assessment using both statistically (‘SU’ index) and physically-based extreme indices (‘TX90p’ index).</p></li>
<li><p>Regional differences in ‘TX90p’ reveal higher values in the southern half of Europe. This regional differences are better appreciated in another assessment using CORDEX Regional Climate Models data (“CORDEX Climate projections: evaluating uncertainty in projected changes in extreme temperature indices for the reinsurance sector.”).</p></li>
<li><p>Boxplots display spatially averaged positive trends across Europe. The ensemble median trend for the ‘SU’ index is approximately 2 days per decade, similar to ERA5 data from 1971 to 2000. For the ‘TX90p’ index, the ensemble median trend is around 6.5 days per decade. The interquantile range spans from 1.7 to 2.25 days per decade for ‘SU’ and from 6 to 7 days per decade for ‘TX90p’.</p></li>
</ul>
<p><a id='RESULTS NOTE'></a></p>
<div class="alert alert-block alert-warning">  
<b>RESULTS NOTE</b>:<br> 
It is important to note that the results presented are specific to the 16 models chosen, and users should aim to assess as wide a range of models as possible before making a sub-selection.</section>
</section>
</section>
<section id="i-if-you-want-to-know-more">
<h2>ℹ️ If you want to know more<a class="headerlink" href="#i-if-you-want-to-know-more" title="Link to this heading">#</a></h2>
<section id="key-resources">
<h3>Key resources<a class="headerlink" href="#key-resources" title="Link to this heading">#</a></h3>
<p>Some key resources and further reading were linked throughout this assessment.</p>
<p>The CDS catalogue entries for the data used were:</p>
<ul class="simple">
<li><p>CMIP6 climate projections (Daily - Daily maximum near-surface air temperature): <a class="reference external" href="https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview" rel="noreferrer" target="_blank">https://cds.climate.copernicus.eu/datasets/projections-cmip6?tab=overview</a></p></li>
</ul>
<p>Code libraries used:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/bopen/c3s-eqc-automatic-quality-control/tree/main/c3s_eqc_automatic_quality_control" rel="noreferrer" target="_blank">C3S EQC custom functions</a>, <code class="docutils literal notranslate"><span class="pre">c3s_eqc_automatic_quality_control</span></code>,  prepared by <a class="reference external" href="https://www.bopen.eu/" rel="noreferrer" target="_blank">B-Open</a></p></li>
<li><p><a class="reference external" href="https://icclim.readthedocs.io/en/stable/" rel="noreferrer" target="_blank">icclim</a> Python package</p></li>
</ul>
</section>
<section id="references">
<h3>References<a class="headerlink" href="#references" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="https://doi.org/10.3390/atmos11020146" rel="noreferrer" target="_blank">[1]</a> Tesselaar, M., Botzen, W.J.W., Aerts, J.C.J.H. (2020). Impacts of Climate Change and Remote Natural Catastrophes on EU Flood Insurance Markets: An Analysis of Soft and Hard Reinsurance Markets for Flood Coverage. Atmosphere 2020, 11, 146. <a class="reference external" href="https://doi.org/10.3390/atmos11020146" rel="noreferrer" target="_blank">https://doi.org/10.3390/atmos11020146</a></p>
<p><a class="reference external" href="https://doi.org/10.5194/nhess-22-659-2022" rel="noreferrer" target="_blank">[2]</a> Rädler, A. T. (2022). Invited perspectives: how does climate change affect the risk of natural hazards? Challenges and step changes from the reinsurance perspective. Nat. Hazards Earth Syst. Sci., 22, 659–664. <a class="reference external" href="https://doi.org/10.5194/nhess-22-659-2022" rel="noreferrer" target="_blank">https://doi.org/10.5194/nhess-22-659-2022</a></p>
<p><a class="reference external" href="https://www.ipcc.ch/site/assets/uploads/2018/03/wg2TARchap8.pdf" rel="noreferrer" target="_blank">[3]</a> Vellinga, P., Mills, E., Bowers, L., Berz, G.A., Huq, S., Kozak, L.M., Paultikof, J., Schanzenbacker, B., Shida, S., Soler, G., Benson, C., Bidan, P., Bruce, J.W., Huyck, P.M., Lemcke, G., Peara, A., Radevsky, R., Schoubroeck, C.V., Dlugolecki, A.F. (2001). Insurance and other financial services. In J. J. McCarthy, O. F. Canziani, N. A. Leary, D. J. Dokken, &amp; K. S. White (Eds.), Climate change 2001: impacts, adaptation, and vulnerability. Contribution of working group 2 to the third assessment report of the intergovernmental panel on climate change. (pp. 417-450). Cambridge University Press.</p>
<p><a class="reference external" href="https://doi.org/10.1002/wcc.71" rel="noreferrer" target="_blank">[4]</a> Lemos, M.C. and Rood, R.B. (2010). Climate projections and their impact on policy and practice. WIREs Clim Chg, 1: 670-682. <a class="reference external" href="https://doi.org/10.1002/wcc.71" rel="noreferrer" target="_blank">https://doi.org/10.1002/wcc.71</a></p>
<p><a class="reference external" href="https://doi.org/10.1002/wcc.579" rel="noreferrer" target="_blank">[5]</a> Nissan H, Goddard L, de Perez EC, et al. (2019). On the use and misuse of climate change projections in international development. WIREs Clim Change, 10:e579. <a class="reference external" href="https://doi.org/10.1002/wcc.579" rel="noreferrer" target="_blank">https://doi.org/10.1002/wcc.579</a></p>
<p><a class="reference external" href="https://doi.org/10.5194/esd-13-321-2022" rel="noreferrer" target="_blank">[6]</a> Cos, J., Doblas-Reyes, F., Jury, M., Marcos, R., Bretonnière, P.-A., and Samsó, M. (2022). The Mediterranean climate change hotspot in the CMIP5 and CMIP6 projections, Earth Syst. Dynam., 13, 321–340. <a class="reference external" href="https://doi.org/10.5194/esd-13-321-2022" rel="noreferrer" target="_blank">https://doi.org/10.5194/esd-13-321-2022</a></p>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./Climate_Projections/CMIP6"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="climate_projections-cmip6_climate-and-weather-extremes_q01.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5.1.1. </span>Bias in extreme temperature indices for the reinsurance sector</p>
      </div>
    </a>
    <a class="right-next"
       href="climate_projections-cmip6_climate-and-weather-extremes_q03.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">5.1.3. </span>Uncertainty in projected changes in extreme temperature indices at a 2°C Global Warming Level for the reinsurance sector</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#use-case-defining-a-strategy-to-optimise-reinsurance-protections">🌍 Use case: Defining a strategy to optimise reinsurance protections</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-question">❓ Quality assessment question</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quality-assessment-statement">📢 Quality assessment statement</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#methodology">📋 Methodology</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#analysis-and-results">📈 Analysis and results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-requests-and-functions-definition">1. Parameters, requests and functions definition</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-packages">1.1. Import packages</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-parameters">1.2. Define Parameters</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-models">1.3. Define models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-land-sea-mask-request">1.4. Define land-sea mask request</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-model-requests">1.5. Define model requests</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#functions-to-cache">1.6. Functions to cache</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-and-processing">2. Downloading and processing</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-the-regridding-model">2.1. Download and transform the regridding model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-transform-models">2.2. Download and transform models</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#apply-land-sea-mask-change-attributes-and-cut-the-region-to-show">2.3. Apply land-sea mask, change attributes and cut the region to show</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-and-describe-results">3. Plot and describe results</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#define-plotting-functions">3.1. Define plotting functions</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-ensemble-maps">3.2. Plot ensemble maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-model-maps">3.3. Plot model maps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#boxplots-of-the-future-trend">3.4. Boxplots of the future trend</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#results-summary-and-discussion">3.5. Results summary and discussion</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#i-if-you-want-to-know-more">ℹ️ If you want to know more</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#key-resources">Key resources</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#references">References</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By the Copernicus Climate Change Service (C3S), entrusted to ECMWF (European Centre for Medium-Range Weather Forecasts)
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>